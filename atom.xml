<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jack Wang Blog</title>
  <subtitle>Goals determine what you are going to be</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yfshare.github.io/"/>
  <updated>2017-07-15T05:53:05.197Z</updated>
  <id>https://yfshare.github.io/</id>
  
  <author>
    <name>Jack Wang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>怎么在Linux划分大磁盘分区</title>
    <link href="https://yfshare.github.io/2017/07/15/%E6%80%8E%E4%B9%88%E5%9C%A8Linux%E5%88%92%E5%88%86%E5%A4%A7%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/"/>
    <id>https://yfshare.github.io/2017/07/15/怎么在Linux划分大磁盘分区/</id>
    <published>2017-07-15T05:35:28.000Z</published>
    <updated>2017-07-15T05:53:05.197Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>前几天收到需求，在阿里云上购买5台服务器，配置为32G,8核,3T<br>问题主要是卡在这里，阿里云的公共镜像里 Centos 7.3 默认为 EXT4 文件系统，和官方的不同，官网默认文件系统为 XFS 。而 EXT4 文件系统默认最大只支持最大分区为2TB，这里有3TB，如果用 EXT4 文件系统，就表示剩余的1TB空间会被浪费…  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@bigdata1 ~]<span class="comment"># fdisk -l /dev/vdb </span></div><div class="line"></div><div class="line">Disk /dev/vdb: 3298.5 GB, 3298534883328 bytes, 6442450944 sectors</div><div class="line">Units = sectors of 1 * 512 = 512 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line"></div><div class="line">[root@bigdata1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>这时默认的fdisk分区工具将无法使用了，因为它不能满足我们的需求，这里就需要用到 parted 分区工具了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#分区命令</span></div><div class="line">parted /dev/vdb</div><div class="line">mklabel</div><div class="line">gpt</div><div class="line">mkpart</div><div class="line"></div><div class="line">xfs</div><div class="line">0G</div><div class="line">3299GB</div><div class="line">p</div><div class="line">quit</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">[root@bigdata1 ~]<span class="comment"># parted /dev/vdb </span></div><div class="line">GNU Parted 3.1</div><div class="line">Using /dev/vdb</div><div class="line">Welcome to GNU Parted! Type <span class="string">'help'</span> to view a list of commands.</div><div class="line">(parted) p                                                                </div><div class="line">Error: /dev/vdb: unrecognised disk label</div><div class="line">Model: Virtio Block Device (virtblk)                                      </div><div class="line">Disk /dev/vdb: 3299GB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: unknown</div><div class="line">Disk Flags: </div><div class="line">(parted) <span class="built_in">help</span>                                                             </div><div class="line">  align-check TYPE N                        check partition N <span class="keyword">for</span> TYPE(min|opt) alignment</div><div class="line">  <span class="built_in">help</span> [COMMAND]                           <span class="built_in">print</span> general <span class="built_in">help</span>, or <span class="built_in">help</span> on COMMAND</div><div class="line">  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)</div><div class="line">  mkpart PART-TYPE [FS-TYPE] START END     make a partition</div><div class="line">  name NUMBER NAME                         name partition NUMBER as NAME</div><div class="line">  <span class="built_in">print</span> [devices|free|list,all|NUMBER]     display the partition table, available devices, free space, all found</div><div class="line">        partitions, or a particular partition</div><div class="line">  quit                                     <span class="built_in">exit</span> program</div><div class="line">  rescue START END                         rescue a lost partition near START and END</div><div class="line">  rm NUMBER                                delete partition NUMBER</div><div class="line">  select DEVICE                            choose the device to edit</div><div class="line">  disk_set FLAG STATE                      change the FLAG on selected device</div><div class="line">  disk_toggle [FLAG]                       toggle the state of FLAG on selected device</div><div class="line">  <span class="built_in">set</span> NUMBER FLAG STATE                    change the FLAG on partition NUMBER</div><div class="line">  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition NUMBER</div><div class="line">  unit UNIT                                <span class="built_in">set</span> the default unit to UNIT</div><div class="line">  version                                  display the version number and copyright information of GNU Parted</div><div class="line">(parted) mklabel                                                          </div><div class="line">New disk label <span class="built_in">type</span>? gpt                                                  </div><div class="line">(parted) p                                                                </div><div class="line">Model: Virtio Block Device (virtblk)</div><div class="line">Disk /dev/vdb: 3299GB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: gpt</div><div class="line">Disk Flags: </div><div class="line"></div><div class="line">Number  Start  End  Size  File system  Name  Flags</div><div class="line"></div><div class="line">(parted) mkpart                                                           </div><div class="line">Partition name?  []? ?                                                    </div><div class="line">File system <span class="built_in">type</span>?  [ext2]? xfs</div><div class="line">Start? 0G                                                                 </div><div class="line">End? 3299GB                                                               </div><div class="line">(parted) p                                                                </div><div class="line">Model: Virtio Block Device (virtblk)</div><div class="line">Disk /dev/vdb: 3299GB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: gpt</div><div class="line">Disk Flags: </div><div class="line"></div><div class="line">Number  Start   End     Size    File system  Name  Flags</div><div class="line"> 1      1049kB  3299GB  3299GB               ?</div><div class="line"></div><div class="line">(parted) quit                                                             </div><div class="line">Information: You may need to update /etc/fstab.</div><div class="line"></div><div class="line">[root@bigdata1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>然后格式化为 xfs 文件系统后挂载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@bigdata1 ~]<span class="comment"># mkfs.xfs /dev/vdb1 </span></div><div class="line">meta-data=/dev/vdb1              isize=512    agcount=4, agsize=201326464 blks</div><div class="line">         =                       sectsz=512   attr=2, projid32bit=1</div><div class="line">         =                       crc=1        finobt=0, sparse=0</div><div class="line">data     =                       bsize=4096   blocks=805305856, imaxpct=5</div><div class="line">         =                       sunit=0      swidth=0 blks</div><div class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</div><div class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=393215, version=2</div><div class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</div><div class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</div><div class="line">[root@bigdata1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@bigdata1 ~]<span class="comment"># blkid /dev/vdb1</span></div><div class="line">/dev/vdb1: UUID=<span class="string">"32687403-bcc8-425f-8544-ddf710186d53"</span> TYPE=<span class="string">"xfs"</span> PARTLABEL=<span class="string">"?"</span> PARTUUID=<span class="string">"580a257e-18e2-4d57-99cf-b5be5b6</span></div><div class="line">9557a" [root@bigdata1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@bigdata1 ~]<span class="comment"># mkdir /data</span></div><div class="line">[root@bigdata1 ~]<span class="comment"># tail -1 /etc/fstab </span></div><div class="line">UUID=<span class="string">"32687403-bcc8-425f-8544-ddf710186d53"</span>	/data		xfs	defaults	0 0</div><div class="line">[root@bigdata1 ~]<span class="comment"># mount -a</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@bigdata1 ~]<span class="comment"># fdisk -l /dev/vdb</span></div><div class="line">WARNING: fdisk GPT support is currently new, and therefore <span class="keyword">in</span> an experimental phase. Use at your own discretion.</div><div class="line"></div><div class="line">Disk /dev/vdb: 3298.5 GB, 3298534883328 bytes, 6442450944 sectors</div><div class="line">Units = sectors of 1 * 512 = 512 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk label <span class="built_in">type</span>: gpt</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#         Start          End    Size  Type            Name</span></div><div class="line"> 1         2048   6442448895      3T  Microsoft basic ?</div><div class="line">[root@bigdata1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@bigdata1 ~]<span class="comment"># df -T /dev/vdb1 </span></div><div class="line">Filesystem     Type  1K-blocks  Used  Available Use% Mounted on</div><div class="line">/dev/vdb1      xfs  3219650564 32944 3219617620   1% /data</div><div class="line">[root@bigdata1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>这时我们就可以在 Centos 7.3(默认为ext4)上使用大磁盘了(超过2TB)  </p>
<p>参考：<a href="https://help.aliyun.com/document_detail/34377.html" target="_blank" rel="external">https://help.aliyun.com/document_detail/34377.html</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/07/15/怎么在Linux划分大磁盘分区/">https://yfshare.github.io/2017/07/15/怎么在Linux划分大磁盘分区/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;script src=&quot;/assets/js/DPlayer.min.js&quot;&gt; &lt;/script&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;前几天收到需求，在阿里云上购买5台服务器，配置为32G,8核,3T&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://yfshare.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://yfshare.github.io/tags/Linux/"/>
    
      <category term="大磁盘分区" scheme="https://yfshare.github.io/tags/%E5%A4%A7%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/"/>
    
      <category term="ext4" scheme="https://yfshare.github.io/tags/ext4/"/>
    
      <category term="xfs" scheme="https://yfshare.github.io/tags/xfs/"/>
    
  </entry>
  
  <entry>
    <title>部署wordpress</title>
    <link href="https://yfshare.github.io/2017/06/25/%E9%83%A8%E7%BD%B2wordpress/"/>
    <id>https://yfshare.github.io/2017/06/25/部署wordpress/</id>
    <published>2017-06-25T02:52:45.000Z</published>
    <updated>2017-06-25T02:55:01.243Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>WordPress是一种使用PHP语言开发的博客平台，用户可以在支持PHP和MySQL数据库的服务器上架设属于自己的网站。也可以把 WordPress当作一个内容管理系统（CMS）来使用. WordPress是一款个人博客系统，并逐步演化成一款内容管理系统软件<br><a id="more"></a><br>官网：<a href="https://wordpress.org/" target="_blank" rel="external">https://wordpress.org/</a><br>官方文档：<a href="https://codex.wordpress.org/Main_Page" target="_blank" rel="external">https://codex.wordpress.org/Main_Page</a><br>wordpress最新版下载(目前最新版是4.8)：<a href="https://wordpress.org/latest.tar.gz" target="_blank" rel="external">https://wordpress.org/latest.tar.gz</a><br>wordpress安装要求：<a href="https://wordpress.org/about/requirements/" target="_blank" rel="external">https://wordpress.org/about/requirements/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#wordpress 4.8系统安装要求</span></div><div class="line">php version &gt;= 7</div><div class="line">mysql version &gt;=5.6 or MariaDB version &gt;= 10.0</div><div class="line">https support</div></pre></td></tr></table></figure></p>
<p>官方安装文档：<a href="https://codex.wordpress.org/Installing_WordPress#Famous_5-Minute_Install" target="_blank" rel="external">https://codex.wordpress.org/Installing_WordPress#Famous_5-Minute_Install</a>  </p>
<h2 id="安装LNMP环境"><a href="#安装LNMP环境" class="headerlink" title="安装LNMP环境"></a>安装LNMP环境</h2><p>环境：<br>　　　Centos 7.3<br>　　　wordpress version 4.8<br>　　　mysql version 5.6.36<br>　　　php version 7.1.5<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install mysql-community-server mysql-community-client</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl start mysql</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl list-unit-files | grep -i mysql</span></div><div class="line">mysql.service                               enabled </div><div class="line">mysqld.service                              enabled </div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#更新yum源</span></div><div class="line">[root@localhost ~]<span class="comment"># rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span></div><div class="line">[root@localhost ~]<span class="comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span></div><div class="line"><span class="comment">#安装php71</span></div><div class="line">[root@localhost ~]<span class="comment"># yum install php71w-fpm php71w-devel php71w-gd php71w-imap php71w-mysql php71w-odbc</span></div><div class="line"><span class="comment">#安装nginx1.12.0-1.w7</span></div><div class="line">[root@localhost ~]<span class="comment"># yum install nginx1w</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># systemctl start php-fpm</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl enable php-fpm</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl start nginx</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl enable nginx</span></div></pre></td></tr></table></figure></p>
<h2 id="安装wordpress"><a href="#安装wordpress" class="headerlink" title="安装wordpress"></a>安装wordpress</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#官方只提供最新版下载，本文附件会提供wordpress-4.8下载</span></div><div class="line">[root@localhost ~]<span class="comment"># wget https://wordpress.org/latest.tar.gz -O wordpress-4.8.tar.gz</span></div><div class="line">[root@localhost ~]<span class="comment"># tar -zxf wordpress-4.8.tar.gz -C /usr/local/</span></div></pre></td></tr></table></figure>
<p>配置nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /etc/nginx/conf.d/</span></div><div class="line">[root@localhost conf.d]<span class="comment"># cat wordpress.conf </span></div><div class="line">server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  192.168.1.199;</div><div class="line">	    root  /usr/<span class="built_in">local</span>;</div><div class="line"></div><div class="line">        location /wordpress &#123;</div><div class="line">		index index.php;</div><div class="line">        access_log  /var/<span class="built_in">log</span>/nginx/host_wordpress.access.log  main;</div><div class="line">		try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$args</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">	    location /info &#123;</div><div class="line">	    	index index.php;</div><div class="line">	    	try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$args</span>;</div><div class="line">	    &#125;</div><div class="line"></div><div class="line">        error_page  404              /404.html;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line"></div><div class="line">	    location ~ ^(.+.php)(.*)$ &#123;</div><div class="line">                fastcgi_split_path_info ^(.+.php)(.*)$;</div><div class="line">                include fastcgi.conf;</div><div class="line">                fastcgi_pass  127.0.0.1:9000;</div><div class="line">                fastcgi_index index.php;</div><div class="line">                fastcgi_param  PATH_INFO          <span class="variable">$fastcgi_path_info</span>;</div><div class="line">	    &#125;</div><div class="line">&#125;</div><div class="line">[root@localhost conf.d]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost conf.d]<span class="comment"># nginx -t</span></div><div class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</div><div class="line">[root@localhost conf.d]<span class="comment"># systemctl reload nginx</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># curl -I http://192.168.1.199/info</span></div><div class="line">[root@localhost ~]<span class="comment"># curl -I http://192.168.1.199/wordpress</span></div></pre></td></tr></table></figure></p>
<p>访问<a href="http://ip/info" target="_blank" rel="external">http://ip/info</a><br><img src="http://note.youdao.com/yws/api/personal/file/E7B92FD10C5A49A39FC9A4A8D462A8AE?method=download&amp;shareKey=42942e0a0e65757aa79d3c3b7d15cf7e" alt="php_info">  </p>
<p>访问<a href="http://ip/wordpress" target="_blank" rel="external">http://ip/wordpress</a><br><img src="http://note.youdao.com/yws/api/personal/file/9B00896C67B548A581D17F957C0C57BF?method=download&amp;shareKey=207e4808d4a05758f9735defc1e5e8d2" alt="wordpress_setup"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#创建mysql库wordpress</span></div><div class="line">mysql&gt; create database wordpress DEFAULT CHARACTER SET utf8;</div><div class="line">mysql&gt; create user wordpress_user identified by <span class="string">'wordpress_pass'</span>;</div><div class="line">mysql&gt; grant all privileges on wordpress.* TO <span class="string">'wordpress_user'</span>;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /usr/local/wordpress</span></div><div class="line">[root@localhost wordpress]<span class="comment"># cp wp-config-sample.php wp-config.php</span></div></pre></td></tr></table></figure>
<p>如果打开时报这个错误，是因为没有正确在 wp-config.php 配置mysql数据库连接信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error establishing a database connection</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost wordpress]<span class="comment"># grep -i '^define' wp-config.php | grep -i 'db'</span></div><div class="line">define(<span class="string">'DB_NAME'</span>, <span class="string">'wordpress'</span>);</div><div class="line">define(<span class="string">'DB_USER'</span>, <span class="string">'wordpress_user'</span>);</div><div class="line">define(<span class="string">'DB_PASSWORD'</span>, <span class="string">'wordpress_pass'</span>);</div><div class="line">define(<span class="string">'DB_HOST'</span>, <span class="string">'192.168.1.199'</span>);</div><div class="line">define(<span class="string">'DB_CHARSET'</span>, <span class="string">'utf8'</span>);</div><div class="line">define(<span class="string">'DB_COLLATE'</span>, <span class="string">''</span>);</div><div class="line">[root@localhost wordpress]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/DAED3746D98F40F58B263B5CD03A3D1B?method=download&amp;shareKey=79e096e183c5ecd255ebe4bcbfccfe8a" alt="wordpress_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/AA1A6476AB314A8AA692FDD8393F4727?method=download&amp;shareKey=2fb2dc9a5c38f1253b8a984832079e8f" alt="wordpress_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/0FDD8E0F04A54865B7EC69388D480F32?method=download&amp;shareKey=a0d006cd9026dfe508fdcc41e316d68e" alt="wordpress_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/E7F1ECC0F00F46368F930FF903B3C288?method=download&amp;shareKey=8fb3db6d436e4ad9dd767dc712048a63" alt="wordpress_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/94A079CC6FEC457FBC26D4B283D460AB?method=download&amp;shareKey=68531e8abc3169d32bbc44a395d5681f" alt="wordpress_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/61B09A80BA024991A7B69C9F26DD5806?method=download&amp;shareKey=657dc0db9545feb26d9090b0a9eb5865" alt="wordpress_setup">  </p>
<p>Wordpress安装成功  </p>
<p>附件：<br><a href="http://note.youdao.com/yws/api/personal/file/EA86652A437B401E89779A59BDB9C277?method=download&amp;shareKey=b37e6799aeaaaa2335bfa0db132320cf" target="_blank" rel="external">wordpress-4.8.tar.gz</a><br><a href="http://note.youdao.com/yws/api/personal/file/48771A01FF8541C0B580B5CC944FF2E7?method=download&amp;shareKey=57c1dcff158b802afd0a65d51d83eb94" target="_blank" rel="external">mysql57-community-release-el7-11.noarch.rpm</a><br>此mysql yum源安装后，修改mysql-community.repo即可</p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/25/部署wordpress/">https://yfshare.github.io/2017/06/25/部署wordpress/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;WordPress是一种使用PHP语言开发的博客平台，用户可以在支持PHP和MySQL数据库的服务器上架设属于自己的网站。也可以把 WordPress当作一个内容管理系统（CMS）来使用. WordPress是一款个人博客系统，并逐步演化成一款内容管理系统软件&lt;br&gt;
    
    </summary>
    
      <category term="WEB" scheme="https://yfshare.github.io/categories/WEB/"/>
    
    
      <category term="wordpress" scheme="https://yfshare.github.io/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>部署atlassian-confluence 6.1.2</title>
    <link href="https://yfshare.github.io/2017/06/25/%E9%83%A8%E7%BD%B2atlassian-confluence-6-1-2/"/>
    <id>https://yfshare.github.io/2017/06/25/部署atlassian-confluence-6-1-2/</id>
    <published>2017-06-25T02:37:27.000Z</published>
    <updated>2017-06-25T02:50:57.619Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>AtlassianConfluence（简称Confluence）是一个专业的wiki程序。它是一个知识管理的工具，通过它可以实现团队成员之间的协作和知识共享。Confluence不是一个开源软件，非商业用途可以免费使用<br>Confluence使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息，文档协作，集体讨论。 目前，Confluence被用于广泛地用于项目团队，开发团队，市场销售团队<br><a id="more"></a></p>
<p>首页：<a href="https://www.atlassian.com/" target="_blank" rel="external">https://www.atlassian.com/</a><br>　　　<a href="https://www.atlassian.com/software/confluence" target="_blank" rel="external">https://www.atlassian.com/software/confluence</a>  </p>
<p>atlassian-confluence各版本下载地址(截至到目前最新版是6.2.2)：<a href="https://www.atlassian.com/software/confluence/download-archives" target="_blank" rel="external">https://www.atlassian.com/software/confluence/download-archives</a>  </p>
<p>6.1.2系统配置要求官方文档：<br><a href="https://confluence.atlassian.com/conf61/system-requirements-877188692.html" target="_blank" rel="external">https://confluence.atlassian.com/conf61/system-requirements-877188692.html</a><br><a href="https://confluence.atlassian.com/conf61/supported-platforms-877188781.html" target="_blank" rel="external">https://confluence.atlassian.com/conf61/supported-platforms-877188781.html</a>  </p>
<p>confluence 6.1.2官方帮助文档：<a href="https://confluence.atlassian.com/conf61/getting-help-and-support-877188789.html" target="_blank" rel="external">https://confluence.atlassian.com/conf61/getting-help-and-support-877188789.html</a>  </p>
<p>附件：<br>下载atlassian-confluence-6.1.2-x64.bin<br><a href="https://downloads.atlassian.com/software/confluence/downloads/atlassian-confluence-6.1.2-x64.bin" target="_blank" rel="external">confluence-6.1.2 for linux官网下载</a><br><a href="http://pan.baidu.com/s/1i4Tp37Z" target="_blank" rel="external">confluence-6.1.2 for linux百度网盘下载，密码：izdr</a><br><a href="http://pan.baidu.com/s/1jHS4VPW" target="_blank" rel="external">jdk-8u20百度网盘下载，密码：9p4g</a>  </p>
<h2 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h2><p>环境：<br>　　　Centos 6.6<br>　　　Mysql version 5.6.36<br>　　　JIRA 7.2.2<br>　　　atlassian-confluence 6.1.2  </p>
<p>服务器内存建议大于3G<br>说明，目前已经成功安装JIRA<br>安装confluence 6.1.2所需要的系统配置：<a href="https://confluence.atlassian.com/conf61/supported-platforms-877188781.html" target="_blank" rel="external">https://confluence.atlassian.com/conf61/supported-platforms-877188781.html</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装confluence对环境的要求</span></div><div class="line">Mysql = 5.6(但不要用5.6.16之前的版本)</div><div class="line">JDK = 1.8</div><div class="line">    ≠ Java 1.8.0_25 and 1.8.0_31 and Java 1.8.0_45</div><div class="line">Tomcat = 8.0.x</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#官方关于JAVA环境的说明</span></div><div class="line"><span class="comment">#这里安装的atlassian-confluence-6.1.2-x64.bin文件，不需要手动安装JRE环境</span></div><div class="line">Java</div><div class="line">The Java Runtime Environment (JRE) is packed up and ready to go when you install Confluence using the Windows or Linux installer. You don<span class="string">'t need to install Java yourself. </span></div><div class="line">If you choose to install Confluence from an archive file, you'll need a supported JRE or JDK, and your JAVA_HOME variable <span class="built_in">set</span> correctly. See Installing Java <span class="keyword">for</span> Confluence <span class="keyword">for</span> more information.</div></pre></td></tr></table></figure>
<p>Confluence安装前准备，如果是生产使用需要用到外部的数据库，这里我们选择安装Mysql  </p>
<p>注：如果当前系统有安装JIRA，则Mysql安装相关配置可省略<br>Mysql 5.6 Yum源(rpm)：<a href="http://note.youdao.com/yws/api/personal/file/9F81786CBC5748E69B2F34FC7BE160D6?method=download&amp;shareKey=aca90d80731cf2a892d421787e401289" target="_blank" rel="external">点击下载</a><br>Confluence 6.1.2关于Mysql的配置参考：<a href="https://confluence.atlassian.com/conf61/database-setup-for-mysql-877188444.html" target="_blank" rel="external">https://confluence.atlassian.com/conf61/database-setup-for-mysql-877188444.html</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm</span></div><div class="line">[root@localhost ~]<span class="comment"># yum -y install mysql-community-server.x86_64 mysql-community-devel.x86_64 mysql-community-client.x86_64</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/mysqld start</span></div><div class="line">[root@localhost ~]<span class="comment"># /usr/bin/mysqladmin -u root password '123456'</span></div><div class="line">[root@localhost ~]<span class="comment"># chkconfig mysqld on</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># grep -iA6 confluence /etc/my.cnf </span></div><div class="line">[mysqld]</div><div class="line">...</div><div class="line"><span class="comment">#confluence configure</span></div><div class="line">character-set-server=utf8</div><div class="line">collation-server=utf8_bin</div><div class="line">default-storage-engine=INNODB</div><div class="line">max_allowed_packet=256M</div><div class="line">innodb_log_file_size=2GB</div><div class="line">transaction-isolation=READ-COMMITTED</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/mysqld restart</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Mysql初始化</span></div><div class="line">[root@localhost ~]<span class="comment"># mysql -uroot -p123456</span></div><div class="line">mysql&gt; CREATE DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin;</div><div class="line">mysql&gt; GRANT ALL PRIVILEGES ON confluence.* TO <span class="string">'confluenceuser'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'confluencepass'</span>;</div><div class="line">mysql&gt; GRANT ALL PRIVILEGES ON confluence.* TO <span class="string">'confluenceuser'</span>@<span class="string">'192.168.1.%'</span> IDENTIFIED BY <span class="string">'confluencepass'</span>;</div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div><div class="line">mysql&gt; \q</div><div class="line">Bye</div><div class="line">[root@localhost ~]<span class="comment"># mysql -V</span></div><div class="line">mysql  Ver 14.14 Distrib 5.6.36, <span class="keyword">for</span> Linux (x86_64) using  EditLine wrapper</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="安装并破解atlassian-confluence-6-1-2"><a href="#安装并破解atlassian-confluence-6-1-2" class="headerlink" title="安装并破解atlassian-confluence 6.1.2"></a>安装并破解atlassian-confluence 6.1.2</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#atlassian-confluence 没有加到chkconfig里，不能开机启动</span></div><div class="line">[root@localhost ~]<span class="comment"># chmod +x atlassian-confluence-6.1.2-x64.bin</span></div><div class="line">[root@localhost ~]<span class="comment"># ./atlassian-confluence-6.1.2-x64.bin </span></div><div class="line">Unpacking JRE ...</div><div class="line">Starting Installer ...</div><div class="line"></div><div class="line">This will install Confluence 6.1.2 on your computer.</div><div class="line">OK [o, Enter], Cancel [c]</div><div class="line">o</div><div class="line">Choose the appropriate installation or upgrade option.</div><div class="line">Please choose one of the following:</div><div class="line">Express Install (uses default settings) [1], </div><div class="line">Custom Install (recommended <span class="keyword">for</span> advanced users) [2, Enter], </div><div class="line">Upgrade an existing Confluence installation [3]</div><div class="line">1</div><div class="line">See <span class="built_in">where</span> Confluence will be installed and the settings that will be used.</div><div class="line">Installation Directory: /opt/atlassian/confluence </div><div class="line">Home Directory: /var/atlassian/application-data/confluence </div><div class="line">HTTP Port: 8090 </div><div class="line">RMI Port: 8000 </div><div class="line">Install as service: Yes </div><div class="line">Install [i, Enter], Exit [e]</div><div class="line">i</div><div class="line"></div><div class="line">Extracting files ...</div><div class="line"></div><div class="line">Please <span class="built_in">wait</span> a few moments <span class="keyword">while</span> we configure Confluence.</div><div class="line">Installation of Confluence 6.1.2 is complete</div><div class="line">Start Confluence now?</div><div class="line">Yes [y, Enter], No [n]</div><div class="line">y</div><div class="line"></div><div class="line">Please <span class="built_in">wait</span> a few moments <span class="keyword">while</span> Confluence starts up.</div><div class="line">Launching Confluence ...</div><div class="line">Installation of Confluence 6.1.2 is complete</div><div class="line">Your installation of Confluence 6.1.2 is now ready and can be accessed via</div><div class="line">your browser.</div><div class="line">Confluence 6.1.2 can be accessed at http://localhost:8090</div><div class="line">Finishing installation ...</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># netstat -tunlp | grep 8090</span></div><div class="line">tcp        0      0 :::8090                     :::*                        LISTEN      14529/java          </div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#破解atlassian-confluence 6.1.2</span></div><div class="line"><span class="comment">#替换 atlassian-extras-decoder-v2-3.2.jar 和 atlassian-universal-plugin-manager-plugin-2.22.1.jar 这两个文件</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/confluence stop</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /opt/atlassian/confluence/confluence/WEB-INF/lib</span></div><div class="line"><span class="comment">#备份，仅限个人使用勿用于商业</span></div><div class="line">[root@localhost lib]<span class="comment"># cp atlassian-extras-decoder-v2-3.2.jar ~</span></div><div class="line"></div><div class="line"><span class="comment">#上传破解文件</span></div><div class="line">[root@localhost lib]<span class="comment"># ll atlassian-extras-decoder-v2-3.2.jar</span></div><div class="line">-rw-r--r-- 1 confluence confluence 8321 Jun 24 17:59 atlassian-extras-decoder-v2-3.2.jar</div><div class="line">[root@localhost lib]<span class="comment"># </span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># cd /opt/atlassian/confluence/confluence/WEB-INF/atlassian-bundled-plugins</span></div><div class="line"><span class="comment">#备份，仅限个人使用勿用于商业</span></div><div class="line">[root@localhost atlassian-bundled-plugins]<span class="comment"># cp atlassian-universal-plugin-manager-plugin-2.22.1.jar ~</span></div><div class="line"></div><div class="line"><span class="comment">#上传破解文件</span></div><div class="line">[root@localhost atlassian-bundled-plugins]<span class="comment"># ll atlassian-universal-plugin-manager-plugin-2.22.1.jar</span></div><div class="line">-rw-r--r-- 1 confluence confluence 8054971 Jun 24 17:59 atlassian-universal-plugin-manager-plugin-2.22.1.jar</div><div class="line">[root@localhost atlassian-bundled-plugins]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># chown confluence:confluence /opt/atlassian/confluence/ -R</span></div><div class="line">[root@localhost ~]<span class="comment"># chown confluence:confluence /var/atlassian/application-data/confluence/ -R</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/confluence start</span></div></pre></td></tr></table></figure>
<p>如果在打开Confluence向导配置页面出现下面错误，可以通过重启Confluence和Mysql解决<br><img src="http://note.youdao.com/yws/api/personal/file/24FD420254F74B25ADF50B1FB5AB133B?method=download&amp;shareKey=8ce860b8f5b432a376faf0286e9093f3" alt="confluence_setup_error">  </p>
<p>访问<a href="http://ip:8090打开Confluence配置页面向导" target="_blank" rel="external">http://ip:8090打开Confluence配置页面向导</a><br><img src="http://note.youdao.com/yws/api/personal/file/5010DB050FDD46F59E134A754DA66C49?method=download&amp;shareKey=923249f8ed3d81325a26d7c8889e2f83" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/18D9A75EAAC84BA6B179AE3ABC144292?method=download&amp;shareKey=5feacdc57b178708ab4785be254015c0" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/C88C03CF5236404EBF3F6C7DE656D951?method=download&amp;shareKey=064c408e1c75e4929a71f4ab456e5cb1" alt="confluence_install">  </p>
<p>如果没有Key的话，就需要我们去官网申请一个测试Key<br>申请一个测试key需要<a href="https://id.atlassian.com/login?application=mac&amp;continue=https://my.atlassian.com" target="_blank" rel="external">登录Atlassian</a>，如果没有Atlassian，则需要<a href="https://id.atlassian.com/signup?application=mac&amp;tenant=&amp;continue=" target="_blank" rel="external">注册Atlassian</a>帐号了。<em>这里可能翻墙，因为需要加载google验证码…</em>  </p>
<p>如果已有Atlassian帐号则跳过下一步<br><img src="http://note.youdao.com/yws/api/personal/file/BEDE645C4D3F4E2292A7EB285CEDE5DB?method=download&amp;shareKey=251da9366a1e1522e01ea296e865136c" alt="SignUP_Atlassian"><br><img src="http://note.youdao.com/yws/api/personal/file/92ED4D7B125B4B85B9D21E91104C0DFE?method=download&amp;shareKey=b45bfd72456ceffcf09da05cd30bd450" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/826333DD3B314B1EBFA2A121E51456D3?method=download&amp;shareKey=5fd3eefb377a6b21f6a9a4e94c2b479d" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/E875F7B88580423D84A389B955C261E5?method=download&amp;shareKey=2e9a3aa73314e56b0d141de841439cc4" alt="confluence_install"><br>然后会生成一个测试key，然后填入上图的key选项框内(一般情况下系统会自动填入)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#试用key，有效期30天，官网可以随时申请</span></div><div class="line">BHBF-LIX9-DF7P-E62M</div><div class="line">AAABJg0ODAoPeNptkF9LwzAUxd/zKQK+6ENGW/tvhYCu7bDSdsNO8cGXGG410GZbkg737U1XxSk+B</div><div class="line">C6555z7u/eiYQbfDxJ7PnaCxA0TN8ZptsGe40YoA82V2BmxlTTdyrYbQHLAlw2oA6irlwTnB9YNb</div><div class="line">BSgVMGpyJgBOtqJExLPR9waZ4wbcQBq1ADTR2OYMqBoyzoNyIYbK8krJjoaX8dB4IeOf7Pfz/i2R</div><div class="line">z9DzgJKwUFq2Bx3ULMeaLqqqvwhLW5L1E2tJ1B69HjIxkoDkln4/GMn1PGMMRoZV+qNSaGnGXWDp</div><div class="line">gWLjC7uFktSFs9zki2jNclDr0JNXlP7SDmfu2EURugLxcrLIvvVOZHWQ/8KatU+agtEifut/x9lP</div><div class="line">Sj+zjT8PeMnH9GHljAsAhQBR2B3nIotW7W/fZPdH5cO1UwcQQIUP5BxRFyS/6+Efljom+Ai9Cgm9</div><div class="line">a8=X02eq</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/CC9CB8F6E7394147BCD2650D1DC4E2E3?method=download&amp;shareKey=2898709ce9794d413dd94e1abf54df77" alt="confluence_install">  </p>
<p>如果出现下面的错误，是因为我们没有安装Mysql的驱动程序<br>关于<a href="https://confluence.atlassian.com/conf61/database-jdbc-drivers-877188428.html" target="_blank" rel="external">Mysql数据库驱动问题解决办法</a><br><img src="http://note.youdao.com/yws/api/personal/file/F46C2CF899714286BBA65BE51BBC2ADB?method=download&amp;shareKey=4dd33733d56de4588c8a7eea0a876c3a" alt="confluence_install"><br>解决办法：在Confluence的安装目录 /opt/atlassian/confluence/confluence/WEB-INF/lib/ 上传Mysql的驱动程序，并重启Confluence服务<br>Mysql驱动程序：<a href="http://note.youdao.com/yws/api/personal/file/96A36E6E887E48A4BF17B26D93404EDC?method=download&amp;shareKey=aef29732ea1e0defc22dd157ef1aca26" target="_blank" rel="external">点击下载</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /opt/atlassian/confluence/confluence/WEB-INF/lib/</span></div><div class="line">[root@localhost lib]<span class="comment"># ll mysql-connector-java-5.1.39-bin.jar </span></div><div class="line">-rw-r--r-- 1 confluence confluence 989497 Jun 24 18:37 mysql-connector-java-5.1.39-bin.jar</div><div class="line">[root@localhost lib]<span class="comment"># /etc/init.d/confluence restart</span></div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/EFF3DFF59D6B46C98EDCE9B6F54D509B?method=download&amp;shareKey=169878c51a7ac0b47e2345048ab025aa" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/29007C22DB284513AEA14ADE85F53F32?method=download&amp;shareKey=86fe76e0d36119217bf6d0d15ac79da9" alt="confluence_install"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#要配置Mysql的授权登录信息</span></div><div class="line">Driver Class Name：com.mysql.jdbc.Driver</div><div class="line">Database URL：jdbc:mysql://192.168.1.119/confluence?sessionVariables=storage_engine%3DInnoDB</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/197029A0B2A346049AC3C25AA6E7FF5F?method=download&amp;shareKey=b407d62ccd0e8db75ca7a5cab905583d" alt="confluence_install">  </p>
<p>如果出现下面的错误，就比较悲剧了，需要我们重新来过<br><img src="http://note.youdao.com/yws/api/personal/file/21B7637E8230483A820EA3C81661C7DA?method=download&amp;shareKey=800bb4fbdc255771ae1474d6395750b4" alt="confluence_install"><br>解决办法：需要删除confluence家目录的相关配置文件和缓存文件<br>参考：<a href="https://confluence.atlassian.com/confkb/confluence-installation-fails-with-set-up-step-error-java-sql-sqlsyntaxerrorexception-user-lacks-privilege-or-object-not-found-bandana-390497283.html" target="_blank" rel="external">https://confluence.atlassian.com/confkb/confluence-installation-fails-with-set-up-step-error-java-sql-sqlsyntaxerrorexception-user-lacks-privilege-or-object-not-found-bandana-390497283.html</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /var/atlassian/application-data/confluence</span></div><div class="line">[root@localhost confluence]<span class="comment"># rm -rf bundled-plugins/ plugins-cache/ plugins-osgi-cache/ plugins-temp/ database confluence.cfg.xml   #database可能没有，我这里就没有这个</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/confluence restart</span></div><div class="line">[root@localhost ~]<span class="comment"># chown confluence:confluence /opt/atlassian/ -R</span></div><div class="line">[root@localhost ~]<span class="comment"># chown confluence:confluence /var/atlassian/ -R</span></div></pre></td></tr></table></figure></p>
<p>重新来过的步骤略，直到下面这一步<br><img src="http://note.youdao.com/yws/api/personal/file/6E48754B104F47E9B6A26294525F1F8A?method=download&amp;shareKey=85cd30e5a10b336f5fc44bc92dfdfbe6" alt="confluence_install">  </p>
<p>点下一步前需要确认JIRA已经启动成功了<br><img src="http://note.youdao.com/yws/api/personal/file/CE4C8B38E4124148AFB74BC269214EB7?method=download&amp;shareKey=9429730240206336286d574b0e08361d" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/7A35B50E505E4AEFB279673FF87B6E66?method=download&amp;shareKey=cc016f54b7645a1f3f425c2f089606fb" alt="confluence_install"><br><img src="http://note.youdao.com/yws/api/personal/file/99E16A726765471BB398E77282AA21CA?method=download&amp;shareKey=bfa286b85821606e1f883d71ca4e905a" alt="confluence_install"><br>安装 atlassian-confluence 6.1.2 成功  </p>
<p>配置 atlassian-confluence 6.1.2<br><img src="http://note.youdao.com/yws/api/personal/file/178719E6241940888BD1A8CE9D738705?method=download&amp;shareKey=ff704a3505262944e34bd3c3a71558db" alt="confluence_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/3CA3D13901BF4BDA9042B212A6F721BD?method=download&amp;shareKey=b0408b3ce4903d2dbe07c5d91a1bbdde" alt="confluence_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/761984549515471C96C3C229419B1C88?method=download&amp;shareKey=d66e7b684dba58a22452abea00c6a8f2" alt="confluence_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/35157265F193450C976C4B499581E07B?method=download&amp;shareKey=27739711e361294143120d15a3872aaa" alt="confluence_setup">  </p>
<p>设置– 一般管理– 授权码细节<br><img src="http://note.youdao.com/yws/api/personal/file/BC4C48F113384AFE8C1425C61B93BD15?method=download&amp;shareKey=11e47d1f4fd91f44ffabccecbaf1e5a1" alt="confluence_setup"><br>破解成功  </p>
<h2 id="汉化atlassian-confluence-6-1-2"><a href="#汉化atlassian-confluence-6-1-2" class="headerlink" title="汉化atlassian-confluence 6.1.2"></a>汉化atlassian-confluence 6.1.2</h2><p>atlassian-confluence 6.1.2 应该是自动识别语言了，我没有做汉化操作，默认就是中文了<br>如果没有汉化的，下面是 atlassian-confluence 6.1.2 的语言包<br><a href="http://note.youdao.com/yws/api/personal/file/42A4E88F9BCD43C89057CA48AF690E62?method=download&amp;shareKey=ef26537fa975a98d1c852007deca1d6e" target="_blank" rel="external">Confluence-6.1.0-language-pack-zh_CN.jar</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#把confluence的中文语言包上传到 /opt/atlassian/confluence/confluence/WEB-INF/lib/ 这个目录然，然后重启confluence即可</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /opt/atlassian/confluence/confluence/WEB-INF/lib/</span></div><div class="line">[root@localhost lib]<span class="comment"># ll Confluence-6.1.0-language-pack-zh_CN.jar </span></div><div class="line">-rw-r--r-- 1 confluence confluence 269133 Jun 24 18:47 Confluence-6.1.0-language-pack-zh_CN.jar </div><div class="line">[root@localhost lib]<span class="comment"># /etc/init.d/confluence restart</span></div></pre></td></tr></table></figure></p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/25/部署atlassian-confluence-6-1-2/">https://yfshare.github.io/2017/06/25/部署atlassian-confluence-6-1-2/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;AtlassianConfluence（简称Confluence）是一个专业的wiki程序。它是一个知识管理的工具，通过它可以实现团队成员之间的协作和知识共享。Confluence不是一个开源软件，非商业用途可以免费使用&lt;br&gt;Confluence使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息，文档协作，集体讨论。 目前，Confluence被用于广泛地用于项目团队，开发团队，市场销售团队&lt;br&gt;
    
    </summary>
    
      <category term="Atlassian" scheme="https://yfshare.github.io/categories/Atlassian/"/>
    
    
      <category term="Atlassian" scheme="https://yfshare.github.io/tags/Atlassian/"/>
    
      <category term="Confluence" scheme="https://yfshare.github.io/tags/Confluence/"/>
    
  </entry>
  
  <entry>
    <title>Dubbo理论</title>
    <link href="https://yfshare.github.io/2017/06/21/Dubbo%E7%90%86%E8%AE%BA/"/>
    <id>https://yfshare.github.io/2017/06/21/Dubbo理论/</id>
    <published>2017-06-20T16:01:51.000Z</published>
    <updated>2017-06-20T16:05:01.331Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>DUBBO是Alibaba开源的分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，使用这种方式可以使各个层之间解耦合(或者最大限度地松耦合)。从服务模型的角度，Dubbo采用的是一种非常简单的模型，分为<strong>提供方提供服务</strong>和<strong>消费方消费服务</strong>，基于这一点可以抽象出<strong>服务提供方</strong>(Provider)和<strong>服务消费方</strong>(Consumer)两个角色<br><a id="more"></a><br>官网：<a href="http://dubbo.io/" target="_blank" rel="external">http://dubbo.io/</a><br>用户手册：<a href="http://dubbo.io/User+Guide-zh.htm" target="_blank" rel="external">http://dubbo.io/User+Guide-zh.htm</a><br>管理指南：<a href="http://dubbo.io/Administrator+Guide-zh.htm" target="_blank" rel="external">http://dubbo.io/Administrator+Guide-zh.htm</a><br>FAQ：<a href="http://dubbo.io/FAQ-zh.htm" target="_blank" rel="external">http://dubbo.io/FAQ-zh.htm</a>  </p>
<p>Dubbo总体架构图<br><img src="http://note.youdao.com/yws/api/personal/file/E36A4921C3074B4D8E75C4AF51C250B7?method=download&amp;shareKey=86c67efbb244731c612a3b9c5c8a6b95" alt="dubbo-architecture"><br>Dubbo框架设计一共划分了10个层，而最上面的 Service 层是留给实际想要使用Dubbo开发分布式服务的开发者实现业务逻辑的接口层<br>图中左边淡蓝背景的为服务消费方使用的接口，右边淡绿色背景的为服务提供方使用的接口， 位于中轴线上的为双方都用到的接口<br>结合Dubbo官方文档，整理了一下框架分层架构，各个层次的设计要点如下：  </p>
<ol>
<li>服务接口层（Service）：该层是与实际业务逻辑相关的，根据服务提供方和服务消费方的业务设计对应的接口和实现  </li>
<li>配置层（Config）：对外配置接口，以 ServiceConfig 和 ReferenceConfig 为中心，可以直接 new 配置类，也可以通过 spring 解析配置生成配置类  </li>
<li>服务代理层（Proxy）：服务接口透明代理，生成服务的客户端 Stub 和服务器端 Skeleton ，以 ServiceProxy 为中心，扩展接口为 ProxyFactory  </li>
<li>服务注册层（Registry）：封装服务地址的注册与发现，以服务URL为中心，扩展接口为 RegistryFactory 、 Registry 和 RegistryService 。可能没有服务注册中心，此时服务提供方直接暴露服务  </li>
<li>集群层（Cluster）：封装多个提供者的路由及负载均衡，并桥接注册中心，以 Invoker 为中心，扩展接口为 Cluster 、 Directory 、 Router 和 LoadBalance 。将多个服务提供方组合为一个服务提供方，实现对服务消费方来透明，只需要与一个服务提供方进行交互  </li>
<li>监控层（Monitor）：RPC调用次数和调用时间监控，以 Statistics 为中心，扩展接口为 MonitorFactory 、 Monitor 和 MonitorService  </li>
<li>远程调用层（Protocol）：封将 RPC 调用，以 Invocation 和 Result 为中心，扩展接口为 Protocol 、 Invoker 和 Exporter 。 Protocol 是服务域，它是 Invoker 暴露和引用的主功能入口，它负责 Invoker 的生命周期管理。Invoker 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，它代表一个可执行体，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现  </li>
<li>信息交换层（Exchange）：封装请求响应模式，同步转异步，以 Request 和 Response 为中心，扩展接口为 Exchanger、ExchangeChannel、ExchangeClient 和 ExchangeServer  </li>
<li>网络传输层（Transport）：抽象 mina 和 netty 为统一接口，以 Message 为中心，扩展接口为 Channel、Transporter、Client、Server 和 Codec  </li>
<li>数据序列化层（Serialize）：可复用的一些工具，扩展接口为 Serialization、 ObjectInput、ObjectOutput 和 ThreadPool  </li>
</ol>
<p>从上图可以看出，Dubbo对于服务提供方和服务消费方，从框架的10层中分别提供了各自需要关心和扩展的接口，构建整个服务生态系统（服务提供方和服务消费方本身就是一个以服务为中心的）  </p>
<p>上述各层之间关系的描述：  </p>
<ul>
<li>在RPC中，Protocol是核心层，也就是只要有Protocol + Invoker + Exporter就可以完成非透明的RPC调用，然后在Invoker的主过程上Filter拦截点  </li>
<li>图中的Consumer和Provider是抽象概念，只是想让看图者更直观的了解哪些类分属于客户端与服务器端，不用Client和Server的原因是Dubbo在很多场景下都使用Provider、Consumer、Registry、Monitor划分逻辑拓普节点，保持统一概念  </li>
<li>而Cluster是外围概念，所以Cluster的目的是将多个Invoker伪装成一个Invoker，这样其它人只要关注Protocol层Invoker即可，加上Cluster或者去掉Cluster对其它层都不会造成影响，因为只有一个提供者时，是不需要Cluster的  </li>
<li>Proxy层封装了所有接口的透明化代理，而在其它层都以Invoker为中心，只有到了暴露给用户使用时，才用Proxy将Invoker转成接口，或将接口实现转成Invoker，也就是去掉Proxy层RPC是可以Run的，只是不那么透明，不那么看起来像调本地服务一样调远程服务  </li>
<li>而Remoting实现是Dubbo协议的实现，如果你选择RMI协议，整个Remoting都不会用上，Remoting内部再划为Transport传输层和Exchange信息交换层，Transport层只负责单向消息传输，是对Mina、Netty、Grizzly的抽象，它也可以扩展UDP传输，而Exchange层是在传输层之上封装了Request-Response语义  </li>
<li>Registry和Monitor实际上不算一层，而是一个独立的节点，只是为了全局概览，用层的方式画在一起  </li>
</ul>
<p>从上面的架构图中，了解到，Dubbo作为一个分布式服务框架，主要具有如下几个核心的要点：  </p>
<p><strong>服务定义</strong><br>服务是围绕服务提供方和服务消费方的，服务提供方实现服务，而服务消费方调用服务  </p>
<p><strong>服务注册</strong><br>　　对于服务提供方，它需要发布服务，而且由于应用系统的复杂性，服务的数量、类型也不断膨胀；对于服务消费方，它最关心如何获取到它所需要的服务，而面对复杂的应用系统，需要管理大量的服务调用。而且，对于服务提供方和服务消费方来说，他们还有可能兼具这两种角色，即既需要提供服务，有需要消费服务<br>　　通过将服务统一管理起来，可以有效地优化内部应用对服务发布/使用的流程和管理。服务注册中心可以通过特定协议来完成服务对外的统一。Dubbo提供的注册中心有如下几种类型可供选择：<br>　　- Multicast注册中心<br>　　- Zookeeper注册中心<br>　　- Redis注册中心<br>　　- Simple注册中心</p>
<p><strong>服务监控</strong><br>无论是服务提供方，还是服务消费方，他们都需要对服务调用的实际状态进行有效的监控，从而改进服务质量<br><strong>远程通信与信息交换</strong><br>远程通信需要指定通信双方所约定的协议，在保证通信双方理解协议语义的基础上，还要保证高效、稳定的消息传输。Dubbo继承了当前主流的网络通信框架，主要包括如下几个：  </p>
<ul>
<li>Mina</li>
<li>Netty</li>
<li>Grizzly</li>
</ul>
<p><strong>服务调用</strong><br>下面从Dubbo官网直接拿来，看一下基于RPC层，服务提供方和服务消费方之间的调用关系<br><img src="http://note.youdao.com/yws/api/personal/file/69A00BB8DFC24AADA522F55D021731A8?method=download&amp;shareKey=e06835a8b18ec947a5f8d36cfeefe4b2" alt="dubbo-architecture"><br>上图中，蓝色的表示与业务有交互，绿色的表示只对Dubbo内部交互。上述图所描述的调用流程如下:  </p>
<ol>
<li>服务提供方发布服务到服务注册中心</li>
<li>服务消费方从服务注册中心订阅服务</li>
<li>服务消费方调用已经注册的可用服务</li>
</ol>
<p>将上面抽象的调用流程图展开，详细如图所示:<br><img src="http://note.youdao.com/yws/api/personal/file/18212A8091A64C37AA396CD2F9ACBFCC?method=download&amp;shareKey=944c755e915ecc452b83b4036cc98f61" alt="dubbo-extension">  </p>
<p><strong>注册/注销服务</strong><br>服务的注册与注销，是对服务提供方角色而言，那么注册服务与注销服务的时序图<br><img src="http://note.youdao.com/yws/api/personal/file/9C8006F023DF44DE9A49DADB602C3FFE?method=download&amp;shareKey=a3c67535a718d9aed979fe4b8564a01c" alt="dubbo-export">  </p>
<p><strong>服务订阅/取消</strong><br>为了满足应用系统的需求，服务消费方的可能需要从服务注册中心订阅指定的有服务提供方发布的服务，在得到通知可以使用服务时，就可以直接调用服务。反过来，如果不需要某一个服务了，可以取消该服务<br><img src="http://note.youdao.com/yws/api/personal/file/6524730E5DBB4D18B824F7A138C49D04?method=download&amp;shareKey=ae6c3e294fcb134f1925091850fc6a06" alt="dubbo-refer">  </p>
<p><strong>协议支持</strong><br>Dubbo支持多种协议  </p>
<ul>
<li>Dubbo协议</li>
<li>Hessian协议</li>
<li>HTTP协议</li>
<li>RMI协议</li>
<li>WebService协议</li>
<li>Thrift协议</li>
<li>Memcached协议</li>
<li>Redis协议</li>
</ul>
<p>在通信过程中，不同的服务等级一般对应着不同的服务质量，那么选择合适的协议便是一件非常重要的事情。你可以根据你应用的创建来选择。例如，使用RMI协议，一般会受到防火墙的限制，所以对于外部与内部进行通信的场景，就不要使用RMI协议，而是基于HTTP协议或者Hessian协议  </p>
<p>参考补充<br>Dubbo以包结构来组织各个模块，各个模块及其关系<br><img src="http://note.youdao.com/yws/api/personal/file/37F8F524EFCB447F8167EE17385E4B28?method=download&amp;shareKey=65136f130a053ce9b5aed041071488ac" alt="dubbo-modules">  </p>
<p>可以通过Dubbo的代码（使用Maven管理）组织，与上面的模块进行比较。简单说明各个包的情况  </p>
<ul>
<li>dubbo-common 公共逻辑模块，包括Util类和通用模型  </li>
<li>dubbo-remoting 远程通讯模块，相当于Dubbo协议的实现，如果RPC用RMI协议则不需要使用此包  </li>
<li>dubbo-rpc 远程调用模块，抽象各种协议，以及动态代理，只包含一对一的调用，不关心集群的管理  </li>
<li>dubbo-cluster 集群模块，将多个服务提供方伪装为一个提供方，包括：负载均衡、容错、路由等，集群的地址列表可以是静态配置的，也可以是由注册中心下发  </li>
<li>dubbo-registry 注册中心模块，基于注册中心下发地址的集群方式，以及对各种注册中心的抽象  </li>
<li>dubbo-monitor 监控模块，统计服务调用次数，调用时间的，调用链跟踪的服务  </li>
<li>dubbo-config 配置模块，是Dubbo对外的API，用户通过Config使用Dubbo，隐藏Dubbo所有细节  </li>
<li>dubbo-container 容器模块，是一个Standalone的容器，以简单的Main加载Spring启动，因为服务通常不需要Tomcat/JBoss等Web容器的特性，没必要用Web容器去加载服务  </li>
</ul>
<p>原文：<a href="http://shiyanjun.cn/archives/325.html" target="_blank" rel="external">http://shiyanjun.cn/archives/325.html</a><br>参考链接：<br><a href="https://github.com/alibaba/dubbo" target="_blank" rel="external">https://github.com/alibaba/dubbo</a><br><a href="http://alibaba.github.io/dubbo-doc-static/Home-zh.htm" target="_blank" rel="external">http://alibaba.github.io/dubbo-doc-static/Home-zh.htm</a><br><a href="http://alibaba.github.io/dubbo-doc-static/User+Guide-zh.htm" target="_blank" rel="external">http://alibaba.github.io/dubbo-doc-static/User+Guide-zh.htm</a><br><a href="http://alibaba.github.io/dubbo-doc-static/Developer+Guide-zh.htm" target="_blank" rel="external">http://alibaba.github.io/dubbo-doc-static/Developer+Guide-zh.htm</a><br><a href="http://alibaba.github.io/dubbo-doc-static/Administrator+Guide-zh.htm" target="_blank" rel="external">http://alibaba.github.io/dubbo-doc-static/Administrator+Guide-zh.htm</a><br><a href="http://alibaba.github.io/dubbo-doc-static/FAQ-zh.htm" target="_blank" rel="external">http://alibaba.github.io/dubbo-doc-static/FAQ-zh.htm</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/21/Dubbo理论/">https://yfshare.github.io/2017/06/21/Dubbo理论/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;DUBBO是Alibaba开源的分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，使用这种方式可以使各个层之间解耦合(或者最大限度地松耦合)。从服务模型的角度，Dubbo采用的是一种非常简单的模型，分为&lt;strong&gt;提供方提供服务&lt;/strong&gt;和&lt;strong&gt;消费方消费服务&lt;/strong&gt;，基于这一点可以抽象出&lt;strong&gt;服务提供方&lt;/strong&gt;(Provider)和&lt;strong&gt;服务消费方&lt;/strong&gt;(Consumer)两个角色&lt;br&gt;
    
    </summary>
    
      <category term="WEB" scheme="https://yfshare.github.io/categories/WEB/"/>
    
    
      <category term="Dubbo" scheme="https://yfshare.github.io/tags/Dubbo/"/>
    
      <category term="Web" scheme="https://yfshare.github.io/tags/Web/"/>
    
      <category term="Tomcat" scheme="https://yfshare.github.io/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>Ant</title>
    <link href="https://yfshare.github.io/2017/06/19/Ant/"/>
    <id>https://yfshare.github.io/2017/06/19/Ant/</id>
    <published>2017-06-19T14:46:38.000Z</published>
    <updated>2017-06-19T14:50:25.522Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>Ant是一个Apache基金会下的跨平台的构件工具，可以实现自动构建和部署，大多数用于JAVA环境中的软件开发<br><a id="more"></a></p>
<h2 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h2><p>官网：<a href="http://ant.apache.org/" target="_blank" rel="external">http://ant.apache.org/</a><br>官方文档：<a href="http://ant.apache.org/manual/index.html" target="_blank" rel="external">http://ant.apache.org/manual/index.html</a><br>下载：<a href="http://ant.apache.org/bindownload.cgi" target="_blank" rel="external">http://ant.apache.org/bindownload.cgi</a><br><a href="http://mirror.bit.edu.cn/apache//ant/binaries/apache-ant-1.9.9-bin.zip" target="_blank" rel="external">apache-ant-1.9.9-bin.zip官方下载</a><br><a href="http://note.youdao.com/yws/api/personal/file/DA790D1F015A4B3EA72C8478B5045781?method=download&amp;shareKey=736463d1e22df8aec9cebf13f9bb2694" target="_blank" rel="external">apache-ant-1.9.9-bin.zip本地下载</a>  </p>
<p><img src="http://note.youdao.com/yws/api/personal/file/A10BDE3E38FF477ABDD560B5DAEB4CBE?method=download&amp;shareKey=407a4732d49b42ddec1a7ff1290060dd" alt="ANT流程"><br>jar包这个部分步骤是为下面编译增量包做准备的，因为增量包导出的增量文件，它依赖于整个项目的其他代码，如果没有这些代码的支持是编译不通过。然而又不能直接通过diff得到增量的class，所以只能导出增量文件后，通过引用全部工程的代码的class再进行编译即可  </p>
<p>环境：<br>　　　centos 7.2<br>　　　jdk version 1.7.0_79<br>　　　ant version 1.9.9  </p>
<p>如果报这个错，说明是服务器上目前的JDK版本不正确<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># ant --version</span></div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java.lang.UnsupportedClassVersionError: org/apache/tools/ant/launch/Launcher : Unsupported maj</div><div class="line">or.minor version 52.0	at java.lang.ClassLoader.defineClass1(Native Method)</div><div class="line">	at java.lang.ClassLoader.defineClass(ClassLoader.java:800)</div><div class="line">	at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)</div><div class="line">	at java.net.URLClassLoader.defineClass(URLClassLoader.java:449)</div></pre></td></tr></table></figure></p>
<p>官方说明<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">The Apache Ant team currently maintains two lines of development. The 1.9.x releases require Java5 at runtime and 1.10.x requires Java8 at runtime. Both lines are based off of Ant 1.9.7 and the 1.9.x releases are mostly bug fix releases <span class="keyword">while</span> additional new features are developed <span class="keyword">for</span> 1.10.x. We recommend using 1.10.x unless you are required to use versions of Java prior to Java8 during the build process.</div><div class="line"></div><div class="line">Currently, Apache Ant 1.9.9 and 1.10.1 are the best available versions, see the release notes.</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># unzip apache-ant-1.9.9-bin.zip -d /usr/local/</span></div><div class="line">[root@localhost ~]<span class="comment"># tail -2 /etc/profile</span></div><div class="line"><span class="built_in">export</span> ANT_HOME=<span class="string">"/usr/local/apache-ant-1.9.9"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>"</span>/bin:<span class="string">"<span class="variable">$ANT_HOME</span>"</span>/bin:<span class="variable">$PATH</span></div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># echo $ANT_HOME</span></div><div class="line">/usr/<span class="built_in">local</span>/apache-ant-1.9.9</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># java -version</span></div><div class="line">java version <span class="string">"1.7.0_79"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.79-b02, mixed mode)</div><div class="line">[root@localhost ~]<span class="comment"># </span></div><div class="line">[root@localhost ~]<span class="comment"># ant -version</span></div><div class="line">Apache Ant(TM) version 1.9.9 compiled on February 2 2017</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>因为这里没有build.xml，所以会报错<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ant</span></div><div class="line">Buildfile: build.xml does not exist!</div><div class="line">Build failed</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#手动建一个build.xml文件</span></div><div class="line">[root@localhost ~]<span class="comment"># cat build.xml </span></div><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"GBK"</span>?&gt;</div><div class="line">&lt;project name=<span class="string">"测试脚本"</span> default=<span class="string">"copyfile"</span> basedir=<span class="string">"."</span> &gt;</div><div class="line">   &lt;target name=<span class="string">"copyfile"</span>&gt;</div><div class="line">      &lt;copy file=<span class="string">"/root/a.txt"</span> todir=<span class="string">"/tmp/"</span> overwrite=<span class="string">"true"</span> /&gt;</div><div class="line">   &lt;/target&gt;</div><div class="line">&lt;/project&gt;</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#新建一个文件a.txt</span></div><div class="line">[root@localhost ~]<span class="comment"># ll /root/a.txt </span></div><div class="line">-rw-r--r-- 1 root root 21 Jun 19 05:43 /root/a.txt</div><div class="line">[root@localhost ~]<span class="comment"># cat /root/a.txt </span></div><div class="line">My filename is a.txt</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#执行ant命令</span></div><div class="line">[root@localhost ~]<span class="comment"># ant</span></div><div class="line">Buildfile: /root/build.xml</div><div class="line"></div><div class="line">copyfile:</div><div class="line">     [copy] Copying 1 file to /tmp</div><div class="line"></div><div class="line">BUILD SUCCESSFUL</div><div class="line">Total time: 0 seconds</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># ll /tmp/a.txt </span></div><div class="line">-rw-r--r-- 1 root root 21 Jun 19 05:43 /tmp/a.txt</div><div class="line">[root@localhost ~]<span class="comment"># cat /tmp/a.txt </span></div><div class="line">My filename is a.txt</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="ANT-Jenkins"><a href="#ANT-Jenkins" class="headerlink" title="ANT+Jenkins  "></a>ANT+Jenkins  </h2><p><img src="http://note.youdao.com/yws/api/personal/file/F2188B73B3AE49838B79E028C8B8F354?method=download&amp;shareKey=3e32cc84bd10237806d7c24099982a89" alt="ant_jenkins_plugin"><br>“Jenkis”— “系统管理”— “Global Tool Configuration”— “Ant”<br><img src="http://note.youdao.com/yws/api/personal/file/8463702CB4F94DE7BEC4C8906486C5F6?method=download&amp;shareKey=8558c7945765f5ddc31c26851ba49d9c" alt="ant_jenkins"><br><img src="http://note.youdao.com/yws/api/personal/file/74E049FDBFF2449CA3426D5F5EC3A0AE?method=download&amp;shareKey=15eb5a00e926b6500123453ed21b3cdf" alt="ant_jenkins"><br><img src="http://note.youdao.com/yws/api/personal/file/63B20CC903C94C6D8DB4700DAAD8732E?method=download&amp;shareKey=462817eadb9468fb14c4775288eab66d" alt="ant_jenkins"><br><img src="http://note.youdao.com/yws/api/personal/file/7BAB9B7AECB44E939DC727F417119555?method=download&amp;shareKey=87b2463a704a2f7a8a97dbd5d39c5874" alt="ant_jenkins">  </p>
<p>这里没有ANT项目就不跑Jenkins了哈  </p>
<p>关于ant的一些用法，参考：<a href="http://www.blogjava.net/amigoxie/archive/2007/11/09/159413.html" target="_blank" rel="external">http://www.blogjava.net/amigoxie/archive/2007/11/09/159413.html</a><br>关于ANT打包的可以参考：<a href="http://www.cnblogs.com/hoojo/p/ant_increment_svn_diff_diffSummarize.html" target="_blank" rel="external">http://www.cnblogs.com/hoojo/p/ant_increment_svn_diff_diffSummarize.html</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/19/Ant/">https://yfshare.github.io/2017/06/19/Ant/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Ant是一个Apache基金会下的跨平台的构件工具，可以实现自动构建和部署，大多数用于JAVA环境中的软件开发&lt;br&gt;
    
    </summary>
    
      <category term="Jenkins" scheme="https://yfshare.github.io/categories/Jenkins/"/>
    
    
      <category term="Ant" scheme="https://yfshare.github.io/tags/Ant/"/>
    
      <category term="Jenkins" scheme="https://yfshare.github.io/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Play Framework</title>
    <link href="https://yfshare.github.io/2017/06/19/Play-Framework/"/>
    <id>https://yfshare.github.io/2017/06/19/Play-Framework/</id>
    <published>2017-06-19T14:44:55.000Z</published>
    <updated>2017-06-19T14:50:44.236Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>Play是一个full-stack（全栈的）Java Web应用框架，包括一个简单的无状态MVC模型，具有Hibernate的对象持续，一个基于Groovy的模板引擎，以及建立一个现代Web应用所需的所有东西<br><a id="more"></a></p>
<h2 id="Play-Framework"><a href="#Play-Framework" class="headerlink" title="Play Framework"></a>Play Framework</h2><p>官网：<a href="https://playframework.com/" target="_blank" rel="external">https://playframework.com/</a><br>官网下载页：<a href="https://playframework.com/download" target="_blank" rel="external">https://playframework.com/download</a>  </p>
<p><a href="https://downloads.typesafe.com/play/2.2.6/play-2.2.6.zip" target="_blank" rel="external">官方play-2.2.6.zip下载</a><br><a href="http://note.youdao.com/yws/api/personal/file/0C87E9E4557E46B9895CAF2424BDC154?method=download&amp;shareKey=a6cd1bf9a59a9765a20266de98d9cb29" target="_blank" rel="external">本地play-2.2.6.zip下载</a>  </p>
<p>环境：<br>　　　centos 7.2<br>　　　jdk version 1.7.0_79<br>　　　play version 2.2.6<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># unzip play-2.2.6.zip -d /usr/local/</span></div><div class="line">[root@localhost ~]<span class="comment"># tail -2 /etc/profile</span></div><div class="line"><span class="built_in">export</span> PLAY_HOME=<span class="string">"/usr/local/play-2.2.6"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PLAY_HOME</span>"</span>:<span class="variable">$PATH</span></div><div class="line">[root@localhost ~]<span class="comment"># echo $PLAY_HOME</span></div><div class="line">/usr/<span class="built_in">local</span>/play-2.2.6</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#play安装完成</span></div><div class="line">[root@localhost ~]<span class="comment"># play -version</span></div><div class="line">Getting com.typesafe.play console_2.10 2.2.6 ...</div><div class="line">:: retrieving :: org.scala-sbt<span class="comment">#boot-app</span></div><div class="line">	confs: [default]</div><div class="line">	6 artifacts copied, 0 already retrieved (2012kB/72ms)</div><div class="line">Getting Scala 2.10.3 (<span class="keyword">for</span> console)...</div><div class="line">:: retrieving :: org.scala-sbt<span class="comment">#boot-scala</span></div><div class="line">	confs: [default]</div><div class="line">	5 artifacts copied, 0 already retrieved (24447kB/302ms)</div><div class="line">       _</div><div class="line"> _ __ | | __ _ _  _</div><div class="line">| <span class="string">'_ \| |/ _'</span> | || |</div><div class="line">|  __/|_|\____|\__ /</div><div class="line">|_|            |__/</div><div class="line"></div><div class="line">play 2.2.6 built with Scala 2.10.3 (running Java 1.7.0_79), http://www.playframework.com</div><div class="line"></div><div class="line">This is not a play application!</div><div class="line"></div><div class="line">Use `play new` to create a new Play application <span class="keyword">in</span> the current directory,</div><div class="line">or go to an existing application and launch the development console using `play`.</div><div class="line"></div><div class="line">You can also browse the complete documentation at http://www.playframework.com.</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>创建一个简单的play测试项目<br>play支持<a href="http://www.scala-lang.org/" target="_blank" rel="external">Scala</a>和JAVA，两者均为一种语言<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">[root@localhost play]<span class="comment"># play new test</span></div><div class="line">       _</div><div class="line"> _ __ | | __ _ _  _</div><div class="line">| <span class="string">'_ \| |/ _'</span> | || |</div><div class="line">|  __/|_|\____|\__ /</div><div class="line">|_|            |__/</div><div class="line"></div><div class="line">play 2.2.6 built with Scala 2.10.3 (running Java 1.7.0_79), http://www.playframework.com</div><div class="line"></div><div class="line">The new application will be created <span class="keyword">in</span> /opt/play/<span class="built_in">test</span></div><div class="line"></div><div class="line">What is the application name? [<span class="built_in">test</span>]</div><div class="line">&gt; Play Jack Wang</div><div class="line">Error: Application name may only contain letters, digits, <span class="string">'_'</span> and <span class="string">'-'</span>, and it must start with a letter.</div><div class="line"></div><div class="line">What is the application name? [<span class="built_in">test</span>]</div><div class="line">&gt; PlayJackWang</div><div class="line"></div><div class="line">Which template <span class="keyword">do</span> you want to use <span class="keyword">for</span> this new application? </div><div class="line"></div><div class="line">  1             - Create a simple Scala application</div><div class="line">  2             - Create a simple Java application</div><div class="line"></div><div class="line">&gt; 1</div><div class="line">OK, application PlayJackWang is created.</div><div class="line"></div><div class="line">Have fun!</div><div class="line"></div><div class="line">[root@localhost play]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost play]<span class="comment"># pwd</span></div><div class="line">/opt/play</div><div class="line">[root@localhost play]<span class="comment"># ll</span></div><div class="line">total 0</div><div class="line">drwxr-xr-x 7 root root 111 Nov 14  2014 <span class="built_in">test</span></div><div class="line">[root@localhost play]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost play]<span class="comment"># tree test/</span></div><div class="line"><span class="built_in">test</span>/</div><div class="line">├── app</div><div class="line">│   ├── controllers</div><div class="line">│   │   └── Application.scala</div><div class="line">│   └── views</div><div class="line">│       ├── index.scala.html</div><div class="line">│       └── main.scala.html</div><div class="line">├── build.sbt</div><div class="line">├── conf</div><div class="line">│   ├── application.conf</div><div class="line">│   └── routes</div><div class="line">├── project</div><div class="line">│   ├── build.properties</div><div class="line">│   └── plugins.sbt</div><div class="line">├── public</div><div class="line">│   ├── images</div><div class="line">│   │   └── favicon.png</div><div class="line">│   ├── javascripts</div><div class="line">│   │   └── jquery-1.9.0.min.js</div><div class="line">│   └── stylesheets</div><div class="line">│       └── main.css</div><div class="line">├── README</div><div class="line">└── <span class="built_in">test</span></div><div class="line">    ├── ApplicationSpec.scala</div><div class="line">    └── IntegrationSpec.scala</div><div class="line"></div><div class="line">10 directories, 14 files</div><div class="line">[root@localhost play]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#然后进入项目所在的目录，使用play run test运行项目</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /opt/play/test/</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># play run test</span></div><div class="line">Getting org.scala-sbt sbt 0.13.0 ...</div><div class="line">:: retrieving :: org.scala-sbt<span class="comment">#boot-app</span></div><div class="line">	confs: [default]</div><div class="line">	43 artifacts copied, 0 already retrieved (12440kB/128ms)</div><div class="line">[info] Loading project definition from /opt/play/<span class="built_in">test</span>/project</div><div class="line">[info] Set current project to PlayJackWang (<span class="keyword">in</span> build file:/opt/play/<span class="built_in">test</span>/)</div><div class="line">[info] Updating &#123;file:/opt/play/<span class="built_in">test</span>/&#125;test...</div><div class="line">[info] Resolving org.fusesource.jansi<span class="comment">#jansi;1.4 ...</span></div><div class="line">[info] Done updating.</div><div class="line"></div><div class="line">--- (Running the application from SBT, auto-reloading is enabled) ---</div><div class="line"></div><div class="line">[info] play - Listening <span class="keyword">for</span> HTTP on /0:0:0:0:0:0:0:0:9000</div><div class="line"></div><div class="line">(Server started, use Ctrl+D to stop and go back to the console...)</div><div class="line"></div><div class="line">[info] Compiling 5 Scala sources and 1 Java <span class="built_in">source</span> to /opt/play/<span class="built_in">test</span>/target/scala-2.10/classes...</div><div class="line">[info] <span class="string">'compiler-interface'</span> not yet compiled <span class="keyword">for</span> Scala 2.10.3. Compiling...</div><div class="line">[info]   Compilation completed <span class="keyword">in</span> 32.219 s</div><div class="line">[info] play - Application started (Dev)</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># netstat -tunlp | grep 9000</span></div><div class="line">tcp6       0      0 :::9000                 :::*                    LISTEN      1833/java     </div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/B99409B6881747B48705FF1F2D7E877F?method=download&amp;shareKey=0c0856c0fb4939d67c83abe34da011cf" alt="Play_test_page">  </p>
<h2 id="play-jenkins"><a href="#play-jenkins" class="headerlink" title="play+jenkins"></a>play+jenkins</h2><p>Jenkins默认是没有安装play插件的<br><img src="http://note.youdao.com/yws/api/personal/file/FC96C4BC7EF84286A8CC6A1ED3E43BF6?method=download&amp;shareKey=225526bbb9392075748faf612136b920" alt="play_jenkis_plugin">  </p>
<p>“Jenkis”— “系统管理”— “Global Tool Configuration”— “Play”<br><img src="http://note.youdao.com/yws/api/personal/file/D9A306755F8142568B3F32AC8627A363?method=download&amp;shareKey=f420f0459148f03b1bb4d435e6ff36ac" alt="play_jenkis"><br><img src="http://note.youdao.com/yws/api/personal/file/1FEA0ACC282D43E3ACDBA5361D038594?method=download&amp;shareKey=b7f31e23edba5f68ee95f9f374fedca2" alt="play_jenkis"><br><img src="http://note.youdao.com/yws/api/personal/file/7D00987222714E4085837027140E4ECE?method=download&amp;shareKey=5c5c475e2ae5367060a754d1d93a9405" alt="play_jenkis"><br><img src="http://note.youdao.com/yws/api/personal/file/1E77FC528CB447ABBBB14C8FC1E3CCD1?method=download&amp;shareKey=13a71ac5df7a37dcb6f9aede296ccd1f" alt="play_jenkis">  </p>
<p>我没有play项目跑不了Jenkins，这里就不做了哈  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/19/Play-Framework/">https://yfshare.github.io/2017/06/19/Play-Framework/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Play是一个full-stack（全栈的）Java Web应用框架，包括一个简单的无状态MVC模型，具有Hibernate的对象持续，一个基于Groovy的模板引擎，以及建立一个现代Web应用所需的所有东西&lt;br&gt;
    
    </summary>
    
      <category term="Jenkins" scheme="https://yfshare.github.io/categories/Jenkins/"/>
    
    
      <category term="Jenkins" scheme="https://yfshare.github.io/tags/Jenkins/"/>
    
      <category term="Play Framework" scheme="https://yfshare.github.io/tags/Play-Framework/"/>
    
  </entry>
  
  <entry>
    <title>Java构建工具：Ant vs Maven vs Gradle</title>
    <link href="https://yfshare.github.io/2017/06/19/Java%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%EF%BC%9AAnt-vs-Maven-vs-Gradle/"/>
    <id>https://yfshare.github.io/2017/06/19/Java构建工具：Ant-vs-Maven-vs-Gradle/</id>
    <published>2017-06-19T14:42:35.000Z</published>
    <updated>2017-06-19T14:45:56.790Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>最开始时，只有Make一种构建工具，其后来发展为GNU Make。但因需求的发展，码农世界JVM生态圈主要分为三大构建工具：Apache Ant+Ivy，Maven，Gradel<br><a id="more"></a></p>
<h2 id="Ant-with-Ivy"><a href="#Ant-with-Ivy" class="headerlink" title="Ant with Ivy"></a>Ant with Ivy</h2><p>Ant是第一个“现代”构建工具，在很多方面它有些像Make。2000年发布，在很短时间内成为Java项目上最流行的构建工具。它的学习曲线很缓，因此不需要什么特殊的准备就能上手。它基于过程式编程的idea。在最初的版本之后，逐渐具备了支持插件的功能<br>　　主要的不足是用XML作为脚本编写格式XML，本质上是层次化的，并不能很好地贴合Ant过程化编程的初衷。Ant的另外一个问题是，除非是很小的项目，否则它的XML文件很快就大得无法管理。<br>后来，随着通过网络进行依赖管理成为必备功能，Ant采用了Apache Ivy<br>　　Ant的主要优点在于对构建过程的控制上  </p>
<h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>Maven发布于2004年。目的是解决码农使用Ant所带来的一些问题.<br>　　Maven仍旧使用XML作为编写构建配置的文件格式，但文件结构却有巨大的变化. 　　Ant需要码农将执行task所需的全部命令都一一列出，然而Maven依靠约定(convention)并提供现成的可调用的目标(goal). 不仅如此，Maven具备从网络上自动下载依赖的能力（Ant后来通过Ivy也具备了这个功能），这一点革命性地改变了我们开发软件的方式<br>　　但是，Maven也有它的问题，依赖管理不能很好地处理相同库文件不同版本之间的冲突（Ivy在这方面更好一些）。XML作为配置文件的格式有严格的结构层次和标准，定制化目标（goal）很困难。因为Maven主要聚焦于依赖管理，实际上用Maven很难写出复杂、定制化的构建脚本，甚至不如Ant<br>　　用XML写的配置文件会变得越来越大，越来越笨重。在大型项目中，它经常什么“特别的”事还没干就有几百行代码<br>　　Maven的主要优点是生命周期。只要项目基于一定之规，它的整个生命周期都能够轻松搞定，代价是牺牲了灵活性<br>　　在对DSL（Domain Specific Languages)的热情持续高涨之时，通常的想法是设计一套能够解决特定领域问题的语言。在构建这方面，DSL的一个成功案例就是Gradle  </p>
<h2 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h2><p>　　Gradle结合了前两者的优点，在此基础之上做了很多改进。它具有Ant的强大和灵活，又有Maven的生命周期管理且易于使用。最终结果就是一个工具在2012年华丽诞生并且很快地获得了广泛关注。例如，Google采用Gradle作为Android OS的默认构建工具<br>　　Gradle不用XML，它使用基于Groovy的专门的DSL，从而使Gradle构建脚本变得比用Ant和Maven写的要简洁清晰。Gradle样板文件的代码很少，这是因为它的DSL被设计用于解决特定的问题：贯穿软件的生命周期，从编译，到静态检查，到测试，直到打包和部署<br>　　它使用Apache Ivy来处理Jar包的依赖，Gradle的成就可以概括为：约定好，灵活性也高  </p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p>代码库 <a href="https://github.com/vfarcic/JavaBuildTools" target="_blank" rel="external">https://github.com/vfarcic/JavaBuildTools</a> 包含有 Java 代码（两个简单的类和测试代码）， checkstyle 配置文件和 Ant，Ivy，Maven 以及 Gradle 的配置文件<br><a href="http://note.youdao.com/yws/api/personal/file/7738723D6C024979A285E214D81DE264?method=download&amp;shareKey=433ebf4cff1d0256fd18e8e5b5e27af0" target="_blank" rel="external">JavaBuildTools本地下载</a>  </p>
<ul>
<li><p>Any+Ivy<br>Ivy的依赖需要在ivy.xml中指定。我们的例子很简单，只需要依赖JUnit和Hamcrest  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ivy.xml</span></div><div class="line">&lt;ivy-module version=<span class="string">"2.0"</span>&gt;  </div><div class="line">    &lt;info organisation=<span class="string">"org.apache"</span> module=<span class="string">"java-build-tools"</span>/&gt;  </div><div class="line">    &lt;dependencies&gt;  </div><div class="line">        &lt;dependency org=<span class="string">"junit"</span> name=<span class="string">"junit"</span> rev=<span class="string">"4.11"</span>/&gt;  </div><div class="line">        &lt;dependency org=<span class="string">"org.hamcrest"</span> name=<span class="string">"hamcrest-all"</span> rev=<span class="string">"1.3"</span>/&gt;  </div><div class="line">    &lt;/dependencies&gt;  </div><div class="line">&lt;/ivy-module&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>ANT  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#build.xml</span></div><div class="line">&lt;project xmlns:ivy=<span class="string">"antlib:org.apache.ivy.ant"</span> name=<span class="string">"java-build-tools"</span> default=<span class="string">"jar"</span>&gt;  </div><div class="line">   </div><div class="line">    &lt;property name=<span class="string">"src.dir"</span> value=<span class="string">"src"</span>/&gt;  </div><div class="line">    &lt;property name=<span class="string">"build.dir"</span> value=<span class="string">"build"</span>/&gt;  </div><div class="line">    &lt;property name=<span class="string">"classes.dir"</span> value=<span class="string">"<span class="variable">$&#123;build.dir&#125;</span>/classes"</span>/&gt;  </div><div class="line">    &lt;property name=<span class="string">"jar.dir"</span> value=<span class="string">"<span class="variable">$&#123;build.dir&#125;</span>/jar"</span>/&gt;  </div><div class="line">    &lt;property name=<span class="string">"lib.dir"</span> value=<span class="string">"lib"</span> /&gt;  </div><div class="line">    &lt;path id=<span class="string">"lib.path.id"</span>&gt;  </div><div class="line">        &lt;fileset dir=<span class="string">"<span class="variable">$&#123;lib.dir&#125;</span>"</span> /&gt;  </div><div class="line">    &lt;/path&gt;  </div><div class="line">   </div><div class="line">    &lt;target name=<span class="string">"resolve"</span>&gt;  </div><div class="line">        &lt;ivy:retrieve /&gt;  </div><div class="line">    &lt;/target&gt;  </div><div class="line">   </div><div class="line">    &lt;target name=<span class="string">"clean"</span>&gt;  </div><div class="line">        &lt;delete dir=<span class="string">"<span class="variable">$&#123;build.dir&#125;</span>"</span>/&gt;  </div><div class="line">    &lt;/target&gt;  </div><div class="line">   </div><div class="line">    &lt;target name=<span class="string">"compile"</span> depends=<span class="string">"resolve"</span>&gt;  </div><div class="line">        &lt;mkdir dir=<span class="string">"<span class="variable">$&#123;classes.dir&#125;</span>"</span>/&gt;  </div><div class="line">        &lt;javac srcdir=<span class="string">"<span class="variable">$&#123;src.dir&#125;</span>"</span> destdir=<span class="string">"<span class="variable">$&#123;classes.dir&#125;</span>"</span> classpathref=<span class="string">"lib.path.id"</span>/&gt;  </div><div class="line">    &lt;/target&gt;  </div><div class="line">   </div><div class="line">    &lt;target name=<span class="string">"jar"</span> depends=<span class="string">"compile"</span>&gt;  </div><div class="line">        &lt;mkdir dir=<span class="string">"<span class="variable">$&#123;jar.dir&#125;</span>"</span>/&gt;  </div><div class="line">        &lt;jar destfile=<span class="string">"<span class="variable">$&#123;jar.dir&#125;</span>/<span class="variable">$&#123;ant.project.name&#125;</span>.jar"</span> basedir=<span class="string">"<span class="variable">$&#123;classes.dir&#125;</span>"</span>/&gt;  </div><div class="line">    &lt;/target&gt;  </div><div class="line">   </div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>设置了几个属性，然后是一个接一个的task。我们用Ivy来处理依赖，清理，编译和打包，这是几乎所有的Java项目都会进行的task，配置有很多<br>运行Ant task来生成Jar文件，执行下面的命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ant jar</div></pre></td></tr></table></figure></p>
<ul>
<li>Maven<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#pom.xml</span></div><div class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span>  </div><div class="line">         xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>  </div><div class="line">         xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0  </span></div><div class="line">   </div><div class="line">http://maven.apache.org/maven-v4_0_0.xsd"&gt;  </div><div class="line">   </div><div class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;  </div><div class="line">    &lt;groupId&gt;com.technologyconversations&lt;/groupId&gt;  </div><div class="line">    &lt;artifactId&gt;java-build-tools&lt;/artifactId&gt;  </div><div class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;  </div><div class="line">    &lt;version&gt;1.0&lt;/version&gt;  </div><div class="line">   </div><div class="line">    &lt;dependencies&gt;  </div><div class="line">        &lt;dependency&gt;  </div><div class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;  </div><div class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;  </div><div class="line">            &lt;version&gt;4.11&lt;/version&gt;  </div><div class="line">        &lt;/dependency&gt;  </div><div class="line">        &lt;dependency&gt;  </div><div class="line">            &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;  </div><div class="line">            &lt;artifactId&gt;hamcrest-all&lt;/artifactId&gt;  </div><div class="line">            &lt;version&gt;1.3&lt;/version&gt;  </div><div class="line">        &lt;/dependency&gt;  </div><div class="line">    &lt;/dependencies&gt;  </div><div class="line">   </div><div class="line">    &lt;build&gt;  </div><div class="line">        &lt;plugins&gt;  </div><div class="line">            &lt;plugin&gt;  </div><div class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;  </div><div class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;  </div><div class="line">                &lt;version&gt;2.3.2&lt;/version&gt;  </div><div class="line">            &lt;/plugin&gt;  </div><div class="line">        &lt;/plugins&gt;  </div><div class="line">    &lt;/build&gt;  </div><div class="line">   </div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>通过执行下面的命令来运行Maven goal生成Jar文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn package</div></pre></td></tr></table></figure></p>
<p>主要的区别在于Maven不需要指定执行的操作，当没有创建task，而是设置了一些参数（有哪些依赖，用哪些插件…)， Maven推行使用约定并提供了开箱即用的goals。Ant和Maven的XML文件都会随时间而变大，为了说明这一点，我们加入CheckStyle，FindBugs和PMD插件来进行静态检查，三者是Java项目中使用很普遍的的工具。我们希望将所有静态检查的执行以及单元测试一起作为一个单独的targetVerify。当然我们还应该指定自定义的checkstyle配置文件的路径并且确保错误时能够提示。更新后的Maven代码如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#pom.xml</span></div><div class="line">&lt;plugin&gt;  </div><div class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;  </div><div class="line">    &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;  </div><div class="line">    &lt;version&gt;2.12.1&lt;/version&gt;  </div><div class="line">    &lt;executions&gt;  </div><div class="line">        &lt;execution&gt;  </div><div class="line">            &lt;configuration&gt;  </div><div class="line">                &lt;configLocation&gt;config/checkstyle/checkstyle.xml&lt;/configLocation&gt;  </div><div class="line">                &lt;consoleOutput&gt;<span class="literal">true</span>&lt;/consoleOutput&gt;  </div><div class="line">                &lt;failsOnError&gt;<span class="literal">true</span>&lt;/failsOnError&gt;  </div><div class="line">            &lt;/configuration&gt;  </div><div class="line">            &lt;goals&gt;  </div><div class="line">                &lt;goal&gt;check&lt;/goal&gt;  </div><div class="line">            &lt;/goals&gt;  </div><div class="line">        &lt;/execution&gt;  </div><div class="line">    &lt;/executions&gt;  </div><div class="line">&lt;/plugin&gt;  </div><div class="line">&lt;plugin&gt;  </div><div class="line">    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;  </div><div class="line">    &lt;artifactId&gt;findbugs-maven-plugin&lt;/artifactId&gt;  </div><div class="line">    &lt;version&gt;2.5.4&lt;/version&gt;  </div><div class="line">    &lt;executions&gt;  </div><div class="line">        &lt;execution&gt;  </div><div class="line">            &lt;goals&gt;  </div><div class="line">                &lt;goal&gt;check&lt;/goal&gt;  </div><div class="line">            &lt;/goals&gt;  </div><div class="line">        &lt;/execution&gt;  </div><div class="line">    &lt;/executions&gt;  </div><div class="line">&lt;/plugin&gt;  </div><div class="line">&lt;plugin&gt;  </div><div class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;  </div><div class="line">    &lt;artifactId&gt;maven-pmd-plugin&lt;/artifactId&gt;  </div><div class="line">    &lt;version&gt;3.1&lt;/version&gt;  </div><div class="line">    &lt;executions&gt;  </div><div class="line">        &lt;execution&gt;  </div><div class="line">            &lt;goals&gt;  </div><div class="line">                &lt;goal&gt;check&lt;/goal&gt;  </div><div class="line">            &lt;/goals&gt;  </div><div class="line">        &lt;/execution&gt;  </div><div class="line">    &lt;/executions&gt;  </div><div class="line">&lt;/plugin&gt;</div></pre></td></tr></table></figure></p>
<p>通过执行下面的命令来运行Maven goal，包括单元测试，静态检查，如CheckStyle，FindBugs和PMD<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn verify</div></pre></td></tr></table></figure></p>
<p>需要写很多XML来进行基本的常用的任务。在实际项目中有更多的依赖和task，Maven的pom.xml很容易就有成百上千行的配置  </p>
<ul>
<li>Gradle<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#build.gradle</span></div><div class="line">apply plugin: <span class="string">'java'</span>  </div><div class="line">apply plugin: <span class="string">'checkstyle'</span>  </div><div class="line">apply plugin: <span class="string">'findbugs'</span>  </div><div class="line">apply plugin: <span class="string">'pmd'</span>  </div><div class="line">   </div><div class="line">version = <span class="string">'1.0'</span>  </div><div class="line">   </div><div class="line">repositories &#123;  </div><div class="line">    mavenCentral()  </div><div class="line">&#125;  </div><div class="line">   </div><div class="line">dependencies &#123;  </div><div class="line">    <span class="built_in">test</span>Compile group: <span class="string">'junit'</span>, name: <span class="string">'junit'</span>, version: <span class="string">'4.11'</span>  </div><div class="line">    <span class="built_in">test</span>Compile group: <span class="string">'org.hamcrest'</span>, name: <span class="string">'hamcrest-all'</span>, version: <span class="string">'1.3'</span>  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>Gradle不仅代码少了很多，对于熟悉的人来说，比Maven要更容易理解，而且它还包括很多Maven代码没有覆盖的有用的task。请执行下面的命令来得到Gradle在当前配置下能够支持的task列表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle tasks --all</div></pre></td></tr></table></figure></p>
<p>清晰性，复杂度和学习曲线<br>对于初学者，Ant是最清晰的。只要读懂XML配置文件你就能够理解它干了些什么，但是，Ant文件很容易变复杂。Maven和Gradle，尤其是Gradle，有很多开箱即用的插件。例如，下面这行代码可能会令那些对Gradle一知半解的人有些困惑，不知道通过这句话就能够使用哪些task<br>build.gradle<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'java'</span></div></pre></td></tr></table></figure></p>
<p>简单的这一行增加了20多个可用的任务<br>Ant的可读性和Maven的简单性，在我看来，是伪命题，只适用于Gradle学习曲线的初级阶段。一旦用上了Gradle的DSL，就会发现语法比Ant和Maven更加短小精悍、易于理解。不仅如此，只有Gradle既提供了约定也提供了自定义命令。如果说Maven可以通过Ant task来扩展，这似乎有些滑稽可笑，而且低效，Groovy写的Gradle将其提升了一个层次  </p>
<p>原文：<a href="https://technologyconversations.com/2014/06/18/build-tools/" target="_blank" rel="external">https://technologyconversations.com/2014/06/18/build-tools/</a><br><a href="http://blog.csdn.net/bailyzheng/article/details/48395949" target="_blank" rel="external">http://blog.csdn.net/bailyzheng/article/details/48395949</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/19/Java构建工具：Ant-vs-Maven-vs-Gradle/">https://yfshare.github.io/2017/06/19/Java构建工具：Ant-vs-Maven-vs-Gradle/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最开始时，只有Make一种构建工具，其后来发展为GNU Make。但因需求的发展，码农世界JVM生态圈主要分为三大构建工具：Apache Ant+Ivy，Maven，Gradel&lt;br&gt;
    
    </summary>
    
      <category term="Jenkins" scheme="https://yfshare.github.io/categories/Jenkins/"/>
    
    
      <category term="Ant" scheme="https://yfshare.github.io/tags/Ant/"/>
    
      <category term="Jenkins" scheme="https://yfshare.github.io/tags/Jenkins/"/>
    
      <category term="Java" scheme="https://yfshare.github.io/tags/Java/"/>
    
      <category term="Maven" scheme="https://yfshare.github.io/tags/Maven/"/>
    
      <category term="Gradle" scheme="https://yfshare.github.io/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>CCKiller：Linux轻量级CC攻击防御工具，秒级检查、自动拉黑和释放</title>
    <link href="https://yfshare.github.io/2017/06/03/CCKiller%EF%BC%9ALinux%E8%BD%BB%E9%87%8F%E7%BA%A7CC%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E5%B7%A5%E5%85%B7%EF%BC%8C%E7%A7%92%E7%BA%A7%E6%A3%80%E6%9F%A5%E3%80%81%E8%87%AA%E5%8A%A8%E6%8B%89%E9%BB%91%E5%92%8C%E9%87%8A%E6%94%BE/"/>
    <id>https://yfshare.github.io/2017/06/03/CCKiller：Linux轻量级CC攻击防御工具，秒级检查、自动拉黑和释放/</id>
    <published>2017-06-03T04:45:26.000Z</published>
    <updated>2017-06-03T05:25:11.422Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>DDoS攻击指的是分布式拒绝服务。而CC攻击只是DDoS攻击的一种，本文所阐述的CC攻击，指的是单个IP达到我们设定好的阈值并发请求，而非海量IP的低并发攻击！对于个人低配服务器，除了使用CDN来防护，至少我是没有想到如何抵挡海量IP攻击的！因为每个IP都模拟正常的用户浏览器请求，并不会触发防御阈值，同时来1000个，甚至上万个，个人低配服务器的带宽在第一时间就会被占满，就无法继续提供服务了<br><a id="more"></a><br>当然，用脚本也是无法防御DDoS大流量攻击的，因为所有机房的防御带宽是有限的，当攻击的流量超过了机房的防御带宽，要么机房把你的服务器IP拉黑洞，要么就一起死。因此，如果你的服务器正遭受大流量攻击，比如几十G上百G，一般机房或CDN节点都是扛不住的，脚本也无能为力了，赶紧换高防服务器吧！  </p>
<h2 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h2><p>CCKiller定位：CCKiller是用于个人低配服务器的轻量级CC攻击防御，可以抵挡单个IP产生的高并发攻击。<br>目前设计的功能特性如下：  </p>
<ol>
<li>秒级检查<br>很多人写的防御脚本都是使用了Linux系统的计划任务crontab来定时检查的。而crontab的最细颗粒是1分钟，也就是说脚本最快也只能1分钟检查一次。对于一些强迫症来说就会很不爽。<br>所以，我还是按照以前分享的思路，利用while循环实现秒级检查，实现更细的颗粒。当然，CCKiller更是被我写成了系统服务，更加灵活稳定。  </li>
<li>拉黑时长<br>CCKiller可以设置拉黑时长，默认为10分钟。当发现有恶意请求时，会自动拉黑目标IP，并在拉黑时长结束后自动释放，这个功能算是对我之前写的脚本的一个大的改进。  </li>
<li>并发阈值<br>CCKiller 可以设定单个IP的最高请求数，如果某个IP同时请求数超过了设定的阈值，就会被暂时拉黑一段时间。    </li>
<li>邮件发送<br>这个功能没啥好说的，意义并不大。而且发送成功率和服务器的环境也有很大关系。  </li>
<li>并发显示<br>安装后，直接运行cckiller会列出当前系统的请求排行，可以清晰的看到当前请求IP和并发数。使用-s参数还可以继续定制需求，比如 cckiller -s 10 就能显示当前并发数排行前10名的IP。  </li>
<li>手动拉黑<br>支持手动拉黑，执行后会立即检查，将并发请求超过n的IP拉黑一段时间，比如 cckiller -k 100 就会将目前超过100个请求的IP拉黑一段时间，如果没有则不会执行任何拉黑操作  </li>
</ol>
<h2 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h2><ol>
<li><p>在线安装<br>由于可能经常会更新一些功能，或修复一些BUG，所以仅提供在线安装，以保证脚本是最新的  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -O install.sh --no-check-certificate https://zhangge.net/wp-content/uploads/files/cckiller/install.sh?ver=1.0.7 &amp;&amp; chmod +x install.sh &amp;&amp; bash install.sh -i</div></pre></td></tr></table></figure>
</li>
<li><p>工具配置<br>因为每个服务器的情况可能不一样，所以有一个自定义配置的过程<br>执行上述安装命令后，将会进入自选配置部分<br><img src="https://res.zgboke.com/wp-content/uploads/2015/09/CCkiller1.png" alt="CCKiller Configuration"><br>提示否使用脚本默认配置，如果选择是（y），那么显示默认配置，并询问是否继续<br><img src="https://res.zgboke.com/wp-content/uploads/2015/09/CCkiller2.png" alt="CCKiller Configuration">  </p>
</li>
</ol>
<p>默认配置如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">The Time interval : 20 s       <span class="comment">#每20s检查一次系统请求情况</span></div><div class="line">The Forbidden Time: 600 s  <span class="comment">#拉黑时长设为10分钟</span></div><div class="line">Adminstrator Email: root@localhost   <span class="comment">#邮件对象设置为root@localhost（即关闭邮件发送）</span></div><div class="line">Connections Allow: 100      <span class="comment">#单个IP并发限制为100</span></div></pre></td></tr></table></figure></p>
<p>如果不符合你的需求，你可以使用 ctrl + c 组合键终止脚本，或者先继续安装，因为工具设计了配置修改的功能，所以无需着急。<br>如果不使用默认配置（n），则会要你输入参数来自定义配置<br><img src="https://res.zgboke.com/wp-content/uploads/2015/09/CCkiller3.png?w=480" alt="CCKiller Configuration"><br>如图，我将参数依次定义为每10秒进行检查，拉黑时长为300秒，发件人设置为博客邮箱，并发限制设置为60，回车后会弹出一个提示，让你检查，如果没问题你直接回车就会安装并启动<br><img src="https://res.zgboke.com/wp-content/uploads/2015/09/CCkiller4.png?w=480" alt="CCKiller Configuration">  </p>
<ol>
<li><p>服务控制<br>安装后，会将cckiller注册成系统服务，这时你就可以使用service来控制cckiller了。使用标准的service定义，支持 start | stop | restart | status 四个参数。所以，你可以使用service cckiller stop来停止cckiller，也可以使用service cckiller status来查看状态。  </p>
</li>
<li><p>集成命令<br>成功安装后，系统还会多出一个cckiller的命令，这个命令现有功能如下：<br>cckiller -h可以调出帮助信息：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CCkiller version 1.0.0 Author: Jager &lt;ge@zhangge.net&gt;</div><div class="line">Copyright ©2015 zhangge.net. All rights reserved. </div><div class="line">Usage: cckiller [OPTIONS] [N]</div><div class="line">N : number of tcp/udp   connections (default 100)</div><div class="line">OPTIONS:</div><div class="line">-h | --help: Show       this <span class="built_in">help</span> screen</div><div class="line">-k | --kill: Block the offending ip making more than N connections</div><div class="line"><span class="_">-s</span> | --show: Show The TOP <span class="string">"N"</span> Connections of System Current</div></pre></td></tr></table></figure>
</li>
</ol>
<p>-k 是拉黑功能，需要在后面带上你想拉黑的并发数，比如 cckiller -k 100 就会拉黑当前请求数大于100的IP一段时间（和拉黑时长一致）<br>-s 是显示并发排名，也需要在后面带上数字，比如 cckiller -s 10 就能显示当前并发数排行前10名的IP。  </p>
<ol>
<li>文件结构<br>如上图所示，脚本安装目录为/usr/local/cckiller，其结构如下  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cckiller/</div><div class="line">├── cckiller       <span class="comment">#主程序</span></div><div class="line">├── <span class="built_in">log</span>/           <span class="comment">#日志目录（ver 1.0.1新增特性）</span></div><div class="line">├── ck.conf        <span class="comment">#配置文件</span></div><div class="line">├── ignore.ip.list <span class="comment">#白名单</span></div><div class="line">└── install.sh     <span class="comment">#安装和卸载脚本</span></div><div class="line"> </div><div class="line">0 directories, 5 files</div></pre></td></tr></table></figure>
</li>
</ol>
<p>如果你熟悉vim的话，只要编辑ck.conf就可以定义工具参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">##### Paths of the script and other files</span></div><div class="line">PROGDIR=<span class="string">"/usr/local/cckiller"</span></div><div class="line">PROG=<span class="string">"/usr/local/cckiller/cckiller"</span></div><div class="line">LOGDIR=<span class="string">"/usr/local/cckiller/log"</span></div><div class="line">IGNORE_IP_LIST=<span class="string">"/usr/local/cckiller/ignore.ip.list"</span></div><div class="line">IPT=<span class="string">"/sbin/iptables"</span></div><div class="line">DKName=CCkiller</div><div class="line">DKVer=1.0.5</div><div class="line"><span class="comment">##### SLEEP_TIME设定检查频率，单位为秒</span></div><div class="line">SLEEP_TIME=10</div><div class="line"><span class="comment">##### NO_OF_CONNECTIONS设定并发限制</span></div><div class="line">NO_OF_CONNECTIONS=60</div><div class="line"><span class="comment">##### EMAIL_TO设定邮件的发送对象</span></div><div class="line">EMAIL_TO=<span class="string">"ge@zhangge.net"</span></div><div class="line"><span class="comment">##### BAN_PERIOD设定拉黑时长，单位为秒</span></div><div class="line">BAN_PERIOD=300</div><div class="line"><span class="comment">##### 设置忽略端口，比如 21,2121,8000 (默认不忽略)</span></div><div class="line">IGNORE_PORT=</div><div class="line"> </div><div class="line"><span class="comment">##### 定义日志级别 INFO,DEBUG,WARNING,OFF (默认 INFO)</span></div><div class="line">LOG_LEVEL=INFO</div></pre></td></tr></table></figure></p>
<p>如果不熟悉也没关系。你还可以执行 ./install.sh -c 进行工具初始化，重新设定所有参数，过程和首次安装时一致  </p>
<ol>
<li><p>白名单<br>工具安装时会默认将系统所有IP都加入白名单，避免自己把自己给拉黑的尴尬。如果你还有其他要加白的IP，可以将IP加入到cckiller安装目录下的ignore.ip.list文件中，每行一个。<br>Ps：目前白名单还不支持IP段，敬请期待后续更新。  </p>
</li>
<li><p>卸载工具<br>有心的朋友可能注意到了install.sh是可以带参数的。写代码的时候已经设计了几个常用的安装卸载功能，具体如下  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#直接执行./install.sh 将会显示如下帮助信息</span></div><div class="line"><span class="comment">###################################################################</span></div><div class="line"><span class="comment">#  CCkiller version 1.0.5 Author: Jager &lt;ge@zhangge.net&gt;          #</span></div><div class="line"><span class="comment">#  For more information please visit http://zhangge.net/5066.html #</span></div><div class="line"><span class="comment">#-----------------------------------------------------------------#</span></div><div class="line"><span class="comment">#  Copyright @2015 zhangge.net. All rights reserved.              #</span></div><div class="line"><span class="comment">###################################################################</span></div><div class="line"> </div><div class="line">Usage: configure.sh [OPTIONS]</div><div class="line"> </div><div class="line">OPTIONS:</div><div class="line">-h | --help : Show <span class="built_in">help</span> of CCkiller</div><div class="line">-u | --update : update Check <span class="keyword">for</span> CCkiller [not available now]</div><div class="line">-c | --config : Edit The configure of CCkiller again</div><div class="line">-i | --install : install CCkiller version 1.0.0 to This System</div><div class="line">-U | --uninstall : Uninstall cckiller from This System</div></pre></td></tr></table></figure>
</li>
</ol>
<p>其中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-u 参数用来升级工具，不过目前由于没时间还没写，所以不可用(Ver 1.0.2已支持在线更新)</div><div class="line">-i  参数用来安装工具，如果已安装则会提示并终止</div><div class="line">-c 参数用来配置工具，方便安装后随时修改工具配置</div><div class="line">-U 参数用来卸载工具，注意是大写哦！</div></pre></td></tr></table></figure></p>
<p>可以使用 ./install.sh -U  如图卸载CCKiller<br><img src="https://res.zgboke.com/wp-content/uploads/2015/09/CCkiller6.png?w=480" alt="CCKiller Configuration">  </p>
<h2 id="攻防测试"><a href="#攻防测试" class="headerlink" title="攻防测试"></a>攻防测试</h2><p>成功安装并启用CCKiller之后，我们可以使用压力测试工具来测试拉黑和释放效果，比如webbench 或 ab等。<br>假如CCKiller设定的并发限制为100，检查间隔为10s，使用webbench如下测试：<br>webbench -c 101 -t 60 <a href="http://www.yourwebsite.com/" target="_blank" rel="external">http://www.yourwebsite.com/</a><br>启动测试后，你可以立即去服务器上查看防火墙：<br>iptables -nvL<br>多刷几下，就可以看到webbench所在服务器IP已经在DROP规则中了。<br>确定已被拉黑之后，你等个10分钟再来看防火墙，可以发现webbench所在服务器IP已经消失了，成功释放！<br>Ps：如果邮件发送功能无误，那么应该也收到了工具发来的告警邮件<br><img src="https://res.zgboke.com/wp-content/uploads/2015/09/cckiller5.png?w=480" alt="CCKiller Configuration">  </p>
<h2 id="更多说明"><a href="#更多说明" class="headerlink" title="更多说明"></a>更多说明</h2><ol>
<li>配置并发限制<br>CCKiller配置最大连接数限制时，建议根据单个网页产生的并发数来判断  </li>
</ol>
<ul>
<li>情况A： 你网站做了动静分离，那么静态的请求就到另一个域名了（假设静态资源托管在另一台服务器或是CDN），单个IP请求一个页面可能就只会产生若干并发（假设5个），我们假设某个用户很猛，他喜欢快速拖拽打开你网站的多个网页，比如同时打开10个，那么正常用户的正常最大并发你也可以基本确定了吧？即并发限制：10x5=50。如果有人同时刷新你几十个页面，要说没恶意你也不相信吧？</li>
<li>情况B： 如果没有做动静分离，那么一个页面产生的并发可能就比较多了，每个css、js、图片都会产生一次请求。所以，在这种情况下就需要稍微计算一下你网站单个页面产生的并发请求，比如一个单页面会产生30个请求，那么你也需要考虑用户可能会连续拖拽多个页面的情况，假设我允许用户可以同时刷新10页面，那么并发限制就可以设置为300了，依此类推。<br>容错：从A和B来看，CCKiller其实是有一个盲点的，那就是如果用户IP是某个公司的统一出口，也就是代理上网IP，那么工具就容易误杀无辜了。所以，除了A和B，你还得考虑你网站的受众人群类型。比如，我就一个个人博客，同一时刻被一个公司的多名同时多窗口拖拽访问，这种情况也不多吧？如果可能存在这种受众人群，那么这个并发限制可以设置大一些，避免错杀无辜。当然，拉黑也就10分钟而已，也不至于“一失足成千古恨”。。。<br>当然，不管哪种情况，并发限制都可以比预估设置高那么一些，这个自行斟酌吧！</li>
</ul>
<ol>
<li>不足与完善<br>CCKiller是我最近利用闲暇时间，匆忙之作，难免会有各种问题。也没时间进行测试和完善。不过目前还是有数位站长在使用，暂未反馈异常。当然， 我分享的是在线安装方式，也是为后续的更新提供方便。不过对比我以前写的防御脚本，CCKiller算是有了长足的进步了，很简单的安装，更强大的功能！  </li>
</ol>
<p>附件下载：<a href="http://note.youdao.com/yws/api/personal/file/1BE15B8113864F7284CA87B8EF3880EC?method=download&amp;shareKey=e54bb3abdeac400d66ddbad0eeee88b4" target="_blank" rel="external">CCkiller V1.0.7</a>  </p>
<p>本文非原创，原文请戳：<a href="https://zhangge.net/5066.html" target="_blank" rel="external">https://zhangge.net/5066.html</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/06/03/CCKiller：Linux轻量级CC攻击防御工具，秒级检查、自动拉黑和释放/">https://yfshare.github.io/2017/06/03/CCKiller：Linux轻量级CC攻击防御工具，秒级检查、自动拉黑和释放/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;DDoS攻击指的是分布式拒绝服务。而CC攻击只是DDoS攻击的一种，本文所阐述的CC攻击，指的是单个IP达到我们设定好的阈值并发请求，而非海量IP的低并发攻击！对于个人低配服务器，除了使用CDN来防护，至少我是没有想到如何抵挡海量IP攻击的！因为每个IP都模拟正常的用户浏览器请求，并不会触发防御阈值，同时来1000个，甚至上万个，个人低配服务器的带宽在第一时间就会被占满，就无法继续提供服务了&lt;br&gt;
    
    </summary>
    
      <category term="Security" scheme="https://yfshare.github.io/categories/Security/"/>
    
    
      <category term="CC" scheme="https://yfshare.github.io/tags/CC/"/>
    
      <category term="Linux" scheme="https://yfshare.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>部署Apache+Subversion版本控制系统</title>
    <link href="https://yfshare.github.io/2017/05/30/%E9%83%A8%E7%BD%B2Apache-Subversion%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/"/>
    <id>https://yfshare.github.io/2017/05/30/部署Apache-Subversion版本控制系统/</id>
    <published>2017-05-30T11:01:01.000Z</published>
    <updated>2017-05-30T14:03:05.349Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>SVN是Subversion的简称，是一个开放源代码的版本控制系统，采用C/S模式。SVN有2中数据存储模式， 一是Berkeley DB 数据库中存放数据；二是使用普通文件，采用自定义的格式来储存，称为 FSFS<br>两种存储格式各有优缺点，如果需要使用FSFS，在创建版本库的时候加参数“--fs-type fsfs”即可。即：“svnadmin create --fs-type fsfs /data/svn/project”<br><a id="more"></a></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>Berkeley DB</th>
<th>FSFS</th>
</tr>
</thead>
<tbody>
<tr>
<td>对操作中断的敏感</td>
<td>很敏感；系统崩溃或者权限问题会导致数据库“塞住”，需要定期进行恢复</td>
<td>不敏感</td>
</tr>
<tr>
<td>可只读加载</td>
<td>不能</td>
<td>可以</td>
</tr>
<tr>
<td>存储平台无关</td>
<td>不能</td>
<td>可以</td>
</tr>
<tr>
<td>可从网络文件系统访问</td>
<td>不能</td>
<td>可以</td>
</tr>
<tr>
<td>版本库大小</td>
<td>稍大</td>
<td>稍小</td>
</tr>
<tr>
<td>扩展性：修订版本树数量</td>
<td>无限制</td>
<td>某些本地文件系统在处理单一目录包含上千个条目时会出现问题。</td>
</tr>
<tr>
<td>扩展性：文件较多的目录</td>
<td>较慢</td>
<td>较慢</td>
</tr>
<tr>
<td>检出最新代码的速度</td>
<td>较快</td>
<td>可以</td>
</tr>
<tr>
<td>大量提交的速度</td>
<td>较慢，但时间被分配在整个提交操作中</td>
<td>较快，但最后较长的延时可能会导致客户端操作超时</td>
</tr>
<tr>
<td>组访问权处理</td>
<td>对于用户的 umask 设置十分敏感，最好只由一个用户访问</td>
<td>对 umask 设置不敏感</td>
</tr>
<tr>
<td>功能成熟时间</td>
<td>2001 年</td>
<td>2004 年</td>
</tr>
</tbody>
</table>
<h2 id="安装SVN"><a href="#安装SVN" class="headerlink" title="安装SVN"></a>安装SVN</h2><p>环境：<br>　　　Centos 7.2<br>　　　Subversion 1.7.14<br>　　　Apache 2.4.6  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install svn</span></div><div class="line">[root@localhost ~]<span class="comment"># svnserve --version </span></div><div class="line">svnserve, version 1.7.14 (r1542130)</div><div class="line">···</div><div class="line">[root@localhost ~]<span class="comment"># mkdir -p /data/svn</span></div><div class="line">[root@localhost ~]<span class="comment"># svnadmin create /data/svn/project</span></div><div class="line">[root@localhost ~]<span class="comment"># ll /data/svn/project/</span></div><div class="line">total 16</div><div class="line">drwxr-xr-x 2 root root   51 May 31 00:17 conf      <span class="comment">#conf 目录下存放了版本库的配置文件，包括用户访问控制和权限控制等内容</span></div><div class="line">drwxr-sr-x 6 root root 4096 May 31 00:17 db        <span class="comment">#db 目录下存放着 Subversion 所要管理的所有受版本控制的数据</span></div><div class="line">-r--r--r-- 1 root root    2 May 31 00:17 format    <span class="comment">#format 文件记录了版本库的布局版本号</span></div><div class="line">drwxr-xr-x 2 root root 4096 May 31 00:17 hooks     <span class="comment">#hooks 目录存放着钩子脚本及其模版(一种版本库事件触发程序)</span></div><div class="line">drwxr-xr-x 2 root root   39 May 31 00:17 locks     <span class="comment">#locks 目录存放着 Subversion 版本库锁定数据</span></div><div class="line">-rw-r--r-- 1 root root  229 May 31 00:17 README.txt</div><div class="line">[root@localhost ~]<span class="comment"># cd /data/svn/project/conf/</span></div><div class="line">[root@localhost conf]<span class="comment"># grep -v ^# passwd | grep -v ^$</span></div><div class="line">[users]</div><div class="line">jack = jackpass</div><div class="line">bob = bobpass</div><div class="line">[root@localhost conf]<span class="comment"># grep -v ^# authz | grep -v ^$</span></div><div class="line">[aliases]</div><div class="line">[groups]</div><div class="line">admin = jack</div><div class="line">[/]</div><div class="line">@admin = rw</div><div class="line">[/svn_test]</div><div class="line">bob = r</div><div class="line">[root@localhost conf]<span class="comment"># grep -v ^# svnserve.conf | grep -v ^$</span></div><div class="line">[general]</div><div class="line">anon-access = none</div><div class="line">auth-access = write</div><div class="line">password-db = passwd</div><div class="line">authz-db = authz</div><div class="line">[sasl]</div><div class="line">[root@localhost conf]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#导入项目</span></div><div class="line">[root@localhost ~]<span class="comment"># svn import /tmp/svncode/ file:///data/svn/project/ --message "init"</span></div><div class="line">···</div><div class="line">Adding         /tmp/svncode/svn_test/<span class="built_in">test</span>9.txt</div><div class="line">Adding         /tmp/svncode/svn_test/<span class="built_in">test</span>1.txt</div><div class="line">Adding         /tmp/svncode/svn_test/<span class="built_in">test</span>10.txt</div><div class="line"></div><div class="line">Committed revision 1.</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#查看项目是否导入成功</span></div><div class="line">[root@localhost ~]<span class="comment"># svn list --verbose file:///data/svn/project/</span></div><div class="line">      1 root                  May 31 00:25 ./</div><div class="line">      1 root                  May 31 00:25 svn_test/</div><div class="line">      1 root                  May 31 00:25 svn_uu/</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#查看最新修订版本的信息</span></div><div class="line">[root@localhost ~]<span class="comment"># svnlook info /data/svn/project/</span></div><div class="line">root</div><div class="line">2017-05-31 00:25:41 +0800 (Wed, 31 May 2017)</div><div class="line">4</div><div class="line">init</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#显示版本库的具体树形结构，“--show-ids”指定显示每一个显示元素的修改版本 ID</span></div><div class="line">[root@localhost ~]<span class="comment"># svnlook tree /data/svn/project/ --show-ids</span></div><div class="line">/ &lt;0.0.r1/4948&gt;</div><div class="line"> svn_test/ &lt;n-1.0.r1/2515&gt;</div><div class="line">  <span class="built_in">test</span>2.txt &lt;o-1.0.r1/697&gt;</div><div class="line">  <span class="built_in">test</span>3.txt &lt;r-1.0.r1/873&gt;</div><div class="line">  <span class="built_in">test</span>4.txt &lt;t-1.0.r1/1049&gt;</div><div class="line">  <span class="built_in">test</span>5.txt &lt;v-1.0.r1/1226&gt;</div><div class="line">  <span class="built_in">test</span>6.txt &lt;x-1.0.r1/1403&gt;</div><div class="line">  <span class="built_in">test</span>7.txt &lt;z-1.0.r1/1580&gt;</div><div class="line">  <span class="built_in">test</span>8.txt &lt;11-1.0.r1/1758&gt;</div><div class="line">  <span class="built_in">test</span>9.txt &lt;13-1.0.r1/1937&gt;</div><div class="line">  <span class="built_in">test</span>1.txt &lt;15-1.0.r1/340&gt;</div><div class="line">  <span class="built_in">test</span>10.txt &lt;17-1.0.r1/518&gt;</div><div class="line"> svn_uu/ &lt;0-1.0.r1/4740&gt;</div><div class="line">  uu8.txt &lt;j-1.0.r1/4016&gt;</div><div class="line">  uu9.txt &lt;l-1.0.r1/4189&gt;</div><div class="line">  uu1.txt &lt;2-1.0.r1/2638&gt;</div><div class="line">  uu10.txt &lt;5-1.0.r1/2809&gt;</div><div class="line">  uu2.txt &lt;7-1.0.r1/2982&gt;</div><div class="line">  uu3.txt &lt;9-1.0.r1/3154&gt;</div><div class="line">  uu4.txt &lt;b-1.0.r1/3326&gt;</div><div class="line">  uu5.txt &lt;d-1.0.r1/3498&gt;</div><div class="line">  uu6.txt &lt;f-1.0.r1/3670&gt;</div><div class="line">  uu7.txt &lt;h-1.0.r1/3843&gt;</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#启动svn</span></div><div class="line">[root@localhost ~]<span class="comment"># svnserve -d -r /data/svn/project/</span></div><div class="line">[root@localhost ~]<span class="comment"># netstat -tunlp | grep 3690</span></div><div class="line">tcp        0      0 0.0.0.0:3690            0.0.0.0:*               LISTEN      2054/svnserve       </div><div class="line">[root@localhost ~]<span class="comment"># ps -ef | grep svn</span></div><div class="line">root       2078      1  0 00:34 ?        00:00:00 svnserve <span class="_">-d</span> -r /data/svn/project/</div><div class="line">root       2094   1126  0 00:37 pts/0    00:00:00 grep --color=auto svn</div><div class="line">[root@localhost ~]<span class="comment"># tail -1 /etc/rc.local </span></div><div class="line">svnserve <span class="_">-d</span> -r /data/svn/project/</div><div class="line">[root@localhost ~]<span class="comment"># systemctl enable svnserve</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/89409706F81647A290F91354249174AC?method=download&amp;shareKey=3b306443717b5fd01c8f1da22e8d6af5" alt="svn_Verification"><br><img src="http://note.youdao.com/yws/api/personal/file/338B32D5033648068533FA9F11EFBBF4?method=download&amp;shareKey=033155feaedb437e1ab33e0de4645b09" alt="svn_Verification"><br>SVN安装成功  </p>
<h2 id="安装Apache"><a href="#安装Apache" class="headerlink" title="安装Apache"></a>安装Apache</h2><p>通过 Http 协议可更方便的访问 Subversion 版本库，只需要打开浏览器，输入 URL 即可轻松的浏览整个版本库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install httpd mod_dav_svn</span></div><div class="line">[root@localhost ~]<span class="comment"># httpd -version</span></div><div class="line">Server version: Apache/2.4.6 (CentOS)</div><div class="line">Server built:   Apr 12 2017 21:03:28</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># chown apache:apache /data/svn/project/ -R</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /data/svn/project/</span></div><div class="line">[root@localhost project]<span class="comment"># htpasswd -cm htpassword jack</span></div><div class="line">New password: </div><div class="line">Re-type new password: </div><div class="line">Adding password <span class="keyword">for</span> user jack</div><div class="line">[root@localhost project]<span class="comment"># cat htpassword </span></div><div class="line">jack:<span class="variable">$apr1</span><span class="variable">$wqsFKPQo</span><span class="variable">$XwD1nh1Y7OPX</span>.62dQIMt..</div><div class="line">[root@localhost project]<span class="comment">#</span></div><div class="line">[root@localhost project]<span class="comment"># chmod 644 htpassword</span></div></pre></td></tr></table></figure></p>
<h2 id="Apache与Subversion结合"><a href="#Apache与Subversion结合" class="headerlink" title="Apache与Subversion结合"></a>Apache与Subversion结合</h2><p>由于 Subversion 需要版本化的控制，因此标准的 Http 协议不能满足需求。要让 Apache 与 Subversion 协同工作，需要使用 WebDAV（Web 分布式创作和版本控制）。WebDAV 是 HTTP 1.1 的扩展，关于 WebDAV 的规范和工作原理，参考：<a href="http://www.ietf.org/rfc/rfc2518.txt" target="_blank" rel="external">http://www.ietf.org/rfc/rfc2518.txt</a><br>为了使 Subversion 与 dav 模块通信，需要安装 mod_dav_svn 插件。默认情况下没有安装，至少我这里是这样的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /etc/httpd/modules/</span></div><div class="line">[root@localhost modules]<span class="comment"># ll | grep -i mod_dav_svn.so</span></div><div class="line">-rwxr-xr-x 1 root root 181336 Nov 21  2015 mod_dav_svn.so</div><div class="line">[root@localhost modules]<span class="comment"># ll | grep -i mod_dav.so</span></div><div class="line">-rwxr-xr-x 1 root root 102400 Apr 13 05:04 mod_dav.so</div><div class="line">[root@localhost modules]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># cd /etc/httpd/</span></div><div class="line">[root@localhost httpd]<span class="comment"># tail -1 conf/httpd.conf </span></div><div class="line">IncludeOptional conf.d/*.conf</div><div class="line">[root@localhost httpd]<span class="comment">#</span></div><div class="line">[root@localhost httpd]<span class="comment"># cat conf.d/subversion.conf </span></div><div class="line"><span class="comment">#使用mod_authz_svn进行目录访问控制</span></div><div class="line">LoadModule dav_svn_module     modules/mod_dav_svn.so  </div><div class="line">LoadModule authz_svn_module   modules/mod_authz_svn.so  </div><div class="line">&lt;Location /svn&gt;  </div><div class="line">    DAV svn</div><div class="line">    SVNPath <span class="string">"/data/svn/project/"</span></div><div class="line">    AuthType Basic</div><div class="line">    AuthName <span class="string">"svn repos"</span></div><div class="line">    AuthUserFile <span class="string">"/data/svn/project/htpassword"</span>         <span class="comment">#前面用htpasswd生成的认证文件</span></div><div class="line">    AuthzSVNAccessFile <span class="string">"/data/svn/project/conf/authz"</span>   <span class="comment">#SVN的 authz 的策略文件</span></div><div class="line">    Satisfy Any    <span class="comment">#用户验证机制，值为all|any。用于一个目录同时被这两个规则作用，All要同时满足两个条件，Any只要满足一个即可</span></div><div class="line">    Require valid-user  </div><div class="line">&lt;/Location&gt;</div><div class="line">[root@localhost httpd]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># systemctl start httpd</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl enable httpd</span></div></pre></td></tr></table></figure></p>
<p>初始版本库<br><img src="http://note.youdao.com/yws/api/personal/file/C0BD1F9006CC454393CF7903F9926513?method=download&amp;shareKey=f98af9c334e20895e824ada31a229f8a" alt="Apache+subversion"><br>这样做的好处是，用户访问管理员给的URL时，首先需要通过Apache的登录验证，再验证SVN的 authz ，两者都满足时，才能正常访问，且用户无法点上面的两个冒号切到上级目录(这时会切到初始版本库)，如下图<br><img src="http://note.youdao.com/yws/api/personal/file/2A63A05A9B25417CBAFE367776149434?method=download&amp;shareKey=875898daa6381f0bda59d2e0a9b5bc0e" alt="Apache+subversion"><br>如果用户满足了Apache的登录验证，但不满足SVN的验证，则会出现下图所示的情况<br><img src="http://note.youdao.com/yws/api/personal/file/05738EAFB7E74A749D1A571B618D118E?method=download&amp;shareKey=7a2c55cce635dffb0bd8ac0c93dce879" alt="Apache+subversion">  </p>
<p>如果启动报下面这个错误，是因为没有安装mod_dav_svn，而在apache和subversion通讯需要加载“mod_dav_svn.so”和“mod_authz_svn.so”模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">May 31 01:42:22 localhost httpd[11633]: Unknown DAV provider: svn</div></pre></td></tr></table></figure></p>
<p>如果通过浏览器访问，出现下面信息，说明我们部署是没有问题的，只是访问URL搞错了<br>在subversion.conf中如果配置“<location svn="">”，则浏览器访问时的URL为：<a href="http://ip/svn" target="_blank" rel="external">http://ip/svn</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">( success ( 2 2 ( ) ( edit-pipeline svndiff1 absent-entries commit-revprops depth <span class="built_in">log</span>-revprops atomic-revprops partial-replay ) ) )</div></pre></td></tr></table></figure></location></p>
<p>关于其他配置可以参考：<a href="https://www.ibm.com/developerworks/cn/java/j-lo-apache-subversion/" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/java/j-lo-apache-subversion/</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/30/部署Apache-Subversion版本控制系统/">https://yfshare.github.io/2017/05/30/部署Apache-Subversion版本控制系统/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SVN是Subversion的简称，是一个开放源代码的版本控制系统，采用C/S模式。SVN有2中数据存储模式， 一是Berkeley DB 数据库中存放数据；二是使用普通文件，采用自定义的格式来储存，称为 FSFS&lt;br&gt;两种存储格式各有优缺点，如果需要使用FSFS，在创建版本库的时候加参数“--fs-type fsfs”即可。即：“svnadmin create --fs-type fsfs /data/svn/project”&lt;br&gt;
    
    </summary>
    
      <category term="版本控制系统" scheme="https://yfshare.github.io/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/"/>
    
    
      <category term="SVN" scheme="https://yfshare.github.io/tags/SVN/"/>
    
      <category term="Subversion" scheme="https://yfshare.github.io/tags/Subversion/"/>
    
      <category term="Apache" scheme="https://yfshare.github.io/tags/Apache/"/>
    
      <category term="Http" scheme="https://yfshare.github.io/tags/Http/"/>
    
  </entry>
  
  <entry>
    <title>Hexo maupassant主题添加disqus评论系统</title>
    <link href="https://yfshare.github.io/2017/05/21/Hexo-maupassant%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0disqus%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/"/>
    <id>https://yfshare.github.io/2017/05/21/Hexo-maupassant主题添加disqus评论系统/</id>
    <published>2017-05-21T13:02:57.000Z</published>
    <updated>2017-05-21T13:07:13.950Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>需求：给博客添加评论系统<br>之前博客用的是多说评论系统，但是最近收到多说官方消息说将在2017年6月1日关闭多说评论系统，消息来源：<a href="http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241" target="_blank" rel="external">http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241</a> 。但是博客又不能没有评论系统，所以呢，所以呢就是更换评论系统咯<br><a id="more"></a><br><img src="http://note.youdao.com/yws/api/personal/file/3A52CC3A48384DA5AD3B5F47F895CC74?method=download&amp;shareKey=0a9e3d2f5589d24c85b0caf103918e05" alt="多说评论系统关闭公告"><br><img src="http://note.youdao.com/yws/api/personal/file/47D6CA8467374D12BFF55EDE87EE0DB4?method=download&amp;shareKey=e525c6a55b2d70de348771e38fbf7f6f" alt="多说评论系统关闭公告">  </p>
<p>有网友建议多说把代码开源或者出售，以后可能还能用哦，关于<a href="http://www.yfshare.vip/2017/02/14/Hexo-maupassant主题添加多说评论系统/" target="_blank" rel="external">Hexo-maupassant主题添加多说评论系统</a>在这里  </p>
<p>效果图：<br><img src="http://note.youdao.com/yws/api/personal/file/E1C7457599194CB6821E80F0C94F9C83?method=download&amp;shareKey=5adabaadfcc0caffeca8feedc7ee8fb3" alt="Disqus评论系统">  </p>
<p>首先，我们需要在<a href="https://disqus.com/" target="_blank" rel="external">disqus官网</a>注册一个帐号：<a href="https://disqus.com/profile/signup/" target="_blank" rel="external">注册跳转点这里</a>，如果有disqus帐号，<a href="https://disqus.com/profile/login/" target="_blank" rel="external">登录跳转点这里</a>  </p>
<p><a href="https://disqus.com/admin/create/" target="_blank" rel="external">创建站点</a><br>路径为：Qisqus – settings – Add Disqus to your site<br><img src="http://note.youdao.com/yws/api/personal/file/3C7B727A7F044CDAAAEEBF71F7C5BD55?method=download&amp;shareKey=a81f853f49144e8b7f616178fbf24bd1" alt="disqus_set"><br><img src="http://note.youdao.com/yws/api/personal/file/73D3129E829D4ED5A82D9F0B3F5AFC50?method=download&amp;shareKey=2c45935589cfbad7c82bd066dda4b387" alt="disqus_set">  </p>
<p>提交后，然后找到本地Hexo的maupassant主题目录(themes\maupassant)，这里就说它了<br>在maupassant主题目录(themes\maupassant)下有个_config.yml文件，在disqus项填上刚在disqus系统上注册的short_name即可<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#这里的disqus_shortname就是在disqus创建站点时的Website Name</span></div><div class="line">$ grep -i <span class="string">'^disqus'</span> themes/maupassant/_config.yml</div><div class="line">disqus: yfshare <span class="comment">## Your disqus_shortname, e.g. username</span></div><div class="line">$</div></pre></td></tr></table></figure></p>
<p>配置好后，重新提交到Github即可  </p>
<p>注：Disqus是国外的网站，要拨VPN才能流畅的访问，我在我自己的博客添加了Disqus评论系统后，拨了VPN可以正常显示，但断开VPN好像就不能显示了，纠结~。。可见文章底部  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/21/Hexo-maupassant主题添加disqus评论系统/">https://yfshare.github.io/2017/05/21/Hexo-maupassant主题添加disqus评论系统/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;需求：给博客添加评论系统&lt;br&gt;之前博客用的是多说评论系统，但是最近收到多说官方消息说将在2017年6月1日关闭多说评论系统，消息来源：&lt;a href=&quot;http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241&quot;&gt;http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241&lt;/a&gt; 。但是博客又不能没有评论系统，所以呢，所以呢就是更换评论系统咯&lt;br&gt;
    
    </summary>
    
      <category term="Hexo" scheme="https://yfshare.github.io/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://yfshare.github.io/tags/Hexo/"/>
    
      <category term="maupassant" scheme="https://yfshare.github.io/tags/maupassant/"/>
    
      <category term="Disqus" scheme="https://yfshare.github.io/tags/Disqus/"/>
    
  </entry>
  
  <entry>
    <title>JDBC执行Mysql存储过程报权限错误</title>
    <link href="https://yfshare.github.io/2017/05/17/JDBC%E6%89%A7%E8%A1%8CMysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E6%8A%A5%E6%9D%83%E9%99%90%E9%94%99%E8%AF%AF/"/>
    <id>https://yfshare.github.io/2017/05/17/JDBC执行Mysql存储过程报权限错误/</id>
    <published>2017-05-17T15:34:24.000Z</published>
    <updated>2017-05-17T16:00:23.805Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>今天开发向我反馈说Mysql账户不能调用存储过程，说没有权限，沟通后说是用tomcat配置JDBC连接的Mysql数据库的<br><a id="more"></a><br>报错信息如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java.sql.SQLException: User does not have access to metadata required to determine stored procedure parameter types. If rights can not be granted, configure connection with <span class="string">"noAccessToProcedureBodies=true"</span> to have driver generate parameters that represent INOUT strings irregardless of actual parameter types</div></pre></td></tr></table></figure></p>
<p>经过查阅资料得知，JDBC在调用存储过程时不光用户要有execute的权限，还需要对mysql.proc具有访问权限。否则它无法访问metadata<br>有两种解决办法：  </p>
<ul>
<li>给数据库连接设置一个noAccessToProcedureBodies属性，属性值为true  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jdbc:mysql://ipaddress:3306/<span class="built_in">test</span>?noAccessToProcedureBodies=<span class="literal">true</span></div></pre></td></tr></table></figure>
<p>网上说设置noAccessToProcedureBodies=true会带来一些影响(未经考证):  </p>
<ol>
<li>调用存储过程时，将没有类型检查，设为字符串类型，并且所有的参数设为int类型，但是在调用registerOutParameter时，不抛出异常  </li>
<li>存储过程的查询结果无法使用getXXX(String parameterName)的形式获取，只能通过getXXX(int parameterIndex)的方式获取  </li>
</ol>
<ul>
<li>给数据库用户赋权，赋执行mysql.proc表的select权限  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GRANT SELECT ON mysql.proc TO <span class="string">'user'</span>@<span class="string">'localhost'</span>;</div></pre></td></tr></table></figure>
<p>参考：<br><a href="http://stackoverflow.com/questions/986628/mysql-java-cant-execute-stored-procedure" target="_blank" rel="external">http://stackoverflow.com/questions/986628/mysql-java-cant-execute-stored-procedure</a><br><a href="http://space.itpub.net/18945822/viewspace-683363" target="_blank" rel="external">http://space.itpub.net/18945822/viewspace-683363</a><br><a href="http://cau99.blog.51cto.com/1855224/348792" target="_blank" rel="external">http://cau99.blog.51cto.com/1855224/348792</a><br><a href="http://www.cnblogs.com/AloneSword/p/3591702.html" target="_blank" rel="external">http://www.cnblogs.com/AloneSword/p/3591702.html</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/17/JDBC执行Mysql存储过程报权限错误/">https://yfshare.github.io/2017/05/17/JDBC执行Mysql存储过程报权限错误/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天开发向我反馈说Mysql账户不能调用存储过程，说没有权限，沟通后说是用tomcat配置JDBC连接的Mysql数据库的&lt;br&gt;
    
    </summary>
    
      <category term="Database" scheme="https://yfshare.github.io/categories/Database/"/>
    
    
      <category term="Mysql" scheme="https://yfshare.github.io/tags/Mysql/"/>
    
      <category term="JDBC" scheme="https://yfshare.github.io/tags/JDBC/"/>
    
  </entry>
  
  <entry>
    <title>KVM网络模式详解</title>
    <link href="https://yfshare.github.io/2017/05/14/KVM%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/"/>
    <id>https://yfshare.github.io/2017/05/14/KVM网络模式详解/</id>
    <published>2017-05-14T06:48:46.000Z</published>
    <updated>2017-05-14T06:51:49.958Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>KVM 客户机网络连接分为三种模式：host-only、NAT、Bridge<br><a id="more"></a>  </p>
<ul>
<li>host-only：看网上说也叫隔离模式，个人理解就类似于Vmware的仅主机模式，意思就是将所有的虚拟机组成一个局域网，不能和外界通信，不能访问Internet，其他主机也不能访问虚拟主机，安全性高。</li>
<li>NAT方式： 用户网络（User Networking）：让虚拟机访问主机、互联网或本地网络上的资源的简单方法，但是不能从网络或其他的客户机访问客户机，性能上也需要大的调整。</li>
<li>Bridge方式：虚拟网桥（Virtual Bridge）：这网络模式下客户机与宿主机处于同一网络环境，类似于一台真实的宿主机，直接访问网络资源，设置好后客户机与互联网，客户机与主机之间的通信都很容易。</li>
</ul>
<p>host-only<br>仅(虚拟)主机模式比较简单，拓扑图如下<br><img src="http://note.youdao.com/yws/api/personal/file/B315F0517F214AB38C08CA511269ECF5?method=download&amp;shareKey=5030a88551480e95137fef3895355a63" alt="host_only">  </p>
<p>桥接网络<br>Bridge方式，即客户机通过网桥连接到宿主机网络环境中，可以使客户机成为网络中具有独立IP的主机<br>注：客户机，即用KVM安装在linux宿主机中的虚拟机<br>桥接网络，也叫物理设备共享，被用作把一个物理设备复制到一台虚拟机<br><img src="http://note.youdao.com/yws/api/personal/file/98989AB92F8041D88C02ABC8A70434F2?method=download&amp;shareKey=130bdf969e2631fe19cbd16bc5936ff2" alt="Bridge"><br>网桥的基本原理就是创建一个桥接接口，并把物理主机的eth0绑定到网桥上，客户机的网络模式需要配置为桥接模式  </p>
<p>NAT网络<br>NAT方式是kvm安装后的默认方式。支持主机与虚拟机的互访，同时也支持虚拟机访问互联网，但不支持外界访问虚拟机<br>virbr0是由宿主机KVM相关模块安装的一个虚拟网络接口（TAP设备），也是一个switch和bridge，负责把内容分发到各虚拟机<br><img src="http://note.youdao.com/yws/api/personal/file/119EF0ED28464FD288E8FB5DF2B3244C?method=download&amp;shareKey=ebbd237b51390893e2bc5200e3765811" alt="NAT"><br><img src="http://note.youdao.com/yws/api/personal/file/163C1296BBC545088C2F6B5A787AD199?method=download&amp;shareKey=a36657a903506b6e3a854228fa00d701" alt="NAT"><br>virbr0是一个桥接器，给虚拟机群虚拟了一个局域网，这个局域网的网络号默认为 192.168.122.0<br>virbr0是kvm虚拟机NAT网络模式的重要角色，相当于Wmware中NAT网络模式中的虚拟NAT服务器<br>同时kvm 安装时默认 NAT 网络模式，他会修改宿主机的 iptables 规则，来实现 NAT网络模式的功能  </p>
<p>参考：<a href="http://blog.csdn.net/cooling88/article/details/52203998" target="_blank" rel="external">http://blog.csdn.net/cooling88/article/details/52203998</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/14/KVM网络模式详解/">https://yfshare.github.io/2017/05/14/KVM网络模式详解/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;KVM 客户机网络连接分为三种模式：host-only、NAT、Bridge&lt;br&gt;
    
    </summary>
    
      <category term="Virtualization" scheme="https://yfshare.github.io/categories/Virtualization/"/>
    
    
      <category term="Linux" scheme="https://yfshare.github.io/tags/Linux/"/>
    
      <category term="Kvm" scheme="https://yfshare.github.io/tags/Kvm/"/>
    
  </entry>
  
  <entry>
    <title>部署KVM虚拟机之命令行操作</title>
    <link href="https://yfshare.github.io/2017/05/14/%E9%83%A8%E7%BD%B2KVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B9%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C/"/>
    <id>https://yfshare.github.io/2017/05/14/部署KVM虚拟机之命令行操作/</id>
    <published>2017-05-14T06:20:09.000Z</published>
    <updated>2017-05-14T06:27:29.155Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>随记，这样操作键盘会错位，不晓得为啥会这样，但不影响使用<br>建议使用配置文件来安装KVM虚拟机，就不会出现这个问题了，参考：<a href="http://www.yfshare.vip/2017/05/14/部署KVM虚拟机/" target="_blank" rel="external">http://www.yfshare.vip/2017/05/14/部署KVM虚拟机/</a><br><a id="more"></a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#本地iso源安装KVM虚拟机</span></div><div class="line">[root@localhost ~]<span class="comment"># virt-install --name=Kvm_centos6.6 \</span></div><div class="line">--ram 512 \</div><div class="line">--vcpus=1 \</div><div class="line">--disk path=/kvm_data/centos6.6/centos.img,size=30 \</div><div class="line">--accelerate \</div><div class="line">--cdrom=/iso/CentOS-6.6-x86_64-bin-DVD1.iso \</div><div class="line">--graphics vnc,password=123456,port=5920 \</div><div class="line">--network bridge=br0 \</div><div class="line">--force --autostart</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>注：如果使用本地源(iso)，加参数–cdrom=；如果使用网络源，加参数–location ‘<a href="http://mirrors.aliyun.com/centos/6/os/x86_64/" target="_blank" rel="external">http://mirrors.aliyun.com/centos/6/os/x86_64/</a>‘  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#使用网络源安装KVM虚拟机</span></div><div class="line">[root@localhost ~]<span class="comment"># virt-install \</span></div><div class="line">--name Kvm_centos6.6 \</div><div class="line">--ram 512 \</div><div class="line">--disk path=/kvm_data/centos6.6/centos.img,size=30 \</div><div class="line">--vcpus 1 \</div><div class="line">--os-type linux \</div><div class="line">--os-variant rhel6 \</div><div class="line">--network bridge=br0 \</div><div class="line">--graphics none \</div><div class="line">--console pty,target_type=serial \</div><div class="line">--location <span class="string">'http://mirrors.aliyun.com/centos/6/os/x86_64/'</span> \</div><div class="line">--extra-args <span class="string">'console=ttyS0,115200n8 serial'</span></div></pre></td></tr></table></figure>
<p>说明：<br>–name  指定虚拟机的名字<br>–ram 指定内存分配多少<br>–vcpus 指定分配cpu几个<br>–os-type 指定系统类型为linux<br>–os-variant 指定系统版本<br>–network  指定网络类型<br>–graphics 指定安装通过哪种类型，可以是vnc，也可以没有图形，在这里我们没有使用图形直接使用文本方式<br>–console 指定控制台类型<br>–disk path 指定虚拟磁盘放到哪里，size=30 指定磁盘大小为30G,这样磁盘文件格式为raw，raw格式不能做快照，后面有说明，需要转换为qcow2格式，如果要使用qcow2格式的虚拟磁盘，需要事先创建qcow2格式的虚拟磁盘。 参考  <a href="http://www.361way.com/kvm-qcow2-preallocation-metadata/3354.html" target="_blank" rel="external">http://www.361way.com/kvm-qcow2-preallocation-metadata/3354.html</a><br>–extra-args 设定内核参数<br>–location 指定网络安装介质地址(http/nfs)<br>–cdrom 指定本地安装介质(iso)  </p>
<p>注：这样操作，好像键盘会错位，不晓得为啥，可以凑合着用<br>如果宿主机(linux有图形化界面的话，可以用Virtual Machine Manager也一样)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># qemu-img info /kvm_data/centos6.6/centos.img</span></div><div class="line">image: /kvm_data/centos6.6/centos.img</div><div class="line">file format: raw</div><div class="line">virtual size: 30G (32212254720 bytes)</div><div class="line">disk size: 1.9G</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>使用virt-install 工具安装虚拟机后，会在/etc/libvirt/qemu/目录下生成Kvm_centos6.6.xml文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># virsh list --all</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"> 7     Kvm_centos6.6                  running</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#开机自动启动虚拟机</span></div><div class="line">[root@localhost ~]<span class="comment"># virsh autostart Kvm_centos6.6</span></div><div class="line">Domain Kvm_centos6.6 marked as autostarted</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ll  /var/lib/libvirt/qemu</span></div><div class="line">total 12</div><div class="line">drwxr-xr-x 2 root root 4096 May 12 11:23 dump</div><div class="line">srwxr-xr-x 1 qemu qemu    0 May 12 13:51 Kvm_centos6.6.monitor   </div><div class="line">drwxr-xr-x 2 qemu qemu 4096 May 12 11:23 save</div><div class="line">drwxr-xr-x 2 qemu qemu 4096 May 12 11:23 snapshot</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># top -d 1 | grep kvm</span></div><div class="line">  2552 qemu      20   0  855m 241m 5804 S 15.9 24.6  18:24.97 qemu-kvm</div><div class="line">  2552 qemu      20   0  855m 241m 5804 R 15.9 24.6  18:25.13 qemu-kvm</div><div class="line">  2552 qemu      20   0  855m 241m 5804 R 12.9 24.6  18:25.26 qemu-kvm</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>修改KVM虚拟机磁盘格式：<br>参考：<a href="https://www.ibm.com/developerworks/cn/linux/1409_qiaoly_qemuimgages/" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/linux/1409_qiaoly_qemuimgages/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#kvm默认是raw磁盘格式，这里可在安装时指定为qcow2磁盘格式</span></div><div class="line">qemu-img create <span class="_">-f</span> qcow2 -o preallocation=metadata  /data/daixuan2.img 10G</div><div class="line">[root@localhost ~]<span class="comment"># virt-install \</span></div><div class="line">--name centos \</div><div class="line">--ram 512 \</div><div class="line">--disk path=/data/centos.img,format=qcow2,size=10,bus=virtio \</div><div class="line">--vcpus 1 \</div><div class="line">--os-type linux \</div><div class="line">--os-variant rhel6 \</div><div class="line">--network bridge=br1 \</div><div class="line">--graphics none \</div><div class="line">--console pty,target_type=serial \</div><div class="line">--location <span class="string">'http://mirrors.163.com/centos/6.7/os/x86_64/'</span> \</div><div class="line">--extra-args <span class="string">'console=ttyS0,115200n8 serial'</span></div></pre></td></tr></table></figure></p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/14/部署KVM虚拟机之命令行操作/">https://yfshare.github.io/2017/05/14/部署KVM虚拟机之命令行操作/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;随记，这样操作键盘会错位，不晓得为啥会这样，但不影响使用&lt;br&gt;建议使用配置文件来安装KVM虚拟机，就不会出现这个问题了，参考：&lt;a href=&quot;http://www.yfshare.vip/2017/05/14/部署KVM虚拟机/&quot;&gt;http://www.yfshare.vip/2017/05/14/部署KVM虚拟机/&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Virtualization" scheme="https://yfshare.github.io/categories/Virtualization/"/>
    
    
      <category term="Linux" scheme="https://yfshare.github.io/tags/Linux/"/>
    
      <category term="Kvm" scheme="https://yfshare.github.io/tags/Kvm/"/>
    
  </entry>
  
  <entry>
    <title>部署KVM虚拟机</title>
    <link href="https://yfshare.github.io/2017/05/14/%E9%83%A8%E7%BD%B2KVM%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    <id>https://yfshare.github.io/2017/05/14/部署KVM虚拟机/</id>
    <published>2017-05-14T04:13:15.000Z</published>
    <updated>2017-05-14T06:42:18.371Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>KVM是指基于Linux内核的虚拟机(Kernel-base Virtual Machine)，在KVM模型中，每一个虚拟机都是一个由Linux调度程序管理的标准进程，你可以在用户空间启动客户机操作系统，一个普通的Linux进程有两种运行模式：内核和用户，KVM增加了第三种模式：客户模式（有自己的内核和用户模式）<br><a id="more"></a><br>KVM虚拟机的管理工具<br>准确的来说，KVM仅仅是Linux内核的一个模块，管理和创建完整的KVM虚拟机，需要更多的辅助工具<br>QEMU-KVM：在Linux系统中，首先我们可以用modprobe命令加载KVM模块，如果用RPM安装KVM软件包，系统会在启动时自动加载模块，QEMU是一个强大的虚拟软件，它可以虚拟不同的构架<br>Virt-manager：尽管QEMU-KVM工具可以创建和管理KVM虚拟机，RedHat为KVM开发了更多的辅助工具，比如 libvirt libguestfs等，原因是QEMU工具效率不高，不易于使用  </p>
<h2 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h2><p>首先需要CPU支持虚拟化功能(VT-X/AMD-V)并开启，如果机器支持虚拟化需要在BIOS开启。如有有，把Virtualization Technology这个功能打开即可  </p>
<p>环境：<br>　　　Centos 6.6 </p>
<p>清除iptables规则和Selinux<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/iptables status</span></div><div class="line">iptables: Firewall is not running.</div><div class="line">[root@localhost ~]<span class="comment"># getenforce </span></div><div class="line">Disabled</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>检查你的系统是否支持虚拟化。如果有输出内容，则支持，其中intel cpu支持会有vmx，amd cpu支持会有svm<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># grep -Ei 'vmx|svm' /proc/cpuinfo</span></div><div class="line">flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov </div><div class="line">pat pse36 clflush dts mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc up arch_perfmon pebs bts xtopology tsc_reliable nonstop_tsc aperfmperf unfair_spinlock pni pclmulqdq vmx ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm ida arat epb xsaveopt pln pts dts tpr_shadow vnmi ept vpid fsgsbase bmi1 avx2 smep bmi2 invpcid</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>注：我这里使用的是Vmware Workstation，如果本身机器支持并开启了，但这里还是查不到。需要检查vmware虚拟机是否开启了虚拟化功能<br><img src="http://note.youdao.com/yws/api/personal/file/BEF83767E54A448BBE2610A0E3F93991?method=download&amp;shareKey=2c8a6f4a180cac114cd2af911f72d518" alt="vmware_vmset">  </p>
<h2 id="安装KVM虚拟机"><a href="#安装KVM虚拟机" class="headerlink" title="安装KVM虚拟机"></a>安装KVM虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install kvm python-virtinst libvirt libvirt-client bridge-utils virt-manager qemu-kvm qemu-kvm-tools virt-viewer virt-v2v avahi dmidecode tunctl</span></div></pre></td></tr></table></figure>
<p>说明：<br>kvm：软件包中含有KVM内核模块，它在默认linux内核中提供kvm管理程序<br>libvirts：安装虚拟机管理工具，使用virsh等命令来管理和控制虚拟机<br>bridge-utils：设置网络网卡桥接<br>virt-*：创建、克隆虚拟机命令，以及图形化管理工具virt-manager<br>qemu-img：安装qemu组件，使用qemu命令来创建磁盘等  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/libvirtd restart</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/messagebus restart</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/avahi-daemon restart</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># chkconfig libvirtd on</span></div><div class="line">[root@localhost ~]<span class="comment"># chkconfig messagebus on</span></div><div class="line">[root@localhost ~]<span class="comment"># chkconfig avahi-daemon on</span></div></pre></td></tr></table></figure>
<p>检查KVM模块是否加载：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#如果没有加载KVM模块，执行下modprobe kvm-intel试试，如果还不行，就重启下</span></div><div class="line">[root@localhost ~]<span class="comment"># lsmod |grep kvm</span></div><div class="line">kvm_intel              55496  0 </div><div class="line">kvm                   337772  1 kvm_intel</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># virsh list --all</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># virt-install --version</span></div><div class="line">0.600.0</div><div class="line">[root@localhost ~]<span class="comment"># virsh --version</span></div><div class="line">0.10.2</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>KVM网络配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /etc/sysconfig/network-scripts/</span></div><div class="line">[root@localhost network-scripts]<span class="comment"># cp ifcfg-eth0 ifcfg-br0</span></div><div class="line">[root@localhost network-scripts]<span class="comment"># cat ifcfg-br0 </span></div><div class="line">DEVICE=br0</div><div class="line">TYPE=Bridge</div><div class="line">ONBOOT=yes</div><div class="line">NM_CONTROLLED=yes</div><div class="line">BOOTPROTO=static</div><div class="line">IPADDR=192.168.1.160</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.1.1</div><div class="line">DNS1=114.114.114.114</div><div class="line">[root@localhost network-scripts]<span class="comment"># </span></div><div class="line">[root@localhost network-scripts]<span class="comment"># cat ifcfg-eth0 </span></div><div class="line">DEVICE=eth0</div><div class="line">HWADDR=00:0C:29:BA:C8:85</div><div class="line">TYPE=Ethernet</div><div class="line">UUID=9f21503e-9a56-4f7c-97dc-4516fb960816</div><div class="line">ONBOOT=yes</div><div class="line">NM_CONTROLLED=no</div><div class="line">BOOTPROTO=none</div><div class="line">BRIDGE=br0</div><div class="line">[root@localhost network-scripts]<span class="comment"># /etc/init.d/network restart</span></div></pre></td></tr></table></figure></p>
<p>查看网络接口列表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># brctl show</span></div><div class="line">bridge name	bridge id		STP enabled	interfaces</div><div class="line">br0		8000.000c29bac885	no		eth0</div><div class="line">virbr0		8000.52540045e79f	yes		virbr0-nic</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ip a</span></div><div class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </div><div class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</div><div class="line">    inet 127.0.0.1/8 scope host lo</div><div class="line">    inet6 ::1/128 scope host </div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP ql</div><div class="line">en 1000    link/ether 00:0c:29:ba:c8:85 brd ff:ff:ff:ff:ff:ff</div><div class="line">    inet6 fe80::20c:29ff:feba:c885/64 scope link </div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">3: virbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOW</div><div class="line">N     link/ether 52:54:00:45:e7:9f brd ff:ff:ff:ff:ff:ff</div><div class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</div><div class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 500</div><div class="line">    link/ether 52:54:00:45:e7:9f brd ff:ff:ff:ff:ff:ff</div><div class="line">6: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN </div><div class="line">    link/ether 00:0c:29:ba:c8:85 brd ff:ff:ff:ff:ff:ff</div><div class="line">    inet 192.168.1.160/24 brd 192.168.5.255 scope global br0</div><div class="line">    inet6 fe80::20c:29ff:feba:c885/64 scope link </div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># mkdir -p /kvm_data/&#123;iso,system&#125;</span></div><div class="line">[root@localhost ~]<span class="comment"># ls /kvm_data/iso/      #安装镜像放这里</span></div><div class="line">CentOS-6.6-x86_64-bin-DVD1.iso</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#制作虚拟机镜像</span></div><div class="line">[root@localhost ~]<span class="comment"># mkdir -p /kvm_data/system/centos6_1</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /kvm_data/system/centos6_1/</span></div><div class="line">[root@localhost centos6_1]<span class="comment"># qemu-img create -f qcow2 centos6_1.qcow2 30G</span></div><div class="line">Formatting <span class="string">'centos6_1.qcow2'</span>, fmt=qcow2 size=32212254720 encryption=off cluster_size=65536 </div><div class="line">[root@localhost centos6_1]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#模版demo_template.xml</span></div><div class="line">[root@localhost ~]<span class="comment"># cat /kvm_data/demo_template.xml </span></div><div class="line">&lt;domain <span class="built_in">type</span>=<span class="string">'kvm'</span>&gt;</div><div class="line">    &lt;name&gt;centos6&lt;/name&gt; //虚拟机名称</div><div class="line">    &lt;uuid&gt;77a83ddb-5ac8-43c3-be22<span class="_">-f</span>8e7156d5784&lt;/uuid&gt;</div><div class="line">    &lt;memory&gt;524288&lt;/memory&gt; //最大内存，单位kb</div><div class="line">    &lt;currentMemory&gt;524288&lt;/currentMemory&gt; //可用内存，单位kb</div><div class="line">    &lt;vcpu&gt;1&lt;/vcpu&gt; //虚拟cpu个数</div><div class="line">    &lt;os&gt;</div><div class="line">      &lt;<span class="built_in">type</span> arch=<span class="string">'x86_64'</span> machine=<span class="string">'pc'</span>&gt;hvm&lt;/<span class="built_in">type</span>&gt;</div><div class="line">      &lt;boot dev=<span class="string">'hd'</span>/&gt; //从硬盘启动</div><div class="line">   &lt;/os&gt;</div><div class="line">   &lt;features&gt;</div><div class="line">     &lt;acpi/&gt;</div><div class="line">     &lt;apic/&gt;</div><div class="line">     &lt;pae/&gt;</div><div class="line">   &lt;/features&gt;</div><div class="line">   &lt;clock offset=<span class="string">'localtime'</span>/&gt;</div><div class="line">   &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</div><div class="line">   &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</div><div class="line">   &lt;on_crash&gt;destroy&lt;/on_crash&gt;</div><div class="line">   &lt;devices&gt;</div><div class="line">     &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</div><div class="line">     &lt;disk <span class="built_in">type</span>=<span class="string">'file'</span> device=<span class="string">'disk'</span>&gt;</div><div class="line">      &lt;driver name=<span class="string">'qemu'</span> <span class="built_in">type</span>=<span class="string">'qcow2'</span>/&gt;</div><div class="line">       &lt;<span class="built_in">source</span> file=<span class="string">'/kvm_data/system/centos6_1/centos6_1.qcow2'</span>/&gt; //目的镜像路径</div><div class="line">       &lt;target dev=<span class="string">'hda'</span> bus=<span class="string">'ide'</span>/&gt;</div><div class="line">     &lt;/disk&gt;</div><div class="line">     &lt;disk <span class="built_in">type</span>=<span class="string">'file'</span> device=<span class="string">'cdrom'</span>&gt;</div><div class="line">       &lt;<span class="built_in">source</span> file=<span class="string">'/kvm_data/iso/CentOS-6.6-x86_64-bin-DVD1.iso'</span>/&gt; //光盘镜像路径</div><div class="line">       &lt;target dev=<span class="string">'hdb'</span> bus=<span class="string">'ide'</span>/&gt;</div><div class="line">     &lt;/disk&gt;</div><div class="line">    &lt;interface <span class="built_in">type</span>=<span class="string">'bridge'</span>&gt; //虚拟机网络连接方式</div><div class="line">      &lt;<span class="built_in">source</span> bridge=<span class="string">'br0'</span>/&gt; //当前主机网桥的名称</div><div class="line">      &lt;mac address=<span class="string">"00:16:00:1e:5a:0d"</span>/&gt; //为虚拟机分配mac地址，务必唯一，否则dhcp获得同样ip,引起冲突</div><div class="line">    &lt;/interface&gt;</div><div class="line">    &lt;input <span class="built_in">type</span>=<span class="string">'mouse'</span> bus=<span class="string">'ps2'</span>/&gt;</div><div class="line">     &lt;graphics <span class="built_in">type</span>=<span class="string">'vnc'</span> port=<span class="string">'-1'</span> autoport=<span class="string">'yes'</span> listen = <span class="string">'0.0.0.0'</span> keymap=<span class="string">'en-us'</span>/&gt;//vnc方式登录，端口号自动分配，自动</div><div class="line">加1，可以通过virsh vncdisplay来查询   &lt;/devices&gt;</div><div class="line"> &lt;/domain&gt;</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#复制模版demo_template.xml</span></div><div class="line">[root@localhost centos6_1]<span class="comment"># cp /kvm_data/demo_template.xml ./centos6_1.xml</span></div><div class="line">[root@localhost centos6_1]<span class="comment"># ls</span></div><div class="line">centos6_1.qcow2  centos6_1.xml</div><div class="line">[root@localhost centos6_1]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#定义虚拟机，define告诉libvirt,要被libvirt管理</span></div><div class="line">[root@localhost centos6_1]<span class="comment"># virsh define centos6_1.xml</span></div><div class="line">Domain centos6 defined <span class="keyword">from</span> centos6_1.xml</div><div class="line"></div><div class="line">[root@localhost centos6_1]<span class="comment"># virsh list --all</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"> -     centos6                        shut <span class="literal">off</span></div><div class="line"></div><div class="line">[root@localhost centos6_1]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#启动虚拟机</span></div><div class="line">[root@localhost centos6_1]<span class="comment"># virsh start centos6</span></div><div class="line">Domain centos6 started</div><div class="line"></div><div class="line"><span class="comment">#查看虚拟机vnc端口</span></div><div class="line">[root@localhost centos6_1]<span class="comment"># virsh vncdisplay centos6</span></div><div class="line">:<span class="number">0</span></div><div class="line"></div><div class="line">[root@localhost centos6_1]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#安装vncviewer和xhost用于图形化安装Linux系统</span></div><div class="line">[root@localhost ~]<span class="comment"># yum -y install tigervnc xhost</span></div><div class="line">[root@localhost ~]<span class="comment"># export DISPLAY=192.168.1.105:0.0</span></div><div class="line"></div><div class="line"><span class="comment">#需要打开Xmanager - Passive</span></div><div class="line">[root@localhost ~]<span class="comment"># xhost +</span></div><div class="line">[root@localhost ~]<span class="comment"># vncviewer 192.168.1.160:0</span></div></pre></td></tr></table></figure>
<p>接下来开始安装系统(略)<br><img src="http://note.youdao.com/yws/api/personal/file/B297E3ECB88A413F8CEFF46392895404?method=download&amp;shareKey=0fcc26483272ea3eeb58c624ce2db1d4" alt="kvm_install"><br><img src="http://note.youdao.com/yws/api/personal/file/0DE1C86363BA41408A4944B7DC08219F?method=download&amp;shareKey=2d2447e0174953874a5005182b9781c5" alt="kvm_install"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#kvm虚拟机安装成功</span></div><div class="line">[root@localhost ~]<span class="comment"># virsh list --all</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"> 2     centos6                        running</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># virsh autostart centos6    #设定kvm虚拟机开机自启</span></div><div class="line">Domain centos6 marked as autostarted</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># qemu-img info /kvm_data/system/centos6_1/centos6_1.qcow2 </span></div><div class="line">image: /kvm_data/system/centos6_1/centos6_1.qcow2</div><div class="line">file format: qcow2</div><div class="line">virtual size: 30G (32212254720 bytes)</div><div class="line">disk size: 2.1G</div><div class="line">cluster_size: 65536</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ll /var/lib/libvirt/qemu</span></div><div class="line">total 12</div><div class="line">srwxr-xr-x 1 qemu qemu    0 May 14 11:41 centos6.monitor      <span class="comment">#这里的文件，是libvirtd在重启后，虚拟机也随着自动重启</span></div><div class="line">drwxr-xr-x 2 root root 4096 May 14 11:05 dump</div><div class="line">drwxr-xr-x 2 qemu qemu 4096 May 14 11:05 save</div><div class="line">drwxr-xr-x 2 qemu qemu 4096 May 14 11:05 snapshot</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#动态查询kvm资源占用情况，每一台VM，对应一个qemu-kvm进程</span></div><div class="line">[root@localhost ~]<span class="comment"># top -d 1 | grep kvm</span></div><div class="line">  2601 qemu      20   0  796m 530m 3928 S  1.0 28.5   5:27.72 qemu-kvm                                                   </div><div class="line">  2601 qemu      20   0  796m 530m 3928 S  1.0 28.5   5:27.73 qemu-kvm                                                   </div><div class="line">  2601 qemu      20   0  796m 530m 3928 S  1.0 28.5   5:27.74 qemu-kvm                                                   </div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="部署多台KVM虚拟机"><a href="#部署多台KVM虚拟机" class="headerlink" title="部署多台KVM虚拟机"></a>部署多台KVM虚拟机</h2><ol>
<li>使用qemu-img创建虚拟机镜像  </li>
<li>拷贝demo_template.xml模版配置文件并修改里的参数，如：UUID/MASK地址/镜像存储位置/ISO镜像目录等</li>
<li>virsh define vm_name和virsh start vm_name即可</li>
</ol>
<h2 id="常见问题解决办法"><a href="#常见问题解决办法" class="headerlink" title="常见问题解决办法"></a>常见问题解决办法</h2><p>如果报这个错，把NetworkManager服务关掉就OK了，因为和桥接有冲突<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Bringing up interface br0:  Error: Connection activation failed: Failed to determine connection<span class="string">'s virtual interface name</span></div></pre></td></tr></table></figure></p>
<p>如果出现下面的错误，需要安装一个avahi软件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR    Failed to connect socket to <span class="string">'/var/run/libvirt/libvirt-sock'</span>: No such file or directory</div></pre></td></tr></table></figure></p>
<p>解决办法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install avahi</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/messagebus restart</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/avahi-daemon restart</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/libvirtd restart</span></div></pre></td></tr></table></figure></p>
<p>如果报这个错，表示disk path选项中的size指定的值大于当前实际磁盘空间<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WARNING  The filesystem will<span class="built_in"> not </span>have enough free space to fully allocate the<span class="built_in"> sparse </span>file when the guest is running. 6144</div><div class="line">0 M requested &gt; 42184 M available</div></pre></td></tr></table></figure></p>
<p>如果报这个错，是因为存在相同名字的虚拟机，即使删掉虚拟机的配置文件也会报这个错<br>kvm和xen不同，xen的半虚拟化要想重装，只要把创建好的虚拟机配置文件删掉就可以了，kvm如果想要重装相同名字的虚拟机，只需要在虚拟机停止的状态下执行如下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR    Guest name <span class="string">'Kvm_centos6.6'</span> is already <span class="keyword">in</span> use.</div></pre></td></tr></table></figure></p>
<p>解决办法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># virsh destroy Kvm_centos6.6</span></div><div class="line">Domain Kvm_centos6.6 destroyed</div><div class="line">[root@localhost ~]<span class="comment"># virsh undefine Kvm_centos6.6</span></div><div class="line">Domain Kvm_centos6.6 has been undefined</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>如果出现下面的错误，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kvm cpu0 disabled perfctr wrmsr 0xc1 data 0xabcd</div></pre></td></tr></table></figure></p>
<h2 id="KVM常用命令"><a href="#KVM常用命令" class="headerlink" title="KVM常用命令"></a>KVM常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#virsh -c qemu:///system list  </span></div><div class="line"><span class="comment">#virsh list  </span></div><div class="line"><span class="comment">#virsh list --all //查看所有状态的虚拟机</span></div><div class="line"><span class="comment">#virsh shutdown myWin7 //关闭myWin7虚拟机</span></div><div class="line"><span class="comment">#virsh destroy myWin7 //删除myWin7虚拟机</span></div><div class="line"><span class="comment">#virsh start node4 //开机虚拟机</span></div><div class="line"><span class="comment">#virsh define /etc/libvirt/qemu/node5.xml #根据主机配置文档添加虚拟机</span></div><div class="line"><span class="comment">#virsh dumpxml node4 &gt; /etc/libvirt/qemu/node6.xml //将node4虚机的配置文件保存至node6.xml</span></div><div class="line"><span class="comment">#virsh edit node6 //修改node6的配置文件</span></div><div class="line"><span class="comment">#virsh suspend vm_name   //暂停虚拟机</span></div><div class="line"><span class="comment">#virsh resume vm_name    //恢复虚拟机</span></div><div class="line"> Kvm配置文件路径 ：</div><div class="line">/etc/libvirtd/qemu/***.xml 可以通过vim对配置文件进行管理，编辑后需要<span class="comment">#service libvirtd restart(不会对现有VM有影响)</span></div></pre></td></tr></table></figure>
<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><ol>
<li>图形化配置：从菜单中启动，或者运行virt-manager进入图形管理界面，比较简单，不过img的位置需要注意一下，kvm安装后会有一个默认位置，不注意的话容易占满空间。或者直接硬盘分区时单独给/var分一个区  </li>
<li>虚拟机重新配置：<br>虚拟机的配置文件保存在/etc/libvirt/qemu目录下，扩展名是xml。修改相应的文件即可重新配置虚拟机  </li>
<li><p>虚拟机备份及恢复：<br>备份：拷贝/etc/libvirt/qemu目录下的xml配置文件，以及xml中设置的img文件<br>恢复：进入virsh，执行define 目录下的xml文件路径  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># virsh</span></div><div class="line">virsh <span class="comment"># define /etc/libvirt/qemu/winxp.xml</span></div></pre></td></tr></table></figure>
</li>
<li><p>开机自动启动虚拟机：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vfeelit qemu]<span class="comment"># virsh autostart Winxp</span></div></pre></td></tr></table></figure>
</li>
<li><p>克隆KVM虚拟机：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vfeelit ~]<span class="comment"># virt-clone -o Winxp -n winxpclong -f /var/lib/libvirt/images/winxpclong.img</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>(-o 原始客体的名称，-n新客户端的名称，-f作为新客户端磁盘映像的新文件)  </p>
<ol>
<li>虚拟机意外关机报下述错误：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vfeelit qemu]<span class="comment"># virsh start winxp</span></div><div class="line">错误：开始域 winxp 失败</div><div class="line">错误：Unable to <span class="built_in">read</span> from monitor: Connection reset by peer</div></pre></td></tr></table></figure>
</li>
</ol>
<p>解决方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virsh managedsave-remove winxp</div></pre></td></tr></table></figure></p>
<p>Virsh语法参考  </p>
<table>
<thead>
<tr>
<th>命令</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>Autostart</td>
<td>自动开始一个域</td>
</tr>
<tr>
<td>Create</td>
<td>从一个XML文件创建一个域</td>
</tr>
<tr>
<td>Define</td>
<td>从一个XML文件定义(但不开始)一个域</td>
</tr>
<tr>
<td>edit</td>
<td>编辑某个域的 XML 配置</td>
</tr>
<tr>
<td>shutdown</td>
<td>关闭一个域</td>
</tr>
<tr>
<td>start</td>
<td>开始一个(以前定义的)非活跃的域</td>
</tr>
<tr>
<td>reboot</td>
<td>重新启动一个域</td>
</tr>
<tr>
<td>suspend</td>
<td>挂起一个域</td>
</tr>
<tr>
<td>resume</td>
<td>重新恢复一个域</td>
</tr>
<tr>
<td>vncdisplay</td>
<td>vnc 显示</td>
</tr>
</tbody>
</table>
<p>使用save来备份当前虚拟机的状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># virsh save --bypass-cache centos6 /var/lib/libvirt/images/test_centos6 --running</span></div><div class="line"></div><div class="line">Domain centos6 saved to /var/lib/libvirt/images/test_centos6</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># virsh list</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>这个命令将Kvm_centos6.6的当前状态保存到/var/lib/libvirt/images/文件中。–running参数表示下次restore回来的时候能够自动启动RedHat，这个命令会导致RedHat被关闭<br>现在还原：必须先关闭虚拟机<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># virsh restore /var/lib/libvirt/images/test_centos6 --bypass-cache --running (还原时不要指定虚拟机名称)</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># virsh list --all</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"> 6     centos6                  running</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>附件：<br><a href="http://note.youdao.com/yws/api/personal/file/34E833FCF9284B4F9086BE10693978E8?method=download&amp;shareKey=8848490fd7479386d223a89d31cffe44" target="_blank" rel="external">demo_template.xml</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/14/部署KVM虚拟机/">https://yfshare.github.io/2017/05/14/部署KVM虚拟机/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;KVM是指基于Linux内核的虚拟机(Kernel-base Virtual Machine)，在KVM模型中，每一个虚拟机都是一个由Linux调度程序管理的标准进程，你可以在用户空间启动客户机操作系统，一个普通的Linux进程有两种运行模式：内核和用户，KVM增加了第三种模式：客户模式（有自己的内核和用户模式）&lt;br&gt;
    
    </summary>
    
      <category term="Virtualization" scheme="https://yfshare.github.io/categories/Virtualization/"/>
    
    
      <category term="Linux" scheme="https://yfshare.github.io/tags/Linux/"/>
    
      <category term="Kvm" scheme="https://yfshare.github.io/tags/Kvm/"/>
    
  </entry>
  
  <entry>
    <title>部署JIRA 7.2.2 for Linux</title>
    <link href="https://yfshare.github.io/2017/05/09/%E9%83%A8%E7%BD%B2JIRA-7-2-2-for-Linux/"/>
    <id>https://yfshare.github.io/2017/05/09/部署JIRA-7-2-2-for-Linux/</id>
    <published>2017-05-09T06:06:34.000Z</published>
    <updated>2017-05-09T06:33:24.000Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>jira是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪（bug管理）、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域<br><a id="more"></a><br>首页：<a href="https://www.atlassian.com/" target="_blank" rel="external">https://www.atlassian.com/</a><br>　　　<a href="https://www.atlassian.com/software/jira/core" target="_blank" rel="external">https://www.atlassian.com/software/jira/core</a>  </p>
<p>JIRA Core各个版本下载地址(目前最新版是7.3.6)：<a href="https://www.atlassian.com/software/jira/core/update" target="_blank" rel="external">https://www.atlassian.com/software/jira/core/update</a><br>JIRA7.2 for Linux官方安装手册：<a href="https://confluence.atlassian.com/adminjiraserver072/installing-jira-applications-on-linux-828787555.html" target="_blank" rel="external">https://confluence.atlassian.com/adminjiraserver072/installing-jira-applications-on-linux-828787555.html</a>  </p>
<h2 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备  "></a>安装前准备  </h2><p>环境：<br>　　　Centos 6.8<br>　　　JIRA Core server 7.2.2<br>　　　Mysql 5.6.36  </p>
<p>服务器内存建议大于3G<br>安装JIRA7.2所需要的系统配置：<a href="https://confluence.atlassian.com/adminjiraserver072/supported-platforms-828787550.html" target="_blank" rel="external">https://confluence.atlassian.com/adminjiraserver072/supported-platforms-828787550.html</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装JIRA对环境的要求</span></div><div class="line">Mysql = 5.5，5.6</div><div class="line">JDK = 1.8</div><div class="line">    ≠ Java 1.8.0_25 and 1.8.0_31 and Java 1.8.0_45</div><div class="line">Tomcat = 8.0.33  <span class="comment">#不支持单个tomcat部署多个Atlassian应用</span></div></pre></td></tr></table></figure></p>
<p>JIRA需要依赖JAVA环境，因此我们需要安装jdk，且需要jdk 1.8以上<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># java -version</span></div><div class="line">java version <span class="string">"1.8.0_20"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_20-b26)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.20-b23, mixed mode)</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>除此之外，JIRA需要使用外部数据库，JIRA支持PostgreSQL, Oracle, MySQL, SQL Server，这里我们选择Mysql<br>JIRA关于Mysql的配置说明：<a href="https://confluence.atlassian.com/adminjiraserver072/connecting-jira-applications-to-mysql-828787562.html" target="_blank" rel="external">https://confluence.atlassian.com/adminjiraserver072/connecting-jira-applications-to-mysql-828787562.html</a>  </p>
<p>Mysql 5.6 Yum源(rpm)：<a href="http://note.youdao.com/yws/api/personal/file/9F81786CBC5748E69B2F34FC7BE160D6?method=download&amp;shareKey=aca90d80731cf2a892d421787e401289" target="_blank" rel="external">点击下载</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装并配置Mysql数据库</span></div><div class="line">[root@localhost ~]<span class="comment"># yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm</span></div><div class="line">[root@localhost ~]<span class="comment"># yum -y install mysql-community-server.x86_64 mysql-community-devel.x86_64 mysql-community-client.x86_64</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/mysqld start</span></div><div class="line">[root@localhost ~]<span class="comment"># /usr/bin/mysqladmin -u root password '123456'</span></div><div class="line">[root@localhost ~]<span class="comment"># chkconfig mysqld on</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># grep -iA6 confluence /etc/my.cnf </span></div><div class="line">[mysqld]</div><div class="line">...</div><div class="line"><span class="comment">#confluence configure</span></div><div class="line">character-set-server=utf8</div><div class="line">collation-server=utf8_bin</div><div class="line">default-storage-engine=INNODB</div><div class="line">max_allowed_packet=256M</div><div class="line">innodb_log_file_size=2GB</div><div class="line">transaction-isolation=READ-COMMITTED</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/mysqld restart</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># mysql -uroot -p123456</span></div><div class="line">mysql&gt; CREATE DATABASE jiradb CHARACTER SET utf8 COLLATE utf8_bin;</div><div class="line">mysql&gt; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER,INDEX on jiradb.* TO <span class="string">'jir</span></div><div class="line">a'@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'jirapass'</span>;</div><div class="line">mysql&gt; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER,INDEX on jiradb.* TO <span class="string">'jir</span></div><div class="line">a'@<span class="string">'192.168.31.117'</span> IDENTIFIED BY <span class="string">'jirapass'</span>;</div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div><div class="line"></div><div class="line">mysql&gt; SHOW GRANTS FOR <span class="string">'jira'</span>@<span class="string">'localhost'</span>;</div><div class="line">+-------------------------------------------------------------------------------------------------------------+</div><div class="line">| Grants <span class="keyword">for</span> jira@localhost                                                                                   |</div><div class="line">+-------------------------------------------------------------------------------------------------------------+</div><div class="line">| GRANT USAGE ON *.* TO <span class="string">'jira'</span>@<span class="string">'localhost'</span> IDENTIFIED BY PASSWORD <span class="string">'*F6300EC05CFE78CF8A64ADD7EB065178DEC0B866'</span> |</div><div class="line">| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON `jiradb`.* TO <span class="string">'jira'</span>@<span class="string">'localhost'</span>        |</div><div class="line">+-------------------------------------------------------------------------------------------------------------+</div><div class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; SHOW GRANTS FOR <span class="string">'jira'</span>@<span class="string">'192.168.31.117'</span>;</div><div class="line">+------------------------------------------------------------------------------------------------------------------+</div><div class="line">| Grants <span class="keyword">for</span> jira@192.168.31.117                                                                                   |</div><div class="line">+------------------------------------------------------------------------------------------------------------------+</div><div class="line">| GRANT USAGE ON *.* TO <span class="string">'jira'</span>@<span class="string">'192.168.31.117'</span> IDENTIFIED BY PASSWORD <span class="string">'*F6300EC05CFE78CF8A64ADD7EB065178DEC0B866'</span> |</div><div class="line">| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON `jiradb`.* TO <span class="string">'jira'</span>@<span class="string">'192.168.31.117'</span>        |</div><div class="line">+------------------------------------------------------------------------------------------------------------------+</div><div class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; \q</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="安装JIRA-7-2-2"><a href="#安装JIRA-7-2-2" class="headerlink" title="安装JIRA 7.2.2  "></a>安装JIRA 7.2.2  </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># chmod u+x atlassian-jira-software-7.2.2-x64.bin </span></div><div class="line">[root@localhost ~]<span class="comment"># ./atlassian-jira-software-7.2.2-x64.bin </span></div><div class="line">Unpacking JRE ...</div><div class="line">Starting Installer ...</div><div class="line">May 09, 2017 10:52:01 AM java.util.prefs.FileSystemPreferences<span class="variable">$1</span> run</div><div class="line">INFO: Created user preferences directory.</div><div class="line"></div><div class="line">This will install JIRA Software 7.2.2 on your computer.</div><div class="line">OK [o, Enter], Cancel [c]</div><div class="line">o</div><div class="line">Choose the appropriate installation or upgrade option.</div><div class="line">Please choose one of the following:</div><div class="line">Express Install (use default settings) [1], Custom Install (recommended <span class="keyword">for</span> advanced users) [2, Enter], Upgrade an existi</div><div class="line">ng JIRA installation [3]1</div><div class="line">Details on <span class="built_in">where</span> JIRA Software will be installed and the settings that will be used.</div><div class="line">c</div><div class="line">HTTP Port: 8080 </div><div class="line">RMI Port: 8005 </div><div class="line">Install as service: Yes </div><div class="line">Install [i, Enter], Exit [e]</div><div class="line">i</div><div class="line"></div><div class="line">Extracting files ...</div><div class="line"></div><div class="line">Please <span class="built_in">wait</span> a few moments <span class="keyword">while</span> JIRA Software starts up.</div><div class="line">Launching JIRA Software ...</div><div class="line">Installation of JIRA Software 7.2.2 is complete</div><div class="line">Your installation of JIRA Software 7.2.2 is now ready and can be accessed</div><div class="line">via your browser.</div><div class="line">JIRA Software 7.2.2 can be accessed at http://localhost:8080</div><div class="line">Finishing installation ...</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># netstat -tunlp | grep 8080</span></div><div class="line">tcp        0      0 :::8080                     :::*                        LISTEN      50711/java          </div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#JIRA的安装目录和家目录</span></div><div class="line">Installation Directory: /opt/atlassian/jira </div><div class="line">Home Directory: /var/atlassian/application-data/jira </div><div class="line"><span class="comment">#如果需要修改端口之类的，需要修改/opt/atlassian/jira/conf/server.xml这个配置文件</span></div><div class="line"><span class="comment">#数据库的配置文件是/var/atlassian/application-data/jira/dbconfig.xml</span></div></pre></td></tr></table></figure>
<h2 id="破解JIRA-7-2-2"><a href="#破解JIRA-7-2-2" class="headerlink" title="破解JIRA 7.2.2  "></a>破解JIRA 7.2.2  </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/jira stop</span></div><div class="line"><span class="comment">#进入JIRA安装目录，上传破解文件</span></div><div class="line"><span class="comment">#atlassian-extras-3.1.2.jar替换原来的atlassian-extras-3.1.2.jar，用于破解JIRA系统</span></div><div class="line"><span class="comment">#mysql-connector-java-5.1.39-bin.jar是MYSQL的驱动程序包</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /opt/atlassian/jira/atlassian-jira/WEB-INF/lib</span></div><div class="line">[root@localhost lib]<span class="comment"># cp ~/atlassian-extras-3.1.2.jar .</span></div><div class="line">[root@localhost lib]<span class="comment"># cp ~/mysql-connector-java-5.1.39-bin.jar .</span></div><div class="line">[root@localhost ~]<span class="comment"># /etc/init.d/jira start</span></div></pre></td></tr></table></figure>
<p>访问<a href="http://ip:8080" target="_blank" rel="external">http://ip:8080</a> 打开JIRA配置向导页面<br><img src="http://note.youdao.com/yws/api/personal/file/0FCA2310301348438C781C2736633C46?method=download&amp;shareKey=e93942bd82fdda8a2f476717b9fa0fb5" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/775AA99451A34E86856C1B328572D3C1?method=download&amp;shareKey=e71bd93e4f86fdcfb1e0e50f27ab63f2" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/D669B7F2B7724AE986A47572B3F447FE?method=download&amp;shareKey=21be15edc6e433f17acfe6e74c5f73bf" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/82E548B0DC16475BA1BD8D401BB6C075?method=download&amp;shareKey=0cc74d94fd01159fab83640fe7ec9a0e" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/95356B5BEDB14AE1B8C96DEDA1115AA8?method=download&amp;shareKey=0185b25a933f73142485ef8a3961089f" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/4A636F46CEAF4082A348456858398F00?method=download&amp;shareKey=57528639d9b0c11854a750915bd0723f" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/E8328EFF81A547D89745C63E5772D89E?method=download&amp;shareKey=c4748c746a378a4444ee15c9b0317ccf" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/C64BD097863945FA84476196CA9EE587?method=download&amp;shareKey=60dbdfa889efcab79f8bb7f3697c62e6" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/0CD6CB2373AD4E74A3B65E4FEEEB4897?method=download&amp;shareKey=3d7764eba4667435a43713ab7c877533" alt="JIRA_install"><br><img src="http://note.youdao.com/yws/api/personal/file/EE09B197C91E401FB3E831278A810833?method=download&amp;shareKey=0bb5acd4584f8d1a90fcc00e757855b4" alt="JIRA_install"><br>JIRA 7.22安装完成  </p>
<p>配置JIRA 7.2.2<br>创建第一个项目<br><img src="http://note.youdao.com/yws/api/personal/file/06347A33D066476293A2BA62930E0BB9?method=download&amp;shareKey=a7a6a93787b3b2d742e3a6ba35c141c6" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/810E923C514746F788E07E617172C516?method=download&amp;shareKey=e59c333222233084d36101d9207ae5d8" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/FC3E1ABE7EE0412EA3A90F62714A8020?method=download&amp;shareKey=3b0f375c1c93f231105c56d0ae703d4d" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/FA5ECD94F4AB41A4BF2B44B64225656A?method=download&amp;shareKey=15876094d96b112355c6a2c185d70d9a" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/1F7D5CB6968B4970B7B8F47C5C8C6579?method=download&amp;shareKey=8091c1be7ef18286bc35276bdcd1a1a7" alt="JIRA_setup">  </p>
<p>从这里看，我们之前的破解是成功的，这个JIRA我们可以使用到2033年，现在是2017年哦~<br>如果没有破解的话，默认是30天使用期限，就是在安装时在官网申请的Licence<br><img src="http://note.youdao.com/yws/api/personal/file/FD82EE49300045D19AF2FCF230BDC4A3?method=download&amp;shareKey=a16d371985fbcb4cdc2f7b60cf057e14" alt="JIRA_setup">  </p>
<h2 id="汉化JIRA-7-2-2"><a href="#汉化JIRA-7-2-2" class="headerlink" title="汉化JIRA 7.2.2  "></a>汉化JIRA 7.2.2  </h2><p>官网JIRA中文语言包获取地址：<a href="https://translations.atlassian.com/dashboard/download?lang=zh_CN#/JIRA" target="_blank" rel="external">https://translations.atlassian.com/dashboard/download?lang=zh_CN#/JIRA</a><br>下载JIRA Core-7.2.1-language-pack-zh_CN.jar(中文语言包)<br><a href="https://translations.atlassian.com/download/JIRA+Core/7.2.1/zh_CN/JIRA+Core-7.2.1-language-pack-zh_CN.jar" target="_blank" rel="external">官网下载jira中文语言包</a><br><a href="http://note.youdao.com/yws/api/personal/file/E97D7487FD91475D9C34F83747DDCF03?method=download&amp;shareKey=803eef9a500cf15e04945fcb71d70eab" target="_blank" rel="external">本地下载jira中文语言包</a>  </p>
<p><img src="http://note.youdao.com/yws/api/personal/file/773421D0FA6A47EAA41F08218AFD902D?method=download&amp;shareKey=eb27a8ab26c06560a1be7a39832aa456" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/A85DFAC834214747A3C8419A9E79149D?method=download&amp;shareKey=d5db63e2fe92a390edeceff10d24903b" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/5C3E02F7ED4B4CB38C0429B5DEE4B912?method=download&amp;shareKey=208fd72af81f8a610151d18801f448dc" alt="JIRA_setup">  </p>
<p>Syetem – Edit Settings – Default language<br><img src="http://note.youdao.com/yws/api/personal/file/83CD29E3E3DC4E4C9696C8AED8905B79?method=download&amp;shareKey=d0cb65a2586a9b6b7e20d59a683d2bb7" alt="JIRA_setup"><br><img src="http://note.youdao.com/yws/api/personal/file/B0A9875D10E3438A900FDC92EC59E2A5?method=download&amp;shareKey=8ddb99a4eeb0c240220f5de9c4625c2b" alt="JIRA_setup"><br>汉化完成  </p>
<p>附件：<br>下载atlassian-jira-software-7.2.2-x64.bin<br><a href="https://downloads.atlassian.com/software/jira/downloads/atlassian-jira-core-7.2.2-x64.bin" target="_blank" rel="external">JIRA 7.2.2 for linux x64官网下载</a><br><a href="http://pan.baidu.com/s/1bBQ1pO" target="_blank" rel="external">JIRA 7.2.2 for linux x64百度网盘下载，密码：a27h</a><br><a href="http://pan.baidu.com/s/1jHS4VPW" target="_blank" rel="external">jdk-8u20百度网盘下载，密码：9p4g</a><br><a href="http://note.youdao.com/yws/api/personal/file/3C3313EA38AB468496274194F97C9B22?method=download&amp;shareKey=f572622fcb9af65860227468644aaef7" target="_blank" rel="external">JIRA 7.2破解包下载</a>  </p>
<p><a href="http://pan.baidu.com/s/1pK8ce4F" target="_blank" rel="external">JIRA 7.2.2安装包合集百度网盘下载，密码：h5tp</a>  </p>
<p>参考：<a href="http://www.ilanni.com/?p=12119" target="_blank" rel="external">http://www.ilanni.com/?p=12119</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/05/09/部署JIRA-7-2-2-for-Linux/">https://yfshare.github.io/2017/05/09/部署JIRA-7-2-2-for-Linux/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;jira是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪（bug管理）、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域&lt;br&gt;
    
    </summary>
    
      <category term="Atlassian" scheme="https://yfshare.github.io/categories/Atlassian/"/>
    
    
      <category term="JIRA" scheme="https://yfshare.github.io/tags/JIRA/"/>
    
      <category term="Atlassian" scheme="https://yfshare.github.io/tags/Atlassian/"/>
    
  </entry>
  
  <entry>
    <title>部署Grafana数据展示系统</title>
    <link href="https://yfshare.github.io/2017/04/29/%E9%83%A8%E7%BD%B2Grafana%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA%E7%B3%BB%E7%BB%9F/"/>
    <id>https://yfshare.github.io/2017/04/29/部署Grafana数据展示系统/</id>
    <published>2017-04-29T05:48:37.000Z</published>
    <updated>2017-05-02T12:39:25.000Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>Grafana 是 Graphite 和 InfluxDB 仪表盘和图形编辑器。<br>Grafana 是开源的，功能齐全的度量仪表盘和图形编辑器，支持 Graphite，InfluxDB 和 OpenTSDB。<br>Grafana 主要特性：灵活丰富的图形化选项；可以混合多种风格；支持白天和夜间模式；多个数据源；Graphite 和 InfluxDB 查询编辑器等等。<br><a id="more"></a></p>
<h2 id="认识Grafana"><a href="#认识Grafana" class="headerlink" title="认识Grafana"></a>认识Grafana</h2><p><strong>Graphite 指标编辑器</strong></p>
<ul>
<li>Graphite 指标表达解析器</li>
<li>功能齐全的查询功能</li>
<li>快速添加和编辑函数和参数</li>
<li>模板化查询</li>
<li>See it in action</li>
</ul>
<p><strong>图形化</strong></p>
<ul>
<li>快速渲染，甚至是较大的时间跨度</li>
<li>点击和拖拽缩放</li>
<li>多个 Y 轴 </li>
<li>条形，折线，点 </li>
<li>智能 Y 轴格式化</li>
<li>系列切换和颜色选择 </li>
<li>Legend values 和格式化选项</li>
<li>网格阈值，轴标签</li>
<li>Annotations</li>
</ul>
<p><strong>仪表盘</strong></p>
<ul>
<li>创建，编辑，保存和搜索仪表盘</li>
<li>修改列宽和行高</li>
<li>拖拽面板重新编排</li>
<li>使用 InfluxDB 或者 Elasticsearch 作为仪表盘存储</li>
<li>导入和导出仪表盘（JSON 文件）</li>
<li>从 Graphite 导入仪表盘</li>
<li>模板</li>
<li>Scripted dashboards</li>
<li>Dashboard playlists</li>
<li>时间范围控制</li>
</ul>
<p><strong>InfluxDB</strong></p>
<ul>
<li>使用 InfluxDB 作为指标数据源，注释源和仪表盘存储</li>
<li>查询编辑器</li>
</ul>
<p><strong>OpenTSDB</strong></p>
<ul>
<li>作为指标数据源</li>
<li>查询编辑器</li>
</ul>
<h2 id="部署Grafana数据展示平台-之在线安装"><a href="#部署Grafana数据展示平台-之在线安装" class="headerlink" title="部署Grafana数据展示平台 之在线安装"></a>部署Grafana数据展示平台 之在线安装</h2><p>官网：<a href="http://grafana.org/" target="_blank" rel="external">http://grafana.org/</a><br>环境：<br>　　　Centos 6.6<br>　　　Zabbix Version 3.0.4<br>　　　grafana Version 3.1.1  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@Zabbix ~]<span class="comment"># wget https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.1-1470047149.x86_64.rpm</span></div><div class="line">[root@Zabbix ~]<span class="comment"># yum -y install grafana-3.1.1-1470047149.x86_64.rpm</span></div><div class="line">[root@Zabbix ~]<span class="comment"># mkdir -p /var/log/grafana</span></div><div class="line">[root@Zabbix ~]<span class="comment"># cd /usr/share/grafana/conf/</span></div><div class="line">[root@Zabbix conf]<span class="comment"># grep -v '^#' defaults.ini | grep -v ^$</span></div><div class="line">···</div><div class="line">[users]</div><div class="line">allow_sign_up = <span class="literal">false</span>         <span class="comment">#关闭这个在登录界面就没有Sign Up了</span></div><div class="line">allow_org_create = <span class="literal">false</span></div><div class="line">auto_assign_org = <span class="literal">false</span></div><div class="line">auto_assign_org_role = Viewer</div><div class="line">verify_email_enabled = <span class="literal">false</span></div><div class="line">login_hint = email or username</div><div class="line">default_theme = dark</div><div class="line">···</div><div class="line">[root@Zabbix conf]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>安装Grafana插件<br>官方文档：<a href="http://docs.grafana.org/plugins/installation/" target="_blank" rel="external">http://docs.grafana.org/plugins/installation/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#列出可用的插件</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins list-remote</span></div><div class="line">id: abhisant-druid-datasource version: 0.0.2</div><div class="line">id: alexanderzobnin-zabbix-app version: 3.0.0</div><div class="line">id: bosun-app version: 0.0.25</div><div class="line">id: bosun-datasource version: 0.0.5</div><div class="line">id: crate-datasource version: 0.0.1</div><div class="line">id: fastweb-openfalcon-datasource version: 1.0.0</div><div class="line">id: fetzerch-sunandmoon-datasource version: 0.1.1</div><div class="line">id: grafana-clock-panel version: 0.0.8</div><div class="line">id: grafana-example-app version: 1.0.1</div><div class="line">id: grafana-influxdb-08-datasource version: 1.0.2</div><div class="line">id: grafana-kairosdb-datasource version: 1.0.1</div><div class="line">id: grafana-piechart-panel version: 1.1.1</div><div class="line">id: grafana-simple-json-datasource version: 1.1.2</div><div class="line">id: grafana-worldmap-panel version: 0.0.14</div><div class="line">id: kentik-app version: 1.0.4</div><div class="line">id: mtanda-heatmap-epoch-panel version: 0.1.1</div><div class="line">id: mtanda-histogram-panel version: 0.1.5</div><div class="line">id: ns1-app version: 0.0.5</div><div class="line">id: opennms-datasource version: 2.0.1</div><div class="line">id: percona-percona-app version: 1.0.0</div><div class="line">id: praj-ams-datasource version: 1.0.1</div><div class="line">id: raintank-snap-app version: 0.0.3</div><div class="line">id: raintank-worldping-app version: 1.0.10</div><div class="line">id: sileht-gnocchi-datasource version: 1.0.6</div><div class="line">id: sraoss-sunburst-panel version: 1.0</div><div class="line">id: stagemonitor-elasticsearch-app version: 0.26.0</div><div class="line">id: udoprog-heroic-datasource version: 0.1.0</div><div class="line">id: voxter-app version: 0.0.1</div><div class="line">Restart grafana after installing plugins . &lt;service grafana-server restart&gt;</div><div class="line">[root@Zabbix ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p><a href="https://grafana.com/plugins/alexanderzobnin-zabbix-app" target="_blank" rel="external">alexanderzobnin-zabbix-app</a> 插件用于Grafana通过Zabbix API获取数据并展示数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install alexanderzobnin-zabbix-app</span></div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/F9559698659841E8913649C3444C5701?method=download&amp;shareKey=2c51f44d408b1674bceee85ab5787611" alt="Grafana_install_plugins">  </p>
<p>安装Grafana其他插件<br>常用插件：<a href="https://grafana.com/plugins/grafana-clock-panel" target="_blank" rel="external">grafana-clock-panel</a>、<a href="https://grafana.com/plugins/grafana-simple-json-datasource" target="_blank" rel="external">grafana-simple-json-datasource</a>、<a href="https://grafana.com/plugins/grafana-piechart-panel" target="_blank" rel="external">grafana-piechart-panel</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install grafana-clock-panel</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install grafana-simple-json-datasource</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install grafana-piechart-panel</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#这三个可以不安装，这三个插件是用于检测DNS/PING等网络情况的，需要付费</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install raintank-worldping-app</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install fastweb-openfalcon-datasource</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins install percona-percona-app</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#列出已安装的插件</span></div><div class="line">[root@Zabbix ~]<span class="comment"># grafana-cli plugins ls</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/9AA193AACC784E9DACA6C47A9162C132?method=download&amp;shareKey=d50c4fe6334663c21675454699cba3d2" alt="Grafana_plugins_list"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@Zabbix ~]<span class="comment"># ll /var/lib/grafana/plugins</span></div><div class="line">total 28</div><div class="line">drwxr-xr-x 7 root root 4096 Aug 30 10:14 alexanderzobnin-zabbix-app</div><div class="line">drwxr-xr-x 6 root root 4096 Aug 30 15:03 fastweb-openfalcon-datasource</div><div class="line">drwxr-xr-x 4 root root 4096 Aug 30 10:15 grafana-clock-panel</div><div class="line">drwxr-xr-x 4 root root 4096 Aug 30 14:40 grafana-piechart-panel</div><div class="line">drwxr-xr-x 5 root root 4096 Aug 30 10:15 grafana-simple-json-datasource</div><div class="line">drwxr-xr-x 4 root root 4096 Aug 30 15:31 percona-percona-app</div><div class="line">drwxr-xr-x 4 root root 4096 Aug 30 10:15 raintank-worldping-app</div><div class="line">[root@Zabbix ~]<span class="comment">#</span></div><div class="line">[root@Zabbix ~]<span class="comment"># /etc/init.d/grafana-server start</span></div><div class="line">Starting Grafana Server: .... OK</div><div class="line">[root@Zabbix ~]<span class="comment"># chkconfig --add grafana-server</span></div><div class="line">[root@Zabbix ~]<span class="comment"># chkconfig grafana-server on</span></div></pre></td></tr></table></figure></p>
<p>访问：<a href="http://ip:3000/" target="_blank" rel="external">http://ip:3000/</a><br><img src="http://note.youdao.com/yws/api/personal/file/C6BD03BA70054CDA86E0F06A22565CF4?method=download&amp;shareKey=4fef0d3fa79d4ddac0ddcec59cf0f324" alt="Grafana_login"><br><img src="http://note.youdao.com/yws/api/personal/file/9917D8C1D4C24100B069C89E388D6D3B?method=download&amp;shareKey=1e7ad5cb9d8a03620beebe317425fe18" alt="Grafana">  </p>
<p>安装zabbix插件<br><img src="http://note.youdao.com/yws/api/personal/file/7A07E86DB96749EFB27ED735384BA754?method=download&amp;shareKey=e81b981df1db0df3b7497548f5e3481e" alt="Grafana"><br><img src="http://note.youdao.com/yws/api/personal/file/C630210B1F1B4BF1AA0695CCBED55FC0?method=download&amp;shareKey=675682543eb92186f4ac9dc9a6f88db0" alt="Grafana"><br><img src="http://note.youdao.com/yws/api/personal/file/FB95B45975024294903C014A0EC7452E?method=download&amp;shareKey=503c506c48df2eba416b79fba9eec87b" alt="Grafana"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Zabbix的API地址为“http://192.168.31.130/zabbix/api_jsonrpc.php”，其中IP的安装zabbix-server的服务器IP</div><div class="line">Zabbix的API账号密码就是Zabbix的Web端登录账号和密码</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/CAE0140CA04D4DF48FE71CC516745D8D?method=download&amp;shareKey=93d4114c12ef3fadfb95511cc90b3ae5" alt="Grafana_datasource"><br><img src="http://note.youdao.com/yws/api/personal/file/4D17740A04754EFD880EE5538BA68F18?method=download&amp;shareKey=90faa224c21a22ea962bca3ab69c043c" alt="Grafana_datasource"><br><img src="http://note.youdao.com/yws/api/personal/file/85BFEE13D1C9484B813E41FF4F94495F?method=download&amp;shareKey=5ab8cd7a870598acce4cc7ac0f34a619" alt="Grafana_datasource">  </p>
<p>新建一个仪表<br><img src="http://note.youdao.com/yws/api/personal/file/7A029D61C3034907A7A478057BECABB2?method=download&amp;shareKey=c01433e248d55b813bafd9932d7260cc" alt="Grafana_table"><br><img src="http://note.youdao.com/yws/api/personal/file/FD53B024CD7F40E3A3A7F4649FF93FEE?method=download&amp;shareKey=7e69a28a18f3f352ff7bb8254a2396e3" alt="Grafana_table"><br><img src="http://note.youdao.com/yws/api/personal/file/665E5D9A6E514558B862359B3DCF8D5E?method=download&amp;shareKey=1d17b900e195a92fd4d234951348dd85" alt="Grafana_table"><br><img src="http://note.youdao.com/yws/api/personal/file/DB3037B236F94787B9152D109D39205E?method=download&amp;shareKey=066caf56955144b5c2a564993d8ee54f" alt="Grafana_table"><br><img src="http://note.youdao.com/yws/api/personal/file/ACEE15EF2DA34CD0B7116DC90A9B8D73?method=download&amp;shareKey=f52e33fc6dc6721525bf5b9dfc4f4d09" alt="Grafana_table"><br><img src="http://note.youdao.com/yws/api/personal/file/82DC4AAFDF744673895B25C90706BA22?method=download&amp;shareKey=f0f36343e8c3cb04a984a98f96761f2b" alt="Grafana_table"><br>OK，Grafana在线安装完成  </p>
<p>看看效果图<br><img src="http://note.youdao.com/yws/api/personal/file/1D8445F4804C435085DE75FBDE27263E?method=download&amp;shareKey=c4fa2915a6d0c49cd5e0a6209a0fba52" alt="Grafana_view"><br><img src="http://note.youdao.com/yws/api/personal/file/8DF5C52B582F494DA2954B8D8827B204?method=download&amp;shareKey=499d5a9b47ace1047965438e21942a1d" alt="Grafana_view"><br><img src="http://note.youdao.com/yws/api/personal/file/07456EC8BB6545CCAB7D2E1318DFCBED?method=download&amp;shareKey=9ca12dd9c5eabd809762f15706fd4164" alt="Grafana_view"><br><img src="http://note.youdao.com/yws/api/personal/file/52FFAD517EBC494DA0FF0B610DCCE4B9?method=download&amp;shareKey=e483df4b036bda1cd7bab7b85caed089" alt="Grafana_view"><br><img src="http://note.youdao.com/yws/api/personal/file/C0B0D4DDAE2F4300A66D28F737E9001A?method=download&amp;shareKey=ac4613af5fcff7c55615905dca9eb00f" alt="Grafana_view">  </p>
<p>用户管理（使用管理员登录）<br><img src="http://note.youdao.com/yws/api/personal/file/D8F5502ED5EE4BC28D325D53138BEBFD?method=download&amp;shareKey=47cc76449f34b867a36f46ca898518bd" alt="Grafana_user"><br>创建Grafana用户并授权<br><img src="http://note.youdao.com/yws/api/personal/file/A40A324FC3534F5280F3D1CAD703782A?method=download&amp;shareKey=dbee8d7330e6bfbf50ef7faeea881762" alt="Grafana_create_user"><br><img src="http://note.youdao.com/yws/api/personal/file/7D17F2BA1B2347A0870FE23DF7389BB4?method=download&amp;shareKey=c3a99d1cb924d7c0fc91802cae6e6a5b" alt="Grafana_create_user"><br><img src="http://note.youdao.com/yws/api/personal/file/9F5FF958A04040D8A0C66BBCDC52794F?method=download&amp;shareKey=fcaeff76d1d9e5d58a2be6c7e243b7cf" alt="Grafana_create_user"><br><img src="http://note.youdao.com/yws/api/personal/file/BBBE8D23CCE149E9B4A8F39BFEA157A1?method=download&amp;shareKey=a19a190c96a5a86fc670a57ffd7136c2" alt="Grafana_create_user"><br><img src="http://note.youdao.com/yws/api/personal/file/1AA4DE107B614001A5DD67B52C8A1553?method=download&amp;shareKey=845ec93e76260b6153ef0d007ac90361" alt="Grafana_create_user">  </p>
<h2 id="部署Grafana数据展示平台-之离线安装"><a href="#部署Grafana数据展示平台-之离线安装" class="headerlink" title="部署Grafana数据展示平台 之离线安装"></a>部署Grafana数据展示平台 之离线安装</h2><p>官网：<a href="http://grafana.org/" target="_blank" rel="external">http://grafana.org/</a><br>环境：<br>　　　Centos 7.2<br>　　　Grafana Version 4.2.0  </p>
<p>Grafana支持多平台安装，目前已知平台有Linux、Windows、Mac、Docker。Linux支持系统有Ubuntu &amp;Debian、Standalone Linux Binaries、Redhat &amp;Centos等等<br>Grafana下载地址：<a href="https://grafana.com/grafana/download" target="_blank" rel="external">https://grafana.com/grafana/download</a>  </p>
<p><a href="https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-4.2.0-1.x86_64.rpm" target="_blank" rel="external">下载Grafana for Centos</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装Grafana</span></div><div class="line">[root@localhost ~]<span class="comment"># yum -y install grafana-4.2.0-1.x86_64.rpm</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /usr/share/grafana/conf/</span></div><div class="line">[root@localhost ~]<span class="comment"># grep -v ^# /usr/share/grafana/conf/defaults.ini | grep -v ^$</span></div><div class="line">...</div><div class="line"><span class="comment">#allow_sign_up、allow_org_create、auto_assign_org值为false在登录界面就没有Sign Up了</span></div><div class="line">[users]</div><div class="line">allow_sign_up = <span class="literal">false</span></div><div class="line">allow_org_create = <span class="literal">false</span></div><div class="line">auto_assign_org = <span class="literal">false</span></div><div class="line">auto_assign_org_role = Viewer</div><div class="line">verify_email_enabled = <span class="literal">false</span></div><div class="line">login_hint = email or username</div><div class="line">default_theme = dark</div><div class="line">...</div><div class="line">[root@localhost ~]<span class="comment"># systemctl enable grafana-server</span></div><div class="line">[root@localhost ~]<span class="comment"># service grafana-server start</span></div><div class="line">[root@localhost ~]<span class="comment"># mkdir -p /var/log/grafana</span></div></pre></td></tr></table></figure></p>
<p>访问<a href="http://ip:3000" target="_blank" rel="external">http://ip:3000</a><br><img src="http://note.youdao.com/yws/api/personal/file/283EB01F3A4941E29F8AE30FD43E8775?method=download&amp;shareKey=a5c4750aa0f94fb4ef599640a08155d6" alt="Grafana_login">  </p>
<p>安装Grafana插件<br>grafana插件：<a href="https://grafana.com/plugins" target="_blank" rel="external">https://grafana.com/plugins</a> ，这里可以获取Grafana最新插件  </p>
<p>安装Grafana for Zabbix插件<br><a href="https://grafana.com/plugins/alexanderzobnin-zabbix-app" target="_blank" rel="external">alexanderzobnin-zabbix-app</a> 插件用于Grafana通过Zabbix API获取数据并展示数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># unzip alexanderzobnin-grafana-zabbix-v3.3.0-0-geca8096.zip</span></div><div class="line">[root@localhost ~]<span class="comment"># cp -rfp alexanderzobnin-grafana-zabbix-eca8096/ /var/lib/g</span></div><div class="line">rafana/plugins/</div><div class="line">[root@localhost ~]<span class="comment"># service grafana-server restart</span></div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/4FA3930F6A92405EA22D6615C4F27B8C?method=download&amp;shareKey=1f06986616b1ada68340d0504fdd2bd8" alt="Grafana_install_plugin"><br><img src="http://note.youdao.com/yws/api/personal/file/DDFE4FD7CED342AB888E8505A9886929?method=download&amp;shareKey=539ea2e4844cb414ca5a7c0d9e7b5801" alt="Grafana_install_plugin"><br><img src="http://note.youdao.com/yws/api/personal/file/7106F5778C6C4BCEB8EC2691F940C1FC?method=download&amp;shareKey=9dcf899b3fdc6449592318587c0f91a9" alt="Grafana_install_plugin">  </p>
<p>安装Grafana其他插件<br>常用插件：<a href="https://grafana.com/plugins/grafana-clock-panel" target="_blank" rel="external">grafana-clock-panel</a>、<a href="https://grafana.com/plugins/grafana-simple-json-datasource" target="_blank" rel="external">grafana-simple-json-datasource</a>、<a href="https://grafana.com/plugins/grafana-piechart-panel" target="_blank" rel="external">grafana-piechart-panel</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># unzip grafana-clock-panel-c5b3c7f.zip</span></div><div class="line">[root@localhost ~]<span class="comment"># cp -rfp grafana-clock-panel-c5b3c7f /var/lib/grafana/plugins/</span></div><div class="line">[root@localhost ~]<span class="comment"># unzip grafana-piechart-panel-ce2ede8.zip</span></div><div class="line">[root@localhost ~]<span class="comment"># cp grafana-piechart-panel-ce2ede8 /var/lib/grafana/plugins/ -rfp</span></div><div class="line">[root@localhost ~]<span class="comment"># unzip grafana-simple-json-datasource-49eeb6d.zip</span></div><div class="line">[root@localhost ~]<span class="comment"># cp -rfp grafana-simple-json-datasource-49eeb6d /var/lib/grafana/plugins/</span></div><div class="line">[root@localhost ~]<span class="comment"># unzip Vonage-Grafana_Status_panel-1.0.4-0-g8bf28f2.zip</span></div><div class="line">[root@localhost ~]<span class="comment"># cp -rfp Vonage-Grafana_Status_panel-8bf28f2/ /var/lib/grafana/plugins/</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># ll /var/lib/grafana/plugins/</span></div><div class="line">total 8</div><div class="line">drwxr-xr-x 6 root root 4096 Feb 10 23:30 alexanderzobnin-grafana-zabbix-eca8096</div><div class="line">drwxr-xr-x 4 root root 4096 Mar 18 07:29 grafana-clock-panel-c5b3c7f</div><div class="line">drwxr-xr-x 4 root root  112 Sep 29  2016 grafana-piechart-panel-ce2ede8</div><div class="line">drwxr-xr-x 5 root root  156 Mar 24 00:54 grafana-simple-json-datasource-49eeb6d</div><div class="line">drwxr-xr-x 4 root root  136 Apr 27 18:02 Vonage-Grafana_Status_panel-8bf28f2</div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line">[root@localhost ~]<span class="comment"># grafana-cli plugins ls </span></div><div class="line">installed plugins:</div><div class="line">vonage-status-panel @ 1.0.4 </div><div class="line">alexanderzobnin-zabbix-app @ 3.3.0 </div><div class="line">grafana-clock-panel @ 0.0.9 </div><div class="line">grafana-piechart-panel @ 1.1.4 </div><div class="line">grafana-simple-json-datasource @ 1.3.1 </div><div class="line"></div><div class="line">Restart grafana after installing plugins . &lt;service grafana-server restart&gt;</div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment">#</span></div><div class="line"><span class="comment">#安装了新的Grafana插件需要重启Grafana</span></div><div class="line">[root@localhost ~]<span class="comment"># service grafana-server restart</span></div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/C95B8C145A5D426DA83765ABCD32AB69?method=download&amp;shareKey=cc367f5f83d84d60348a4207b4b6409b" alt="Grafana_install_plugin"><br>OK，Grafana离线安装完成  </p>
<p>附件：<br><a href="http://note.youdao.com/yws/api/personal/file/5DBEFC3BD49A4A4389EB254F017BEAE5?method=download&amp;shareKey=6e1a225b682c682666f2b06f5f1053a9" target="_blank" rel="external">grafana_install_packages.zip</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/04/29/部署Grafana数据展示系统/">https://yfshare.github.io/2017/04/29/部署Grafana数据展示系统/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Grafana 是 Graphite 和 InfluxDB 仪表盘和图形编辑器。&lt;br&gt;Grafana 是开源的，功能齐全的度量仪表盘和图形编辑器，支持 Graphite，InfluxDB 和 OpenTSDB。&lt;br&gt;Grafana 主要特性：灵活丰富的图形化选项；可以混合多种风格；支持白天和夜间模式；多个数据源；Graphite 和 InfluxDB 查询编辑器等等。&lt;br&gt;
    
    </summary>
    
      <category term="Zabbix" scheme="https://yfshare.github.io/categories/Zabbix/"/>
    
    
      <category term="Zabbix" scheme="https://yfshare.github.io/tags/Zabbix/"/>
    
      <category term="Grafana" scheme="https://yfshare.github.io/tags/Grafana/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix之微信(Wechat)告警</title>
    <link href="https://yfshare.github.io/2017/04/13/Zabbix%E4%B9%8B%E5%BE%AE%E4%BF%A1-Wechat-%E5%91%8A%E8%AD%A6/"/>
    <id>https://yfshare.github.io/2017/04/13/Zabbix之微信-Wechat-告警/</id>
    <published>2017-04-13T01:41:25.000Z</published>
    <updated>2017-06-15T15:31:02.402Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>Zabbix告警可以通过邮件，微信，电话，短信等方式发送告警消息。电话和短信需要向运营商购买相应的网关，需要付费；邮件和微信是免费的，可以根据业务需要选择相应的告警模式<br><a id="more"></a></p>
<h2 id="部署前准备工作"><a href="#部署前准备工作" class="headerlink" title="部署前准备工作"></a>部署前准备工作</h2><p>先申请一个微信企业号：<a href="https://qy.weixin.qq.com" target="_blank" rel="external">https://qy.weixin.qq.com</a><br>申请通过过<a href="https://qy.weixin.qq.com" target="_blank" rel="external">登录</a>该企业号  </p>
<p>注：每个企业号有发送消息限制<br>据说是有消息数限制的  </p>
<ul>
<li>发消息频率。每企业不可超过200次/分钟；不可超过帐号上限数x30人次/天。例如：企业号的注册号的人数上限为200人，注册号一天可以发送200x30=6000人次/天，注意：1条消息发给100人算作100人次。<br>参考：<a href="http://qydev.weixin.qq.com/qa/index.php?qa=29914&amp;qa_1=企业号发布消息有条数限制吗？&amp;show=29914#q29914" target="_blank" rel="external">企业号发布消息数限制</a>  </li>
</ul>
<p>向微信企业号添加部门<br><img src="http://note.youdao.com/yws/api/personal/file/9A74C3796A06442FAB736F9293BF47C7?method=download&amp;shareKey=a9669fcd95dab5382a282862a282879b" alt="weichat_qiyehao">  </p>
<p>向微信企业号新增成员。添加成员后，会生成一个二维码，需要用户扫描关注该微信企业号<br><img src="http://note.youdao.com/yws/api/personal/file/400EBA197981491D9F820AFB94337A0F?method=download&amp;shareKey=9daf4035ea99807443e593907c2fe811" alt="qiyehao_adduser">  </p>
<p>创建应用（消息型应用），并给部门设置管理员（设置—权限管理–新建管理组）<br><img src="http://note.youdao.com/yws/api/personal/file/EE9D4CBA5E224EF6A2F4D998C923A9F3?method=download&amp;shareKey=8f9be28123bf4786673250d257bcb8cf" alt="create_application"><br><img src="http://note.youdao.com/yws/api/personal/file/7F8798ADB8064107A95F0D6B0129A952?method=download&amp;shareKey=4fbec5cec5dfc6b0194e72f1a2146678" alt="qiyehao_app_set">  </p>
<p>要确认管理员能读取通讯录，可以使用应用发送消息<br>注意：这时需要管理员的CorpID和Secret  </p>
<p>我们要准备这些东西：  </p>
<ul>
<li>一个微信企业号</li>
<li>企业号已经被部门成员关注</li>
<li>企业号里有一个可以发消息的应用</li>
<li>一个授权管理员，可以使用该应用给成员发消息</li>
</ul>
<p>我们要取到这些信息：  </p>
<ul>
<li>成员账号</li>
<li>组织部门ID</li>
<li>应用ID</li>
<li>CropID</li>
<li>Secret</li>
</ul>
<h2 id="配置Zabbix之微信告警"><a href="#配置Zabbix之微信告警" class="headerlink" title="配置Zabbix之微信告警"></a>配置Zabbix之微信告警</h2><p>调用微信接口：<br>调用微信接口需要一个调用接口的凭证：access_token<br>通过 ：CropID 、Secret才能获取到access_token，但是获取到的token有效期为两分钟<br><a href="http://qydev.weixin.qq.com/debug" target="_blank" rel="external">http://qydev.weixin.qq.com/debug</a><br><img src="http://note.youdao.com/yws/api/personal/file/FAA655931F1D439793DD0A0E85AF40F8?method=download&amp;shareKey=b5c3ea2a1d938ae1a014746df9cb2e39" alt="weichat_debug">  </p>
<p>Shell脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span> -G  url       获取 AccessToken</div><div class="line">curl --data  url     传送凭证调用企业号接口</div><div class="line">zabbix会传递三个参数给脚本，<span class="variable">$1</span>是消息接收账号，<span class="variable">$2</span>报警标题，<span class="variable">$3</span>报警内容</div></pre></td></tr></table></figure></p>
<p>把脚本放到zabbix告警脚本目录下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost etc]<span class="comment"># grep -i '^AlertScriptsPath' zabbix_server.conf</span></div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts</div><div class="line">[root@CentOS etc]<span class="comment"># cd /usr/local/zabbix/share/zabbix/alertscripts</span></div><div class="line">[root@CentOS alertscripts]<span class="comment"># chmod 755 weixin.sh</span></div><div class="line">[root@CentOS alertscripts]<span class="comment"># chown zabbix:zabbix weixin.sh</span></div></pre></td></tr></table></figure></p>
<p>登录zabbix webGUI：管理–报警媒介类型–创建媒介类型<br><img src="http://note.youdao.com/yws/api/personal/file/5AE07B5F4F9442348AA652A440188C9B?method=download&amp;shareKey=054ef9e8898a679922aa9cc5ec13e59b" alt="zabbix_weichat_warnning"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;ALERT.SENDTO&#125;</div><div class="line">&#123;ALERT.SUBJECT&#125;</div><div class="line">&#123;ALERT.MESSAGE&#125;</div><div class="line">这三个参数在zabbix3.0上必须加上，否则无法发送消息</div></pre></td></tr></table></figure></p>
<p>管理–用户–admin–报警媒介–添加：<br><img src="http://note.youdao.com/yws/api/personal/file/20D63B48DC094209ADEC22BEAF762802?method=download&amp;shareKey=5f5d1d5888a3fbf7d9700977cb287a03" alt="zabbix_wechat_mess">  </p>
<p>创建Trigger和Action（略），发送选择微信<br><img src="http://note.youdao.com/yws/api/personal/file/C58EE9B446BF42CAA697DDE1217582D9?method=download&amp;shareKey=6c59c733bd45500705f106198a9cf5a1" alt="zabbix_wechat_action">  </p>
<p>当条件满足Zabbix Trigger后会触发Action，然后Action调用微信API发送告警消息：<br><img src="http://note.youdao.com/yws/api/personal/file/AA7934E296D648AABF13FF77AE79855C?method=download&amp;shareKey=82b3fc350484396c84b59117b19304c7" alt="image">  </p>
<p>zabbix Action默认消息模版<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">【告警】 &#123;TRIGGER.NAME&#125;\n</div><div class="line"></div><div class="line">告警主机：&#123;HOST.NAME&#125;\n</div><div class="line">主机IP：  &#123;HOST.IP&#125;\n</div><div class="line">告警时间：&#123;EVENT.DATE&#125;  &#123;EVENT.TIME&#125; \n</div><div class="line">告警等级：&#123;TRIGGER.SEVERITY&#125; \n</div><div class="line">告警信息：&#123;TRIGGER.NAME&#125;\n</div><div class="line">问题详情：&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;\n</div><div class="line">事件ID：  &#123;EVENT.ID&#125;\n</div><div class="line">触发器URL： &#123;TRIGGER.URL&#125;\n</div><div class="line"></div><div class="line">Item values:\n</div><div class="line"></div><div class="line">1. &#123;ITEM.NAME1&#125; (&#123;HOST.NAME1&#125;:&#123;ITEM.KEY1&#125;): &#123;ITEM.VALUE1&#125;\n</div><div class="line">2. &#123;ITEM.NAME2&#125; (&#123;HOST.NAME2&#125;:&#123;ITEM.KEY2&#125;): &#123;ITEM.VALUE2&#125;\n</div><div class="line">3. &#123;ITEM.NAME3&#125; (&#123;HOST.NAME3&#125;:&#123;ITEM.KEY3&#125;): &#123;ITEM.VALUE3&#125;\n</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#微信脚本：</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">###SCRIPT_NAME:weixin.sh###</span></div><div class="line"><span class="comment">###send message from weixin for zabbix monitor###</span></div><div class="line"><span class="comment">###wuhf###</span></div><div class="line"><span class="comment">###V1-2015-08-25###</span></div><div class="line">CropID=<span class="string">'1234567890abcdefghi'</span></div><div class="line">Secret=<span class="string">'12435dfh5ysdqwdMD4MI3ORUVpPnd9Q174mXP7'</span></div><div class="line">GURL=<span class="string">"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=<span class="variable">$CropID</span>&amp;corpsecret=<span class="variable">$Secret</span>"</span> </div><div class="line">Gtoken=$(/usr/bin/curl <span class="_">-s</span> -G <span class="variable">$GURL</span> | awk -F\<span class="string">" '&#123;print <span class="variable">$4</span>&#125;')</span></div><div class="line">PURL="https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=<span class="variable">$Gtoken</span><span class="string">"</span></div><div class="line">function body() &#123;</div><div class="line">        local int AppID=1                        企业号中的应用id</div><div class="line">        local UserID=<span class="variable">$1</span>                          部门成员id，zabbix中定义的微信接收者</div><div class="line">        local PartyID=3                          部门id，定义了范围，组内成员都可接收到消息</div><div class="line">        local Msg=<span class="variable">$(echo "$@" | cut -d" " -f3-)</span>  过滤出zabbix中传递的第三个参数</div><div class="line">        printf '&#123;\n'</div><div class="line">        printf '\t"touser<span class="string">": "</span><span class="string">'"$User"\"",\n"</span></div><div class="line">        printf '\t<span class="string">"toparty"</span>: <span class="string">"'"</span><span class="variable">$PartyID</span><span class="string">"\""</span>,\n<span class="string">"</span></div><div class="line">        printf '\t"msgtype<span class="string">": "</span>text<span class="string">",\n'</span></div><div class="line">        printf '\t"agentid<span class="string">": "</span><span class="string">'" $AppID "\"",\n"</span></div><div class="line">        printf '\t<span class="string">"text"</span>: &#123;\n<span class="string">'</span></div><div class="line">        printf '\t\t<span class="string">"content"</span>: <span class="string">"'"</span><span class="variable">$Msg</span><span class="string">"\""</span>\n<span class="string">"</span></div><div class="line">        printf '\t&#125;,\n'</div><div class="line">        printf '\t"safe<span class="string">":"</span>0<span class="string">"\n'</span></div><div class="line">        printf '&#125;\n'</div><div class="line">&#125;</div><div class="line">/usr/bin/curl --data-ascii "$(body <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span>)<span class="string">" <span class="variable">$PURL</span></span></div></pre></td></tr></table></figure>
<h2 id="部署多人接收微信告警消息"><a href="#部署多人接收微信告警消息" class="headerlink" title="部署多人接收微信告警消息"></a>部署多人接收微信告警消息</h2><p>首先登录微信企业号（<a href="https://qy.weixin.qq.com/）" target="_blank" rel="external">https://qy.weixin.qq.com/）</a><br>向微信企业号接收Zabbix告警消息组添加成员<br><img src="http://note.youdao.com/yws/api/personal/file/17F887DE7C884A01934E332E77220771?method=download&amp;shareKey=bca3e12a44445a18ee224caa0d127eb6" alt="weichat_qiyehao_adduser"><br><img src="http://note.youdao.com/yws/api/personal/file/1A04970180AD4D0F96B5340E974FF810?method=download&amp;shareKey=2c9224ac567e884ca3534ba97b57ea62" alt="weichat_qiyehao_adduser"><br><img src="http://note.youdao.com/yws/api/personal/file/AA8CA35D820A490E9510D4521FE5C8CB?method=download&amp;shareKey=6cfc782f00783c728a3b2ceadf43ad93" alt="weichat_qiyehao_adduser">  </p>
<p>这里在部署时设置好后就不需要在操作了<br><img src="http://note.youdao.com/yws/api/personal/file/2E88038AF4814B7F85AB7B7A5782AC7F?method=download&amp;shareKey=e666f11a513f2926a71b28c555e0fcf6" alt="image">  </p>
<p>登录Zabbix Web Gui<br>管理–用户–admin–报警媒介–微信<br><img src="http://note.youdao.com/yws/api/personal/file/B3039377906B4D5A8DBAC67B379E9A4F?method=download&amp;shareKey=43fd59327f2a5e613bf9cb67443d3c83" alt="zabbix_weichat_mess_adduser">  </p>
<p>测试<br><img src="http://note.youdao.com/yws/api/personal/file/D974AE71BAC64D56A025543156B82354?method=download&amp;shareKey=bcd9d048f215fb8398f2c8eb5d2a638c" alt="test_weichat_mess_success"><br>成功  </p>
<p>附件：<br><a href="http://note.youdao.com/yws/api/personal/file/514487CA90F1482AA53BA3E7B81CF4FF?method=download&amp;shareKey=fda0d641c4d0b542cbbf2e2d300d4d7f" target="_blank" rel="external">weichat.sh</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/04/13/Zabbix之微信-Wechat-告警/">https://yfshare.github.io/2017/04/13/Zabbix之微信-Wechat-告警/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Zabbix告警可以通过邮件，微信，电话，短信等方式发送告警消息。电话和短信需要向运营商购买相应的网关，需要付费；邮件和微信是免费的，可以根据业务需要选择相应的告警模式&lt;br&gt;
    
    </summary>
    
      <category term="Zabbix" scheme="https://yfshare.github.io/categories/Zabbix/"/>
    
    
      <category term="zabbix" scheme="https://yfshare.github.io/tags/zabbix/"/>
    
      <category term="wechat" scheme="https://yfshare.github.io/tags/wechat/"/>
    
      <category term="warn" scheme="https://yfshare.github.io/tags/warn/"/>
    
  </entry>
  
  <entry>
    <title>部署Oracle-RAC集群</title>
    <link href="https://yfshare.github.io/2017/04/12/%E9%83%A8%E7%BD%B2Oracle-RAC%E9%9B%86%E7%BE%A4/"/>
    <id>https://yfshare.github.io/2017/04/12/部署Oracle-RAC集群/</id>
    <published>2017-04-12T01:47:00.000Z</published>
    <updated>2017-05-17T15:36:18.491Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>RAC：real application clusters introduction  </p>
<p>ORACLE RAC原理：<br>在一个应用环境当中，所有的服务器使用和管理同一个数据库，目的是为了分散每一台服务器的工作量，硬件上至少需要两台以上的服务器，而且还需一个共享存储设备。还需要两类软件，一个是集群软件，另外一个就是Oracle数据库中的RAC组件，所有服务器上的OS都应该是同一类OS。<br><a id="more"></a><br>根据负载均衡的配置策略，当一个客户端发送请求到某一台服务的listener后，这台服务器根据负载均衡策略，会把请求发送给本机的RAC组件处理，也可能会发送给另外一台服务器的RAC组件处理，处理完请求后，RAC会通过集群软件来访问我们的共享存储设备。</p>
<p>逻辑结构上，每一个参加集群的节点有一个独立的instance，这些instance访问同一个数据库。节点之间通过集群软件的通讯层（communication layer）来进行通讯。同时为了减少IO的消耗，存在了一个全局缓存服务，因此每一个数据库的instance，都保留了一份相同的数据库cache。</p>
<p>RAC中的特点是：<br>每一个节点的instance都有自己的SGA，background process，redo logs，undo表空间<br>所有节点都共享一份datafiles和controlfiles</p>
<p>Oracle缓存融合技术(Cache fusion):  </p>
<ol>
<li>保证缓存的一致性  </li>
<li>减少共享磁盘IO的消耗</li>
</ol>
<p>缓存融合原理：  </p>
<ol>
<li>其中一个节点会从共享数据库中读取一个block到db cache中</li>
<li>这个节点会在所有的节点进行交叉db block copy</li>
<li>当任何一个节点缓存被修改的时候，就会在节点之间进行缓存修改</li>
<li>为了达到存储的一致最终修改的结果也会写到磁盘上</li>
</ol>
<p>ClusterWare组件：<br>有四种服务  </p>
<ul>
<li>Crsd - 集群资源服务</li>
<li>Cssd - 集群同步服务</li>
<li>Evmd - 事件管理服务</li>
<li>oprocd - 节点检测监控</li>
</ul>
<p>三类Resource  </p>
<ul>
<li>VIP - 虚拟IP地址(Virtual IP)</li>
<li>OCR - Oracle Cluster Registry(集群注册文件),记录每个节点的相关信息</li>
<li>Voting Disk - Establishes quorum (表决磁盘),仲裁机制用于仲裁多个节点向共享节点同时写的行为，这样做是为了避免发生冲突</li>
</ul>
<p>RAC组件：<br>提供过了额外的进程，用来维护数据库  </p>
<ul>
<li>LMS - Gobal Cache Service Process 全局缓存服务进程</li>
<li>LMD - Global Enqueue Service Daemon 全局查询服务守护进程</li>
<li>LMON - Global Enqueue Service Monitor全局查询服务监视进程</li>
<li>LCK0 - Instance Enqueue Process 实例查询进程</li>
</ul>
<h2 id="规划"><a href="#规划" class="headerlink" title="规划"></a>规划</h2><p>拓扑图：<br><img src="http://note.youdao.com/yws/api/personal/file/36F1D89D60D64C6AAD28358C84DCE3BF?method=download&amp;shareKey=87cdeb07ee5b622b6164e2f6d6c746b1" alt="tuopu">  </p>
<p>IP规划</p>
<table>
<thead>
<tr>
<th style="text-align:center">Node</th>
<th style="text-align:center">Public IP(Bond0)</th>
<th style="text-align:center">Heartbeat(eth2)</th>
<th style="text-align:center">Private IP</th>
<th style="text-align:center">System</th>
<th style="text-align:center">hostname</th>
<th style="text-align:center">Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RAC1</td>
<td style="text-align:center">192.168.100.241/24</td>
<td style="text-align:center">192.168.90.1/24</td>
<td style="text-align:center">eth3：192.168.80.1/24</td>
<td style="text-align:center">Centos 6.4</td>
<td style="text-align:center">rac1.example.com</td>
<td style="text-align:center">3G</td>
</tr>
<tr>
<td style="text-align:center">RAC2</td>
<td style="text-align:center">192.168.100.242/24</td>
<td style="text-align:center">192.168.90.2/24</td>
<td style="text-align:center">eth3：192.168.80.1/24</td>
<td style="text-align:center">Centos 6.4</td>
<td style="text-align:center">rac2.example.com</td>
<td style="text-align:center">3G</td>
</tr>
<tr>
<td style="text-align:center">Storage</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">bond0：192.168.80.3/24</td>
<td style="text-align:center">CentOS 6.4</td>
<td style="text-align:center">iscsi</td>
<td style="text-align:center">512M</td>
</tr>
</tbody>
</table>
<p>Storage磁盘规划</p>
<table>
<thead>
<tr>
<th>存储组件</th>
<th>文件系统</th>
<th>卷大小</th>
<th>ASM卷组名</th>
<th>ASM冗余</th>
<th>ASM磁盘组</th>
</tr>
</thead>
<tbody>
<tr>
<td>OCR/表决磁盘</td>
<td>ASM</td>
<td>2G</td>
<td>+CRS</td>
<td>External</td>
<td>DISK1</td>
</tr>
<tr>
<td>数据库文件</td>
<td>ASM</td>
<td>40G</td>
<td>+RACDB_DATA</td>
<td>External</td>
<td>DISK2</td>
</tr>
<tr>
<td>快速恢复区</td>
<td>ASM</td>
<td>40G</td>
<td>+FRA</td>
<td>External</td>
<td>DISK3</td>
</tr>
</tbody>
</table>
<h2 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h2><p>环境：Centos 6.4<br>　　　Oracle 11.2.0.4  </p>
<p>附件：<br><a href="http://note.youdao.com/yws/api/personal/file/3F26DCE4F66E4A92955421AD81907702?method=download&amp;shareKey=171e55b45eb00b0b4a04c19c94713f9d" target="_blank" rel="external">hosts</a><br><a href="http://note.youdao.com/yws/api/personal/file/EBE77CFA3E284EB6B536742A65ACB240?method=download&amp;shareKey=532b531d1b9e1b365f917c08268b1058" target="_blank" rel="external">cvuqdisk-1.0.9-1.rpm</a><br><a href="http://note.youdao.com/yws/api/personal/file/E8045FCC036D451CACE873C042919AB3?method=download&amp;shareKey=c990c68ec5fe93a69e4cfd97310d9ba9" target="_blank" rel="external">pdksh-5.2.14-1.i386.rpm</a><br><a href="http://note.youdao.com/yws/api/personal/file/918F64A65F6B4723AE40E7415A0D0D97?method=download&amp;shareKey=0671839fd7336ba472007fd158a0b91c" target="_blank" rel="external">plsql+instantclient_11_2安装包</a>  </p>
<p>利用ISCSI搭建后台存储<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@iscsi ~]<span class="comment"># tgt-admin -s|grep -i target</span></div><div class="line">Target 1: iqn.disk1</div><div class="line">Target 2: iqn.disk2</div><div class="line">Target 3: iqn.disk3</div><div class="line">[root@iscsi ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>rac1和rac2挂载后分区<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac1 software]<span class="comment"># fdisk -l|grep sd|tail -n 3</span></div><div class="line">Disk /dev/sdb: 2147 MB, 2147483648 bytes</div><div class="line">Disk /dev/sdc: 42.9 GB, 42949672960 bytes</div><div class="line">Disk /dev/sdd: 42.9 GB, 42949672960 bytes</div><div class="line">[root@rac1 software]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># hostname</span></div><div class="line">rac1.example.com</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div><div class="line">[root@rac2 ~]<span class="comment"># hostname</span></div><div class="line">rac2.example.com</div><div class="line">[root@rac2 ~]<span class="comment">#</span></div><div class="line">[root@rac1 ~]<span class="comment"># ping rac2.example.com -c 3</span></div><div class="line">PING rac2 (192.168.100.242) 56(84) bytes of data.</div><div class="line">64 bytes from rac2 (192.168.100.242): icmp_seq=1 ttl=64 time=0.622 ms</div><div class="line">64 bytes from rac2 (192.168.100.242): icmp_seq=2 ttl=64 time=0.369 ms</div></pre></td></tr></table></figure>
<p>在rac1和rac2上需要做地址解析<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># tail -n 19 /etc/hosts</span></div><div class="line"><span class="comment">#Public Network</span></div><div class="line">192.168.100.241	rac1	rac1.example.com</div><div class="line">192.168.100.242 rac2	rac2.example.com</div><div class="line"></div><div class="line"><span class="comment">#Public Virtual IP (VIP) addresses</span></div><div class="line">192.168.100.244	rac1-vip</div><div class="line">192.168.100.245	rac2-vip</div><div class="line"></div><div class="line"><span class="comment">#Single Client Access Name (SCAN)</span></div><div class="line">192.168.100.246	racscan</div><div class="line"></div><div class="line"><span class="comment">#Private Interconnect</span></div><div class="line">192.168.90.1 rac1-priv</div><div class="line">192.168.90.2 rac2-priv</div><div class="line"></div><div class="line"><span class="comment">#Private Storage Network</span></div><div class="line">192.168.80.1 rac1<span class="_">-s</span></div><div class="line">192.168.80.2 rac2<span class="_">-s</span></div><div class="line">192.168.80.3 iscsi</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>关闭防火墙和Selinux<br>要求：内存至少2G，swap：16GB内存以内内存的1.5或者1倍，16GB内存以上设置16GB<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@rac1 software]<span class="comment"># uname -a</span></div><div class="line">Linux rac1 2.6.32-358.el6.x86_64 <span class="comment">#1 SMP Fri Feb 22 00:31:26 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux</span></div><div class="line">[root@rac1 ~]<span class="comment">#</span></div><div class="line">[root@rac1 ~]<span class="comment"># ntpdate time.windows.com</span></div><div class="line">[root@rac1 ~]<span class="comment"># df -h|grep shm</span></div><div class="line">tmpfs                  10G     0   10G   0% /dev/shm</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/DD5C35B377C24C52BEA24662EB8338CE?method=download&amp;shareKey=b2cc6c7953190c0f83d0e38c951df89e" alt="image"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># yum -y install binutils* elfutils-libelf* compat-libstdc++* compat-libcap1* gcc gcc-c++ ksh libaio* libgcc* libstdc++* make* sysstat unixODBC* glibc*</span></div><div class="line">[root@rac1 ~]<span class="comment"># rpm -ivh pdksh-5.2.14-1.i386.rpm --nodeps --force</span></div><div class="line">[root@rac1 ~]<span class="comment"># yum -y install xhost</span></div><div class="line">[root@rac1 ~]<span class="comment"># groupadd oinstall</span></div><div class="line">[root@rac1 ~]<span class="comment"># groupadd dba</span></div><div class="line">[root@rac1 ~]<span class="comment"># groupadd oper</span></div><div class="line">[root@rac1 ~]<span class="comment"># groupadd asmadmin</span></div><div class="line">[root@rac1 ~]<span class="comment"># groupadd asmoper</span></div><div class="line">[root@rac1 ~]<span class="comment"># groupadd asmdba</span></div><div class="line">[root@rac1 ~]<span class="comment"># useradd -g oinstall -G asmadmin,asmdba,asmoper,dba grid</span></div><div class="line">[root@rac1 ~]<span class="comment"># useradd -g oinstall -G dba,asmdba,oper oracle</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#资源限制</span></div><div class="line">[root@rac1 ~]<span class="comment"># tail -n 12 /etc/security/limits.conf</span></div><div class="line"><span class="comment">#for oracle</span></div><div class="line">oracle soft nproc 2047</div><div class="line">oracle hard nproc 16384</div><div class="line">oracle soft nofile 1024</div><div class="line">oracle hard nofile 65536</div><div class="line">oracle soft stack 10240</div><div class="line"><span class="comment">#for grid</span></div><div class="line">grid soft nproc 2047</div><div class="line">grid hard nproc 16384</div><div class="line">grid soft nofile 1024</div><div class="line">grid hard nofile 65536</div><div class="line">grid soft stack 10240</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@rac1 ~]<span class="comment"># tail -n 2 /etc/pam.d/login</span></div><div class="line"><span class="comment">#oracle</span></div><div class="line">session	  required	pam_limits.so</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div><div class="line">[root@rac1 ~]<span class="comment"># tail -n 12 /etc/sysctl.conf</span></div><div class="line"><span class="comment">#oracle</span></div><div class="line">fs.aio-max-nr = 1048576</div><div class="line">fs.file-max = 6815744</div><div class="line">kernel.shmall = 2097152</div><div class="line">kernel.shmmax = 4294967295</div><div class="line">kernel.shmmni = 4096</div><div class="line">kernel.sem = 250 32000 100 128</div><div class="line">net.ipv4.ip_local_port_range = 9000 65500</div><div class="line">net.core.rmem_default = 262144</div><div class="line">net.core.rmem_max = 4194304</div><div class="line">net.core.wmem_default = 262144</div><div class="line">net.core.wmem_max = 1048576</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># mkdir -p /u01/app/grid</span></div><div class="line">[root@rac1 ~]<span class="comment"># mkdir -p /u01/app/11.2.0/grid</span></div><div class="line">[root@rac1 ~]<span class="comment"># chown -R grid:oinstall /u01</span></div><div class="line">[root@rac1 ~]<span class="comment"># mkdir -p /u01/app/oracle</span></div><div class="line">[root@rac1 ~]<span class="comment"># chown -R oracle:oinstall /u01/app/oracle</span></div><div class="line">[root@rac1 ~]<span class="comment"># chmod -R 775 /u01</span></div><div class="line">[root@rac1 ~]<span class="comment"># mkdir /oradata</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置环境变量</span></div><div class="line">[root@rac1 ~]<span class="comment"># su - oracle</span></div><div class="line">[oracle@rac1 ~]$ tail -n 8 .bash_profile</div><div class="line"><span class="comment">#oracle</span></div><div class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</div><div class="line"><span class="built_in">export</span> ORACLE_SID=racdb1</div><div class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</div><div class="line"><span class="built_in">export</span> LD_LIBARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">export</span> ORACLE_UNQNAME=racdb</div><div class="line"><span class="built_in">umask</span> 022</div><div class="line">[oracle@rac1 ~]$ <span class="built_in">source</span> .bash_profile</div><div class="line">[oracle@rac1 ~]$ <span class="built_in">echo</span> <span class="variable">$ORACLE_HOME</span></div><div class="line">/u01/app/oracle/product/11.2.0/db_1</div><div class="line">[oracle@rac1 ~]$ <span class="built_in">echo</span> <span class="variable">$ORACLE_BASE</span></div><div class="line">/u01/app/oracle</div><div class="line">[oracle@rac1 ~]$</div><div class="line"></div><div class="line">[grid@rac1 ~]$ tail -n 7 .bash_profile</div><div class="line"><span class="comment">#oracle</span></div><div class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/grid</div><div class="line"><span class="built_in">export</span> ORACLE_SID=+ASM1</div><div class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/11.2.0/grid</div><div class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">umask</span> 022</div><div class="line">[grid@rac1 ~]$ <span class="built_in">source</span> .bash_profile</div><div class="line">[gr[grid@rac1 ~]$ <span class="built_in">echo</span> <span class="variable">$ORACLE_BASE</span></div><div class="line">/u01/app/grid</div><div class="line">[grid@rac1 ~]$ <span class="built_in">echo</span> <span class="variable">$ORACLE_HOME</span></div><div class="line">/u01/app/11.2.0/grid</div><div class="line">[grid@rac1 ~]$</div><div class="line"></div><div class="line">[grid@rac2 ~]$ grep SID .bash_profile</div><div class="line"><span class="built_in">export</span> ORACLE_SID=+ASM2</div><div class="line">[grid@rac2 ~]$</div><div class="line"></div><div class="line">[oracle@rac2 ~]$ grep SID .bash_profile</div><div class="line"><span class="built_in">export</span> ORACLE_SID=racdb2</div><div class="line">[oracle@rac2 ~]$</div><div class="line">以上步骤第二个节点也同样操作</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#配置SSH互信</span></div><div class="line">[grid@rac1 sshsetup]$ <span class="built_in">pwd</span></div><div class="line">/software/grid/sshsetup</div><div class="line">[grid@rac1 sshsetup]$ ./sshUserSetup.sh -user grid -hosts rac2.example.com -advanced -exverify -confirm -noPromptPassphrase</div><div class="line">[grid@rac1 sshsetup]$</div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/9118C973FE614DCCBBA3F5BA6AEB41EC?method=download&amp;shareKey=a34b7dbec01e15dcd522013c0045af23" alt="ssh互信"><br><img src="http://note.youdao.com/yws/api/personal/file/6912860CAE2C4AADB5861B26A578A7CA?method=download&amp;shareKey=f7498f91cf7007e3b73de0362548bbdf" alt="ssh互信">  </p>
<p>检查下会不会出现下面的情况。如果出现在测试SSH互信时会包INS-06006的错误<br><img src="http://note.youdao.com/yws/api/personal/file/1FD46DDB71034ACEBB41F2C3B5C16104?method=download&amp;shareKey=71aa8faaca754212dc512af07d428f1f" alt="ssh_date1"><br><img src="http://note.youdao.com/yws/api/personal/file/843B1CBBA6B149D7B10D5DACB4424B11?method=download&amp;shareKey=da67f85fc412182ed0ea0900020cedc4" alt="ssh_date2"><br><img src="http://note.youdao.com/yws/api/personal/file/4315C5D7C6604B67AF2AD4BA8EB8C182?method=download&amp;shareKey=dcdc2804e2d9e67c62675b387b03cf58" alt="image"><br><img src="http://note.youdao.com/yws/api/personal/file/DB73EC487F3B42CDA69B8F5689922938?method=download&amp;shareKey=9edb234b13e3501524f96774150519b1" alt="image">  </p>
<p>安装cvuqdisk，发现共享磁盘(rac1和rac2都安装)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># CVUQDISK_GRP=oinstall &amp;&amp; export CVUQDISK_GRP</span></div><div class="line">[root@rac1 software]<span class="comment"># yum -y install smartmontools</span></div><div class="line">[root@rac1 software]<span class="comment"># yum -y install cvuqdisk-1.0.9-1.rpm</span></div></pre></td></tr></table></figure></p>
<p>使用UDEV绑定ASM<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># echo "options=--whitelisted --replace-whitespace"  &gt;&gt; /etc/scsi_id.config</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#UDEV绑定ASM脚本</span></div><div class="line"><span class="built_in">declare</span> -i num =0</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b c d;</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="built_in">let</span> num=<span class="variable">$num</span>+1</div><div class="line"><span class="built_in">echo</span> <span class="string">"KERNEL==\"sd*\", BUS==\"scsi\", PROGRAM==\"/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/\$name\", RESULT==\"`/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sd<span class="variable">$i</span>`\", NAME=\"asm-disk<span class="variable">$num</span>\", OWNER=\"grid\", GROUP=\"asmadmin\", MODE=\"0660\""</span> &gt;&gt; /etc/udev/rules.d/12-oracle-asmdevices.rules</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#使用start_udev命令重新启动udev服务</span></div><div class="line">[root@rac1 ~]<span class="comment"># start_udev</span></div><div class="line">Starting udev:                                             [  OK  ]</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#12-oracle-asmdevices.rules</span></div><div class="line"><span class="comment">#UDEV策略</span></div><div class="line">KERNEL==<span class="string">"sd*"</span>, BUS==<span class="string">"scsi"</span>, PROGRAM==<span class="string">"/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/<span class="variable">$name</span>"</span>, RESULT==<span class="string">"1IET_00010001"</span>, NAME=<span class="string">"asm-disk1"</span>, OWNER=<span class="string">"grid"</span>, GROUP=<span class="string">"asmadmin"</span>, MODE=<span class="string">"0660"</span></div><div class="line">KERNEL==<span class="string">"sd*"</span>, BUS==<span class="string">"scsi"</span>, PROGRAM==<span class="string">"/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/<span class="variable">$name</span>"</span>, RESULT==<span class="string">"1IET_00020002"</span>, NAME=<span class="string">"asm-disk2"</span>, OWNER=<span class="string">"grid"</span>, GROUP=<span class="string">"asmadmin"</span>, MODE=<span class="string">"0660"</span></div><div class="line">KERNEL==<span class="string">"sd*"</span>, BUS==<span class="string">"scsi"</span>, PROGRAM==<span class="string">"/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/<span class="variable">$name</span>"</span>, RESULT==<span class="string">"1IET_00030003"</span>, NAME=<span class="string">"asm-disk3"</span>, OWNER=<span class="string">"grid"</span>, GROUP=<span class="string">"asmadmin"</span>, MODE=<span class="string">"0660"</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/4968F05A3DAC4C71A8E945E8C3E6DBB3?method=download&amp;shareKey=c8d8aab71065291750db66df1e62939d" alt="image"><br>固化磁盘后Linux就无法读取到/dev/sdb、/dev/sdc、/dev/sdd了，在rac1上固化磁盘后，rac2上也需要执行下上面的脚本，注意匹配PROGRAM的值，需要与节点一的相同<br>注：如果使用UDEV绑定磁盘后所属组不是asmadmin，需要手动改下，否则在创建数据库(dbca)时会报错，如下图：<br><img src="http://note.youdao.com/yws/api/personal/file/FE485775F730495B8D65775CAF10F0A0?method=download&amp;shareKey=a48e258d0439272956fc6a1228eb14df" alt="image"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># chown grid:asmadmin /dev/asm-disk*</span></div><div class="line">[root@rac1 ~]<span class="comment"># echo "chown grid:asmadmin /dev/asm-disk*" &gt;&gt;/etc/rc.local</span></div></pre></td></tr></table></figure></p>
<p>更改后：<br><img src="http://note.youdao.com/yws/api/personal/file/7D70E68FA40A4B8F9337103C37F19FD6?method=download&amp;shareKey=c2cef35b5512fbfd2fb5be4348694769" alt="image">  </p>
<h2 id="安装Grid"><a href="#安装Grid" class="headerlink" title="安装Grid"></a>安装Grid</h2><p>用grid用户登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 grid]$ <span class="built_in">export</span> DISPLAY=192.168.100.251:0.0</div><div class="line">[grid@rac1 grid]$ ./runInstaller</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/FE8E61CC6E3E45F6A26DC92ED45D55D9?method=download&amp;shareKey=102774b58ddc8d9968ed2522a262bdd3" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/CFD0CBA42ABD4398AA646F45E51E8F3E?method=download&amp;shareKey=50203b8136874ce61978cf085e26bdc5" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/CCC009BB056645339376A817ADBBDE2C?method=download&amp;shareKey=bf0c55f1a04c50bd2ff6a191d0d29083" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/2E31CD4F29A349308C5EDE45C297C8F8?method=download&amp;shareKey=4efb135eed5c139437b4212f06e57280" alt="grid_install">  </p>
<p>需要在/etc/hosts里面解析racscan，否则会报：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[INS-40718] Single Client Access Name (SCAN):RACSCAN1 could not be resolved.</div></pre></td></tr></table></figure></p>
<p>但racscan不是真实存在的地址<br><img src="http://note.youdao.com/yws/api/personal/file/FF0748FF48B142AB859C7D9963B1B45B?method=download&amp;shareKey=b45ec81818a4873f70e445528eb77bca" alt="grid_install">  </p>
<p>Test和Setup均能通过<br><img src="http://note.youdao.com/yws/api/personal/file/17D7FE8F5E43433D8A4F8C2E3598D9EA?method=download&amp;shareKey=89108bde8e1ce16654c058b090ec0af5" alt="grid_install">  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[INS-40912] Virtual host name: rac1-vip is assigned to another system on the network.</div></pre></td></tr></table></figure>
<p>参考：<a href="https://community.oracle.com/thread/2594182" target="_blank" rel="external">https://community.oracle.com/thread/2594182</a><br>如果出现上面的报错信息，看下/etc/hosts里面的Virtual IP是否存在，ping一下<br><img src="http://note.youdao.com/yws/api/personal/file/2BDD7464264E45468E94FE7B82FE317C?method=download&amp;shareKey=9f0d48e5dbe439b46ae4e9d5fcdd0e3c" alt="rac_vip">  </p>
<p><img src="http://note.youdao.com/yws/api/personal/file/2BF28D6032274BC0935B3751AB90C015?method=download&amp;shareKey=a5ea2082ec4ad6802f2465ffa1e18f31" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/D90DA12B5BBD4EE294AE2F545BC73CF5?method=download&amp;shareKey=7b5c6c05a3a4d708b19d6347920a5de7" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/7EB263CDE75C4802AA045A3FBF22919A?method=download&amp;shareKey=7f4e16907a66e49ed5ef2a2c0e8760c4" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/900E5DE683CA470386D1F63D16A39162?method=download&amp;shareKey=9e185e802aa2c8d2b75b46d99d1ff2d3" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/8409B55D39224F64A3B631A9C38B198B?method=download&amp;shareKey=06b72a1b028c64847704e4f5334a5a09" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/9891079073064BDAA3E1D6024AAFEB87?method=download&amp;shareKey=2dfe1d8c8cc1e5fc752c489830813baf" alt="grid_install">  </p>
<p>在grid用户的环境变量，$ORACLE_HOME  不能是  $ORACLE_BASE  子目录，否则会报错：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ORACLE 11G RAC [INS-32026] The Software Location specified should not</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/1FE9A53C986042DEAFE66CD3DD533AB9?method=download&amp;shareKey=ff9b937ad40d6907acf04fd05f8a4806" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/DC323BFFE5044728B6025E7309DF4574?method=download&amp;shareKey=f91d6af7a55af38fb301679989c79bc7" alt="grid_install">  </p>
<p>因为这里使用是的udev绑定，这个警告可以忽略<br><img src="http://note.youdao.com/yws/api/personal/file/BC0579F86B5149E693285E4523E403D2?method=download&amp;shareKey=6227b8857a1a02cf34d1dedf3b6bbbb7" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/9C7E26FF75BA443A9B82D6EA84DE664D?method=download&amp;shareKey=f022760193ab0d46240a5d51f1ff68ef" alt="grid_install">  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># /u01/app/oraInventory/orainstRoot.sh</span></div><div class="line">Changing permissions of /u01/app/oraInventory.</div><div class="line">Adding <span class="built_in">read</span>,write permissions <span class="keyword">for</span> group.</div><div class="line">Removing <span class="built_in">read</span>,write,execute permissions <span class="keyword">for</span> world.</div><div class="line"></div><div class="line">Changing groupname of /u01/app/oraInventory to oinstall.</div><div class="line">The execution of the script is complete.</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div><div class="line">[root@rac1 ~]<span class="comment"># /u01/app/11.2.0/grid/root.sh</span></div></pre></td></tr></table></figure>
<p>执行上面这个脚本如果报下面的错误<br><img src="http://note.youdao.com/yws/api/personal/file/A8F28B38E831479288A74182A788A7CE?method=download&amp;shareKey=258f1581e7fd15d73a768c0b1c870fbf" alt="grid_root"><br>解决方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># yum -y install compat-libcap1*</span></div></pre></td></tr></table></figure></p>
<p>再执行/u01/app/11.2.0/grid/root.sh就没问题了<br>执行过程如下：<br><a href="http://note.youdao.com/yws/api/personal/file/5F86C7E0A3564106AAE09443614C4DB3?method=download&amp;shareKey=cd8ebff8d5e7a14cb9a5f306aced24e1" target="_blank" rel="external">rac1_u01_app_11.2.0_grid_root.sh执行过程</a><br><a href="http://note.youdao.com/yws/api/personal/file/7E8ACFD112234C4EAA6CFE3C598B81F1?method=download&amp;shareKey=b26ccf10fcffe85e535e19acb0045a8b" target="_blank" rel="external">rac1_u01_app_11.2.0_grid_root.sh执行过程</a><br>在rac1和rac2上都执行下↑↑↑(/u01/app/oraInventory/orainstRoot.sh和/u01/app/11.2.0/grid/root.sh)<br>在Install Product过程中如果出现下面的情况：(忽略）<br><img src="http://note.youdao.com/yws/api/personal/file/F91F56DC002140609177534DF6FA056D?method=download&amp;shareKey=1550687b6616e3380e772de03c512112" alt="grid_install">  </p>
<p>如果出现这个错误且能ping通racscan地址(192.168.100.246)，则可忽略<br><img src="http://note.youdao.com/yws/api/personal/file/F31B12CB31274E2CA5C7E869A0748EA9?method=download&amp;shareKey=61375d52ca2da7f0e08dd2c1e82fc6df" alt="grid_install"><br><img src="http://note.youdao.com/yws/api/personal/file/B0B0273158F3455B90DCD83990DD8F70?method=download&amp;shareKey=be794a83daed905874d9c917a85ded8d" alt="ping_racscan"><br><img src="http://note.youdao.com/yws/api/personal/file/6CC8AFF1F00D49A08ADFB36ACF617494?method=download&amp;shareKey=5ff8cb14275aba741f968b0d4f7fedf9" alt="grid_install">  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#检查crs状态</span></div><div class="line">[grid@rac1 grid]$ crsctl check crs</div><div class="line">CRS-4638: Oracle High Availability Services is online</div><div class="line">CRS-4537: Cluster Ready Services is online</div><div class="line">CRS-4529: Cluster Synchronization Services is online</div><div class="line">CRS-4533: Event Manager is online</div><div class="line"></div><div class="line"><span class="comment">#打印节点编号和节点名</span></div><div class="line">[grid@rac1 grid]$ olsnodes -n</div><div class="line">rac1	1</div><div class="line">rac2	2</div><div class="line"></div><div class="line"><span class="comment">#检测ctss状态</span></div><div class="line">[grid@rac1 grid]$ crsctl check ctss</div><div class="line">CRS-4701: The Cluster Time Synchronization Service is <span class="keyword">in</span> Active mode.</div><div class="line">CRS-4702: Offset (<span class="keyword">in</span> msec): 0</div><div class="line"></div><div class="line"><span class="comment">#显示指定数据库当前状态</span></div><div class="line">[grid@rac1 grid]$ srvctl status asm <span class="_">-a</span></div><div class="line">ASM is running on rac2,rac1</div><div class="line">ASM is enabled.</div><div class="line"></div><div class="line"><span class="comment">#显示注册Oracle集群的健康状态</span></div><div class="line">[grid@rac1 grid]$ ocrcheck</div><div class="line">Status of Oracle Cluster Registry is as follows :</div><div class="line">  Version                  :          3</div><div class="line">  Total space (kbytes)     :     262120</div><div class="line">  Used space (kbytes)      :       2592</div><div class="line">  Available space (kbytes) :     259528</div><div class="line">  ID                       : 1975731354</div><div class="line">  Device/File Name         :       +CRS</div><div class="line">                                    Device/File integrity check succeeded</div><div class="line"></div><div class="line">                                    Device/File not configured</div><div class="line"></div><div class="line">                                    Device/File not configured</div><div class="line"></div><div class="line">                                    Device/File not configured</div><div class="line"></div><div class="line">                                    Device/File not configured</div><div class="line"></div><div class="line">  Cluster registry integrity check succeeded</div><div class="line"></div><div class="line">  Logical corruption check bypassed due to non-privileged user</div><div class="line"></div><div class="line"><span class="comment">#查看votedisk磁盘位置</span></div><div class="line">[grid@rac1 grid]$ crsctl query css votedisk</div><div class="line"><span class="comment">##  STATE    File Universal Id                File Name Disk group</span></div><div class="line">--  -----    -----------------                --------- ---------</div><div class="line"> 1. ONLINE   65b9ef5913044fdbbff0d1b75e91172e (/dev/asm-disk1) [CRS]</div><div class="line">Located 1 voting disk(s).</div><div class="line">[grid@rac1 grid]$</div></pre></td></tr></table></figure>
<h2 id="创建ASM磁盘"><a href="#创建ASM磁盘" class="headerlink" title="创建ASM磁盘"></a>创建ASM磁盘</h2><p>grid用户登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ <span class="built_in">export</span> DISPLAY=192.168.100.251:0.0</div><div class="line">[grid@rac1 ~]$ xhost +</div><div class="line">access control disabled, clients can connect from any host</div><div class="line">[grid@rac1 ~]$ asmca</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/03C4A43AD7A64661A9D1D6F7EC185DC5?method=download&amp;shareKey=5fc81aaaeffd229cb98d98f55d4d0c4b" alt="ASM_install"><br><img src="http://note.youdao.com/yws/api/personal/file/04B843E1A9F34108BB17BF03C1C20CE8?method=download&amp;shareKey=04a0908d8bad5e7ed95fbba6cb0c0ec6" alt="ASM_install"><br><img src="http://note.youdao.com/yws/api/personal/file/094F58FBCE7C40529956B7953030953E?method=download&amp;shareKey=a08ff5ab2bfb4bb7b763ae9dc3540bd8" alt="ASM_install">  </p>
<h2 id="安装database"><a href="#安装database" class="headerlink" title="安装database"></a>安装database</h2><p>用Oracle用户登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]$ <span class="built_in">export</span> DISPLAY=192.168.100.251:0.0</div><div class="line">[oracle@rac1 ~]$ xhost +</div><div class="line">access control disabled, clients can connect from any host</div><div class="line">[oracle@rac1 ~]$ <span class="built_in">cd</span> /software/database</div><div class="line">[oracle@rac1 database]$ ./runInstaller</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/8D27737A5648408D8BC6D65160F19FEE?method=download&amp;shareKey=89e2e512ba5492fba02750710a519142" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/E30E8704F02049D2899F64B8C813B084?method=download&amp;shareKey=3c94b82c3ac0e3332af201ba61f1db27" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/46E5A434B9FA4589A6D9B479FF4427CC?method=download&amp;shareKey=03ef98de2f76489b85cfbd737ed9d027" alt="DB_install">  </p>
<p>做Oracle用户SSH互信(按照之前grid用户一样做互信)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 sshsetup]$ ./sshUserSetup.sh -user oracle -hosts rac2.example.com -advanced -exverify -confirm -noPromptPassphrase</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/7500B4745E454A33B8DE422A69C41EF2?method=download&amp;shareKey=cfd1df564ca56af384f33e8c2fcf4b0b" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/4667BFA405C94DC4B16EF5C0D4202277?method=download&amp;shareKey=c2518992dc8fe5fa6f655fae2090a642" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/39ECFC3C78DE48A69D133AA5852FE5DD?method=download&amp;shareKey=1d483c70b0afc1c966366af58281d6a3" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/A3BDB3519BD54AB69E30B2EB4CE9E0E4?method=download&amp;shareKey=eb593b50dd934d0059b344a95e00ea23" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/EC73246D2BA841B78357FF4028B42C55?method=download&amp;shareKey=633bca30d6a07834cbb5c757c9667e64" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/79B11710EA3145DF9EFFE4E9B2F63740?method=download&amp;shareKey=1564620f65cb5932e8f3d9527f85bd6f" alt="DB_install"><br><img src="http://note.youdao.com/yws/api/personal/file/83CB5C68B58A40999AF87472C598B7BB?method=download&amp;shareKey=276a1242d68cb6b789211c0c0d2ed032" alt="DB_install">  </p>
<p>节点rac1和节点rac2都执行下面的脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># /u01/app/oracle/product/11.2.0/db_1/root.sh</span></div><div class="line">Performing root user operation <span class="keyword">for</span> Oracle 11g</div><div class="line"></div><div class="line">The following environment variables are <span class="built_in">set</span> as:</div><div class="line">    ORACLE_OWNER= oracle</div><div class="line">    ORACLE_HOME=  /u01/app/oracle/product/11.2.0/db_1</div><div class="line"></div><div class="line">Enter the full pathname of the <span class="built_in">local</span> bin directory: [/usr/<span class="built_in">local</span>/bin]:</div><div class="line">The contents of <span class="string">"dbhome"</span> have not changed. No need to overwrite.</div><div class="line">The contents of <span class="string">"oraenv"</span> have not changed. No need to overwrite.</div><div class="line">The contents of <span class="string">"coraenv"</span> have not changed. No need to overwrite.</div><div class="line"></div><div class="line">Entries will be added to the /etc/oratab file as needed by</div><div class="line">Database Configuration Assistant when a database is created</div><div class="line">Finished running generic part of root script.</div><div class="line">Now product-specific root actions will be performed.</div><div class="line">Finished product-specific root actions.</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/9329F7C332564B30A997B062FF205885?method=download&amp;shareKey=3a8b9a6fc87a80c2654ed36d4baff48a" alt="DB_install"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># su - grid</span></div><div class="line"></div><div class="line"><span class="comment">#RAC查看集群资源状态</span></div><div class="line">[grid@rac1 ~]$ crs_stat  -t -v</div><div class="line">Name           Type           R/RA   F/FT   Target    State     Host        </div><div class="line">----------------------------------------------------------------------</div><div class="line">ora.CRS.dg     ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.FRA.dg     ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....ER.lsnr ora....er.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....N1.lsnr ora....er.type 0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....DATA.dg ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.asm        ora.asm.type   0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.cvu        ora.cvu.type   0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.gsd        ora.gsd.type   0/5    0/     OFFLINE   OFFLINE              </div><div class="line">ora....network ora....rk.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.oc4j       ora.oc4j.type  0/1    0/2    ONLINE    ONLINE    rac1        </div><div class="line">ora.ons        ora.ons.type   0/3    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....SM1.asm application    0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....C1.lsnr application    0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.rac1.gsd   application    0/5    0/0    OFFLINE   OFFLINE              </div><div class="line">ora.rac1.ons   application    0/3    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.rac1.vip   ora....t1.type 0/0    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....SM2.asm application    0/5    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora....C2.lsnr application    0/5    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.rac2.gsd   application    0/5    0/0    OFFLINE   OFFLINE              </div><div class="line">ora.rac2.ons   application    0/3    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.rac2.vip   ora....t1.type 0/0    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.scan1.vip  ora....ip.type 0/0    0/0    ONLINE    ONLINE    rac1        </div><div class="line">[grid@rac1 ~]$</div></pre></td></tr></table></figure></p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><p>创建数据库：(用oracle用户登录)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]$ <span class="built_in">export</span> DISPLAY=192.168.100.251:0.0</div><div class="line">[oracle@rac1 ~]$ xhost +</div><div class="line">access control disabled, clients can connect from any host</div><div class="line">[oracle@rac1 ~]$ dbca</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/B5F8C257719340B8A22A7E6364F27547?method=download&amp;shareKey=63d9c209de07599c1bd10b4007343f63" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/EC8B5FB7119944DB985A8417C8AC1E59?method=download&amp;shareKey=724f0eec005c3979adb19d91df077d03" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/73DF5250A493444FA211D6020C326624?method=download&amp;shareKey=e247fa3a130468dc2ee84ee4f4a8f88a" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/B1BE1C1885CB4A16ADC81F38F20E7242?method=download&amp;shareKey=fc6641f76abc9af875caf458bc1e2746" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/7D1B74AFAB0D46F497211545D05ECF3C?method=download&amp;shareKey=fc72815a42af6d027683594ab2fbb73f" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/D58AEA48BC9E4D97B04148222E495319?method=download&amp;shareKey=2f06e6917fb8ff2074182837d90e68da" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/92CBFDB752DD4A689904D208044DFEFA?method=download&amp;shareKey=ebdd2834a2be2f3a7a0b25e4041212a2" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/A67BFEEE880C4702BF2651C55D307E4C?method=download&amp;shareKey=10bd73780edc1b9fcbb6ad8a016c0a1e" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/9FABA2D3265448A18CD970588B437B16?method=download&amp;shareKey=0c2f98ed195c5d596d4fe52070ce97e5" alt="Create_db">  </p>
<p>如果SGA and PGA内存不够在安装数据库时会出现下面的错误：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ORA-00838: Specified value of MEMORY_TARGET is too small, needs to be at least 1408M</div><div class="line">ORA-01078：failure <span class="keyword">in</span> processing system parameters</div></pre></td></tr></table></figure></p>
<p>参考：<a href="http://yfshare.blog.51cto.com/8611708/1671927" target="_blank" rel="external">http://yfshare.blog.51cto.com/8611708/1671927</a>  </p>
<p><img src="http://note.youdao.com/yws/api/personal/file/531024DC7DF24577AB2C6BB0BCD30BAE?method=download&amp;shareKey=3fbdddc7d6413ce9169adfd0228e6b89" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/CEC9BC8BB4F04742A29FEF372612688C?method=download&amp;shareKey=e33dbdb30ea172090cb8f9fc6fcd1f8d" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/8A035EEF0C50450FBBF7B9B481B88CBC?method=download&amp;shareKey=3c735d9f58384633630df499b1f2843c" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/7FD8667B1D0A4F8A87ADE703925F0A25?method=download&amp;shareKey=85ff3fbdf736b2d2626bbc150f4bdb39" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/5DB3EE5CC1CB45299BDA03903CBDB517?method=download&amp;shareKey=4e5c5765cd6599136bf009a05ed5c5d7" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/985657944EA94DFFA419BFFCD59A48C1?method=download&amp;shareKey=7974beee807487207bc56da4e21ecd1c" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/D23B5E2CC2ED41848A392A7161ADA0CD?method=download&amp;shareKey=c46d6a21c0b78c4262095ae90b08464a" alt="Create_db"><br><img src="http://note.youdao.com/yws/api/personal/file/3758624B77A64DCB950BF4A1C1E3D28E?method=download&amp;shareKey=40fcf6de27d69bb64ce4101f7eb8f07d" alt="Create_db">  </p>
<p>如果安装到85%报上面这个错，查看到闪回区没空间了<br><img src="http://note.youdao.com/yws/api/personal/file/449AB7641BCF4D4FBF9E6D67A7D9F380?method=download&amp;shareKey=70a203188b5aa20546e05cca5fb1d348" alt="recovery_file_dest"><br>解决方法：删除多余的归档文件，或设置较大的db_recovery_file_dest_size  </p>
<p><img src="http://note.youdao.com/yws/api/personal/file/F0B6421ECD50485CBDB77BA985609B22?method=download&amp;shareKey=a113a3ab29f750841e6e0c4480b7bb2c" alt="Create_db">  </p>
<p>检查集群运行状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl status database <span class="_">-d</span> racdb</div><div class="line">crs_stat -t -v</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/87EB8740870045F880745C052AADEC76?method=download&amp;shareKey=6217fb496f2a634eccc760a25e42fdd9" alt="srvctl_status"><br><img src="http://note.youdao.com/yws/api/personal/file/805DC37BDB8D4CDC9D5951AF65B7D384?method=download&amp;shareKey=d11a2ec0e6cccacaea3a25d97a54b9f0" alt="crs_stat"><br><img src="http://note.youdao.com/yws/api/personal/file/6147B920E8B24AC5AE2CC3CF28A31008?method=download&amp;shareKey=80671286ac0a8d3d7a742b47cb00e012" alt="crs_stat">  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]$ lsnrctl status</div><div class="line">LSNRCTL <span class="keyword">for</span> Linux: Version 11.2.0.4.0 - Production on 11-JUL-2015 01:07:17</div><div class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</div><div class="line">Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR <span class="keyword">for</span> Linux: Version 11.2.0.4.0 - Production</div><div class="line">Start Date                10-JUL-2015 15:38:11</div><div class="line">Uptime                    0 days 9 hr. 29 min. 6 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/11.2.0/grid/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/grid/diag/tnslsnr/rac1/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.100.244)(PORT=1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.100.241)(PORT=1521)))</div><div class="line">Services Summary...</div><div class="line">Service <span class="string">"+ASM"</span> has 1 instance(s).</div><div class="line">  Instance <span class="string">"+ASM1"</span>, status READY, has 1 handler(s) <span class="keyword">for</span> this service...</div><div class="line">Service <span class="string">"racdb"</span> has 1 instance(s).</div><div class="line">  Instance <span class="string">"racdb1"</span>, status READY, has 1 handler(s) <span class="keyword">for</span> this service...</div><div class="line">Service <span class="string">"racdbXDB"</span> has 1 instance(s).</div><div class="line">  Instance <span class="string">"racdb1"</span>, status READY, has 1 handler(s) <span class="keyword">for</span> this service...</div><div class="line">The <span class="built_in">command</span> completed successfully</div><div class="line">[oracle@rac1 ~]$</div><div class="line"></div><div class="line">[oracle@rac1 ~]$ sqlplus / as sysdba</div><div class="line">SQL&gt; select status from v<span class="variable">$instance</span>;</div><div class="line"></div><div class="line">STATUS</div><div class="line">------------</div><div class="line">OPEN</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure>
<h2 id="配置EM管理器"><a href="#配置EM管理器" class="headerlink" title="配置EM管理器"></a>配置EM管理器</h2><p>如果启动EM web界面管理工具，出现下面的问题，则使用emca -config dbcontrol db重建EM<br><img src="http://note.youdao.com/yws/api/personal/file/8B81A3F8C4F24FB9AE76BF17483C6F24?method=download&amp;shareKey=6b4edfb25a8cb71d7b6288a8f042509a" alt="em_start"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除集群EM</span></div><div class="line">[oracle@rac1 ~]$ emca -deconfig dbcontrol db -cluster</div></pre></td></tr></table></figure></p>
<p><a href="http://note.youdao.com/yws/api/personal/file/E97CE99D29F74E0088BE1DD1BB2D2450?method=download&amp;shareKey=41edb04ba2cb25d35c10dbd851abae7e" target="_blank" rel="external">删除集群EM执行过程</a><br><a href="http://note.youdao.com/yws/api/personal/file/BEB6B2ECD5764208B17893513F26C6F4?method=download&amp;shareKey=de30b1edb7fa40d9a8debc87f710c3c9" target="_blank" rel="external">emctl命令</a>  </p>
<p>重建EM<br>用oracle用户登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]$ <span class="built_in">export</span> DISPLAY=192.168.100.251:0.0</div><div class="line">[oracle@rac1 ~]$ xhost +</div><div class="line">access control disabled, clients can connect from any host</div><div class="line">[oracle@rac1 ~]$ dbca</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/30AFD56186C94798BB9C494321EB5726?method=download&amp;shareKey=57185649b2653571b6315665457cb16d" alt="em_rebuild"><br><img src="http://note.youdao.com/yws/api/personal/file/51E12844D74A4A30BFA5DADD15726A93?method=download&amp;shareKey=175017e912a9c48781c67aa217eff47d" alt="em_rebuild"><br><img src="http://note.youdao.com/yws/api/personal/file/493A3B0E2F8D4E9C961BDCD561D0505D?method=download&amp;shareKey=a1a86d942a22150f0d9c2de0cd638ccb" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/0AD996F1EF3B41E9BAE257B8AFC672E2?method=download&amp;shareKey=2b72b9ca1ee1a07a4f9c01f70ba06fc7" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/7741542BB1EA4F4FB275E832A9873C38?method=download&amp;shareKey=92ca47c9566794f50e193f25ce76f837" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/257D3B750D7C4F5596F1735FA72EC76E?method=download&amp;shareKey=6674f78d0c6326e122c29bd35b41111a" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/ED32CFCE3ABE4CDA9EF15CD56D8BB4F0?method=download&amp;shareKey=b657a58df51961db1a7659dacf2bc2a0" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/B8EEDAD45D0E46D5805F15D08184C674?method=download&amp;shareKey=017dd6a0aaae1277a86ccc1cfb5ab336" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/85797754B44B4C71978F6EE9C8ADFD8F?method=download&amp;shareKey=29ee7750d8e9c3109152c327ae5efcb6" alt="em_rebuild1"><br><img src="http://note.youdao.com/yws/api/personal/file/9D6F942B32264A1C8402C2755AD5E9BB?method=download&amp;shareKey=739fd735cf7d39d55b3914fdd5183234" alt="em_rebuild1"><br>注：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]<span class="variable">$emctl</span> status dbconsole</div><div class="line">Environment variable ORACLE_UNQNAME not defined. Please <span class="built_in">set</span> ORACLE_UNQNAME to database unique name.</div><div class="line">[oracle@rac1 ~]$</div></pre></td></tr></table></figure></p>
<p>如果报上面的错误，是oracle用户的ORACLE_UNQNAME环境变量未设置。如果报下面的错误，则是ORACLE_UNQNAME设置不正确<br><img src="http://note.youdao.com/yws/api/personal/file/A410DFF1803F48B0A87A26CAC027CADA?method=download&amp;shareKey=a7658d2940b902f565cda2f6d2421497" alt="ORACLE_UNQNAME_error"><br>正确设置<br><img src="http://note.youdao.com/yws/api/personal/file/9F50F62A73104E2DA0BDB9531EE8DA48?method=download&amp;shareKey=9e765fb734dd34be7488ef2b86c891f5" alt="ORACLE_UNQNAME_true"><br><img src="http://note.youdao.com/yws/api/personal/file/79479FA7AE684FF9845E3780F7592B2D?method=download&amp;shareKey=c1bca3ac67335417a2964b46797597f8" alt="em_status"><br>oracle RAC集群默认是开机自启。根据配置不同，花费的时间不一样  </p>
<h2 id="配置PL-SQL"><a href="#配置PL-SQL" class="headerlink" title="配置PL/SQL"></a>配置PL/SQL</h2><p>使用PL/SQL登录oracle RAC<br>安装plsql+ora10client<br><a href="http://note.youdao.com/yws/api/personal/file/918F64A65F6B4723AE40E7415A0D0D97?method=download&amp;shareKey=0671839fd7336ba472007fd158a0b91c" target="_blank" rel="external">plsql+instantclient_11_2安装包</a><br>C:\Ora10InstantClient\network\admin\tnsnames.ora（在ora10client安装目录下新建network/admin目录，在RAC服务器上把$ORACLE_HOME/network/admin/tnsnames.ora文件放到ora10client安装目录下的admin目录下）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]<span class="comment"># grep racscan /etc/hosts</span></div><div class="line">192.168.100.246	racscan</div><div class="line">[root@rac1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>格式为：把HOST = racscan改为HOST = racscan对应的地址<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#监听文件</span></div><div class="line"><span class="attr">RACDB</span> =</div><div class="line">  (<span class="attr">DESCRIPTION</span> =</div><div class="line">    (<span class="attr">ADDRESS</span> = (<span class="attr">PROTOCOL</span> =TCP)(<span class="attr">HOST</span> = <span class="number">192.168</span>.<span class="number">100.246</span>)(<span class="attr">PORT=</span> <span class="number">1521</span>))</div><div class="line">    (<span class="attr">CONNECT_DATA</span> =</div><div class="line">      (<span class="attr">SERVER</span> = DEDICATED)</div><div class="line">      (<span class="attr">SERVICE_NAME</span> = racdb)</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure></p>
<p>打开PL/SQL—&gt;Tools—&gt;Preferences—&gt;Connection<br><img src="http://note.youdao.com/yws/api/personal/file/3C5FEB3B813C4EA1A23B8A2E3E184287?method=download&amp;shareKey=c2f4cd579bde7bb8c3b59610d79b7960" alt="plsql_preferences"><br><img src="http://note.youdao.com/yws/api/personal/file/867F08CA18E941CAA87DEFDB628EF9C8?method=download&amp;shareKey=97463fbbab49dd3a6b770c739d4ef260" alt="plsql_login"><br><img src="http://note.youdao.com/yws/api/personal/file/1D8F9F0F64554F5D94881F4491B030AC?method=download&amp;shareKey=7fa82a30a8bcd139dfa6e28467d7e849" alt="plsql_connected">  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/04/12/部署Oracle-RAC集群/">https://yfshare.github.io/2017/04/12/部署Oracle-RAC集群/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;RAC：real application clusters introduction  &lt;/p&gt;
&lt;p&gt;ORACLE RAC原理：&lt;br&gt;在一个应用环境当中，所有的服务器使用和管理同一个数据库，目的是为了分散每一台服务器的工作量，硬件上至少需要两台以上的服务器，而且还需一个共享存储设备。还需要两类软件，一个是集群软件，另外一个就是Oracle数据库中的RAC组件，所有服务器上的OS都应该是同一类OS。&lt;br&gt;
    
    </summary>
    
      <category term="Database" scheme="https://yfshare.github.io/categories/Database/"/>
    
    
      <category term="oracle" scheme="https://yfshare.github.io/tags/oracle/"/>
    
      <category term="RAC" scheme="https://yfshare.github.io/tags/RAC/"/>
    
  </entry>
  
  <entry>
    <title>Ansible常用模块</title>
    <link href="https://yfshare.github.io/2017/04/05/Ansible%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/"/>
    <id>https://yfshare.github.io/2017/04/05/Ansible常用模块/</id>
    <published>2017-04-05T03:26:10.000Z</published>
    <updated>2017-04-05T03:40:05.000Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>模块(也被称为 “task plugins” 或 “library plugins”)，可以在Ansible-playbooks和Ansible命令中运用它们。</p>
<p>官方文档：<br>Ansible所有模块列表：<a href="https://docs.ansible.com/ansible/list_of_all_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_all_modules.html</a><br><a id="more"></a><br>环境：Centos 6.6<br>　　　ansible 2.2.1.0  </p>
<h2 id="Command模块"><a href="#Command模块" class="headerlink" title="Command模块"></a>Command模块</h2><p>Ansible command模块：<a href="https://docs.ansible.com/ansible/list_of_commands_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_commands_modules.html</a><br>在远程主机上执行命令<br>常用选项：<br><strong>creates</strong>：判断，当该文件存在时，则该命令不执行<br><strong>free_form</strong>：需要执行的Linux指令<br><strong>chdir</strong>：在执行命令之前，先切换到该指定的目录<br><strong>removes</strong>：判断，当该文件不存在时，则该选项不执行<br><strong>executable</strong>：切换shell来执行命令，该执行路径必须是一个绝对路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查看test_hosts组主机的主机名</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible -i /etc/ansible/hosts test_hosts -u root -m command -a 'hostname' -k</span></div><div class="line">SSH password: </div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">host1</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"><span class="comment"># -i：specify inventory host path</span></div><div class="line"><span class="comment"># -u：Remote User</span></div><div class="line"><span class="comment"># -m：Module name</span></div><div class="line"><span class="comment"># -a：Module Args</span></div><div class="line"><span class="comment"># -k：ask for privilege escalation password。在Inventory(/etc/ansible/hosts)中配置ansible_ssh_user和ansible_ssh_pass后可实现Ansible免密连接或者使用证书实现免密连接，即不使用-k参数</span></div><div class="line"><span class="comment"># test_hosts：/etc/ansible/hosts指定的主机组</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#creates判断一个文件，当该文件存在时，则不执行后面的命令</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'creates=/tmp/aaa.txt ls /home'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">lost+found</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'creates=/tmp/ansible_test_cpoy.txt ls /home'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">skipped, since /tmp/ansible_test_cpoy.txt exists</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#removes当文件不存在时，不执行后面的命令</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'removes=/tmp/ansible_test_cpoy.txt ls /home'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">lost+found</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'removes=/tmp/bbb.txt.txt ls /home'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">skipped, since /tmp/bbb.txt.txt does not exist</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#chdir在执行命令前，先切换到指定的目录</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'chdir=/usr/local/games tar -czf game1.tar.gz game1'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'chdir=/usr/local/games ls -l'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 20500</div><div class="line">-rw-r--r-- 1 root root 20971520 Feb  6 15:42 game1</div><div class="line">-rw-r--r-- 1 root root    20458 Feb  6 15:43 game1.tar.gz</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Shell模块"><a href="#Shell模块" class="headerlink" title="Shell模块"></a>Shell模块</h2><p>Ansible shell模块：<a href="https://docs.ansible.com/ansible/shell_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/shell_module.html</a><br>Ansible raw：<a href="https://docs.ansible.com/ansible/raw_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/raw_module.html</a><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#shell模块可以使用command模块所有选项，但功能比command模块更强大，因为其支持“|”管道符。</span></div><div class="line"><span class="comment">#使用raw模块也可。执行ansible-doc -s raw查看帮助</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'ps -ef | grep crond | grep -v grep'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">root       <span class="number">1013</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span><span class="symbol">:</span><span class="number">36</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> crond</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m raw -a 'ps -ef | grep crond | grep -v grep'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">root       <span class="number">1013</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span><span class="symbol">:</span><span class="number">36</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> crond</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "aaa.sh &gt;&gt; /tmp/output.txt"</span></div></pre></td></tr></table></figure></p>
<h2 id="File模块"><a href="#File模块" class="headerlink" title="File模块"></a>File模块</h2><p>Ansible File模块：<a href="https://docs.ansible.com/ansible/list_of_files_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_files_modules.html</a><br>file - Sets attributes of file：<a href="https://docs.ansible.com/ansible/file_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/file_module.html</a></p>
<p>常用选项：<br><strong>force</strong>：在两种情况下强制创建软链接。1、源文件不存在但之后会建立的情况；2、目标软件已存在，需要先取消之前的软链接，然后创建新的软链接。选项：yes|no<br><strong>group</strong>：定义文件/目录的属组<br><strong>mode</strong>：定义文件/目录的权限<br><strong>path</strong>：必选项，定义文件/目录的路径<br><strong>recurse</strong>：递归的设置文件的属性，只对目录有效<br><strong>src</strong>：要被链接到的路径，只应用于state=link的情况<br><strong>dest</strong>：被链接到的路径，只应用于state=link的情况<br><strong>state</strong>：  </p>
<ul>
<li>directory：如果目录不存在，创建目录</li>
<li>file：即使文件不存在，也不会被创建</li>
<li>link：创建软链接；hard：创建硬链接</li>
<li>touch：如果文件不存在，则会创建一个新的文件，如果已存在，则更新其最后修改时间</li>
<li>absent：删除目录/文件或者取消链接文件  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Ansible创建文件：</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/tmp/test.txt state=touch'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/test.txt"</span>, </div><div class="line">    <span class="string">"gid"</span>: <span class="number">0</span>, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: <span class="number">0</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'ls -l /tmp/test.txt'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">0</span> Feb  <span class="number">6</span> <span class="number">10</span><span class="symbol">:</span><span class="number">38</span> /tmp/test.txt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"><span class="comment">#Ansible删除文件，文件状态改成absent；使用command模块执行rm命令也可</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/tmp/test.txt state=absent'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"path"</span>: <span class="string">"/tmp/test.txt"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"absent"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Ansible创建目录：</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/tmp/test_dir state=directory owner=root group=mail mode=777'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"gid"</span>: <span class="number">12</span>, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"mail"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0777"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"path"</span>: <span class="string">"/tmp/test_dir"</span>, </div><div class="line">    <span class="string">"size"</span>: <span class="number">4096</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"directory"</span>, </div><div class="line">    <span class="string">"uid"</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'ls -ld /tmp/test_dir'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">drwxrwxrwx <span class="number">2</span> root mail <span class="number">4096</span> Feb  <span class="number">6</span> <span class="number">10</span><span class="symbol">:</span><span class="number">47</span> /tmp/test_dir</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Copy模块："><a href="#Copy模块：" class="headerlink" title="Copy模块："></a>Copy模块：</h2><p>Ansible copy模块：<a href="https://docs.ansible.com/ansible/copy_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/copy_module.html</a><br>复制文件到远程主机<br>常用选项<br><strong>backup</strong>：在覆盖之前将源文件备份，备份文件包含时间信息，选项：yes|no<br><strong>content</strong>：用于替代”src”，可以直接设定文件的值<br><strong>directory_node</strong>：递归的设定目录权限，默认为系统默认权限<br><strong>force</strong>：如果目标主机包含该文件，但内容不同，如果设置为yes，则强制覆盖；如果设置为no，则只有当目标主机的目标位置不存在该文件时，才复制。默认为yes<br><strong>others</strong>：所有file模块里的选项都可以在这里使用<br><strong>src</strong>：要复制到远程主机的文件在本地的地址，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制。在这种情况下，如果路径使用“/”来结尾，则只复制目录里的内容，如果没有使用“/”来结尾，则包含目录在内的整个内容全部复制，类似于rsync<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m copy -a 'src=/root/test_file.txt dest=/tmp/ansible_test_cpoy.txt owner=root group=mail mode=0600'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"e6c4fbd4fe7607f3e6ebf68b2ea4ef694da7b4fe"</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/ansible_test_cpoy.txt"</span>, </div><div class="line">    <span class="string">"gid"</span>: 12, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"mail"</span>, </div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"2d282102fa671256327d4767ec23bc6b"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0600"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 21, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1486364820.02-66604881581156/source"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'ls -l /tmp/ansible_test_cpoy.txt'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">-rw------- 1 root mail 21 Feb  6 15:07 /tmp/ansible_test_cpoy.txt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="Service模块"><a href="#Service模块" class="headerlink" title="Service模块"></a>Service模块</h2><p>Ansible service模块：<a href="https://docs.ansible.com/ansible/service_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/service_module.html</a><br>用于管理服务<br>常用选项：<br><strong>arguments</strong>：为命令提供一些附加参数<br><strong>enabled</strong>：是否开机启动，选项 yes|no<br><strong>name</strong>：必选项，服务名称<br><strong>pattern</strong>：定义一个模式，如果通过status指令来查看服务状态时，没有响应，它会通过ps命令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然运行<br><strong>runlevel</strong>：运行级别<br><strong>sleep</strong>：如果执行了restarted，则在stop和start之间等待几秒钟<br><strong>state</strong>：对当前服务执行启动/停止/重启/重新加载等操作(started/stopped/restarted/reloaded)<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m service -a 'name=nginx state=started enabled=yes'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"enabled"</span>: true, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"nginx"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'ps -ef | grep nginx | grep -v grep'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">root       <span class="number">2638</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> <span class="symbol">nginx:</span> master process /usr/sbin/nginx -c /etc/nginx/nginx.conf</div><div class="line">nginx      <span class="number">2640</span>   <span class="number">2638</span>  <span class="number">0</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> <span class="symbol">nginx:</span> worker process                   </div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'chkconfig --list | egrep -w nginx'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">nginx          	<span class="number">0</span><span class="symbol">:off</span>	<span class="number">1</span><span class="symbol">:off</span>	<span class="number">2</span><span class="symbol">:on</span>	<span class="number">3</span><span class="symbol">:on</span>	<span class="number">4</span><span class="symbol">:on</span>	<span class="number">5</span><span class="symbol">:on</span>	<span class="number">6</span><span class="symbol">:off</span></div><div class="line">nginx-debug    	<span class="number">0</span><span class="symbol">:off</span>	<span class="number">1</span><span class="symbol">:off</span>	<span class="number">2</span><span class="symbol">:off</span>	<span class="number">3</span><span class="symbol">:off</span>	<span class="number">4</span><span class="symbol">:off</span>	<span class="number">5</span><span class="symbol">:off</span>	<span class="number">6</span><span class="symbol">:off</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#Ansible会匹配nginx服务，如果存在/usr/sbin/nginx这个进程时，认为其已经启动，则不执行后面的started操作</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m service -a 'name=nginx pattern=/usr/sbin/nginx state=started'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: false, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"nginx"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m service -a 'name=network state=restarted args=eth0'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"network"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="Cron模块"><a href="#Cron模块" class="headerlink" title="Cron模块"></a>Cron模块</h2><p>Ansible cron模块：<a href="https://docs.ansible.com/ansible/cron_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/cron_module.html</a><br>用于管理计划任务<br>常用参数：<br><strong>backup</strong>：对远程主机上的原计划任务内容修改之前做备份<br><strong>cron_file</strong>：如果指定该选项，则用该文件替换远程主机上cron.d目录下的用户的任务计划<br><strong>day</strong>：日(1-31,*,*/2,…)<br><strong>hour</strong>：小时(0-23,*,*/2,…)<br><strong>minute</strong>:分钟(0-59,*,*/2,…)<br><strong>month</strong>：月(0-12,*,…)<br><strong>weekday</strong>：周(0-7,*,…)<br><strong>job</strong>：要执行的任务，依赖于state=present<br><strong>name</strong>：该任务的描述<br><strong>special_time</strong>：指定什么时候执行，参数：reboot,yearly,annually,monthly,weekly,daily,hourly<br><strong>state</strong>：确认该任务计划是创建还是删除<br><strong>user</strong>：以哪个用户身份执行<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="reboot system" minute=0 hour=5 user=root job="/sbin/reboot" state=present'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: [</div><div class="line">        <span class="string">"reboot system"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "crontab -l"</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="comment">#Ansible: reboot system</span></div><div class="line"><span class="number">0</span> <span class="number">5</span> * * * <span class="regexp">/sbin/reboot</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="reboot system" state=absent'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: []</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#每隔5分钟查看home目录,state=present可省略</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="check home directory" minute=*/5 job="ls -lht /home"'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: [</div><div class="line">        <span class="string">"check home directory"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "crontab -l"</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="comment">#Ansible: check home directory</span></div><div class="line">*<span class="regexp">/5 * * * * ls -lht /home</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="echo reboot" special_time=reboot job="echo reboot_successful" state=present'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: [</div><div class="line">        <span class="string">"echo reboot"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "crontab -l"</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="comment">#Ansible: echo reboot</span></div><div class="line">@reboot echo reboot_successful</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h2><p>Ansible FileSystem模块：<a href="https://docs.ansible.com/ansible/filesystem_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/filesystem_module.html</a><br>块设备上创建文件系统<br>选项：<br><strong>dev</strong>：目标块设备<br><strong>force</strong>：在一个已有文件系统的设备上强制创建<br><strong>fstype</strong>：文件系统的类型<br><strong>opts</strong>：传递给mkfs命令的选项<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Filesystem模块只能对整个块设备操作，不能分区</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m filesystem -a 'dev=/dev/sdb fstype=ext4'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'fdisk -l /dev/sdb'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line"></div><div class="line">Disk /dev/sdb: 107.4 GB, 107374182400 bytes</div><div class="line">255 heads, 63 sectors/track, 13054 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#如果需要像平时样对块设备进行分区操作，则需要编写脚本让Ansible执行。这里用到了copy和command模块</span></div><div class="line">[root@Ansible ~]<span class="comment"># cat fdisk.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#make partition</span></div><div class="line">fdisk /dev/sdb &lt;&lt;EOF</div><div class="line">n</div><div class="line">p</div><div class="line">1</div><div class="line"></div><div class="line">+10G</div><div class="line">p</div><div class="line">w</div><div class="line">EOF</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m copy -a 'src=/root/fdisk.sh dest=/tmp/'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"f265923f0a4578e36c82418df1a068a55867c1b1"</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/fdisk.sh"</span>, </div><div class="line">    <span class="string">"gid"</span>: 0, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"87c9e0b074e4828b37d6e334d1cf7ce1"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 71, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1486437971.22-237961786906240/source"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'sh /tmp/fdisk.sh'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">...</div><div class="line">Disk /dev/sdb: 107.4 GB, 107374182400 bytes</div><div class="line">255 heads, 63 sectors/track, 13054 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x166637ee</div><div class="line"></div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sdb1               1        1306    10490413+  83  Linux</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'mkfs.ext4 /dev/sdb1'</span></div><div class="line"><span class="comment">#格式化分区</span></div></pre></td></tr></table></figure>
<h2 id="Mount模块"><a href="#Mount模块" class="headerlink" title="Mount模块"></a>Mount模块</h2><p>Ansible mount模块：<a href="https://docs.ansible.com/ansible/mount_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/mount_module.html</a><br><strong>dump</strong>：存储(见fstab文件第5列)。注意，如果设置为null并且状态设置为present，它将停止工作，并且将在后续运行中进行重复条目。对Solaris系统没有影响。<br><strong>fstype</strong>：必选项，文件系统类型，要求状态是present或mounted<br><strong>name</strong>：必选项，挂载点<br><strong>opts</strong>：传递给mount命令的参数<br><strong>src</strong>：必选项，要挂载的设备路径。要求状态是present或mounted<br><strong>state</strong>：必选项。选项为present/absent/mounted/unmounted  </p>
<ul>
<li>present：只处理fstab中的配置</li>
<li>absent：删除挂载点  </li>
<li>mounted：自动创建挂载点并挂载  </li>
<li>unmounted：卸载  <figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#挂载分区</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m mount -a 'name=/mnt src=/dev/sdb1 fstype=ext4 state=mounted opts=rw'</span></div><div class="line"><span class="number">192.168</span><span class="number">.31</span><span class="number">.110</span> | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"dump"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"fstab"</span>: <span class="string">"/etc/fstab"</span>, </div><div class="line">    <span class="string">"fstype"</span>: <span class="string">"ext4"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"/mnt"</span>, </div><div class="line">    <span class="string">"opts"</span>: <span class="string">"rw"</span>, </div><div class="line">    <span class="string">"passno"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/dev/sdb1"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'df -h /dev/sdb1'</span></div><div class="line"><span class="number">192.168</span><span class="number">.31</span><span class="number">.110</span> | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</div><div class="line">Filesystem      Size  Used Avail Use% Mounted <span class="literal">on</span></div><div class="line">/dev/sdb1       <span class="number">9.8</span>G   <span class="number">23</span>M  <span class="number">9.3</span>G   <span class="number">1</span>% /mnt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'tail -1 /etc/fstab'</span></div><div class="line"><span class="number">192.168</span><span class="number">.31</span><span class="number">.110</span> | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</div><div class="line">/dev/sdb1 /mnt ext4 rw <span class="number">0</span> <span class="number">0</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#state=mounted，如果挂载点不存在会自动创建</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'dd if=/dev/zero of=/mnt/disk.img bs=1M count=100'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">100+0 records <span class="keyword">in</span></div><div class="line">100+0 records out</div><div class="line">104857600 bytes (105 MB) copied, 0.241784 s, 434 MB/s</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'losetup /dev/loop0 /mnt/disk.img'  #关联设备</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m filesystem -a 'dev=/mnt/disk.img fstype=ext4 opts=-F'  #格式化块设备</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m mount -a 'src=/dev/loop0 name=/yfshare fstype=ext4 state=mounted'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"dump"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"fstab"</span>: <span class="string">"/etc/fstab"</span>, </div><div class="line">    <span class="string">"fstype"</span>: <span class="string">"ext4"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"/yfshare"</span>, </div><div class="line">    <span class="string">"opts"</span>: <span class="string">"defaults"</span>, </div><div class="line">    <span class="string">"passno"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/dev/loop0"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'df -h | grep -w loop0'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">/dev/loop0             93M  1.6M   87M   2% /yfshare</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'grep -w loop0 /etc/fstab'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">/dev/loop0 /yfshare ext4 defaults 0 0</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/yfshare/test.txt state=touch mode=0600'</span></div></pre></td></tr></table></figure>
<h2 id="Yum模块"><a href="#Yum模块" class="headerlink" title="Yum模块"></a>Yum模块</h2><p>Ansible Packaging Modules：<a href="https://docs.ansible.com/ansible/list_of_packaging_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_packaging_modules.html</a><br>Ansible yum模块：<a href="https://docs.ansible.com/ansible/yum_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/yum_module.html</a><br>使用yum包管理器来管理软件包<br>选项：<br><strong>conf_file</strong>：yum的配置文件<br><strong>disable_gpg_check</strong>：关闭gpg_check<br><strong>disablerepo</strong>：不启用某个源<br><strong>enablerepo</strong>：启用某个源<br><strong>list</strong>：查看yum列表<br><strong>name</strong>：要进行操作的软件包名字，也可以传递一个url或者一个本地的rpm包的路径<br><strong>state</strong>：状态(present/installed/absent/removed/latest)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#卸载nginx软件包</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m yum -a 'name=nginx state=absent'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"msg"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"rc"</span>: 0, </div><div class="line">    <span class="string">"results"</span>: [</div><div class="line">    <span class="string">"Loaded plugins: fastestmirror\nSetting up Remove Process\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package nginx.x86_64 0:1.10.3-1.el6.ngx will be erased\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n\n</span></div><div class="line">    ...</div><div class="line">        ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]#</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#更新nginx软件包</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m yum -a 'name=nginx update_cache=yes'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"msg"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"rc"</span>: 0, </div><div class="line">    <span class="string">"results"</span>: [</div><div class="line">        <span class="string">"nginx-1.10.3-1.el6.ngx.x86_64 providing nginx is already installed"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="User模块"><a href="#User模块" class="headerlink" title="User模块"></a>User模块</h2><p>Ansible User模块：<a href="https://docs.ansible.com/ansible/user_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/user_module.html</a><br>常用参数：<br><strong>home</strong>：指定用户家目录<br><strong>group</strong>：设置用户主组<br><strong>groups</strong>：设置用户的附属组<br><strong>uid</strong>：设置用户的UID<br><strong>password</strong>：设置用户的密码，密码必须为加密后的值<br><strong>name</strong>：创建用户的用户名<br><strong>createhhome</strong>：选项yes|no，值为yes时才创建用户家目录<br><strong>system</strong>：选项yes|no，默认为no，值为yes时创建的用户为系统用户<br><strong>remove</strong>：当state=absent时，remove=yes则表示连同家目录一起删除，等价于userdel -r<br><strong>state</strong>：选项present|absent，创建用户或删除用户<br><strong>shell</strong>：设置用户的shell环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#生成用户的密码</span></div><div class="line">[root@Ansible ~]<span class="comment"># echo "123456" | openssl passwd -1 -salt $(&lt; /dev/urandom tr -dc '[:alnum:]' | head -c 32) -stdin</span></div><div class="line"><span class="variable">$1</span><span class="variable">$K28XAyId</span><span class="variable">$YUKHvYzbbO9C8RkzGIzNo1</span></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#group为指定用户的主组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m user -a 'name=user1 uid=1001 group=yfshare createhome=yes home=/home/user1 password="$1$K28XAyId$YUKHvYzbbO9C8RkzGIzNo1" shell=/bin/bash state=present'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"comment"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"createhome"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"group"</span>: 1000, </div><div class="line">    <span class="string">"home"</span>: <span class="string">"/home/user1"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"user1"</span>, </div><div class="line">    <span class="string">"password"</span>: <span class="string">"NOT_LOGGING_PASSWORD"</span>, </div><div class="line">    <span class="string">"shell"</span>: <span class="string">"/bin/bash"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"present"</span>, </div><div class="line">    <span class="string">"system"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"uid"</span>: 1001</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'id user1'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">uid=1001(user1) gid=1000(yfshare) groups=1000(yfshare)</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#groups为指定用户的附属组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m user -a 'name=user2 uid=1002 groups=yfshare createhome=yes home=/home/user2 password="$1$K28XAyId$YUKHvYzbbO9C8RkzGIzNo1" shell=/bin/bash state=present'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"comment"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"createhome"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"group"</span>: 1002, </div><div class="line">    <span class="string">"groups"</span>: <span class="string">"yfshare"</span>, </div><div class="line">    <span class="string">"home"</span>: <span class="string">"/home/user2"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"user2"</span>, </div><div class="line">    <span class="string">"password"</span>: <span class="string">"NOT_LOGGING_PASSWORD"</span>, </div><div class="line">    <span class="string">"shell"</span>: <span class="string">"/bin/bash"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"present"</span>, </div><div class="line">    <span class="string">"system"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"uid"</span>: 1002</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'id user2'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">uid=1002(user2) gid=1002(user2) groups=1002(user2),1000(yfshare)</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除user1用户</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m user -a 'name=user1 remove=yes state=absent'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"force"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"user1"</span>, </div><div class="line">    <span class="string">"remove"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"absent"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'id user1'</span></div><div class="line">192.168.31.110 | FAILED | rc=1 &gt;&gt;</div><div class="line">id: user1: No such user</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Group模块"><a href="#Group模块" class="headerlink" title="Group模块"></a>Group模块</h2><p>Ansible group模块：<a href="https://docs.ansible.com/ansible/group_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/group_module.html</a><br>选项：<br><strong>gid</strong>：设置组的GID<br><strong>name</strong>：组名<br><strong>state</strong>：选项为present|absent，创建组或删除组<br><strong>system</strong>：选项为yes|no，值为yes，则创建系统组<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#创建yfshare组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m group -a 'name=yfshare gid=1000 state=present'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"gid"</span>: 1000, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"yfshare"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"present"</span>, </div><div class="line">    <span class="string">"system"</span>: <span class="literal">false</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'grep yfshare /etc/group'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">yfshare:x:1000:</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除yfshare组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m group -a 'name=yfshare gid=1000 state=absent'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"yfshare"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"absent"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'grep yfshare /etc/group'</span></div><div class="line">192.168.31.110 | FAILED | rc=1 &gt;&gt;</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Synchronize模块"><a href="#Synchronize模块" class="headerlink" title="Synchronize模块"></a>Synchronize模块</h2><p>Ansible synchronize模块：<a href="https://docs.ansible.com/ansible/synchronize_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/synchronize_module.html</a><br><strong>archive</strong>：归档，相当于同时开启recursive(递归)、links、perms、times、owner、group、-D选项都为yes ，默认该项为开启<br><strong>checksum</strong>：跳过检测sum值，默认关闭<br><strong>delete</strong>：删除不存在的文件(源主机没有但目标主机中存在的文件)，默认no<br><strong>dest</strong>：从源同步到目的主机的路径，可以为绝对路径或相对路径<br><strong>src</strong>：在源主机上将要同步到目的主机的路径，可为绝对路径或相对路径<br><strong>dest_port</strong>：目标主机上的SSH端口号，在Ansible 2.0之前，ansible_ssh_port变量值优先于此变量<br><strong>existing_only</strong>：在目的主机上不创建新文件<br><strong>links</strong>：将符号链接复制为符号链接<br><strong>copy_links</strong>：复制链接文件，默认为no<br><strong>owner</strong>：保留所有者（仅超级用户）<br><strong>mode</strong>：选项push和pull。push模式，从本机向远程主机传送文件；pull模式从远程主机上取文件<br><strong>recursive</strong>：递归到目录<br><strong>rsync_path</strong>：指定在远程主机上运行rsync命令<br><strong>times</strong>：保留修改时间<br><strong>compress</strong>：在传输过程中是否压缩文件，选项yes|no<br><strong>dirs</strong>：传速目录不进行递归，默认为no，即进行目录递归<br><strong>rsync_opts</strong>：指定rsync参数选项<br><strong>set_remote_user</strong>：主要用于/etc/ansible/hosts中定义或默认使用的用户与rsync使用的用户不同的情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="string">"msg"</span>: <span class="string">"Failed to find required executable ssh"</span>  <span class="comment">#出现这个报错，需要安装openssh-clients</span></div><div class="line"><span class="string">"msg"</span>: <span class="string">"Failed to find required executable rsync"</span>  <span class="comment">#出现这个问题，需要安装rsync</span></div><div class="line"></div><div class="line"><span class="comment">#synchronize同步文件</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m synchronize -a 'src=/tmp/helloworld.txt dest=/tmp/'</span></div><div class="line">root@192.168.31.110<span class="string">'s password: </span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    "changed": true, </div><div class="line">    "cmd": "/usr/bin/rsync --delay-updates -F --compress --archive --rsh 'ssh  -S none -o StrictHostKeyChecking=no<span class="string">' --out-format='</span>&lt;&lt;CHANGED&gt;&gt;%i %n%L<span class="string">' \"/tmp/helloworld.txt\" \"root@192.168.31.110:/tmp/\"", </span></div><div class="line">    "msg": "&lt;f+++++++++ helloworld.txt\n", </div><div class="line">    "rc": 0, </div><div class="line">    "stdout_lines": [</div><div class="line">        "&lt;f+++++++++ helloworld.txt"</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]# ansible test_hosts -a 'cat /tmp/helloworld.txt<span class="string">'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">hello world</div><div class="line"></div><div class="line">[root@Ansible ~]#</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#synchronize同步目录。如果synchronize同步到目的服务器的目录不存在，则会创建该目录后同步到该目录，rsync_path可以指定rsync的路径(如果是源码安装的)</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m synchronize -a 'src=/tmp/test dest=/tmp/synchronize_test delete=yes mode=push owner=yes rsync_path=/usr/bin/rsync rsync_opts="-avz,--exclude=.git"'</span></div><div class="line">root@192.168.31.110<span class="string">'s password: </span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    "changed": true, </div><div class="line">    "cmd": "/usr/bin/rsync --delay-updates -F --compress --delete-after --archive --rsh 'ssh  -S none -o StrictHostKeyChecking=no<span class="string">' --out-format='</span>&lt;&lt;CHANGED&gt;&gt;%i %n%L<span class="string">' \"/tmp/test\" \"root@192.168.31.110:/tmp/synchronize_test\"", </span></div><div class="line">    "msg": "cd+++++++++ test/\n</div><div class="line">    ···</div><div class="line">        ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]#</div><div class="line">[root@Ansible ~]# ansible test_hosts -a 'ls /tmp/synchronize_test<span class="string">'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">test</div><div class="line"></div><div class="line">[root@Ansible ~]#</div></pre></td></tr></table></figure>
<h2 id="get-url模块"><a href="#get-url模块" class="headerlink" title="get_url模块"></a>get_url模块</h2><p>主要用于从http、ftp、https服务器上下载文件（类似于wget）<br>Ansible get_url模块：<a href="https://docs.ansible.com/ansible/get_url_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/get_url_module.html</a><br>选项：<br><strong>checksum</strong>：文件下载完成后进行校验<br><strong>timeout</strong>：请求超时时间，默认为10s<br><strong>url</strong>：文件下载地址<br><strong>url_username</strong>：用户名，基于HTTP的基本认证<br><strong>url_password</strong>：密码<br><strong>use_proxy</strong>：选项yes|no，默认为yes，即使用代理<br><strong>dest</strong>：下载文件存储的绝对路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#下载文件并下载完成后进行sha256sum校验</span></div><div class="line"><span class="comment">#支持加密算法：sha1, sha224, sha384, sha256, sha512, md5</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m get_url -a 'dest=/tmp/ url="http://archive.kernel.org/centos-vault/6.7/isos/x86_64/0_README.txt" checksum="sha256:f98849cdc1b3dee8cf47cfcf2a2fe2fb8e8e69426157a47d20a3005693fd3e1c"'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"checksum_dest"</span>: null, </div><div class="line">    <span class="string">"checksum_src"</span>: <span class="string">"a1b756c6a431552e5012a9332c68dc1ef3ec463c"</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/0_README.txt"</span>, </div><div class="line">    <span class="string">"gid"</span>: 0, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"99bc97977d71be899bef0c5664fae3fb"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>, </div><div class="line">    <span class="string">"msg"</span>: <span class="string">"OK (2210 bytes)"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 2210, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/tmp/tmp8GUXc4"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0, </div><div class="line">    <span class="string">"url"</span>: <span class="string">"http://archive.kernel.org/centos-vault/6.7/isos/x86_64/0_README.txt"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'ls /tmp/0_README.txt -l'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">-rw-r--r-- 1 root root 2210 Feb  8 19:33 /tmp/0_README.txt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="unarchive模块"><a href="#unarchive模块" class="headerlink" title="unarchive模块"></a>unarchive模块</h2><p>Ansible unarchive模块：<a href="https://docs.ansible.com/ansible/unarchive_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/unarchive_module.html</a><br>用于解压文件<br>选项：<br><strong>remote_src</strong>：选项yes|no，默认为no，值为yes表示文件已复制到远程主机，added in Ansible 2.2<br><strong>creates</strong>：如果文件存在，则不执行解压命令<br><strong>dest</strong>：在远程主机上解压的绝对路径<br><strong>group</strong>：设置解压后文件/目录的属组<br><strong>owner</strong>：设置解压后文件/目录的属主<br><strong>list_files</strong>：选项yes|no，默认为no，值为yes，解压后列出压缩包的文件，added in Ansible 2.0<br><strong>mode</strong>：解压后文件的权限<br><strong>src</strong>：值为yes，如果remote_src=no (default)，本地压缩文件复制到目的服务器，绝对路径相对路径均可；如果remote_src=yes，直接在目标服务器上解压文件；如果remote_src=yes和src包含URL，则先下载文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m unarchive -a 'creates=NewSid.zip src=/tmp/NewSid.zip dest=/tmp/ mode=0600 owner=yfshare list_files=yes'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/"</span>, </div><div class="line">    <span class="string">"extract_results"</span>: &#123;</div><div class="line">        <span class="string">"cmd"</span>: [</div><div class="line">            <span class="string">"/usr/bin/unzip"</span>, </div><div class="line">            <span class="string">"-o"</span>, </div><div class="line">            <span class="string">"/root/.ansible/tmp/ansible-tmp-1486610818.84-40104290759151/source"</span>, </div><div class="line">            <span class="string">"-d"</span>, </div><div class="line">            <span class="string">"/tmp/"</span></div><div class="line">        ], </div><div class="line">        <span class="string">"err"</span>: <span class="string">""</span>, </div><div class="line">        <span class="string">"out"</span>: <span class="string">"Archive:  /root/.ansible/tmp/ansible-tmp-1486610818.84-40104290759151/source\n  inflating: /tmp/newsid.exe         \n  inflating: /tmp/Eula.txt           \n"</span>, </div><div class="line">        <span class="string">"rc"</span>: 0</div><div class="line">    &#125;, </div><div class="line">    <span class="string">"files"</span>: [   <span class="comment">#列出解压文件列表</span></div><div class="line">        <span class="string">"newsid.exe"</span>, </div><div class="line">        <span class="string">"Eula.txt"</span></div><div class="line">    ], </div><div class="line">    <span class="string">"gid"</span>: 0, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"handler"</span>: <span class="string">"ZipArchive"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"01777"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 4096, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1486610818.84-40104290759151/source"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"directory"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'ls -l /tmp'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 240</div><div class="line">drwx------ 2 root    root   4096 Feb  9 11:28 ansible_zimVwy</div><div class="line">-rw------- 1 yfshare root   7005 Jul 28  2006 Eula.txt</div><div class="line">-rw------- 1 yfshare root 228152 Nov  1  2006 newsid.exe</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="Setup模块"><a href="#Setup模块" class="headerlink" title="Setup模块"></a>Setup模块</h2><p>Ansible Setup模块：<a href="https://docs.ansible.com/ansible/setup_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/setup_module.html</a><br>playbooks自动收集远程主机上可用变量，这些变量用于playbooks<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m setup</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"ansible_facts"</span>: &#123;</div><div class="line">        <span class="string">"ansible_all_ipv4_addresses"</span>: [</div><div class="line">            <span class="string">"192.168.31.110"</span></div><div class="line">        ], </div><div class="line">        <span class="string">"ansible_all_ipv6_addresses"</span>: [</div><div class="line">            <span class="string">"fe80::20c:29ff:fe5c:dc6d"</span></div><div class="line">        ], </div><div class="line">        <span class="string">"ansible_architecture"</span>: <span class="string">"x86_64"</span>,</div><div class="line">...</div></pre></td></tr></table></figure></p>
<h2 id="Template模块"><a href="#Template模块" class="headerlink" title="Template模块"></a>Template模块</h2><p>Ansible Template模块：<a href="https://docs.ansible.com/ansible/template_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/template_module.html</a><br>模版由<a href="http://jinja.pocoo.org/docs" target="_blank" rel="external">jinja2模版语言</a>处理，模版设计文档参考<a href="http://jinja.pocoo.org/docs/templates/" target="_blank" rel="external">这里</a><br>模版中可以使用六个附加变量：  </p>
<ul>
<li>ansible_managed(通过ansible.cfg的defaults部分配置)包含一个字符串，可用户描述模版名称，主机，模版文件修改时间和所有者uid</li>
<li>template_host包含模版机器的节点名称</li>
<li>template_uid所有者的用户ID</li>
<li>template_path模版路径</li>
<li>template_fullpath模版的绝对路径</li>
<li>telmpate_run_date模版显示日期</li>
</ul>
<p>常用选项：<br><strong>backup</strong>：选项yes|no，默认为no，创建一个包含时间戳的备份文件<br><strong>src</strong>：本地文件的路径<br><strong>dest</strong>：远程主机的文件位置<br><strong>force</strong>：选项yes|no，默认为yes，覆盖远程主机上的同名文件，如果为否，只有当远程主机上不存在此文件时，才传输文件<br><strong>owner</strong>：文件/目录的所有者，chown<br><strong>group</strong>：文件/目录的所属组，chown<br><strong>mode</strong>：文件/目录的权限，chmod<br><strong>validate</strong>：在复制之前需要验证命令，要验证的文件的路径通过“%s”传递<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- template:</div><div class="line">    src: etc/ssh/sshd_config.j2</div><div class="line">    dest: /etc/ssh/sshd_config</div><div class="line">    owner: root</div><div class="line">    group: root</div><div class="line">    mode: <span class="string">'0600'</span></div><div class="line">    validate: /usr/sbin/sshd -t <span class="_">-f</span> %s</div><div class="line">    backup: yes</div></pre></td></tr></table></figure></p>
<h2 id="script模块"><a href="#script模块" class="headerlink" title="script模块"></a>script模块</h2><p>Ansible script模块：<a href="http://docs.ansible.com/ansible/script_module.html" target="_blank" rel="external">http://docs.ansible.com/ansible/script_module.html</a><br>在远程主机上执行脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># chmod +x /tmp/script.sh </span></div><div class="line">[root@Ansible ~]<span class="comment"># cat /tmp/script.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'This is a test script'</span> &gt; /tmp/script.ansible</div><div class="line">useradd Jack_wang</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m script -a '/tmp/script.sh'</span></div><div class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">'/root/.ssh/id_rsa'</span>: </div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"rc"</span>: 0, </div><div class="line">    <span class="string">"stderr"</span>: <span class="string">"Shared connection to 192.168.31.110 closed.\r\n"</span>, </div><div class="line">    <span class="string">"stdout"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"stdout_lines"</span>: []</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a "id Jack_wang"</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">uid=502(Jack_wang) gid=502(Jack_wang) groups=502(Jack_wang)</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a "cat /tmp/script.ansible"</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">This is a <span class="built_in">test</span> script</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>参考文档：<a href="http://breezey.blog.51cto.com/2400275/1555530/" target="_blank" rel="external">http://breezey.blog.51cto.com/2400275/1555530/</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/04/05/Ansible常用模块/">https://yfshare.github.io/2017/04/05/Ansible常用模块/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;模块(也被称为 “task plugins” 或 “library plugins”)，可以在Ansible-playbooks和Ansible命令中运用它们。&lt;/p&gt;
&lt;p&gt;官方文档：&lt;br&gt;Ansible所有模块列表：&lt;a href=&quot;https://docs.ansible.com/ansible/list_of_all_modules.html&quot;&gt;https://docs.ansible.com/ansible/list_of_all_modules.html&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://yfshare.github.io/categories/Ansible/"/>
    
    
      <category term="ansible" scheme="https://yfshare.github.io/tags/ansible/"/>
    
      <category term="Modules" scheme="https://yfshare.github.io/tags/Modules/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-Playbooks之安装Zabbix</title>
    <link href="https://yfshare.github.io/2017/03/20/Ansible-Playbooks%E4%B9%8B%E5%AE%89%E8%A3%85Zabbix/"/>
    <id>https://yfshare.github.io/2017/03/20/Ansible-Playbooks之安装Zabbix/</id>
    <published>2017-03-20T10:50:41.000Z</published>
    <updated>2017-03-21T11:50:15.000Z</updated>
    
    <content type="html"><![CDATA[<script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>playbooks 是一种简单的配置管理系统与多机器部署系统的基础。与现有的其他系统有不同之处,且非常适合于复杂应用的批量部署<br>Playbooks 的格式是YAML，语法做到最小化  </p>
<p>这里讲述的是使用ansible-playbooks的roles安装Zabbix应用<br><a id="more"></a></p>
<h2 id="Ansible之源码安装Zabbix-sever"><a href="#Ansible之源码安装Zabbix-sever" class="headerlink" title="Ansible之源码安装Zabbix-sever"></a>Ansible之源码安装Zabbix-sever</h2><ul>
<li>Zabbix_Server结构目录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#结构目录</span></div><div class="line">[root@Ansible ~]<span class="comment"># tree /etc/ansible/</span></div><div class="line">/etc/ansible/</div><div class="line">├── ansible.cfg</div><div class="line">├── hosts</div><div class="line">├── roles</div><div class="line">│   └── source_zabbix_server</div><div class="line">│       ├── files</div><div class="line">│       │   ├── authorization.sql</div><div class="line">│       │   ├── initialize.sql</div><div class="line">│       │   ├── yum.repo</div><div class="line">│       │   └── zabbix-3.2.4.tar.gz</div><div class="line">│       ├── handlers</div><div class="line">│       │   └── main.yml</div><div class="line">│       ├── tasks</div><div class="line">│       │   └── main.yml</div><div class="line">│       ├── templates</div><div class="line">│       │   ├── fastcgi.conf.j2</div><div class="line">│       │   ├── zabbix_agentd.conf</div><div class="line">│       │   ├── zabbix.conf</div><div class="line">│       │   └── zabbix_server.conf</div><div class="line">│       └── vars</div><div class="line">│           └── main.yml</div><div class="line">└── site.yml</div><div class="line"></div><div class="line">7 directories, 14 files</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>环境：<br>　　　ansible 2.2.1.0<br>　　　Centos 6.6<br>　　　zabbix-3.2.4  </p>
<p>参考：<br><a href="http://www.yfshare.vip/2017/03/20/Ansible-Playbooks之安装LNMP/" target="_blank" rel="external">Ansible-Playbooks之安装LNMP</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#入口文件</span></div><div class="line">[root@Ansible ~]<span class="comment"># cd /etc/ansible/</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat site.yml </span></div><div class="line">- hosts: test_hosts</div><div class="line">  user: root</div><div class="line">  roles:</div><div class="line">    - yum_mysql</div><div class="line">    - yum_php</div><div class="line">    - source_nginx</div><div class="line">    - source_zabbix_server</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#tasks</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat roles/source_zabbix_server/tasks/main.yml</span></div><div class="line">- name: disabled iptables</div><div class="line">  service: name=iptables state=stopped</div><div class="line">- name: Set the selinux value to Permissive</div><div class="line">  shell: setenforce 0</div><div class="line"></div><div class="line">- name: Install libselinux-python package</div><div class="line">  yum: name=libselinux-python state=installed</div><div class="line"></div><div class="line">- name: Check whether yum.repo file exist</div><div class="line">  shell: ls /etc/yum.repos.d/yum.repo</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: Copy yum.repo file</div><div class="line">  copy: src=<span class="string">"files/yum.repo"</span> dest=<span class="string">"/etc/yum.repos.d/yum.repo"</span> mode=0644 owner=root group=root</div><div class="line">  when: result|failed</div><div class="line">- name: Rebuild the yum cache</div><div class="line">  shell: yum clean all &amp;&amp; yum makecache</div><div class="line">  when: result|failed</div><div class="line"></div><div class="line">- name: Install same devel packages</div><div class="line">  yum: name=<span class="string">"&#123;&#123;item.name&#125;&#125;"</span></div><div class="line">  with_items:</div><div class="line">    - name: <span class="string">"net-snmp"</span></div><div class="line">    - name: <span class="string">"net-snmp-devel"</span></div><div class="line">    - name: <span class="string">"libxml2-devel"</span></div><div class="line">    - name: <span class="string">"libcurl-devel"</span></div><div class="line">    - name: <span class="string">"java-devel"</span></div><div class="line">    - name: <span class="string">"unixODBC"</span></div><div class="line">    - name: <span class="string">"unixODBC-devel"</span></div><div class="line">    - name: <span class="string">"OpenIPMI-devel"</span></div><div class="line">    - name: <span class="string">"curl-devel"</span></div><div class="line">    - name: <span class="string">"libssh2-devel"</span></div><div class="line">    - name: <span class="string">"MySQL-python"</span></div><div class="line"></div><div class="line">- name: Check whether jdk-7u79-linux-x64.tar.gz file exist</div><div class="line">  shell: ls /tmp/jdk-7u79-linux-x64.tar.gz</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: download jdk-7u79 <span class="built_in">source</span> package</div><div class="line">  get_url: url=<span class="string">"http://note.youdao.com/yws/api/personal/file/B6CC3F0E2AED4E51B16CE7FAF865A81B?method=download&amp;shareKey=8bce5fcc4e54f5295476a3be85eb16d5"</span> dest=<span class="string">"/tmp"</span></div><div class="line">  when: result|failed</div><div class="line"></div><div class="line">- name: Check whether <span class="string">'/usr/local/jdk1.7.0_79'</span> file exist</div><div class="line">  shell: ls /usr/<span class="built_in">local</span>/jdk1.7.0_79</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: unarchive jdk-7u79 <span class="built_in">source</span> package</div><div class="line">  unarchive: src=<span class="string">"/tmp/jdk-7u79-linux-x64.tar.gz"</span> dest=<span class="string">"/usr/local/"</span> remote_src=yes</div><div class="line">  when: result|failed</div><div class="line">- name: Configure java variable</div><div class="line">  shell: <span class="built_in">echo</span> <span class="string">'export JAVA_HOME=/usr/local/jdk1.7.0_79'</span> &gt;&gt; /etc/profile &amp;&amp; <span class="built_in">echo</span> <span class="string">'export PATH=$&#123;JAVA_HOME&#125;/bin/:$PATH'</span> &gt;&gt; /etc/profile &amp;&amp; <span class="built_in">source</span> /etc/profile</div><div class="line">  when: result|failed</div><div class="line"></div><div class="line">- name: unarchive zabbix-3.2.4 <span class="built_in">source</span> package</div><div class="line">  unarchive: src=<span class="string">"files/zabbix-3.2.4.tar.gz"</span> dest=<span class="string">"/tmp"</span> remote_src=no</div><div class="line">- name: Install zabbix <span class="built_in">source</span> package</div><div class="line">  shell: <span class="built_in">cd</span> /tmp/zabbix-3.2.4 &amp;&amp; ./configure --prefix=&#123;&#123;zabbix_install_path&#125;&#125; --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl --with-libxml2  --enable-java &amp;&amp; make &amp;&amp; make install</div><div class="line"></div><div class="line">- name: Check whether zabbix users exist</div><div class="line">  shell: id zabbix</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: The zabbix user does not exist, so we need to create it.</div><div class="line">  user: name=zabbix createhome=yes home=/home/zabbix shell=/sbin/nologin  state=present</div><div class="line">  when: result|failed</div><div class="line"></div><div class="line">- name: Replace some files</div><div class="line">  lineinfile: dest=<span class="string">"&#123;&#123;item.dest&#125;&#125;"</span> regexp=<span class="string">"&#123;&#123;item.reg&#125;&#125;"</span> line=<span class="string">"&#123;&#123;item.line&#125;&#125;"</span> backrefs=yes</div><div class="line">  with_items:</div><div class="line">    - dest: <span class="string">'/etc/php.ini'</span></div><div class="line">      reg: <span class="string">'^max_execution_time'</span></div><div class="line">      line: <span class="string">'max_execution_time = 300'</span></div><div class="line">    - dest: <span class="string">'/etc/php.ini'</span></div><div class="line">      reg: <span class="string">'^post_max_size'</span></div><div class="line">      line: <span class="string">'post_max_size = 16M'</span></div><div class="line">    - dest: <span class="string">'/etc/php.ini'</span></div><div class="line">      reg: <span class="string">'^max_input_time'</span></div><div class="line">      line: <span class="string">'max_input_time = 300'</span></div><div class="line">    - dest: <span class="string">'/etc/php.ini'</span></div><div class="line">      reg: <span class="string">'^;date.timezone'</span></div><div class="line">      line: <span class="string">'date.timezone = "Asia/Shanghai"'</span></div><div class="line">    - dest: <span class="string">'/etc/php-fpm.conf'</span></div><div class="line">      reg: <span class="string">'^;pid ='</span></div><div class="line">      line: <span class="string">'pid = /var/run/php-fpm/php-fpm.pid'</span></div><div class="line">    - dest: <span class="string">'/etc/php-fpm.d/www.conf'</span></div><div class="line">      reg: <span class="string">'^;pm.min_spare_servers'</span></div><div class="line">      line: <span class="string">'pm.min_spare_servers = 5'</span></div><div class="line">    - dest: <span class="string">'/etc/php-fpm.d/www.conf'</span></div><div class="line">      reg: <span class="string">'^;pm.max_spare_servers'</span></div><div class="line">      line: <span class="string">'pm.max_spare_servers = 35'</span></div><div class="line">    - dest: <span class="string">'/etc/php-fpm.d/www.conf'</span></div><div class="line">      reg: <span class="string">'^;^pm.start_servers'</span></div><div class="line">      line: <span class="string">'pm.start_servers = 5'</span></div><div class="line"></div><div class="line">- name: Copy authorization.sql file</div><div class="line">  template: src=<span class="string">"&#123;&#123;item.name&#125;&#125;"</span> dest=<span class="string">"/tmp/"</span></div><div class="line">  with_items:</div><div class="line">    - name: <span class="string">"files/authorization.sql"</span></div><div class="line">    - name: <span class="string">"files/initialize.sql"</span></div><div class="line"></div><div class="line">- name: Set up mysql database authorization</div><div class="line">  shell: mysql -u&#123;&#123;mysql_user&#125;&#125; -p&#123;&#123;mysql_pass&#125;&#125; -P&#123;&#123;mysql_port&#125;&#125; &lt; <span class="string">"/tmp/authorization.sql"</span></div><div class="line">- name: Authorize Zabbix users</div><div class="line">  shell: mysql -u&#123;&#123;mysql_user&#125;&#125; -p&#123;&#123;mysql_pass&#125;&#125; -P&#123;&#123;mysql_port&#125;&#125; &lt; <span class="string">"/tmp/initialize.sql"</span></div><div class="line">- name: Initialize the zabbix database</div><div class="line">  shell: <span class="built_in">cd</span> /tmp/zabbix-3.2.4 &amp;&amp; mysql -u&#123;&#123;mysql_zbx_user&#125;&#125; -p&#123;&#123;mysql_zbx_pass&#125;&#125; -P&#123;&#123;mysql_port&#125;&#125; &#123;&#123;mysql_zbx_db&#125;&#125; &lt; database/mysql/schema.sql &amp;&amp; mysql -u&#123;&#123;mysql_zbx_user&#125;&#125; -p&#123;&#123;mysql_zbx_pass&#125;&#125; -P&#123;&#123;mysql_port&#125;&#125; &#123;&#123;mysql_zbx_db&#125;&#125; &lt; database/mysql/images.sql &amp;&amp; mysql -u&#123;&#123;mysql_zbx_user&#125;&#125; -p&#123;&#123;mysql_zbx_pass&#125;&#125; -P&#123;&#123;mysql_port&#125;&#125; &#123;&#123;mysql_zbx_db&#125;&#125; &lt; database/mysql/data.sql</div><div class="line"></div><div class="line">- name: Configure zabbix</div><div class="line">  shell: <span class="built_in">cd</span> /tmp/zabbix-3.2.4 &amp;&amp; cp misc/init.d/fedora/core/zabbix_* /etc/init.d/ &amp;&amp; chmod 775 /etc/init.d/zabbix_*</div><div class="line">- name: Copy zabbix configure</div><div class="line">  template: src=<span class="string">"&#123;&#123;item.src&#125;&#125;"</span> dest=<span class="string">"&#123;&#123;item.dest&#125;&#125;"</span></div><div class="line">  with_items:</div><div class="line">    - src: <span class="string">"templates/zabbix_server.conf"</span></div><div class="line">      dest: <span class="string">"&#123;&#123;zabbix_install_path&#125;&#125;/etc/zabbix_server.conf"</span></div><div class="line">    - src: <span class="string">"templates/zabbix_agentd.conf"</span></div><div class="line">      dest: <span class="string">"&#123;&#123;zabbix_install_path&#125;&#125;/etc/zabbix_agentd.conf"</span></div><div class="line"></div><div class="line">- name: Create some directory</div><div class="line">  file: path=<span class="string">"&#123;&#123;item.path&#125;&#125;"</span> state=directory mode=0755</div><div class="line">  with_items:</div><div class="line">    - path: <span class="string">"&#123;&#123;nginx_install_path&#125;&#125;/html/zabbix"</span></div><div class="line">    - path: <span class="string">"&#123;&#123;zabbix_log_path&#125;&#125;"</span></div><div class="line">    - path: <span class="string">"&#123;&#123;nginx_log_path&#125;&#125;/zabbix"</span></div><div class="line"></div><div class="line">- name: Copy zabbix pages</div><div class="line">  shell: cp -rpf /tmp/zabbix-3.2.4/frontends/php/* &#123;&#123;nginx_install_path&#125;&#125;/html/zabbix/ &amp;&amp; chown zabbix:zabbix &#123;&#123;nginx_install_path&#125;&#125;/html/zabbix/</div><div class="line">- name: Modify file permissions</div><div class="line">  file: path=<span class="string">"&#123;&#123;nginx_install_path&#125;&#125;/html/zabbix/conf"</span> state=directory owner=zabbix group=zabbix mode=0777</div><div class="line">- name: Command Links</div><div class="line">  file: src=<span class="string">"&#123;&#123;item.src&#125;&#125;"</span> dest=<span class="string">"&#123;&#123;item.dest&#125;&#125;"</span> state=link remote_src=True</div><div class="line">  with_items:</div><div class="line">    - src: <span class="string">"&#123;&#123;zabbix_install_path&#125;&#125;/sbin/zabbix_server"</span></div><div class="line">      dest: <span class="string">"/usr/local/sbin/zabbix_server"</span></div><div class="line">    - src: <span class="string">"&#123;&#123;zabbix_install_path&#125;&#125;/sbin/zabbix_agentd"</span></div><div class="line">      dest: <span class="string">"/usr/local/sbin/zabbix_agentd"</span></div><div class="line">- name: touch zabbix <span class="built_in">log</span> file</div><div class="line">  file: path=&#123;&#123;item.path&#125;&#125; state=touch owner=zabbix group=zabbix mode=0755</div><div class="line">  with_items:</div><div class="line">    - path: <span class="string">"&#123;&#123;zabbix_log_path&#125;&#125;/zabbix_server.log"</span></div><div class="line">    - path: <span class="string">"&#123;&#123;zabbix_log_path&#125;&#125;/zabbix_agentd.log"</span></div><div class="line"></div><div class="line">- name: Configure nginx <span class="keyword">for</span> Zabbix</div><div class="line">  template: src=<span class="string">"templates/zabbix.conf"</span> dest=<span class="string">"&#123;&#123;nginx_install_path&#125;&#125;/conf/vhosts/zabbix.conf"</span> mode=0644 owner=nginx group=nginx</div><div class="line">- name: Check whether fastcgi.conf file exist</div><div class="line">  shell: ls &#123;&#123;nginx_install_path&#125;&#125;/conf/vhosts/fastcgi.conf</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: Copy fastcgi.conf file</div><div class="line">  copy: src=<span class="string">"templates/fastcgi.conf.j2"</span> dest=<span class="string">"&#123;&#123;nginx_install_path&#125;&#125;/conf/vhosts/fastcgi.conf"</span> mode=0644 owner=nginx group=nginx mode=0644</div><div class="line">  when: result|failed</div><div class="line">- name: Add zabbix to chkconfig</div><div class="line">  shell: chkconfig --add zabbix_server &amp;&amp; chkconfig --add zabbix_agentd</div><div class="line">  notify: restart zabbix server</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#handlers</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat roles/source_zabbix_server/handlers/main.yml</span></div><div class="line">- name: restart zabbix server</div><div class="line">  service: name=&#123;&#123;item.name&#125;&#125; state=restarted enabled=yes</div><div class="line">  with_items:</div><div class="line">    - name: <span class="string">"zabbix_server"</span></div><div class="line">    - name: <span class="string">"zabbix_agentd"</span></div><div class="line">    - name: <span class="string">"php-fpm"</span></div><div class="line">    - name: <span class="string">"nginx"</span></div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#变量</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat roles/source_zabbix_server/vars/main.yml</span></div><div class="line">mysql_user: root</div><div class="line">mysql_host: 192.168.31.110</div><div class="line">mysql_pass: 123456</div><div class="line">mysql_zbx_db: zabbix</div><div class="line">mysql_zbx_user: zabbix</div><div class="line">mysql_zbx_pass: zabbix</div><div class="line">mysql_zbx_hosts: 192.168.31.%</div><div class="line">mysql_port: 3306</div><div class="line"></div><div class="line">zabbix_install_path: /usr/<span class="built_in">local</span>/zabbix</div><div class="line">zabbix_log_path: /var/<span class="built_in">log</span>/zabbix</div><div class="line">zabbix_server_ip: 192.168.31.110</div><div class="line"></div><div class="line">nginx_install_path: /usr/<span class="built_in">local</span>/nginx-1.11.7</div><div class="line">nginx_log_path: /var/<span class="built_in">log</span>/nginx</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#执行过程</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible-playbook /etc/ansible/site.yml </span></div><div class="line"></div><div class="line">PLAY [test_hosts] **************************************************************</div><div class="line"></div><div class="line">TASK [setup] *******************************************************************</div><div class="line">ok: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : disabled iptables] ********************************</div><div class="line">ok: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Set the selinux value to Permissive] **************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Install libselinux-python package] ****************</div><div class="line">ok: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Check whether yum.repo file exist] ****************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Copy yum.repo file] *******************************</div><div class="line">skipping: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Rebuild the yum cache] ****************************</div><div class="line">skipping: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Install same devel packages] **********************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'net-snmp'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'net-snmp-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'libxml2-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'libcurl-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'java-devel'</span>&#125;)</div><div class="line">ok: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'unixODBC'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'unixODBC-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'OpenIPMI-devel'</span>&#125;)</div><div class="line">ok: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'curl-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'libssh2-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'MySQL-python'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Check whether jdk-7u79-linux-x64.tar.gz file exist] ***</div><div class="line">fatal: [192.168.31.110]: FAILED! =&gt; &#123;<span class="string">"changed"</span>: <span class="literal">true</span>, <span class="string">"cmd"</span>: <span class="string">"ls /tmp/jdk-7u79-linux-x64.tar.gz"</span>, <span class="string">"delta"</span>: <span class="string">"0:00:00.006056"</span>, <span class="string">"end"</span>: <span class="string">"2017-03-21 10:42:08.254025"</span>, <span class="string">"failed"</span>: <span class="literal">true</span>, <span class="string">"rc"</span>: 2, <span class="string">"start"</span>: <span class="string">"2017-03-21 10:42:08.247969"</span>, <span class="string">"stderr"</span>: <span class="string">"ls: cannot access /tmp/jdk-7u79-linux-x64.tar.gz: No such file or directory"</span>, <span class="string">"stdout"</span>: <span class="string">""</span>, <span class="string">"stdout_lines"</span>: [], <span class="string">"warnings"</span>: []&#125;</div><div class="line">...ignoring</div><div class="line"></div><div class="line">TASK [source_zabbix_server : download jdk-7u79 <span class="built_in">source</span> package] *****************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Check whether <span class="string">'/usr/local/jdk1.7.0_79'</span> file exist] </div><div class="line">fatal: [192.168.31.110]: FAILED! =&gt; &#123;<span class="string">"changed"</span>: <span class="literal">true</span>, <span class="string">"cmd"</span>: <span class="string">"ls /usr/local/jdk1.7.0_79"</span>, <span class="string">"delta"</span>: <span class="string">"0:00:00.004081"</span>, <span class="string">"end"</span>: <span class="string">"2017-03-21 10:45:48.414682"</span>, <span class="string">"failed"</span>: <span class="literal">true</span>, <span class="string">"rc"</span>: 2, <span class="string">"start"</span>: <span class="string">"2017-03-21 10:45:48.410601"</span>, <span class="string">"stderr"</span>: <span class="string">"ls: cannot access /usr/local/jdk1.7.0_79: No such file or directory"</span>, <span class="string">"stdout"</span>: <span class="string">""</span>, <span class="string">"stdout_lines"</span>: [], <span class="string">"warnings"</span>: []&#125;</div><div class="line">...ignoring</div><div class="line"></div><div class="line">TASK [source_zabbix_server : unarchive jdk-7u79 <span class="built_in">source</span> package] ****************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Configure java variable] **************************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : unarchive zabbix-3.2.4 <span class="built_in">source</span> package] ************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Install zabbix <span class="built_in">source</span> package] ********************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Check whether zabbix users exist] *****************</div><div class="line">fatal: [192.168.31.110]: FAILED! =&gt; &#123;<span class="string">"changed"</span>: <span class="literal">true</span>, <span class="string">"cmd"</span>: <span class="string">"id zabbix"</span>, <span class="string">"delta"</span>: <span class="string">"0:00:00.004139"</span>, <span class="string">"end"</span>: <span class="string">"2017-03-21 10:46:58.885950"</span>, <span class="string">"failed"</span>: <span class="literal">true</span>, <span class="string">"rc"</span>: 1, <span class="string">"start"</span>: <span class="string">"2017-03-21 10:46:58.881811"</span>, <span class="string">"stderr"</span>: <span class="string">"id: zabbix: No such user"</span>, <span class="string">"stdout"</span>: <span class="string">""</span>, <span class="string">"stdout_lines"</span>: [], <span class="string">"warnings"</span>: []&#125;</div><div class="line">...ignoring</div><div class="line"></div><div class="line">TASK [source_zabbix_server : The zabbix user does not exist, so we need to create it.] ***</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Replace some files] *******************************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php.ini'</span>, u<span class="string">'line'</span>: u<span class="string">'max_execution_time = 300'</span>, u<span class="string">'reg'</span>: u<span class="string">'^max_execution_time'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php.ini'</span>, u<span class="string">'line'</span>: u<span class="string">'post_max_size = 16M'</span>, u<span class="string">'reg'</span>: u<span class="string">'^post_max_size'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php.ini'</span>, u<span class="string">'line'</span>: u<span class="string">'max_input_time = 300'</span>, u<span class="string">'reg'</span>: u<span class="string">'^max_input_time'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php.ini'</span>, u<span class="string">'line'</span>: u<span class="string">'date.timezone = "Asia/Shanghai"'</span>, u<span class="string">'reg'</span>: u<span class="string">'^;date.timezone'</span>&#125;)</div><div class="line">ok: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php-fpm.conf'</span>, u<span class="string">'line'</span>: u<span class="string">'pid = /var/run/php-fpm/php-fpm.pid'</span>, u<span class="string">'reg'</span>: u<span class="string">'^;pid ='</span>&#125;)</div><div class="line">ok: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php-fpm.d/www.conf'</span>, u<span class="string">'line'</span>: u<span class="string">'pm.min_spare_servers = 5'</span>, u<span class="string">'reg'</span>: u<span class="string">'^;pm.min_spare_servers'</span>&#125;)</div><div class="line">ok: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php-fpm.d/www.conf'</span>, u<span class="string">'line'</span>: u<span class="string">'pm.max_spare_servers = 35'</span>, u<span class="string">'reg'</span>: u<span class="string">'^;pm.max_spare_servers'</span>&#125;)</div><div class="line">ok: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/etc/php-fpm.d/www.conf'</span>, u<span class="string">'line'</span>: u<span class="string">'pm.start_servers = 5'</span>, u<span class="string">'reg'</span>: u<span class="string">'^;^pm.start_servers'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Copy authorization.sql file] **********************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'files/authorization.sql'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'files/initialize.sql'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Set up mysql database authorization] **************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Authorize Zabbix users] ***************************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Initialize the zabbix database] *******************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Configure zabbix] *********************************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Copy zabbix configure] ****************************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/usr/local/zabbix/etc/zabbix_server.conf'</span>, u<span class="string">'src'</span>: u<span class="string">'templates/zabbix_server.conf'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/usr/local/zabbix/etc/zabbix_agentd.conf'</span>, u<span class="string">'src'</span>: u<span class="string">'templates/zabbix_agentd.conf'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Create some directory] ****************************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/usr/local/nginx-1.11.7/html/zabbix'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/var/log/zabbix'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/var/log/nginx/zabbix'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Copy zabbix pages] ********************************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Modify file permissions] **************************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Command Links] ************************************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/usr/local/sbin/zabbix_server'</span>, u<span class="string">'src'</span>: u<span class="string">'/usr/local/zabbix/sbin/zabbix_server'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'dest'</span>: u<span class="string">'/usr/local/sbin/zabbix_agentd'</span>, u<span class="string">'src'</span>: u<span class="string">'/usr/local/zabbix/sbin/zabbix_agentd'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : touch zabbix <span class="built_in">log</span> file] ****************************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/var/log/zabbix/zabbix_server.log'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/var/log/zabbix/zabbix_agentd.log'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Configure nginx <span class="keyword">for</span> Zabbix] ***********************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Check whether fastcgi.conf file exist] ************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Copy fastcgi.conf file] ***************************</div><div class="line">skipping: [192.168.31.110]</div><div class="line"></div><div class="line">TASK [source_zabbix_server : Add zabbix to chkconfig] **************************</div><div class="line">changed: [192.168.31.110]</div><div class="line"></div><div class="line">RUNNING HANDLER [source_zabbix_server : restart zabbix server] *****************</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'zabbix_server'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'zabbix_agentd'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'php-fpm'</span>&#125;)</div><div class="line">changed: [192.168.31.110] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'nginx'</span>&#125;)</div><div class="line"></div><div class="line">PLAY RECAP *********************************************************************</div><div class="line">192.168.31.110             : ok=31   changed=28   unreachable=0    failed=0   </div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/1B3E3B138F6F4BD2BD3F7EE4A611B33C?method=download&amp;shareKey=15995fa7cd9fd6515aa8b95ea4712f07" alt="image">  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'ps -ef | grep zabbix | grep -v grep'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">zabbix    11586      1  0 18:01 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_server</div><div class="line">zabbix    11593  11586  0 18:01 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_server: configuration syncer [synced configuration <span class="keyword">in</span> 0.006998 sec, idle 60 sec]</div><div class="line">zabbix    11594  11586  0 18:01 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_server: db watchdog [synced alerts config <span class="keyword">in</span> 0.001220 sec, idle 60 sec]</div><div class="line">zabbix    11595  11586  0 18:01 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_server: poller <span class="comment">#1 [got 0 values in 0.000101 sec, idle 5 sec]</span></div><div class="line">···</div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/F586BD68280D4E8281FF40208BB99318?method=download&amp;shareKey=2547559de07cb0792ac84676339ec885" alt="image"><br><img src="http://note.youdao.com/yws/api/personal/file/AAB04280F3D5480098F3560BA6ACCBD6?method=download&amp;shareKey=22bd12e0ba86ebb7b6f545ca6debaea7" alt="image">  </p>
<h2 id="Ansible之源码安装Zabbix-agent"><a href="#Ansible之源码安装Zabbix-agent" class="headerlink" title="Ansible之源码安装Zabbix-agent"></a>Ansible之源码安装Zabbix-agent</h2><ul>
<li>Zabbix_Agent结构目录  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#结构目录</span></div><div class="line">[root@Ansible ~]<span class="comment"># tree /etc/ansible/</span></div><div class="line">/etc/ansible/</div><div class="line">├── ansible.cfg</div><div class="line">├── hosts</div><div class="line">├── roles</div><div class="line">│   └── source_zabbix_agent</div><div class="line">│       ├── files</div><div class="line">│       │   ├── yum.repo</div><div class="line">│       │   └── zabbix-3.2.4.tar.gz</div><div class="line">│       ├── handlers</div><div class="line">│       │   └── main.yml</div><div class="line">│       ├── tasks</div><div class="line">│       │   └── main.yml</div><div class="line">│       ├── templates</div><div class="line">│       │   └── zabbix_agentd.conf</div><div class="line">│       └── vars</div><div class="line">│           └── main.yml</div><div class="line">└── site.yml</div><div class="line"></div><div class="line">7 directories, 9 files</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>环境：<br>　　　ansible 2.2.1.0<br>　　　Centos 6.6<br>　　　zabbix-3.2.4  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#入口文件</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat site.yml </span></div><div class="line">- hosts: test_hosts2</div><div class="line">  user: root</div><div class="line">  roles:</div><div class="line">    - source_zabbix_agent</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#tasks</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat roles/source_zabbix_agent/tasks/main.yml </span></div><div class="line">- name: Install libselinux-python package</div><div class="line">  yum: name=libselinux-python state=installed</div><div class="line"></div><div class="line">- name: Check whether yum.repo file exist</div><div class="line">  shell: ls /etc/yum.repos.d/yum.repo</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: Copy yum.repo file</div><div class="line">  copy: src=<span class="string">"files/yum.repo"</span> dest=<span class="string">"/etc/yum.repos.d/yum.repo"</span> mode=0644 owner=root group=root</div><div class="line">  when: result|failed</div><div class="line">- name: Rebuild the yum cache</div><div class="line">  shell: yum clean all &amp;&amp; yum makecache</div><div class="line">  when: result|failed</div><div class="line"></div><div class="line">- name: Install same devel packages</div><div class="line">  yum: name=<span class="string">"&#123;&#123;item.name&#125;&#125;"</span></div><div class="line">  with_items:</div><div class="line">    - name: <span class="string">"net-snmp"</span></div><div class="line">    - name: <span class="string">"net-snmp-devel"</span></div><div class="line">    - name: <span class="string">"libxml2-devel"</span></div><div class="line">    - name: <span class="string">"libcurl-devel"</span></div><div class="line">    - name: <span class="string">"java-devel"</span></div><div class="line">    - name: <span class="string">"unixODBC"</span></div><div class="line">    - name: <span class="string">"unixODBC-devel"</span></div><div class="line">    - name: <span class="string">"OpenIPMI-devel"</span></div><div class="line">    - name: <span class="string">"curl-devel"</span></div><div class="line">    - name: <span class="string">"libssh2-devel"</span></div><div class="line">    - name: <span class="string">"MySQL-python"</span></div><div class="line"></div><div class="line">- name: unarchive zabbix-3.2.4 <span class="built_in">source</span> package</div><div class="line">  unarchive: src=<span class="string">"files/zabbix-3.2.4.tar.gz"</span> dest=<span class="string">"/tmp"</span> remote_src=no</div><div class="line">- name: Install zabbix <span class="built_in">source</span> package</div><div class="line">  shell: <span class="built_in">cd</span> /tmp/zabbix-3.2.4 &amp;&amp; ./configure --prefix=&#123;&#123;zabbix_install_path&#125;&#125; --enable-agent  &amp;&amp; make &amp;&amp; make install</div><div class="line">- name: Configure zabbix</div><div class="line">  copy: src=<span class="string">"/tmp/zabbix-3.2.4/misc/init.d/fedora/core/zabbix_agentd"</span> dest=<span class="string">"/etc/init.d/zabbix_agentd"</span> mode=0755 remote_src=True</div><div class="line"></div><div class="line">- name: Check whether zabbix users exist</div><div class="line">  shell: id zabbix</div><div class="line">  register: result</div><div class="line">  ignore_errors: True</div><div class="line">- name: The zabbix user does not exist, so we need to create it.</div><div class="line">  user: name=zabbix createhome=yes home=/home/zabbix shell=/sbin/nologin  state=present</div><div class="line">  when: result|failed</div><div class="line"></div><div class="line">- name: Configure zabbix agent</div><div class="line">  template: src=<span class="string">"templates/zabbix_agentd.conf"</span> dest=<span class="string">"&#123;&#123;zabbix_install_path&#125;&#125;/etc/zabbix_agentd.conf"</span></div><div class="line"></div><div class="line">- name: Command Links</div><div class="line">  file: src=<span class="string">"&#123;&#123;zabbix_install_path&#125;&#125;/sbin/zabbix_agentd"</span> dest=<span class="string">"/usr/local/sbin/zabbix_agentd"</span> state=link remote_src=True</div><div class="line"></div><div class="line">- name: touch zabbix <span class="built_in">log</span> file</div><div class="line">  file: path=&#123;&#123;item.path&#125;&#125; state=<span class="string">"&#123;&#123;item.state|default("</span>touch<span class="string">")&#125;&#125;"</span> owner=zabbix group=zabbix mode=0755</div><div class="line">  with_items:</div><div class="line">    - path: <span class="string">"&#123;&#123;zabbix_log_path&#125;&#125;"</span></div><div class="line">      state: <span class="string">"directory"</span></div><div class="line">    - path: <span class="string">"&#123;&#123;zabbix_log_path&#125;&#125;/zabbix_agentd.log"</span></div><div class="line">- name: Add zabbix_agent to chkconfig</div><div class="line">  shell: chkconfig --add zabbix_agentd</div><div class="line">  notify: restart zabbix agent</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#handlers</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat roles/source_zabbix_agent/handlers/main.yml </span></div><div class="line">- name: restart zabbix agent</div><div class="line">  service: name=<span class="string">"zabbix_agentd"</span> state=restarted enabled=yes</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#变量</span></div><div class="line">[root@Ansible ansible]<span class="comment"># cat roles/source_zabbix_agent/vars/main.yml </span></div><div class="line">zabbix_install_path: /usr/<span class="built_in">local</span>/zabbix</div><div class="line">zabbix_log_path: /var/<span class="built_in">log</span>/zabbix</div><div class="line">zabbix_server_ip: 192.168.31.110</div><div class="line">[root@Ansible ansible]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#执行过程</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible-playbook /etc/ansible/site.yml </span></div><div class="line"></div><div class="line">PLAY [test_hosts2] *************************************************************</div><div class="line"></div><div class="line">TASK [setup] *******************************************************************</div><div class="line">ok: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Install libselinux-python package] *****************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Check whether yum.repo file exist] *****************</div><div class="line">fatal: [192.168.31.120]: FAILED! =&gt; &#123;<span class="string">"changed"</span>: <span class="literal">true</span>, <span class="string">"cmd"</span>: <span class="string">"ls /etc/yum.repos.d/yum.repo"</span>, <span class="string">"delta"</span>: <span class="string">"0:00:00.004811"</span>, <span class="string">"end"</span>: <span class="string">"2017-03-21 18:22:42.833895"</span>, <span class="string">"failed"</span>: <span class="literal">true</span>, <span class="string">"rc"</span>: 2, <span class="string">"start"</span>: <span class="string">"2017-03-21 18:22:42.829084"</span>, <span class="string">"stderr"</span>: <span class="string">"ls: cannot access /etc/yum.repos.d/yum.repo: No such file or directory"</span>, <span class="string">"stdout"</span>: <span class="string">""</span>, <span class="string">"stdout_lines"</span>: [], <span class="string">"warnings"</span>: []&#125;</div><div class="line">...ignoring</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Copy yum.repo file] ********************************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Rebuild the yum cache] *****************************</div><div class="line">changed: [192.168.31.120]</div><div class="line"> [WARNING]: Consider using yum module rather than running yum</div><div class="line"></div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Install same devel packages] ***********************</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'net-snmp'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'net-snmp-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'libxml2-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'libcurl-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'java-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'unixODBC'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'unixODBC-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'OpenIPMI-devel'</span>&#125;)</div><div class="line">ok: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'curl-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'libssh2-devel'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'name'</span>: u<span class="string">'MySQL-python'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : unarchive zabbix-3.2.4 <span class="built_in">source</span> package] *************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Install zabbix <span class="built_in">source</span> package] *********************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Configure zabbix] **********************************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Check whether zabbix users exist] ******************</div><div class="line">fatal: [192.168.31.120]: FAILED! =&gt; &#123;<span class="string">"changed"</span>: <span class="literal">true</span>, <span class="string">"cmd"</span>: <span class="string">"id zabbix"</span>, <span class="string">"delta"</span>: <span class="string">"0:00:00.005663"</span>, <span class="string">"end"</span>: <span class="string">"2017-03-21 18:35:09.861371"</span>, <span class="string">"failed"</span>: <span class="literal">true</span>, <span class="string">"rc"</span>: 1, <span class="string">"start"</span>: <span class="string">"2017-03-21 18:35:09.855708"</span>, <span class="string">"stderr"</span>: <span class="string">"id: zabbix: No such user"</span>, <span class="string">"stdout"</span>: <span class="string">""</span>, <span class="string">"stdout_lines"</span>: [], <span class="string">"warnings"</span>: []&#125;</div><div class="line">...ignoring</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : The zabbix user does not exist, so we need to create it.] ***</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Configure zabbix agent] ****************************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Command Links] *************************************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : touch zabbix <span class="built_in">log</span> file] *****************************</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/var/log/zabbix'</span>, u<span class="string">'state'</span>: u<span class="string">'directory'</span>&#125;)</div><div class="line">changed: [192.168.31.120] =&gt; (item=&#123;u<span class="string">'path'</span>: u<span class="string">'/var/log/zabbix/zabbix_agentd.log'</span>&#125;)</div><div class="line"></div><div class="line">TASK [source_zabbix_agent : Add zabbix_agent to chkconfig] *********************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">RUNNING HANDLER [source_zabbix_agent : restart zabbix agent] *******************</div><div class="line">changed: [192.168.31.120]</div><div class="line"></div><div class="line">PLAY RECAP *********************************************************************</div><div class="line">192.168.31.120             : ok=16   changed=15   unreachable=0    failed=0   </div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts2 -m shell -a 'ps -ef | grep zabbix_agentd  | grep -v grep'</span></div><div class="line">192.168.31.120 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">zabbix     9164      1  0 18:35 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_agentd</div><div class="line">zabbix     9167   9164  0 18:35 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_agentd: collector [idle 1 sec]</div><div class="line">zabbix     9168   9164  0 18:35 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_agentd: listener <span class="comment">#1 [waiting for connection]</span></div><div class="line">zabbix     9169   9164  0 18:35 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_agentd: listener <span class="comment">#2 [waiting for connection]</span></div><div class="line">zabbix     9170   9164  0 18:35 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_agentd: listener <span class="comment">#3 [waiting for connection]</span></div><div class="line">zabbix     9171   9164  0 18:35 ?        00:00:00 /usr/<span class="built_in">local</span>/sbin/zabbix_agentd: active checks <span class="comment">#1 [idle 1 sec]</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/5D828A8CCD3643EB8F083F1CCF8C71EB?method=download&amp;shareKey=0810956092871cfbe13f70370cb0395c" alt="image">  </p>
<p>附件：<br><a href="http://note.youdao.com/yws/api/personal/file/554F1EB189BD49ACBDAD71A8B003AC3F?method=download&amp;shareKey=be625cbe4ce873c616ff86f32ea8763b" target="_blank" rel="external">ansible_install_zabbix_server3.2.tar.gz</a><br><a href="http://note.youdao.com/yws/api/personal/file/A9AAE22EB1F64A01B780344178710FAD?method=download&amp;shareKey=6a6454485d9104a40c2fccaffeb33473" target="_blank" rel="external">ansible_install_zabbix_agent3.2.tar.gz</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/03/20/Ansible-Playbooks之安装Zabbix/">https://yfshare.github.io/2017/03/20/Ansible-Playbooks之安装Zabbix/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;playbooks 是一种简单的配置管理系统与多机器部署系统的基础。与现有的其他系统有不同之处,且非常适合于复杂应用的批量部署&lt;br&gt;Playbooks 的格式是YAML，语法做到最小化  &lt;/p&gt;
&lt;p&gt;这里讲述的是使用ansible-playbooks的roles安装Zabbix应用&lt;br&gt;
    
    </summary>
    
      <category term="Ansible" scheme="https://yfshare.github.io/categories/Ansible/"/>
    
    
      <category term="ansible" scheme="https://yfshare.github.io/tags/ansible/"/>
    
      <category term="Zabbix" scheme="https://yfshare.github.io/tags/Zabbix/"/>
    
  </entry>
  
</feed>

<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Blog"><title>Ansible常用模块 | Jack Wang Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Ansible常用模块</h1><a id="logo" href="/.">Jack Wang Blog</a><p class="description">Goals determine what you are going to be</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Ansible常用模块</h1><div class="post-meta">Apr 5, 2017<span> | </span><span class="category"><a href="/categories/Ansible/">Ansible</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/04/05/Ansible常用模块/" href="/2017/04/05/Ansible常用模块/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Command模块"><span class="toc-number">1.</span> <span class="toc-text">Command模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell模块"><span class="toc-number">2.</span> <span class="toc-text">Shell模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#File模块"><span class="toc-number">3.</span> <span class="toc-text">File模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Copy模块："><span class="toc-number">4.</span> <span class="toc-text">Copy模块：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service模块"><span class="toc-number">5.</span> <span class="toc-text">Service模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cron模块"><span class="toc-number">6.</span> <span class="toc-text">Cron模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FileSystem"><span class="toc-number">7.</span> <span class="toc-text">FileSystem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mount模块"><span class="toc-number">8.</span> <span class="toc-text">Mount模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yum模块"><span class="toc-number">9.</span> <span class="toc-text">Yum模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User模块"><span class="toc-number">10.</span> <span class="toc-text">User模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Group模块"><span class="toc-number">11.</span> <span class="toc-text">Group模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Synchronize模块"><span class="toc-number">12.</span> <span class="toc-text">Synchronize模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get-url模块"><span class="toc-number">13.</span> <span class="toc-text">get_url模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unarchive模块"><span class="toc-number">14.</span> <span class="toc-text">unarchive模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup模块"><span class="toc-number">15.</span> <span class="toc-text">Setup模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Template模块"><span class="toc-number">16.</span> <span class="toc-text">Template模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#script模块"><span class="toc-number">17.</span> <span class="toc-text">script模块</span></a></li></ol></div></div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>模块(也被称为 “task plugins” 或 “library plugins”)，可以在Ansible-playbooks和Ansible命令中运用它们。</p>
<p>官方文档：<br>Ansible所有模块列表：<a href="https://docs.ansible.com/ansible/list_of_all_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_all_modules.html</a><br><a id="more"></a><br>环境：Centos 6.6<br>　　　ansible 2.2.1.0  </p>
<h2 id="Command模块"><a href="#Command模块" class="headerlink" title="Command模块"></a>Command模块</h2><p>Ansible command模块：<a href="https://docs.ansible.com/ansible/list_of_commands_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_commands_modules.html</a><br>在远程主机上执行命令<br>常用选项：<br><strong>creates</strong>：判断，当该文件存在时，则该命令不执行<br><strong>free_form</strong>：需要执行的Linux指令<br><strong>chdir</strong>：在执行命令之前，先切换到该指定的目录<br><strong>removes</strong>：判断，当该文件不存在时，则该选项不执行<br><strong>executable</strong>：切换shell来执行命令，该执行路径必须是一个绝对路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查看test_hosts组主机的主机名</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible -i /etc/ansible/hosts test_hosts -u root -m command -a 'hostname' -k</span></div><div class="line">SSH password: </div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">host1</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"><span class="comment"># -i：specify inventory host path</span></div><div class="line"><span class="comment"># -u：Remote User</span></div><div class="line"><span class="comment"># -m：Module name</span></div><div class="line"><span class="comment"># -a：Module Args</span></div><div class="line"><span class="comment"># -k：ask for privilege escalation password。在Inventory(/etc/ansible/hosts)中配置ansible_ssh_user和ansible_ssh_pass后可实现Ansible免密连接或者使用证书实现免密连接，即不使用-k参数</span></div><div class="line"><span class="comment"># test_hosts：/etc/ansible/hosts指定的主机组</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#creates判断一个文件，当该文件存在时，则不执行后面的命令</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'creates=/tmp/aaa.txt ls /home'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">lost+found</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'creates=/tmp/ansible_test_cpoy.txt ls /home'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">skipped, since /tmp/ansible_test_cpoy.txt exists</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#removes当文件不存在时，不执行后面的命令</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'removes=/tmp/ansible_test_cpoy.txt ls /home'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">lost+found</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'removes=/tmp/bbb.txt.txt ls /home'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">skipped, since /tmp/bbb.txt.txt does not exist</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#chdir在执行命令前，先切换到指定的目录</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'chdir=/usr/local/games tar -czf game1.tar.gz game1'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'chdir=/usr/local/games ls -l'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 20500</div><div class="line">-rw-r--r-- 1 root root 20971520 Feb  6 15:42 game1</div><div class="line">-rw-r--r-- 1 root root    20458 Feb  6 15:43 game1.tar.gz</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Shell模块"><a href="#Shell模块" class="headerlink" title="Shell模块"></a>Shell模块</h2><p>Ansible shell模块：<a href="https://docs.ansible.com/ansible/shell_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/shell_module.html</a><br>Ansible raw：<a href="https://docs.ansible.com/ansible/raw_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/raw_module.html</a><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#shell模块可以使用command模块所有选项，但功能比command模块更强大，因为其支持“|”管道符。</span></div><div class="line"><span class="comment">#使用raw模块也可。执行ansible-doc -s raw查看帮助</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'ps -ef | grep crond | grep -v grep'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">root       <span class="number">1013</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span><span class="symbol">:</span><span class="number">36</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> crond</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m raw -a 'ps -ef | grep crond | grep -v grep'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">root       <span class="number">1013</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">10</span><span class="symbol">:</span><span class="number">36</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> crond</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "aaa.sh &gt;&gt; /tmp/output.txt"</span></div></pre></td></tr></table></figure></p>
<h2 id="File模块"><a href="#File模块" class="headerlink" title="File模块"></a>File模块</h2><p>Ansible File模块：<a href="https://docs.ansible.com/ansible/list_of_files_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_files_modules.html</a><br>file - Sets attributes of file：<a href="https://docs.ansible.com/ansible/file_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/file_module.html</a></p>
<p>常用选项：<br><strong>force</strong>：在两种情况下强制创建软链接。1、源文件不存在但之后会建立的情况；2、目标软件已存在，需要先取消之前的软链接，然后创建新的软链接。选项：yes|no<br><strong>group</strong>：定义文件/目录的属组<br><strong>mode</strong>：定义文件/目录的权限<br><strong>path</strong>：必选项，定义文件/目录的路径<br><strong>recurse</strong>：递归的设置文件的属性，只对目录有效<br><strong>src</strong>：要被链接到的路径，只应用于state=link的情况<br><strong>dest</strong>：被链接到的路径，只应用于state=link的情况<br><strong>state</strong>：  </p>
<ul>
<li>directory：如果目录不存在，创建目录</li>
<li>file：即使文件不存在，也不会被创建</li>
<li>link：创建软链接；hard：创建硬链接</li>
<li>touch：如果文件不存在，则会创建一个新的文件，如果已存在，则更新其最后修改时间</li>
<li>absent：删除目录/文件或者取消链接文件  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Ansible创建文件：</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/tmp/test.txt state=touch'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/test.txt"</span>, </div><div class="line">    <span class="string">"gid"</span>: <span class="number">0</span>, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: <span class="number">0</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'ls -l /tmp/test.txt'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">0</span> Feb  <span class="number">6</span> <span class="number">10</span><span class="symbol">:</span><span class="number">38</span> /tmp/test.txt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"><span class="comment">#Ansible删除文件，文件状态改成absent；使用command模块执行rm命令也可</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/tmp/test.txt state=absent'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"path"</span>: <span class="string">"/tmp/test.txt"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"absent"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Ansible创建目录：</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/tmp/test_dir state=directory owner=root group=mail mode=777'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"gid"</span>: <span class="number">12</span>, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"mail"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0777"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"path"</span>: <span class="string">"/tmp/test_dir"</span>, </div><div class="line">    <span class="string">"size"</span>: <span class="number">4096</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"directory"</span>, </div><div class="line">    <span class="string">"uid"</span>: <span class="number">0</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'ls -ld /tmp/test_dir'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">drwxrwxrwx <span class="number">2</span> root mail <span class="number">4096</span> Feb  <span class="number">6</span> <span class="number">10</span><span class="symbol">:</span><span class="number">47</span> /tmp/test_dir</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Copy模块："><a href="#Copy模块：" class="headerlink" title="Copy模块："></a>Copy模块：</h2><p>Ansible copy模块：<a href="https://docs.ansible.com/ansible/copy_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/copy_module.html</a><br>复制文件到远程主机<br>常用选项<br><strong>backup</strong>：在覆盖之前将源文件备份，备份文件包含时间信息，选项：yes|no<br><strong>content</strong>：用于替代”src”，可以直接设定文件的值<br><strong>directory_node</strong>：递归的设定目录权限，默认为系统默认权限<br><strong>force</strong>：如果目标主机包含该文件，但内容不同，如果设置为yes，则强制覆盖；如果设置为no，则只有当目标主机的目标位置不存在该文件时，才复制。默认为yes<br><strong>others</strong>：所有file模块里的选项都可以在这里使用<br><strong>src</strong>：要复制到远程主机的文件在本地的地址，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制。在这种情况下，如果路径使用“/”来结尾，则只复制目录里的内容，如果没有使用“/”来结尾，则包含目录在内的整个内容全部复制，类似于rsync<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m copy -a 'src=/root/test_file.txt dest=/tmp/ansible_test_cpoy.txt owner=root group=mail mode=0600'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"e6c4fbd4fe7607f3e6ebf68b2ea4ef694da7b4fe"</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/ansible_test_cpoy.txt"</span>, </div><div class="line">    <span class="string">"gid"</span>: 12, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"mail"</span>, </div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"2d282102fa671256327d4767ec23bc6b"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0600"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 21, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1486364820.02-66604881581156/source"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'ls -l /tmp/ansible_test_cpoy.txt'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">-rw------- 1 root mail 21 Feb  6 15:07 /tmp/ansible_test_cpoy.txt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="Service模块"><a href="#Service模块" class="headerlink" title="Service模块"></a>Service模块</h2><p>Ansible service模块：<a href="https://docs.ansible.com/ansible/service_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/service_module.html</a><br>用于管理服务<br>常用选项：<br><strong>arguments</strong>：为命令提供一些附加参数<br><strong>enabled</strong>：是否开机启动，选项 yes|no<br><strong>name</strong>：必选项，服务名称<br><strong>pattern</strong>：定义一个模式，如果通过status指令来查看服务状态时，没有响应，它会通过ps命令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然运行<br><strong>runlevel</strong>：运行级别<br><strong>sleep</strong>：如果执行了restarted，则在stop和start之间等待几秒钟<br><strong>state</strong>：对当前服务执行启动/停止/重启/重新加载等操作(started/stopped/restarted/reloaded)<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m service -a 'name=nginx state=started enabled=yes'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"enabled"</span>: true, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"nginx"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'ps -ef | grep nginx | grep -v grep'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">root       <span class="number">2638</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> <span class="symbol">nginx:</span> master process /usr/sbin/nginx -c /etc/nginx/nginx.conf</div><div class="line">nginx      <span class="number">2640</span>   <span class="number">2638</span>  <span class="number">0</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> ?        <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> <span class="symbol">nginx:</span> worker process                   </div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'chkconfig --list | egrep -w nginx'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line">nginx          	<span class="number">0</span><span class="symbol">:off</span>	<span class="number">1</span><span class="symbol">:off</span>	<span class="number">2</span><span class="symbol">:on</span>	<span class="number">3</span><span class="symbol">:on</span>	<span class="number">4</span><span class="symbol">:on</span>	<span class="number">5</span><span class="symbol">:on</span>	<span class="number">6</span><span class="symbol">:off</span></div><div class="line">nginx-debug    	<span class="number">0</span><span class="symbol">:off</span>	<span class="number">1</span><span class="symbol">:off</span>	<span class="number">2</span><span class="symbol">:off</span>	<span class="number">3</span><span class="symbol">:off</span>	<span class="number">4</span><span class="symbol">:off</span>	<span class="number">5</span><span class="symbol">:off</span>	<span class="number">6</span><span class="symbol">:off</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#Ansible会匹配nginx服务，如果存在/usr/sbin/nginx这个进程时，认为其已经启动，则不执行后面的started操作</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m service -a 'name=nginx pattern=/usr/sbin/nginx state=started'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: false, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"nginx"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m service -a 'name=network state=restarted args=eth0'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"network"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"started"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="Cron模块"><a href="#Cron模块" class="headerlink" title="Cron模块"></a>Cron模块</h2><p>Ansible cron模块：<a href="https://docs.ansible.com/ansible/cron_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/cron_module.html</a><br>用于管理计划任务<br>常用参数：<br><strong>backup</strong>：对远程主机上的原计划任务内容修改之前做备份<br><strong>cron_file</strong>：如果指定该选项，则用该文件替换远程主机上cron.d目录下的用户的任务计划<br><strong>day</strong>：日(1-31,*,*/2,…)<br><strong>hour</strong>：小时(0-23,*,*/2,…)<br><strong>minute</strong>:分钟(0-59,*,*/2,…)<br><strong>month</strong>：月(0-12,*,…)<br><strong>weekday</strong>：周(0-7,*,…)<br><strong>job</strong>：要执行的任务，依赖于state=present<br><strong>name</strong>：该任务的描述<br><strong>special_time</strong>：指定什么时候执行，参数：reboot,yearly,annually,monthly,weekly,daily,hourly<br><strong>state</strong>：确认该任务计划是创建还是删除<br><strong>user</strong>：以哪个用户身份执行<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="reboot system" minute=0 hour=5 user=root job="/sbin/reboot" state=present'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: [</div><div class="line">        <span class="string">"reboot system"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "crontab -l"</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="comment">#Ansible: reboot system</span></div><div class="line"><span class="number">0</span> <span class="number">5</span> * * * <span class="regexp">/sbin/reboot</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="reboot system" state=absent'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: []</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#每隔5分钟查看home目录,state=present可省略</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="check home directory" minute=*/5 job="ls -lht /home"'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: [</div><div class="line">        <span class="string">"check home directory"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "crontab -l"</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="comment">#Ansible: check home directory</span></div><div class="line">*<span class="regexp">/5 * * * * ls -lht /home</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m cron -a 'name="echo reboot" special_time=reboot job="echo reboot_successful" state=present'</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS =&gt;</span> &#123;</div><div class="line">    <span class="string">"changed"</span>: true, </div><div class="line">    <span class="string">"envs"</span>: [], </div><div class="line">    <span class="string">"jobs"</span>: [</div><div class="line">        <span class="string">"echo reboot"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a "crontab -l"</span></div><div class="line"><span class="meta">192.168.31.110 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="comment">#Ansible: echo reboot</span></div><div class="line">@reboot echo reboot_successful</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h2><p>Ansible FileSystem模块：<a href="https://docs.ansible.com/ansible/filesystem_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/filesystem_module.html</a><br>块设备上创建文件系统<br>选项：<br><strong>dev</strong>：目标块设备<br><strong>force</strong>：在一个已有文件系统的设备上强制创建<br><strong>fstype</strong>：文件系统的类型<br><strong>opts</strong>：传递给mkfs命令的选项<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Filesystem模块只能对整个块设备操作，不能分区</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m filesystem -a 'dev=/dev/sdb fstype=ext4'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'fdisk -l /dev/sdb'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line"></div><div class="line">Disk /dev/sdb: 107.4 GB, 107374182400 bytes</div><div class="line">255 heads, 63 sectors/track, 13054 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#如果需要像平时样对块设备进行分区操作，则需要编写脚本让Ansible执行。这里用到了copy和command模块</span></div><div class="line">[root@Ansible ~]<span class="comment"># cat fdisk.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#make partition</span></div><div class="line">fdisk /dev/sdb &lt;&lt;EOF</div><div class="line">n</div><div class="line">p</div><div class="line">1</div><div class="line"></div><div class="line">+10G</div><div class="line">p</div><div class="line">w</div><div class="line">EOF</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m copy -a 'src=/root/fdisk.sh dest=/tmp/'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"f265923f0a4578e36c82418df1a068a55867c1b1"</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/fdisk.sh"</span>, </div><div class="line">    <span class="string">"gid"</span>: 0, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"87c9e0b074e4828b37d6e334d1cf7ce1"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 71, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1486437971.22-237961786906240/source"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m command -a 'sh /tmp/fdisk.sh'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">...</div><div class="line">Disk /dev/sdb: 107.4 GB, 107374182400 bytes</div><div class="line">255 heads, 63 sectors/track, 13054 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x166637ee</div><div class="line"></div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sdb1               1        1306    10490413+  83  Linux</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'mkfs.ext4 /dev/sdb1'</span></div><div class="line"><span class="comment">#格式化分区</span></div></pre></td></tr></table></figure>
<h2 id="Mount模块"><a href="#Mount模块" class="headerlink" title="Mount模块"></a>Mount模块</h2><p>Ansible mount模块：<a href="https://docs.ansible.com/ansible/mount_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/mount_module.html</a><br><strong>dump</strong>：存储(见fstab文件第5列)。注意，如果设置为null并且状态设置为present，它将停止工作，并且将在后续运行中进行重复条目。对Solaris系统没有影响。<br><strong>fstype</strong>：必选项，文件系统类型，要求状态是present或mounted<br><strong>name</strong>：必选项，挂载点<br><strong>opts</strong>：传递给mount命令的参数<br><strong>src</strong>：必选项，要挂载的设备路径。要求状态是present或mounted<br><strong>state</strong>：必选项。选项为present/absent/mounted/unmounted  </p>
<ul>
<li>present：只处理fstab中的配置</li>
<li>absent：删除挂载点  </li>
<li>mounted：自动创建挂载点并挂载  </li>
<li>unmounted：卸载  <figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#挂载分区</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m mount -a 'name=/mnt src=/dev/sdb1 fstype=ext4 state=mounted opts=rw'</span></div><div class="line"><span class="number">192.168</span><span class="number">.31</span><span class="number">.110</span> | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"dump"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"fstab"</span>: <span class="string">"/etc/fstab"</span>, </div><div class="line">    <span class="string">"fstype"</span>: <span class="string">"ext4"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"/mnt"</span>, </div><div class="line">    <span class="string">"opts"</span>: <span class="string">"rw"</span>, </div><div class="line">    <span class="string">"passno"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/dev/sdb1"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'df -h /dev/sdb1'</span></div><div class="line"><span class="number">192.168</span><span class="number">.31</span><span class="number">.110</span> | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</div><div class="line">Filesystem      Size  Used Avail Use% Mounted <span class="literal">on</span></div><div class="line">/dev/sdb1       <span class="number">9.8</span>G   <span class="number">23</span>M  <span class="number">9.3</span>G   <span class="number">1</span>% /mnt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'tail -1 /etc/fstab'</span></div><div class="line"><span class="number">192.168</span><span class="number">.31</span><span class="number">.110</span> | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</div><div class="line">/dev/sdb1 /mnt ext4 rw <span class="number">0</span> <span class="number">0</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#state=mounted，如果挂载点不存在会自动创建</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'dd if=/dev/zero of=/mnt/disk.img bs=1M count=100'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">100+0 records <span class="keyword">in</span></div><div class="line">100+0 records out</div><div class="line">104857600 bytes (105 MB) copied, 0.241784 s, 434 MB/s</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'losetup /dev/loop0 /mnt/disk.img'  #关联设备</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m filesystem -a 'dev=/mnt/disk.img fstype=ext4 opts=-F'  #格式化块设备</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m mount -a 'src=/dev/loop0 name=/yfshare fstype=ext4 state=mounted'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"dump"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"fstab"</span>: <span class="string">"/etc/fstab"</span>, </div><div class="line">    <span class="string">"fstype"</span>: <span class="string">"ext4"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"/yfshare"</span>, </div><div class="line">    <span class="string">"opts"</span>: <span class="string">"defaults"</span>, </div><div class="line">    <span class="string">"passno"</span>: <span class="string">"0"</span>, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/dev/loop0"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'df -h | grep -w loop0'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">/dev/loop0             93M  1.6M   87M   2% /yfshare</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m shell -a 'grep -w loop0 /etc/fstab'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">/dev/loop0 /yfshare ext4 defaults 0 0</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m file -a 'path=/yfshare/test.txt state=touch mode=0600'</span></div></pre></td></tr></table></figure>
<h2 id="Yum模块"><a href="#Yum模块" class="headerlink" title="Yum模块"></a>Yum模块</h2><p>Ansible Packaging Modules：<a href="https://docs.ansible.com/ansible/list_of_packaging_modules.html" target="_blank" rel="external">https://docs.ansible.com/ansible/list_of_packaging_modules.html</a><br>Ansible yum模块：<a href="https://docs.ansible.com/ansible/yum_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/yum_module.html</a><br>使用yum包管理器来管理软件包<br>选项：<br><strong>conf_file</strong>：yum的配置文件<br><strong>disable_gpg_check</strong>：关闭gpg_check<br><strong>disablerepo</strong>：不启用某个源<br><strong>enablerepo</strong>：启用某个源<br><strong>list</strong>：查看yum列表<br><strong>name</strong>：要进行操作的软件包名字，也可以传递一个url或者一个本地的rpm包的路径<br><strong>state</strong>：状态(present/installed/absent/removed/latest)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#卸载nginx软件包</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m yum -a 'name=nginx state=absent'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"msg"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"rc"</span>: 0, </div><div class="line">    <span class="string">"results"</span>: [</div><div class="line">    <span class="string">"Loaded plugins: fastestmirror\nSetting up Remove Process\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package nginx.x86_64 0:1.10.3-1.el6.ngx will be erased\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n\n</span></div><div class="line">    ...</div><div class="line">        ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]#</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#更新nginx软件包</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m yum -a 'name=nginx update_cache=yes'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"msg"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"rc"</span>: 0, </div><div class="line">    <span class="string">"results"</span>: [</div><div class="line">        <span class="string">"nginx-1.10.3-1.el6.ngx.x86_64 providing nginx is already installed"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="User模块"><a href="#User模块" class="headerlink" title="User模块"></a>User模块</h2><p>Ansible User模块：<a href="https://docs.ansible.com/ansible/user_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/user_module.html</a><br>常用参数：<br><strong>home</strong>：指定用户家目录<br><strong>group</strong>：设置用户主组<br><strong>groups</strong>：设置用户的附属组<br><strong>uid</strong>：设置用户的UID<br><strong>password</strong>：设置用户的密码，密码必须为加密后的值<br><strong>name</strong>：创建用户的用户名<br><strong>createhhome</strong>：选项yes|no，值为yes时才创建用户家目录<br><strong>system</strong>：选项yes|no，默认为no，值为yes时创建的用户为系统用户<br><strong>remove</strong>：当state=absent时，remove=yes则表示连同家目录一起删除，等价于userdel -r<br><strong>state</strong>：选项present|absent，创建用户或删除用户<br><strong>shell</strong>：设置用户的shell环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#生成用户的密码</span></div><div class="line">[root@Ansible ~]<span class="comment"># echo "123456" | openssl passwd -1 -salt $(&lt; /dev/urandom tr -dc '[:alnum:]' | head -c 32) -stdin</span></div><div class="line"><span class="variable">$1</span><span class="variable">$K28XAyId</span><span class="variable">$YUKHvYzbbO9C8RkzGIzNo1</span></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#group为指定用户的主组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m user -a 'name=user1 uid=1001 group=yfshare createhome=yes home=/home/user1 password="$1$K28XAyId$YUKHvYzbbO9C8RkzGIzNo1" shell=/bin/bash state=present'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"comment"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"createhome"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"group"</span>: 1000, </div><div class="line">    <span class="string">"home"</span>: <span class="string">"/home/user1"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"user1"</span>, </div><div class="line">    <span class="string">"password"</span>: <span class="string">"NOT_LOGGING_PASSWORD"</span>, </div><div class="line">    <span class="string">"shell"</span>: <span class="string">"/bin/bash"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"present"</span>, </div><div class="line">    <span class="string">"system"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"uid"</span>: 1001</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'id user1'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">uid=1001(user1) gid=1000(yfshare) groups=1000(yfshare)</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#groups为指定用户的附属组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m user -a 'name=user2 uid=1002 groups=yfshare createhome=yes home=/home/user2 password="$1$K28XAyId$YUKHvYzbbO9C8RkzGIzNo1" shell=/bin/bash state=present'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"comment"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"createhome"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"group"</span>: 1002, </div><div class="line">    <span class="string">"groups"</span>: <span class="string">"yfshare"</span>, </div><div class="line">    <span class="string">"home"</span>: <span class="string">"/home/user2"</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"user2"</span>, </div><div class="line">    <span class="string">"password"</span>: <span class="string">"NOT_LOGGING_PASSWORD"</span>, </div><div class="line">    <span class="string">"shell"</span>: <span class="string">"/bin/bash"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"present"</span>, </div><div class="line">    <span class="string">"system"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"uid"</span>: 1002</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'id user2'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">uid=1002(user2) gid=1002(user2) groups=1002(user2),1000(yfshare)</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除user1用户</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m user -a 'name=user1 remove=yes state=absent'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"force"</span>: <span class="literal">false</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"user1"</span>, </div><div class="line">    <span class="string">"remove"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"absent"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'id user1'</span></div><div class="line">192.168.31.110 | FAILED | rc=1 &gt;&gt;</div><div class="line">id: user1: No such user</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Group模块"><a href="#Group模块" class="headerlink" title="Group模块"></a>Group模块</h2><p>Ansible group模块：<a href="https://docs.ansible.com/ansible/group_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/group_module.html</a><br>选项：<br><strong>gid</strong>：设置组的GID<br><strong>name</strong>：组名<br><strong>state</strong>：选项为present|absent，创建组或删除组<br><strong>system</strong>：选项为yes|no，值为yes，则创建系统组<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#创建yfshare组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m group -a 'name=yfshare gid=1000 state=present'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"gid"</span>: 1000, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"yfshare"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"present"</span>, </div><div class="line">    <span class="string">"system"</span>: <span class="literal">false</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'grep yfshare /etc/group'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">yfshare:x:1000:</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除yfshare组</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m group -a 'name=yfshare gid=1000 state=absent'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"name"</span>: <span class="string">"yfshare"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"absent"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'grep yfshare /etc/group'</span></div><div class="line">192.168.31.110 | FAILED | rc=1 &gt;&gt;</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Synchronize模块"><a href="#Synchronize模块" class="headerlink" title="Synchronize模块"></a>Synchronize模块</h2><p>Ansible synchronize模块：<a href="https://docs.ansible.com/ansible/synchronize_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/synchronize_module.html</a><br><strong>archive</strong>：归档，相当于同时开启recursive(递归)、links、perms、times、owner、group、-D选项都为yes ，默认该项为开启<br><strong>checksum</strong>：跳过检测sum值，默认关闭<br><strong>delete</strong>：删除不存在的文件(源主机没有但目标主机中存在的文件)，默认no<br><strong>dest</strong>：从源同步到目的主机的路径，可以为绝对路径或相对路径<br><strong>src</strong>：在源主机上将要同步到目的主机的路径，可为绝对路径或相对路径<br><strong>dest_port</strong>：目标主机上的SSH端口号，在Ansible 2.0之前，ansible_ssh_port变量值优先于此变量<br><strong>existing_only</strong>：在目的主机上不创建新文件<br><strong>links</strong>：将符号链接复制为符号链接<br><strong>copy_links</strong>：复制链接文件，默认为no<br><strong>owner</strong>：保留所有者（仅超级用户）<br><strong>mode</strong>：选项push和pull。push模式，从本机向远程主机传送文件；pull模式从远程主机上取文件<br><strong>recursive</strong>：递归到目录<br><strong>rsync_path</strong>：指定在远程主机上运行rsync命令<br><strong>times</strong>：保留修改时间<br><strong>compress</strong>：在传输过程中是否压缩文件，选项yes|no<br><strong>dirs</strong>：传速目录不进行递归，默认为no，即进行目录递归<br><strong>rsync_opts</strong>：指定rsync参数选项<br><strong>set_remote_user</strong>：主要用于/etc/ansible/hosts中定义或默认使用的用户与rsync使用的用户不同的情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="string">"msg"</span>: <span class="string">"Failed to find required executable ssh"</span>  <span class="comment">#出现这个报错，需要安装openssh-clients</span></div><div class="line"><span class="string">"msg"</span>: <span class="string">"Failed to find required executable rsync"</span>  <span class="comment">#出现这个问题，需要安装rsync</span></div><div class="line"></div><div class="line"><span class="comment">#synchronize同步文件</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m synchronize -a 'src=/tmp/helloworld.txt dest=/tmp/'</span></div><div class="line">root@192.168.31.110<span class="string">'s password: </span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    "changed": true, </div><div class="line">    "cmd": "/usr/bin/rsync --delay-updates -F --compress --archive --rsh 'ssh  -S none -o StrictHostKeyChecking=no<span class="string">' --out-format='</span>&lt;&lt;CHANGED&gt;&gt;%i %n%L<span class="string">' \"/tmp/helloworld.txt\" \"root@192.168.31.110:/tmp/\"", </span></div><div class="line">    "msg": "&lt;f+++++++++ helloworld.txt\n", </div><div class="line">    "rc": 0, </div><div class="line">    "stdout_lines": [</div><div class="line">        "&lt;f+++++++++ helloworld.txt"</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]# ansible test_hosts -a 'cat /tmp/helloworld.txt<span class="string">'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">hello world</div><div class="line"></div><div class="line">[root@Ansible ~]#</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#synchronize同步目录。如果synchronize同步到目的服务器的目录不存在，则会创建该目录后同步到该目录，rsync_path可以指定rsync的路径(如果是源码安装的)</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m synchronize -a 'src=/tmp/test dest=/tmp/synchronize_test delete=yes mode=push owner=yes rsync_path=/usr/bin/rsync rsync_opts="-avz,--exclude=.git"'</span></div><div class="line">root@192.168.31.110<span class="string">'s password: </span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    "changed": true, </div><div class="line">    "cmd": "/usr/bin/rsync --delay-updates -F --compress --delete-after --archive --rsh 'ssh  -S none -o StrictHostKeyChecking=no<span class="string">' --out-format='</span>&lt;&lt;CHANGED&gt;&gt;%i %n%L<span class="string">' \"/tmp/test\" \"root@192.168.31.110:/tmp/synchronize_test\"", </span></div><div class="line">    "msg": "cd+++++++++ test/\n</div><div class="line">    ···</div><div class="line">        ]</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]#</div><div class="line">[root@Ansible ~]# ansible test_hosts -a 'ls /tmp/synchronize_test<span class="string">'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">test</div><div class="line"></div><div class="line">[root@Ansible ~]#</div></pre></td></tr></table></figure>
<h2 id="get-url模块"><a href="#get-url模块" class="headerlink" title="get_url模块"></a>get_url模块</h2><p>主要用于从http、ftp、https服务器上下载文件（类似于wget）<br>Ansible get_url模块：<a href="https://docs.ansible.com/ansible/get_url_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/get_url_module.html</a><br>选项：<br><strong>checksum</strong>：文件下载完成后进行校验<br><strong>timeout</strong>：请求超时时间，默认为10s<br><strong>url</strong>：文件下载地址<br><strong>url_username</strong>：用户名，基于HTTP的基本认证<br><strong>url_password</strong>：密码<br><strong>use_proxy</strong>：选项yes|no，默认为yes，即使用代理<br><strong>dest</strong>：下载文件存储的绝对路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#下载文件并下载完成后进行sha256sum校验</span></div><div class="line"><span class="comment">#支持加密算法：sha1, sha224, sha384, sha256, sha512, md5</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m get_url -a 'dest=/tmp/ url="http://archive.kernel.org/centos-vault/6.7/isos/x86_64/0_README.txt" checksum="sha256:f98849cdc1b3dee8cf47cfcf2a2fe2fb8e8e69426157a47d20a3005693fd3e1c"'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"checksum_dest"</span>: null, </div><div class="line">    <span class="string">"checksum_src"</span>: <span class="string">"a1b756c6a431552e5012a9332c68dc1ef3ec463c"</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/0_README.txt"</span>, </div><div class="line">    <span class="string">"gid"</span>: 0, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"99bc97977d71be899bef0c5664fae3fb"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>, </div><div class="line">    <span class="string">"msg"</span>: <span class="string">"OK (2210 bytes)"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 2210, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/tmp/tmp8GUXc4"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0, </div><div class="line">    <span class="string">"url"</span>: <span class="string">"http://archive.kernel.org/centos-vault/6.7/isos/x86_64/0_README.txt"</span></div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'ls /tmp/0_README.txt -l'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">-rw-r--r-- 1 root root 2210 Feb  8 19:33 /tmp/0_README.txt</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="unarchive模块"><a href="#unarchive模块" class="headerlink" title="unarchive模块"></a>unarchive模块</h2><p>Ansible unarchive模块：<a href="https://docs.ansible.com/ansible/unarchive_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/unarchive_module.html</a><br>用于解压文件<br>选项：<br><strong>remote_src</strong>：选项yes|no，默认为no，值为yes表示文件已复制到远程主机，added in Ansible 2.2<br><strong>creates</strong>：如果文件存在，则不执行解压命令<br><strong>dest</strong>：在远程主机上解压的绝对路径<br><strong>group</strong>：设置解压后文件/目录的属组<br><strong>owner</strong>：设置解压后文件/目录的属主<br><strong>list_files</strong>：选项yes|no，默认为no，值为yes，解压后列出压缩包的文件，added in Ansible 2.0<br><strong>mode</strong>：解压后文件的权限<br><strong>src</strong>：值为yes，如果remote_src=no (default)，本地压缩文件复制到目的服务器，绝对路径相对路径均可；如果remote_src=yes，直接在目标服务器上解压文件；如果remote_src=yes和src包含URL，则先下载文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m unarchive -a 'creates=NewSid.zip src=/tmp/NewSid.zip dest=/tmp/ mode=0600 owner=yfshare list_files=yes'</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/"</span>, </div><div class="line">    <span class="string">"extract_results"</span>: &#123;</div><div class="line">        <span class="string">"cmd"</span>: [</div><div class="line">            <span class="string">"/usr/bin/unzip"</span>, </div><div class="line">            <span class="string">"-o"</span>, </div><div class="line">            <span class="string">"/root/.ansible/tmp/ansible-tmp-1486610818.84-40104290759151/source"</span>, </div><div class="line">            <span class="string">"-d"</span>, </div><div class="line">            <span class="string">"/tmp/"</span></div><div class="line">        ], </div><div class="line">        <span class="string">"err"</span>: <span class="string">""</span>, </div><div class="line">        <span class="string">"out"</span>: <span class="string">"Archive:  /root/.ansible/tmp/ansible-tmp-1486610818.84-40104290759151/source\n  inflating: /tmp/newsid.exe         \n  inflating: /tmp/Eula.txt           \n"</span>, </div><div class="line">        <span class="string">"rc"</span>: 0</div><div class="line">    &#125;, </div><div class="line">    <span class="string">"files"</span>: [   <span class="comment">#列出解压文件列表</span></div><div class="line">        <span class="string">"newsid.exe"</span>, </div><div class="line">        <span class="string">"Eula.txt"</span></div><div class="line">    ], </div><div class="line">    <span class="string">"gid"</span>: 0, </div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"handler"</span>: <span class="string">"ZipArchive"</span>, </div><div class="line">    <span class="string">"mode"</span>: <span class="string">"01777"</span>, </div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>, </div><div class="line">    <span class="string">"size"</span>: 4096, </div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1486610818.84-40104290759151/source"</span>, </div><div class="line">    <span class="string">"state"</span>: <span class="string">"directory"</span>, </div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a 'ls -l /tmp'</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 240</div><div class="line">drwx------ 2 root    root   4096 Feb  9 11:28 ansible_zimVwy</div><div class="line">-rw------- 1 yfshare root   7005 Jul 28  2006 Eula.txt</div><div class="line">-rw------- 1 yfshare root 228152 Nov  1  2006 newsid.exe</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h2 id="Setup模块"><a href="#Setup模块" class="headerlink" title="Setup模块"></a>Setup模块</h2><p>Ansible Setup模块：<a href="https://docs.ansible.com/ansible/setup_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/setup_module.html</a><br>playbooks自动收集远程主机上可用变量，这些变量用于playbooks<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m setup</span></div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"ansible_facts"</span>: &#123;</div><div class="line">        <span class="string">"ansible_all_ipv4_addresses"</span>: [</div><div class="line">            <span class="string">"192.168.31.110"</span></div><div class="line">        ], </div><div class="line">        <span class="string">"ansible_all_ipv6_addresses"</span>: [</div><div class="line">            <span class="string">"fe80::20c:29ff:fe5c:dc6d"</span></div><div class="line">        ], </div><div class="line">        <span class="string">"ansible_architecture"</span>: <span class="string">"x86_64"</span>,</div><div class="line">...</div></pre></td></tr></table></figure></p>
<h2 id="Template模块"><a href="#Template模块" class="headerlink" title="Template模块"></a>Template模块</h2><p>Ansible Template模块：<a href="https://docs.ansible.com/ansible/template_module.html" target="_blank" rel="external">https://docs.ansible.com/ansible/template_module.html</a><br>模版由<a href="http://jinja.pocoo.org/docs" target="_blank" rel="external">jinja2模版语言</a>处理，模版设计文档参考<a href="http://jinja.pocoo.org/docs/templates/" target="_blank" rel="external">这里</a><br>模版中可以使用六个附加变量：  </p>
<ul>
<li>ansible_managed(通过ansible.cfg的defaults部分配置)包含一个字符串，可用户描述模版名称，主机，模版文件修改时间和所有者uid</li>
<li>template_host包含模版机器的节点名称</li>
<li>template_uid所有者的用户ID</li>
<li>template_path模版路径</li>
<li>template_fullpath模版的绝对路径</li>
<li>telmpate_run_date模版显示日期</li>
</ul>
<p>常用选项：<br><strong>backup</strong>：选项yes|no，默认为no，创建一个包含时间戳的备份文件<br><strong>src</strong>：本地文件的路径<br><strong>dest</strong>：远程主机的文件位置<br><strong>force</strong>：选项yes|no，默认为yes，覆盖远程主机上的同名文件，如果为否，只有当远程主机上不存在此文件时，才传输文件<br><strong>owner</strong>：文件/目录的所有者，chown<br><strong>group</strong>：文件/目录的所属组，chown<br><strong>mode</strong>：文件/目录的权限，chmod<br><strong>validate</strong>：在复制之前需要验证命令，要验证的文件的路径通过“%s”传递<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- template:</div><div class="line">    src: etc/ssh/sshd_config.j2</div><div class="line">    dest: /etc/ssh/sshd_config</div><div class="line">    owner: root</div><div class="line">    group: root</div><div class="line">    mode: <span class="string">'0600'</span></div><div class="line">    validate: /usr/sbin/sshd -t <span class="_">-f</span> %s</div><div class="line">    backup: yes</div></pre></td></tr></table></figure></p>
<h2 id="script模块"><a href="#script模块" class="headerlink" title="script模块"></a>script模块</h2><p>Ansible script模块：<a href="http://docs.ansible.com/ansible/script_module.html" target="_blank" rel="external">http://docs.ansible.com/ansible/script_module.html</a><br>在远程主机上执行脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># chmod +x /tmp/script.sh </span></div><div class="line">[root@Ansible ~]<span class="comment"># cat /tmp/script.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'This is a test script'</span> &gt; /tmp/script.ansible</div><div class="line">useradd Jack_wang</div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -m script -a '/tmp/script.sh'</span></div><div class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">'/root/.ssh/id_rsa'</span>: </div><div class="line">192.168.31.110 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </div><div class="line">    <span class="string">"rc"</span>: 0, </div><div class="line">    <span class="string">"stderr"</span>: <span class="string">"Shared connection to 192.168.31.110 closed.\r\n"</span>, </div><div class="line">    <span class="string">"stdout"</span>: <span class="string">""</span>, </div><div class="line">    <span class="string">"stdout_lines"</span>: []</div><div class="line">&#125;</div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a "id Jack_wang"</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">uid=502(Jack_wang) gid=502(Jack_wang) groups=502(Jack_wang)</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment"># ansible test_hosts -a "cat /tmp/script.ansible"</span></div><div class="line">192.168.31.110 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">This is a <span class="built_in">test</span> script</div><div class="line"></div><div class="line">[root@Ansible ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>参考文档：<a href="http://breezey.blog.51cto.com/2400275/1555530/" target="_blank" rel="external">http://breezey.blog.51cto.com/2400275/1555530/</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="http://www.yfshare.vip">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="http://www.yfshare.vip/2017/04/05/Ansible常用模块/">http://www.yfshare.vip/2017/04/05/Ansible常用模块/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=2.0.0" async></script><a data-url="http://www.yfshare.vip/2017/04/05/Ansible常用模块/" data-id="cjb6m4g9r000oqkm50jkhplmf" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ansible/">ansible</a><a href="/tags/Modules/">Modules</a></div><div class="post-nav"><a href="/2017/04/12/部署Oracle-RAC集群/" class="pre">部署Oracle-RAC集群</a><a href="/2017/03/20/Ansible-Playbooks之安装Zabbix/" class="next">Ansible-Playbooks之安装Zabbix</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'yfshare';
var disqus_identifier = '2017/04/05/Ansible常用模块/';
var disqus_title = 'Ansible常用模块';
var disqus_url = 'http://www.yfshare.vip/2017/04/05/Ansible常用模块/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//yfshare.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Atlassian/">Atlassian</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ELK/">ELK</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jenkins/">Jenkins</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Virtualization/">Virtualization</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制系统/">版本控制系统</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/14/The-Redmine-svn-of-docker/">The Redmine_svn of docker</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/05/关于kernel-nf-conntrack-table-full-dropping-packet问题/">关于kernel: nf_conntrack: table full, dropping packet问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/04/ElasticSearch集群-基础/">ElasticSearch集群(基础)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/04/timelion请求语法/">timelion请求语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/04/Logstash监控/">Logstash监控</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/22/Grok正则语法/">Grok正则语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/22/Logstash配置语法/">Logstash配置语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/22/ELK安装-基础/">ELK安装(基础)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/18/Logstash插件/">Logstash插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/14/Elasticsearch监控相关/">Elasticsearch监控相关</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yfshare.blog.51cto.com/" title="酱油瓶 博客" target="_blank">酱油瓶 博客</a><ul></ul><a href="http://zerosre.com/" title="龙哥zero 博客" target="_blank">龙哥zero 博客</a><ul></ul><a href="http://renzhiyuan.blog.51cto.com/" title="任志远Ray 博客" target="_blank">任志远Ray 博客</a><ul></ul><a href="http://rongrong.njdgwl.com" title="浩子的 博客" target="_blank">浩子的 博客</a><ul></ul><a href="http://www.cnblogs.com/aresxin/" title="欣哥aresxin 博客" target="_blank">欣哥aresxin 博客</a><ul></ul><a href="http://securityit.cn/" title="万马奔腾" target="_blank">万马奔腾</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-resources"> 资源站</i></div><ul></ul><a href="http://mirror.symnds.com/distributions/CentOS-vault/" title="Centos镜像站" target="_blank">Centos镜像站</a><ul></ul><a href="http://www.rpmfind.net/" title="rpmfind mirror" target="_blank">rpmfind mirror</a><ul></ul><a href="http://rpm.org/" title="rpm.org" target="_blank">rpm.org</a><ul></ul><a href="http://rpm.pbone.net/" title="rpm search" target="_blank">rpm search</a><ul></ul><a href="http://download.chinaunix.net/" title="chinaunix download" target="_blank">chinaunix download</a><ul></ul><a href="http://www.anquanquan.info/" title="安全圈info" target="_blank">安全圈info</a><ul></ul><a href="http://source.tosimp.net/" title="Tosimp 资源站" target="_blank">Tosimp 资源站</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=371362&auto=1&height=66"></iframe><div class="widget"><div class="widget-title"><i class="fa fa-external-game"> 游戏</i></div><ul></ul><a href="/2048" title="2048小游戏" target="_blank">2048小游戏</a><ul></ul><a href="/tantanqiu" title="变色弹球跳台阶小游戏" target="_blank">变色弹球跳台阶小游戏</a></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//yfshare.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Jack Wang Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=2.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=2.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=2.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3890bdc1bfaccae9364479b65f36fbd2";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=2.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=2.0.0"></script></div></body></html>
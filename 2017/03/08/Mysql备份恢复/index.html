<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Blog"><title>Mysql备份恢复 | Jack Wang Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Mysql备份恢复</h1><a id="logo" href="/.">Jack Wang Blog</a><p class="description">Goals determine what you are going to be</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Mysql备份恢复</h1><div class="post-meta">Mar 8, 2017<span> | </span><span class="category"><a href="/categories/mysql/">mysql</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/03/08/Mysql备份恢复/" href="/2017/03/08/Mysql备份恢复/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#binlog"><span class="toc-number">1.</span> <span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开启binlog"><span class="toc-number">2.</span> <span class="toc-text">开启binlog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql备份恢复"><span class="toc-number">3.</span> <span class="toc-text">Mysql备份恢复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql备份恢复脚本"><span class="toc-number">4.</span> <span class="toc-text">Mysql备份恢复脚本</span></a></li></ol></div></div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>开启mysql的binlog功能可以有效防止在日常mysql操作过程中因操作失误而导致的数据丢失问题<br>但是，对于DBA来说，第一准则就是<strong>备份重于一切</strong>。<a href="http://www.eygle.com/" target="_blank" rel="external">eygle</a>在DBA<a href="http://www.eygle.com/archives/2006/03/the_four_rule_for_dba.html" target="_blank" rel="external">四大生存法则</a>中也有提到<br><em>我们必需知道,系统总是要崩溃的，没有有效的备份只是等哪一天死！我经常开玩笑的说,唯一会使DBA在梦中惊醒的就是,没有有效的备份.</em><br><a id="more"></a></p>
<h2 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h2><p>binlog，也称为二进制日志，记录对数据发生或潜在发生更改的SQL语句，并以二进制的形式保存在磁盘中，可以用来查看数据库的变更历史（具体的时间点所有的SQL操作）、数据库增量备份和恢复（增量备份和基于时间点的恢复）、Mysql的复制（主主数据库的复制、主从数据库的复制）</p>
<h2 id="开启binlog"><a href="#开启binlog" class="headerlink" title="开启binlog"></a>开启binlog</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like <span class="string">'%log_bin%'</span>;</div><div class="line">+---------------------------------+-------+</div><div class="line">| Variable_name                   | Value |</div><div class="line">+---------------------------------+-------+</div><div class="line">| log_bin                         | ON    |</div><div class="line">| log_bin_trust_function_creators | OFF   |</div><div class="line">| sql_log_bin                     | ON    |</div><div class="line">+---------------------------------+-------+</div><div class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div><div class="line"></div><div class="line">[root@host1 ~]<span class="comment"># grep -i 'bin' /etc/my.cnf | grep -i 'log'</span></div><div class="line">log_bin=mysql_bin</div><div class="line">binlog_format=Mixed</div><div class="line">[root@host1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@host1 ~]<span class="comment"># /etc/init.d/mysqld restart</span></div><div class="line"></div><div class="line">[root@host1 ~]<span class="comment"># ls /var/lib/mysql | grep 'mysql_bin' | tail -3</span></div><div class="line">mysql_bin.000032</div><div class="line">mysql_bin.000033</div><div class="line">mysql_bin.index</div><div class="line">[root@host1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="Mysql备份恢复"><a href="#Mysql备份恢复" class="headerlink" title="Mysql备份恢复"></a>Mysql备份恢复</h2><p>环境：Centos 6.6<br>　　　Mysql version： 5.5.54<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#先执行全备操作</span></div><div class="line">[root@host1 ~]<span class="comment"># sh mysql_back.sh </span></div><div class="line">Usage: please input Mysql_Fullbackup|Mysql_Incbackup</div><div class="line"></div><div class="line">[root@host1 ~]<span class="comment"># sh mysql_back.sh Mysql_Fullbackup</span></div><div class="line">Full backup of MySQL database... Please wait.</div><div class="line"></div><div class="line">Mysql database full backup success.</div><div class="line">[root@host1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@host1 ~]<span class="comment"># tree /backup/mysql_backup/</span></div><div class="line">/backup/mysql_backup/</div><div class="line">├── backup_20170308.log</div><div class="line">├── Full_backup</div><div class="line">│   └── 20170308</div><div class="line">│       ├── all_databases_backup_20170308_17:06:08.sql.gz</div><div class="line">│       └── jack_backup_20170308_17:06:08.sql.gz</div><div class="line">├── Full_backup_time.txt</div><div class="line">├── Inc_backup</div><div class="line">└── mysql_db.txt</div><div class="line"></div><div class="line">3 directories, 5 files</div><div class="line">[root@host1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@host1 mysql_backup]<span class="comment"># cat backup_20170308.log </span></div><div class="line">[ 2017-03-08 17:06:08 ] - Databases all-databases has been backup successful.</div><div class="line"></div><div class="line">[ 2017-03-08 17:06:08 ] - Databases jack has been backup successful.</div><div class="line">----------------------------------------</div><div class="line"></div><div class="line">[root@host1 mysql_backup]<span class="comment"># cat Full_backup_time.txt </span></div><div class="line">2017-03-08 17:06:08</div><div class="line">[root@host1 mysql_backup]<span class="comment"># cat mysql_db.txt </span></div><div class="line">jack</div><div class="line">[root@host1 mysql_backup]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>向jack库的yfshare表插入几条数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use jack;</div><div class="line">mysql&gt; select * from yfshare;</div><div class="line">+------+---------+</div><div class="line">| id   | name    |</div><div class="line">+------+---------+</div><div class="line">| 1    | jack    |</div><div class="line">| 2    | yfshare |</div><div class="line">| 3    | tom     |</div><div class="line">| 4    | jerry   |</div><div class="line">| 5    | bob     |</div><div class="line">+------+---------+</div><div class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line">mysql&gt; INSERT INTO yfshare values(6,<span class="string">'aaa'</span>);</div><div class="line">mysql&gt; INSERT INTO yfshare values(7,<span class="string">'bbb'</span>);</div><div class="line">mysql&gt; commit;</div><div class="line">mysql&gt; select * from yfshare;</div><div class="line">+------+---------+</div><div class="line">| id   | name    |</div><div class="line">+------+---------+</div><div class="line">| 1    | jack    |</div><div class="line">| 2    | yfshare |</div><div class="line">| 3    | tom     |</div><div class="line">| 4    | jerry   |</div><div class="line">| 5    | bob     |</div><div class="line">| 6    | aaa     |</div><div class="line">| 7    | bbb     |</div><div class="line">+------+---------+</div><div class="line">7 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p>然后做增量备份<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@host1 ~]<span class="comment"># sh mysql_back.sh Mysql_Incbackup</span></div><div class="line">Increment backup of MySQL database... Please wait.</div><div class="line"></div><div class="line">Mysql database Increment backup success.</div><div class="line">[root@host1 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@host1 ~]<span class="comment"># tree /backup/mysql_backup/Inc_backup/</span></div><div class="line">/backup/mysql_backup/Inc_backup/</div><div class="line">└── 20170308</div><div class="line">    └── jack_Inc_20170308_17:15:27.zip</div><div class="line"></div><div class="line">1 directory, 1 file</div><div class="line">[root@host1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">再向jack库和yfshare表插入几条数据后，不做备份，假设不小心删除了库jack    </div><div class="line"><span class="code">```</span>bash</div><div class="line">mysql&gt; INSERT INTO yfshare values(8,<span class="emphasis">'ccc'</span>);</div><div class="line">mysql&gt; INSERT INTO yfshare values(9,<span class="emphasis">'ddd'</span>);</div><div class="line">mysql&gt; commit;</div><div class="line"><span class="section">mysql&gt; select * from yfshare;</span></div><div class="line">+------+---------+</div><div class="line"><span class="section">| id   | name    |</span></div><div class="line">+------+---------+</div><div class="line">| 1    | jack    |</div><div class="line">| 2    | yfshare |</div><div class="line">| 3    | tom     |</div><div class="line">| 4    | jerry   |</div><div class="line">| 5    | bob     |</div><div class="line">| 6    | aaa     |</div><div class="line">| 7    | bbb     |</div><div class="line">| 8    | ccc     |</div><div class="line"><span class="section">| 9    | ddd     |</span></div><div class="line">+------+---------+</div><div class="line">9 rows in set (0.00 sec)</div><div class="line">mysql&gt; drop database jack;</div><div class="line">mysql&gt; commit;</div><div class="line">mysql&gt; desc yfshare;</div><div class="line">ERROR 1046 (3D000): No database selected</div><div class="line">mysql&gt; use jack;</div><div class="line">ERROR 1049 (42000): Unknown database <span class="emphasis">'jack'</span></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<p>下面来开始恢复jack库的yfshare表<br>恢复步骤：  </p>
<ol>
<li>恢复jack库的全量备份</li>
<li>恢复jack库的增量备份</li>
<li>通过binlog恢复数据库到删除前</li>
</ol>
<p>恢复思路：先在mysql中新建一个测试库，在测试库导入误删除表所在的库全量增量备份，然后通过binlog恢复到该表删除前一刻，并导入测试库，然后从测试库导出该表的sql，最后导入到正式库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@host1 mysql_backup]<span class="comment"># mysql -uroot -p123456 jack --one-database &lt; Full_backup/20170308/jack_backup_20170308_17\:06\:08.sql </span></div><div class="line">ERROR 1049 (42000): Unknown database <span class="string">'jack'</span></div><div class="line">[root@host1 mysql_backup]<span class="comment">#</span></div><div class="line"></div><div class="line">这时是因为没有库，所以需要先创建对应的库名，再执行全备恢复操作</div><div class="line">mysql&gt; create database jack;</div><div class="line">mysql&gt; commit;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#全量备份恢复</span></div><div class="line">[root@host1 mysql_backup]<span class="comment"># gunzip Full_backup/20170308/jack_backup_20170308_17\:06\:08.sql.gz</span></div><div class="line">[root@host1 mysql_backup]<span class="comment"># mysql -uroot -p123456 jack --one-database &lt; Full_backup/20170308/jack_backup_20170308_17\:06\:08.sql</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#增量备份恢复</span></div><div class="line">[root@host1 mysql_backup]<span class="comment"># unzip Inc_backup/20170308/jack_Inc_20170308_17\:15\:27.zip -d Inc_backup/20170308/</span></div><div class="line">[root@host1 mysql_backup]<span class="comment"># mysql -uroot -p123456 jack --one-database &lt; Inc_backup/20170308/jack_Inc_20170308_17\:15\:27.sql</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#先看看恢复的情况</span></div><div class="line">mysql&gt; use jack;</div><div class="line">mysql&gt; show tables;</div><div class="line">+----------------+</div><div class="line">| Tables_in_jack |</div><div class="line">+----------------+</div><div class="line">| aaa            |</div><div class="line">| yfshare        |</div><div class="line">+----------------+</div><div class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from yfshare;</div><div class="line">+------+---------+</div><div class="line">| id   | name    |</div><div class="line">+------+---------+</div><div class="line">| 1    | jack    |</div><div class="line">| 2    | yfshare |</div><div class="line">| 3    | tom     |</div><div class="line">| 4    | jerry   |</div><div class="line">| 5    | bob     |</div><div class="line">| 6    | aaa     |</div><div class="line">| 7    | bbb     |</div><div class="line">+------+---------+</div><div class="line">7 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<p>现在yfshare表里面只有7条数据，删除前是有9条数据的，而后边的数据没有备份，所以只能通过mysqlbinlog恢复了</p>
<p>增量备份时间是20170308_17:15:27，所以需要把从这个时间点到删除前的操作导出成一个sql文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@host1 mysql_backup]<span class="comment"># tail -3 /var/lib/mysql/mysql_bin.index </span></div><div class="line">./mysql_bin.000031</div><div class="line">./mysql_bin.000032</div><div class="line">./mysql_bin.000033</div><div class="line">[root@host1 mysql_backup]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>binlog的时间格式是：170308 17:15:27<br>mysqlbinlog恢复的时间格式：2017-03-08 17:15:27<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查找增量备份时记录到了哪个binlog文件</span></div><div class="line"><span class="comment">#因为我们在增量备份文件中记录了备份时间，所以能很快找到是从mysql_bin.000032开始的</span></div><div class="line">[root@host1 tmp]<span class="comment"># mysqlbinlog --no-defaults /var/lib/mysql/mysql_bin.000032 | grep -i '170308 17:15:27'</span></div></pre></td></tr></table></figure></p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#查找删除的时间点</span></div><div class="line"><span class="meta">#可以考虑把所有mysql_bin文件导成sql文件后过滤查找</span></div><div class="line">[root@host1 ~]# mysqlbinlog -d jack /<span class="keyword">var</span>/lib/mysql/mysql_bin<span class="number">.000033</span> &gt; test.sql</div><div class="line"></div><div class="line"><span class="meta">#发现误删除操作的时间是170308 17:18:29</span></div><div class="line"><span class="meta">#170308 17:18:29 server id 1  end_log_pos 602   Query   thread_id=117   exec_time=0     error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1488964709</span><span class="comment">/*!*/</span>;</div><div class="line">DROP TABLE `yfshare` <span class="comment">/* generated by server */</span></div><div class="line"><span class="comment">/*!*/</span>;</div><div class="line"><span class="meta"># at 602</span></div><div class="line"><span class="meta">#170308 17:24:43 server id 1  end_log_pos 683   Query   thread_id=117   exec_time=0     error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1488965083</span><span class="comment">/*!*/</span>;</div><div class="line">drop database jack</div></pre></td></tr></table></figure>
<p>通过查找binlog发现，我们需要恢复的时间是170308 17:18:29<br>这时候我们就可以恢复了<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#因为找到具体的binlog文件和误删除操作时间，所以我们要把期间所有的操作导成一个sql文件，然后恢复</span></div><div class="line">[root<span class="meta">@host1</span> ~]<span class="comment"># mysqlbinlog -d jack --start-datetime="2017-03-08 17:15:27" /var/lib/mysql/mysql_bin.000032 &gt; recover.sql</span></div><div class="line">[root<span class="meta">@host1</span> ~]<span class="comment"># mysqlbinlog -d jack --stop-datetime="2017-03-08 17:18:29" /var/lib/mysql/mysql_bin.000033 &gt;&gt; recover.sql</span></div><div class="line">mysql&gt; use jack;</div><div class="line">mysql&gt; source ~/recover.sql</div><div class="line">mysql&gt; commit;</div><div class="line">mysql&gt; select <span class="symbol">*</span> from yfshare;</div><div class="line">+------+---------+</div><div class="line">|<span class="string"> id   </span>|<span class="string"> name    </span>|</div><div class="line">+------+---------+</div><div class="line">|<span class="string"> 1    </span>|<span class="string"> jack    </span>|</div><div class="line">|<span class="string"> 2    </span>|<span class="string"> yfshare </span>|</div><div class="line">|<span class="string"> 3    </span>|<span class="string"> tom     </span>|</div><div class="line">|<span class="string"> 4    </span>|<span class="string"> jerry   </span>|</div><div class="line">|<span class="string"> 5    </span>|<span class="string"> bob     </span>|</div><div class="line">|<span class="string"> 6    </span>|<span class="string"> aaa     </span>|</div><div class="line">|<span class="string"> 7    </span>|<span class="string"> bbb     </span>|</div><div class="line">|<span class="string"> 8    </span>|<span class="string"> ccc     </span>|</div><div class="line">|<span class="string"> 9    </span>|<span class="string"> ddd     </span>|</div><div class="line">+------+---------+</div><div class="line">9 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p>OK，恢复成功  </p>
<h2 id="Mysql备份恢复脚本"><a href="#Mysql备份恢复脚本" class="headerlink" title="Mysql备份恢复脚本"></a>Mysql备份恢复脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#mysql备份脚本目录结构</span></div><div class="line">[root@host1 ~]<span class="comment"># tree /backup/mysql_backup/</span></div><div class="line">/backup/mysql_backup/</div><div class="line">├── backup_20170308.log</div><div class="line">├── Full_backup</div><div class="line">│   └── 20170308</div><div class="line">│       ├── all_databases_backup_20170308_17:06:08.sql.gz</div><div class="line">│       └── jack_backup_20170308_17:06:08.sql</div><div class="line">├── Full_backup_time.txt</div><div class="line">├── Inc_backup</div><div class="line">│   └── 20170308</div><div class="line">│       ├── jack_Inc_20170308_17:15:27.sql</div><div class="line">│       └── jack_Inc_20170308_17:15:27.zip</div><div class="line">├── mysql_db.txt</div><div class="line">└── mysql_index.txt</div><div class="line"></div><div class="line">4 directories, 8 files</div><div class="line">[root@host1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line">[root@host1 ~]<span class="comment"># cat mysql_back.sh</span></div><div class="line"><span class="comment">#mysql全量增量备份脚本</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment"># create user 'mysqlback'@'localhost' identified by '123456';</span></div><div class="line"><span class="comment"># grant select,lock tables,reload,super,file,show view on *.* to 'mysqlback'@'localhost' identified by '123456';</span></div><div class="line"><span class="comment"># flush privileges;</span></div><div class="line"><span class="comment"># \q</span></div><div class="line">DATE=`date <span class="string">'+%Y%m%d'</span>`</div><div class="line">DATE_log=`date <span class="string">'+%Y-%m-%d %H:%M:%S'</span>`</div><div class="line">DATE_filename=`date <span class="string">'+%Y%m%d_%H:%M:%S'</span>`</div><div class="line">DATE_backup_time=`date <span class="string">'+%Y-%m-%d %H:%M:%S'</span>`</div><div class="line"></div><div class="line">mysql_host=<span class="string">"192.168.31.110"</span></div><div class="line">mysql_user=<span class="string">"root"</span></div><div class="line">mysql_pass=<span class="string">"123456"</span></div><div class="line"></div><div class="line">Mysql_Backup=<span class="string">"/backup/mysql_backup"</span></div><div class="line">Full_Backup=<span class="string">"<span class="variable">$Mysql_Backup</span>/Full_backup"</span></div><div class="line">Inc_Backup=<span class="string">"<span class="variable">$Mysql_Backup</span>/Inc_backup"</span></div><div class="line">Mysql_index=<span class="string">"<span class="variable">$Mysql_Backup</span>/mysql_index.txt"</span></div><div class="line"></div><div class="line">Mysql_data=<span class="string">"/var/lib/mysql"</span></div><div class="line">Mysql_bin=<span class="string">"/usr/bin"</span></div><div class="line">Mysql_db=<span class="string">"<span class="variable">$Mysql_Backup</span>/mysql_db.txt"</span></div><div class="line">Mysql_logbin_name=<span class="string">"mysql_bin"</span></div><div class="line">Mysql_binlog=<span class="string">"/usr/bin/mysqlbinlog"</span></div><div class="line"></div><div class="line">MYSQL=<span class="string">"/usr/bin/mysql"</span></div><div class="line">MYSQLDUMP=<span class="string">"/usr/bin/mysqldump"</span></div><div class="line">MYSQLADMIN=<span class="string">"/usr/bin/mysqladmin"</span></div><div class="line">SOCKET=<span class="string">"/var/lib/mysql/mysql.sock"</span></div><div class="line"></div><div class="line">Error_log=<span class="string">"<span class="variable">$Mysql_Backup</span>/backup_error_<span class="variable">$&#123;DATE&#125;</span>.log"</span></div><div class="line">Backup_log=<span class="string">"<span class="variable">$Mysql_Backup</span>/backup_<span class="variable">$&#123;DATE&#125;</span>.log"</span></div><div class="line"></div><div class="line">[ ! <span class="_">-d</span> <span class="string">"<span class="variable">$Mysql_Backup</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$Mysql_Backup</span>"</span></div><div class="line">[ ! <span class="_">-d</span> <span class="string">"<span class="variable">$Full_Backup</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$Full_Backup</span>"</span></div><div class="line">[ ! <span class="_">-d</span> <span class="string">"<span class="variable">$Inc_Backup</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$Inc_Backup</span>"</span></div><div class="line"></div><div class="line"><span class="built_in">cd</span> <span class="variable">$Mysql_Backup</span></div><div class="line"><span class="variable">$MYSQL</span> -u<span class="string">"<span class="variable">$mysql_user</span>"</span> -p<span class="string">"<span class="variable">$mysql_pass</span>"</span> -Ne <span class="string">'show databases'</span> | grep -vw <span class="string">'test'</span> | grep -vw <span class="string">'performance_schema'</span> | grep -vw <span class="string">'information_schema'</span> | grep -vw <span class="string">'mysql'</span> &gt; <span class="variable">$Mysql_db</span></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">Full</span></span>() &#123;</div><div class="line"><span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'Full backup of MySQL database... Please wait.\n'</span></div><div class="line"><span class="built_in">cd</span> <span class="variable">$Mysql_Backup</span></div><div class="line">[ ! <span class="_">-d</span> <span class="string">"<span class="variable">$Full_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$Full_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$DATE_backup_time</span>"</span> &gt; <span class="string">"<span class="variable">$Mysql_Backup</span>"</span>/Full_backup_time.txt</div><div class="line"></div><div class="line"><span class="comment">#backup all-databases</span></div><div class="line"><span class="variable">$MYSQLDUMP</span> --flush-logs --quick --opt --master-data=2 --tz-utc=<span class="literal">true</span> --ignore-table=mysql.event -u<span class="string">"<span class="variable">$mysql_user</span>"</span> -p<span class="string">"<span class="variable">$mysql_pass</span>"</span> --all-databases | gzip &gt; <span class="string">"<span class="variable">$Full_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span>/all_databases_backup_<span class="string">"<span class="variable">$DATE_filename</span>"</span>.sql.gz</div><div class="line"><span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">  /bin/logger <span class="string">"[ "</span><span class="variable">$DATE_log</span><span class="string">" ] - Databases all-databases has been backup successful."</span></div><div class="line">  <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"[ "</span><span class="variable">$DATE_log</span><span class="string">" ] - Databases all-databases has been backup successful.\n"</span> &gt;&gt; <span class="string">"<span class="variable">$Backup_log</span>"</span></div><div class="line">  /bin/sleep 5</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment">#Backup a single database</span></div><div class="line">[ ! <span class="_">-s</span> <span class="string">"<span class="variable">$Mysql_db</span>"</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'Error: Backup a single database. Do not back up mysql system database.[test|performance_schema|information_schema|mysql]\n'</span> &amp;&amp; <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'Mysql database full backup success.'</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">for</span> DBNAME <span class="keyword">in</span> `cat <span class="variable">$Mysql_db</span>`</div><div class="line"><span class="keyword">do</span></div><div class="line">  <span class="variable">$MYSQLDUMP</span> --ignore-table=mysql.event --skip-lock-tables --quick --opt --master-data=2 --tz-utc=<span class="literal">true</span> -u<span class="string">"<span class="variable">$mysql_user</span>"</span> -p<span class="string">"<span class="variable">$mysql_pass</span>"</span> -S <span class="string">"<span class="variable">$SOCKET</span>"</span> <span class="string">"<span class="variable">$DBNAME</span>"</span> | gzip &gt; <span class="string">"<span class="variable">$Full_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span>/<span class="string">"<span class="variable">$DBNAME</span>"</span>_backup_<span class="string">"<span class="variable">$DATE_filename</span>"</span>.sql.gz</div><div class="line">  <span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">    /bin/logger <span class="string">"[ "</span><span class="variable">$DATE_log</span><span class="string">" ] - Databases "</span><span class="variable">$&#123;DBNAME&#125;</span><span class="string">" has been backup successful."</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"[ "</span><span class="variable">$DATE_log</span><span class="string">" ] - Databases "</span><span class="variable">$&#123;DBNAME&#125;</span><span class="string">" has been backup successful."</span> &gt;&gt; <span class="string">"<span class="variable">$Backup_log</span>"</span></div><div class="line">    /bin/sleep 5</div><div class="line">  <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'----------------------------------------\n'</span> &gt;&gt; <span class="string">"<span class="variable">$Backup_log</span>"</span></div><div class="line"></div><div class="line"><span class="built_in">cd</span> <span class="variable">$Mysql_Backup</span></div><div class="line">find <span class="string">"<span class="variable">$Full_Backup</span>"</span> -mtime +10 | xargs rm -rf &#123;&#125; \; &amp;&gt; /dev/null</div><div class="line"><span class="built_in">echo</span> <span class="string">'Mysql database full backup success.'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">Inc</span></span>() &#123;</div><div class="line"><span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'Increment backup of MySQL database... Please wait.\n'</span></div><div class="line">[ ! <span class="_">-f</span> <span class="string">"<span class="variable">$Mysql_Backup</span>"</span>/Full_backup_time.txt ] &amp;&amp; <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'Error: Please perform a full backup first. command: sh mysql_back.sh Mysql_Fullbackup'</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line"></div><div class="line">[ ! <span class="_">-s</span> <span class="string">"<span class="variable">$Mysql_db</span>"</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"Error: file <span class="variable">$Mysql_db</span> is empey. There may only be a system database[test|performance_schema|information_schema|mysql]."</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line"></div><div class="line"><span class="built_in">cd</span> <span class="variable">$Mysql_Backup</span></div><div class="line"></div><div class="line"><span class="string">"<span class="variable">$MYSQLADMIN</span>"</span> -u<span class="string">"<span class="variable">$mysql_user</span>"</span> -p<span class="string">"<span class="variable">$mysql_pass</span>"</span> flush-logs</div><div class="line">awk -F<span class="string">'/'</span> <span class="string">'&#123;print $NF&#125;'</span> <span class="string">"<span class="variable">$Mysql_data</span>"</span>/mysql_bin.index &gt; <span class="string">"<span class="variable">$Mysql_index</span>"</span></div><div class="line"></div><div class="line">[ ! <span class="_">-s</span> <span class="string">"<span class="variable">$Mysql_index</span>"</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"Error: Please open the mysql binlog log. The command in the my.cnf file: log_bin=mysql_bin and binlog_format=Mixed"</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line">[ ! <span class="_">-d</span> <span class="string">"<span class="variable">$Inc_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$Inc_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span></div><div class="line"></div><div class="line">DATE_starttime=`cat <span class="string">"<span class="variable">$Mysql_Backup</span>"</span>/Full_backup_time.txt`</div><div class="line">start=<span class="string">'--start-datetime'</span></div><div class="line"><span class="keyword">for</span> DBNAME <span class="keyword">in</span> `cat <span class="variable">$Mysql_db</span>`</div><div class="line"><span class="keyword">do</span></div><div class="line">  <span class="keyword">for</span> index <span class="keyword">in</span> `cat <span class="variable">$Mysql_index</span>`</div><div class="line">  <span class="keyword">do</span></div><div class="line">    <span class="string">"<span class="variable">$Mysql_binlog</span>"</span> -u<span class="string">"<span class="variable">$mysql_user</span>"</span> -p<span class="string">"<span class="variable">$mysql_pass</span>"</span> <span class="_">-d</span> <span class="string">"<span class="variable">$DBNAME</span>"</span> <span class="string">"<span class="variable">$start</span>"</span>=<span class="string">"<span class="variable">$DATE_starttime</span>"</span> <span class="string">"<span class="variable">$Mysql_data</span>"</span>/<span class="string">"<span class="variable">$index</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$Inc_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span>/<span class="string">"<span class="variable">$DBNAME</span>"</span>_Inc_<span class="string">"<span class="variable">$DATE_filename</span>"</span>.sql</div><div class="line">    /bin/sleep 1</div><div class="line">  <span class="keyword">done</span></div><div class="line">  <span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">      <span class="built_in">cd</span> <span class="string">"<span class="variable">$Inc_Backup</span>"</span>/<span class="string">"<span class="variable">$DATE</span>"</span></div><div class="line">      /usr/bin/zip -q <span class="string">"<span class="variable">$DBNAME</span>"</span>_Inc_<span class="string">"<span class="variable">$DATE_filename</span>"</span>.zip <span class="string">"<span class="variable">$DBNAME</span>"</span>_Inc_<span class="string">"<span class="variable">$DATE_filename</span>"</span>.sql</div><div class="line">      /bin/logger <span class="string">"[ "</span><span class="variable">$DATE_log</span><span class="string">" ] - Databases "</span><span class="variable">$&#123;DBNAME&#125;</span><span class="string">" has been Inc_backup successful."</span></div><div class="line">      <span class="built_in">echo</span> <span class="string">"[ "</span><span class="variable">$DATE_log</span><span class="string">" ] - Databases "</span><span class="variable">$&#123;DBNAME&#125;</span><span class="string">" has been Inc_backup successful."</span> &gt;&gt; <span class="string">"<span class="variable">$Backup_log</span>"</span></div><div class="line">      rm -rf <span class="string">"<span class="variable">$DBNAME</span>"</span>_Inc_<span class="string">"<span class="variable">$DATE_filename</span>"</span>.sql</div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="built_in">echo</span> <span class="_">-e</span> <span class="string">'----------------------------------------\n'</span> &gt;&gt; <span class="string">"<span class="variable">$Backup_log</span>"</span></div><div class="line"><span class="built_in">cd</span> <span class="variable">$Mysql_Backup</span></div><div class="line">find <span class="string">"<span class="variable">$Inc_Backup</span>"</span> -mtime +10 | xargs rm -rf &#123;&#125; \; &amp;&gt; /dev/null</div><div class="line"><span class="built_in">echo</span> <span class="string">'Mysql database Increment backup success.'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span> </div><div class="line">	Mysql_Fullbackup)</div><div class="line">		Full;;</div><div class="line">	Mysql_Incbackup)</div><div class="line">		Inc;;</div><div class="line">	*)</div><div class="line">		<span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"Usage: please input Mysql_Fullbackup|Mysql_Incbackup\n"</span>;;</div><div class="line"><span class="keyword">esac</span></div><div class="line">[root@host1 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="https://yfshare.github.io">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="https://yfshare.github.io/2017/03/08/Mysql备份恢复/">https://yfshare.github.io/2017/03/08/Mysql备份恢复/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a data-url="https://yfshare.github.io/2017/03/08/Mysql备份恢复/" data-id="cj27jjpce001dbkm51oqlco42" class="article-share-link">分享到</a><div class="tags"><a href="/tags/mysql/">mysql</a><a href="/tags/mysql备份恢复/">mysql备份恢复</a></div><div class="post-nav"><a href="/2017/03/11/Ansible-Playbooks之安装Nginx/" class="pre">Ansible-Playbooks之安装Nginx</a><a href="/2017/03/07/部署Ansible-Tower/" class="next">部署Ansible Tower</a></div><div data-thread-key="2017/03/08/Mysql备份恢复/" data-title="Mysql备份恢复" data-url="https://yfshare.github.io/2017/03/08/Mysql备份恢复/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/03/08/Mysql备份恢复/" data-title="Mysql备份恢复" data-url="https://yfshare.github.io/2017/03/08/Mysql备份恢复/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/oracle/">oracle</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/RSS/" style="font-size: 15px;">RSS</a> <a href="/tags/ansible/" style="font-size: 15px;">ansible</a> <a href="/tags/LNMP/" style="font-size: 15px;">LNMP</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Zabbix/" style="font-size: 15px;">Zabbix</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/Modules/" style="font-size: 15px;">Modules</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/analytics/" style="font-size: 15px;">analytics</a> <a href="/tags/maupassant/" style="font-size: 15px;">maupassant</a> <a href="/tags/多说/" style="font-size: 15px;">多说</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/domain/" style="font-size: 15px;">domain</a> <a href="/tags/B站/" style="font-size: 15px;">B站</a> <a href="/tags/html5/" style="font-size: 15px;">html5</a> <a href="/tags/404/" style="font-size: 15px;">404</a> <a href="/tags/Template/" style="font-size: 15px;">Template</a> <a href="/tags/music/" style="font-size: 15px;">music</a> <a href="/tags/video/" style="font-size: 15px;">video</a> <a href="/tags/版权说明/" style="font-size: 15px;">版权说明</a> <a href="/tags/oracle/" style="font-size: 15px;">oracle</a> <a href="/tags/RMAN/" style="font-size: 15px;">RMAN</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/mysql备份恢复/" style="font-size: 15px;">mysql备份恢复</a> <a href="/tags/zabbix/" style="font-size: 15px;">zabbix</a> <a href="/tags/wechat/" style="font-size: 15px;">wechat</a> <a href="/tags/warn/" style="font-size: 15px;">warn</a> <a href="/tags/Grafana/" style="font-size: 15px;">Grafana</a> <a href="/tags/GitHub/" style="font-size: 15px;">GitHub</a> <a href="/tags/control/" style="font-size: 15px;">control</a> <a href="/tags/Ansible/" style="font-size: 15px;">Ansible</a> <a href="/tags/Tower/" style="font-size: 15px;">Tower</a> <a href="/tags/RAC/" style="font-size: 15px;">RAC</a> <a href="/tags/Graphtree/" style="font-size: 15px;">Graphtree</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/29/部署Grafana数据展示系统/">部署Grafana数据展示系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/13/Zabbix之微信-Wechat-告警/">Zabbix之微信(Wechat)告警</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/12/部署Oracle-RAC集群/">部署Oracle-RAC集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/05/Ansible常用模块/">Ansible常用模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/Ansible-Playbooks之安装Zabbix/">Ansible-Playbooks之安装Zabbix</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/Ansible-Playbooks之安装LNMP/">Ansible-Playbooks之安装LNMP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/16/Ansible-Playbooks之安装Mysql/">Ansible-Playbooks之安装Mysql</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/16/Ansible Template处理含特殊字符的文件/">Ansible Template处理含特殊字符的文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/Ansible-Playbooks之安装PHP/">Ansible-Playbooks之安装PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/Ansible-Playbooks之安装Nginx/">Ansible-Playbooks之安装Nginx</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yfshare.blog.51cto.com/" title="酱油瓶 博客" target="_blank">酱油瓶 博客</a><ul></ul><a href="http://zerosre.com/" title="龙哥zero 博客" target="_blank">龙哥zero 博客</a><ul></ul><a href="http://renzhiyuan.blog.51cto.com/" title="任志远Ray 博客" target="_blank">任志远Ray 博客</a><ul></ul><a href="http://www.yunxing.org/" title="疯子 博客" target="_blank">疯子 博客</a><ul></ul><a href="http://securityit.cn/" title="万马奔腾" target="_blank">万马奔腾</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-resources"> 资源站</i></div><ul></ul><a href="http://mirror.symnds.com/distributions/CentOS-vault/" title="Centos镜像站" target="_blank">Centos镜像站</a><ul></ul><a href="http://www.rpmfind.net/" title="rpmfind mirror" target="_blank">rpmfind mirror</a><ul></ul><a href="http://rpm.org/" title="rpm.org" target="_blank">rpm.org</a><ul></ul><a href="http://rpm.pbone.net/" title="rpm search" target="_blank">rpm search</a><ul></ul><a href="http://download.chinaunix.net/" title="chinaunix download" target="_blank">chinaunix download</a><ul></ul><a href="http://www.anquanquan.info/" title="安全圈info" target="_blank">安全圈info</a><ul></ul><a href="http://source.tosimp.net/" title="Tosimp 资源站" target="_blank">Tosimp 资源站</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=371362&auto=1&height=66"></iframe><div class="widget"><div class="widget-title"><i class="fa fa-external-game"> 游戏</i></div><ul></ul><a href="/2048" title="2048小游戏" target="_blank">2048小游戏</a><ul></ul><a href="/tantanqiu" title="变色弹球跳台阶小游戏" target="_blank">变色弹球跳台阶小游戏</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Jack Wang Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=1.0.0"><script>var duoshuoQuery = {short_name:'yfshare'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3890bdc1bfaccae9364479b65f36fbd2";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Blog"><title>部署FileBeat+logstash+elasticsearch集群+kibana | Jack Wang Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">部署FileBeat+logstash+elasticsearch集群+kibana</h1><a id="logo" href="/.">Jack Wang Blog</a><p class="description">Goals determine what you are going to be</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">部署FileBeat+logstash+elasticsearch集群+kibana</h1><div class="post-meta">Nov 4, 2017<span> | </span><span class="category"><a href="/categories/ELK/">ELK</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/" href="/2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境部署"><span class="toc-number">1.</span> <span class="toc-text">环境部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">2.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-filebeart"><span class="toc-number">2.1.</span> <span class="toc-text">配置 filebeart</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-logstash"><span class="toc-number">2.2.</span> <span class="toc-text">配置 logstash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-elasticsearch集群"><span class="toc-number">2.3.</span> <span class="toc-text">配置 elasticsearch集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Kibana"><span class="toc-number">2.4.</span> <span class="toc-text">配置 Kibana</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置nginx"><span class="toc-number">2.5.</span> <span class="toc-text">配置nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动服务"><span class="toc-number">2.6.</span> <span class="toc-text">启动服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#logstash-服务启动日志"><span class="toc-number">2.6.1.</span> <span class="toc-text">logstash 服务启动日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#filebeat-服务启动日志"><span class="toc-number">2.6.2.</span> <span class="toc-text">filebeat 服务启动日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#elasticsearch-服务启动日志"><span class="toc-number">2.6.3.</span> <span class="toc-text">elasticsearch 服务启动日志</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看-elasticsearch-集群状态"><span class="toc-number">2.7.</span> <span class="toc-text">查看 elasticsearch 集群状态</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#获取集群中节点列表"><span class="toc-number">2.7.1.</span> <span class="toc-text">获取集群中节点列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#集群健康检查"><span class="toc-number">2.7.2.</span> <span class="toc-text">集群健康检查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#获取ElasticSearch索引"><span class="toc-number">2.7.3.</span> <span class="toc-text">获取ElasticSearch索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#本机节点查询"><span class="toc-number">2.7.4.</span> <span class="toc-text">本机节点查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#节点状态"><span class="toc-number">2.7.5.</span> <span class="toc-text">节点状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#获取集群健康状况"><span class="toc-number">2.7.6.</span> <span class="toc-text">获取集群健康状况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#集群状态"><span class="toc-number">2.7.7.</span> <span class="toc-text">集群状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#kibana-状态"><span class="toc-number">2.7.8.</span> <span class="toc-text">kibana 状态</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>ELK由Elasticsearch、Logstash和Kibana三部分组件组成，这里新增了一个FileBeat，它是一个轻量级的日志收集处理工具(Agent)，Filebeat占用资源少，适合于在各个服务器上搜集日志后传输给Logstash，官方也推荐此工具<br><a id="more"></a><br>Filebeat隶属于Beats。目前Beats包含四种工具：  </p>
<ol>
<li>Packetbeat（搜集网络流量数据）  </li>
<li>Topbeat（搜集系统、进程和文件系统级别的 CPU 和内存使用情况等数据）</li>
<li>Filebeat（搜集文件数据）</li>
<li>Winlogbeat（搜集 Windows 事件日志数据）</li>
</ol>
<p>官方文档<br>Filebeat：<br><a href="https://www.elastic.co/cn/products/beats/filebeat" target="_blank" rel="external">https://www.elastic.co/cn/products/beats/filebeat</a><br><a href="https://www.elastic.co/guide/en/beats/filebeat/5.6/index.html" target="_blank" rel="external">https://www.elastic.co/guide/en/beats/filebeat/5.6/index.html</a>  </p>
<p>Logstash：<br><a href="https://www.elastic.co/cn/products/logstash" target="_blank" rel="external">https://www.elastic.co/cn/products/logstash</a><br><a href="https://www.elastic.co/guide/en/logstash/5.6/index.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.6/index.html</a></p>
<p>Elasticsearch：<br><a href="https://www.elastic.co/cn/products/elasticsearch" target="_blank" rel="external">https://www.elastic.co/cn/products/elasticsearch</a><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/index.html" target="_blank" rel="external">https://www.elastic.co/guide/en/elasticsearch/reference/5.6/index.html</a>  </p>
<p>elasticsearch中文社区：<br><a href="https://elasticsearch.cn/" target="_blank" rel="external">https://elasticsearch.cn/</a> </p>
<p>官方ELK架构图：<br><img src="http://note.youdao.com/yws/api/personal/file/DCE29CF684C34FC3BA73809D566B0150?method=download&amp;shareKey=798f64543357202a0efb9a95d35c4e5b" alt="filebeat">  </p>
<p>本次环境的拓扑图：<br><img src="http://note.youdao.com/yws/api/personal/file/4772759A56704D82A3D1C6056C76613F?method=download&amp;shareKey=3c9825a509086b1a28b8ffd34aa9c6b0" alt="ELK_拓扑图">  </p>
<p>环境：<br>　　　Centos 7.3<br>　　　Filebeat 5.6.1<br>　　　Logstash 5.6.1<br>　　　Kibana 5.6.1  </p>
<p>软件下载：<br><a href="http://note.youdao.com/yws/api/personal/file/09E0C74E473348FA8DCBDB96F3AEE13D?method=download&amp;shareKey=9d9dc334d3d6c72613c00359372887a9" target="_blank" rel="external">filebeat-5.6.1-x86_64.rpm</a><br><a href="http://note.youdao.com/yws/api/personal/file/85468EC34C484B3F8D2B0AF3B7386841?method=download&amp;shareKey=e00a03bcfbc3d4b63c419ab1139a8765" target="_blank" rel="external">kibana-5.6.1-x86_64.rpm</a><br><a href="http://note.youdao.com/yws/api/personal/file/3D218AEF94474D4A9BC755B4AAADFE0B?method=download&amp;shareKey=3f79c453a9993cd899f38420983db94e" target="_blank" rel="external">logstash-5.6.1.rpm</a><br><a href="http://note.youdao.com/yws/api/personal/file/430B5F758002423A92C9023EF656C1E5?method=download&amp;shareKey=7507f90e005394aff511356bd60fc28e" target="_blank" rel="external">elasticsearch-5.6.1.rpm</a>  </p>
<h3 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#环境部署（安装）</span></div><div class="line"><span class="comment">#每台机器上都需要安装JDK</span></div><div class="line">[root@DevEVN-21 ~]<span class="comment"># curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.6.1-x86_64.rpm</span></div><div class="line">[root@DevEVN-21 ~]<span class="comment"># rpm -ivh filebeat-5.6.1-x86_64.rpm</span></div><div class="line">[root@DevEVN-21 ~]<span class="comment"># rpm -qa | grep -i filebeat</span></div><div class="line">filebeat-5.6.1-1.x86_64</div><div class="line">[root@DevEVN-21 ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@ELK-test software]<span class="comment"># wget https://artifacts.elastic.co/downloads/logstash/logstash-5.6.1.rpm</span></div><div class="line">[root@ELK-test software]<span class="comment"># wget http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gz?AuthParam=1505893074_6e8dfac4ee1e712087b65acabe8b2506 -O jdk-8u144-linux-x64.tar.gz</span></div><div class="line">[root@ELK-test software]<span class="comment"># tar -zxf jdk-8u144-linux-x64.tar.gz  -C /usr/local/</span></div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div><div class="line">[root@ELK-test ~]<span class="comment"># cat /etc/profile.d/java.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=<span class="string">'/usr/local/jdk1.8.0_144'</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line">[root@ELK-test ~]<span class="comment"># source /etc/profile.d/java.sh</span></div><div class="line">[root@ELK-test ~]<span class="comment"># java -version</span></div><div class="line">java version <span class="string">"1.8.0_144"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_144-b01)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)</div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div><div class="line">[root@ELK-test software]<span class="comment"># rpm -ivh logstash-5.6.1.rpm</span></div><div class="line">[root@ELK-test software]<span class="comment"># rpm -qa | grep logstash</span></div><div class="line">logstash-5.6.1-1.noarch</div><div class="line">[root@ELK-test software]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@ELK-test software]<span class="comment"># wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.1.rpm</span></div><div class="line">[root@ELK-test software]<span class="comment"># yum install elasticsearch-5.6.1.rpm</span></div><div class="line">[root@ELK-test software]<span class="comment"># rpm -qa | grep elasticsearch</span></div><div class="line">elasticsearch-5.6.1-1.noarch</div><div class="line">[root@ELK-test software]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@ELK-test software]<span class="comment"># wget https://artifacts.elastic.co/downloads/kibana/kibana-5.6.1-x86_64.rpm</span></div><div class="line">[root@ELK-test software]<span class="comment"># rpm -ivh kibana-5.6.1-x86_64.rpm</span></div><div class="line">[root@ELK-test software]<span class="comment"># rpm -qa | grep kibana</span></div><div class="line">kibana-5.6.1-1.x86_64</div><div class="line">[root@ELK-test software]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@ELK-test ~]<span class="comment"># ll /data/ELK_data/*</span></div><div class="line">/data/ELK_data/elasticsearch:</div><div class="line">total 8</div><div class="line">drwxr-xr-x. 3 elasticsearch elasticsearch 4096 Sep 22 17:25 data</div><div class="line">drwxr-xr-x. 2 elasticsearch elasticsearch 4096 Oct 19 19:54 logs</div><div class="line"></div><div class="line">/data/ELK_data/kibana:</div><div class="line">total 8</div><div class="line">drwxr-xr-x. 2 kibana kibana 4096 Sep 22 16:50 data</div><div class="line">drwxr-xr-x. 2 kibana kibana 4096 Sep 22 16:50 logs</div><div class="line"></div><div class="line">/data/ELK_data/logstash:</div><div class="line">total 8</div><div class="line">drwxr-xr-x. 4 logstash logstash 4096 Oct 19 19:51 data_192.168.1.21</div><div class="line">drwxr-xr-x. 2 logstash logstash 4096 Oct 19 17:41 logs</div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="配置-filebeart"><a href="#配置-filebeart" class="headerlink" title="配置 filebeart"></a>配置 filebeart</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#配置filebeart</span></div><div class="line">[root@DevEVN-21 ~]<span class="comment"># grep -iv '#' /etc/filebeat/filebeat.yml | grep -iv '^$'</span></div><div class="line">filebeat.prospectors:</div><div class="line">- input_type: <span class="built_in">log</span>  <span class="comment">#指定文件的输入类型log(默认)或者stdin</span></div><div class="line">  paths:   <span class="comment">#指定要监控的日志，目前按照Go语言的glob函数处理，没有对配置目录做递归处理，如果指定的文件为/var/log/*.log的话，会读取该目录下所有以log结尾的文件，但是这样不好，在logstash上不好处理，会写到一个文件内，kibana显示会很乱，建议分开写</span></div><div class="line">    - /data/soros/logs/soros-account-service-error.log      <span class="comment">#指定filebeat读取的文件（绝对路径）</span></div><div class="line">  document_type: 192.168.1.21-account_errorlog   <span class="comment">#设定Elasticsearch输出时的document的type字段，也可以用来给日志进行分类</span></div><div class="line"></div><div class="line">- input_type: <span class="built_in">log</span></div><div class="line">  paths:</div><div class="line">    - /data/soros/logs/soros-account-service.log</div><div class="line">  document_type: 192.168.1.21-account_log</div><div class="line"></div><div class="line">output.logstash:</div><div class="line">  hosts: [<span class="string">"192.168.1.41:5044"</span>]     <span class="comment">#指定logstash服务器地址及端口，可以指定多个logstash</span></div><div class="line">[root@DevEVN-21 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>参考：<a href="http://blog.csdn.net/xiongzhichao/article/details/51783704" target="_blank" rel="external">Filebeat的高级配置</a><br><a href="http://www.cnblogs.com/zlslch/p/6622079.html" target="_blank" rel="external">filebeat.yml配置详解</a><br><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-elk-filebeat/index.html" target="_blank" rel="external">ELK+Filebeat 集中式日志解决方案详解</a>  </p>
<h4 id="配置-logstash"><a href="#配置-logstash" class="headerlink" title="配置 logstash"></a>配置 logstash</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">[root@ELK-test ~]<span class="comment"># grep -iv '#' /etc/logstash/logstash.yml | grep -iv '^$'</span></div><div class="line">path.data: /data/ELK_data/logstash/data</div><div class="line">path.config: /etc/logstash/conf.d</div><div class="line">http.host: <span class="string">"0.0.0.0"</span></div><div class="line">path.logs: /data/ELK_data/logstash/logs</div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#配置logstash</span></div><div class="line">[root@ELK-test ~]<span class="comment"># grep -iv '#' /etc/logstash/conf.d/logstash_192.168.1.21.conf | grep -iv '^$'</span></div><div class="line"><span class="comment">#指定logstash监听filebeat的端口</span></div><div class="line">input &#123;</div><div class="line">  beats &#123;</div><div class="line">    port =&gt; 5044</div><div class="line">    codec =&gt; multiline &#123;</div><div class="line">         pattern =&gt; <span class="string">"^%&#123;YEAR&#125;[/-]%&#123;MONTHNUM&#125;[/-]%&#123;MONTHDAY&#125;[/_]%&#123;TIME&#125; "</span></div><div class="line">         negate =&gt; <span class="literal">true</span></div><div class="line">         what =&gt; previous</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">#pattern：多行日志开始的那一行匹配的</span></div><div class="line"><span class="comment">#pattern negate：是否需要对pattern条件转置使用，不翻转设为true，反转设置为false</span></div><div class="line"><span class="comment">#match：匹配pattern后，与前面(后面)的内容合并为一条日志</span></div><div class="line"><span class="comment">#max_lines：合并的最多行数(包含匹配pattern的那一行)，到了timeout之后，即使没有匹配一个新的pattern（发生一个新的事件），也把已经匹配的日志事件发送出去</span></div><div class="line"></div><div class="line"><span class="comment">#output测试输出到控制台</span></div><div class="line">output &#123;</div><div class="line"><span class="comment">#program logs</span></div><div class="line">    <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">'192.168.1.21-account_errorlog'</span>&#123;        <span class="comment">#'192.168.1.21-account_errorlog'为filebeat配置中由document_type定义的</span></div><div class="line">        elasticsearch &#123;          <span class="comment">#输出到elasticsearch中</span></div><div class="line">                hosts =&gt; [<span class="string">"192.168.1.41:9200"</span>,<span class="string">"192.168.1.42:9200"</span>,<span class="string">"192.168.1.43:9200"</span>]       <span class="comment">#指定elasticsearch主机</span></div><div class="line">		index =&gt; <span class="string">"%&#123;type&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">		document_type =&gt; <span class="string">"log"</span>       <span class="comment">#设定Elasticsearch输出时的document的type字段，也可以用来给日志进行分类</span></div><div class="line">		template_overwrite =&gt; <span class="literal">true</span>       <span class="comment">#如果设置为true，模板名字一样的时候，新的模板会覆盖旧的模板</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">'192.168.1.21-account_log'</span>&#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                hosts =&gt; [<span class="string">"192.168.1.41:9200"</span>,<span class="string">"192.168.1.42:9200"</span>,<span class="string">"192.168.1.43:9200"</span>]</div><div class="line">		index =&gt; <span class="string">"%&#123;type&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">		document_type =&gt; <span class="string">"log"</span></div><div class="line">		template_overwrite =&gt; <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div><div class="line"></div><div class="line">其他机器的logstash配置同上</div></pre></td></tr></table></figure>
<p>参考：<a href="http://blog.csdn.net/shudaqi2010/article/details/53941389" target="_blank" rel="external">Elasticsearch之<em>default</em>—— 为索引添加默认映射</a><br><a href="http://blog.chinaunix.net/uid-532511-id-4845841.html" target="_blank" rel="external">logstash 多行数据合并 &amp; 日志时间字段解析</a>  </p>
<h4 id="配置-elasticsearch集群"><a href="#配置-elasticsearch集群" class="headerlink" title="配置 elasticsearch集群"></a>配置 elasticsearch集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Julend_es1 节点</span></div><div class="line">[root@ELK-test ~]<span class="comment"># grep -iv '#' /etc/elasticsearch/elasticsearch.yml | grep -iv '^$'</span></div><div class="line">cluster.name: <span class="string">"Julend_ES-cluster"</span></div><div class="line">node.name: Julend_es1</div><div class="line">node.data: <span class="literal">true</span></div><div class="line">http.enabled: <span class="literal">true</span></div><div class="line">path.data: /data/ELK_data/elasticsearch/data</div><div class="line">path.logs: /data/ELK_data/elasticsearch/logs</div><div class="line">network.host: 0.0.0.0</div><div class="line">http.port: 9200</div><div class="line">http.cors.enabled: <span class="literal">true</span></div><div class="line">http.cors.allow-origin: <span class="string">"*"</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.1.41"</span>, <span class="string">"192.168.1.42"</span>, <span class="string">"192.168.1.43"</span>]</div><div class="line">discovery.zen.minimum_master_nodes: 3</div><div class="line">gateway.recover_after_nodes: 2</div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Julend_es2 节点</span></div><div class="line">[root@ELK-test2 ~]<span class="comment"># grep -iv '#' /etc/elasticsearch/elasticsearch.yml | grep -iv '^$'</span></div><div class="line">cluster.name: <span class="string">"Julend_ES-cluster"</span></div><div class="line">node.name: Julend_es2</div><div class="line">node.data: <span class="literal">true</span></div><div class="line">http.enabled: <span class="literal">true</span></div><div class="line">path.data: /data/ELK_data/elasticsearch/data</div><div class="line">path.logs: /data/ELK_data/elasticsearch/logs</div><div class="line">network.host: 0.0.0.0</div><div class="line">http.port: 9200</div><div class="line">http.cors.enabled: <span class="literal">true</span></div><div class="line">http.cors.allow-origin: <span class="string">"*"</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.1.41"</span>, <span class="string">"192.168.1.42"</span>, <span class="string">"193.168.1.43"</span>]</div><div class="line">discovery.zen.minimum_master_nodes: 3</div><div class="line">gateway.recover_after_nodes: 2</div><div class="line">[root@ELK-test2 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Julend_es3 节点</span></div><div class="line">[root@ELK-test3 ~]<span class="comment"># grep -iv '#' /etc/elasticsearch/elasticsearch.yml | grep -iv '^$'</span></div><div class="line">cluster.name: <span class="string">"Julend_ES-cluster"</span></div><div class="line">node.name: Julend_es3</div><div class="line">node.data: <span class="literal">true</span></div><div class="line">http.enabled: <span class="literal">true</span></div><div class="line">path.data: /data/ELK_data/elasticsearch/data</div><div class="line">path.logs: /data/ELK_data/elasticsearch/logs</div><div class="line">network.host: 0.0.0.0</div><div class="line">http.port: 9200</div><div class="line">http.cors.enabled: <span class="literal">true</span></div><div class="line">http.cors.allow-origin: <span class="string">"*"</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.1.41"</span>, <span class="string">"192.168.1.42"</span>,<span class="string">"192.168.1.43"</span>]</div><div class="line">discovery.zen.minimum_master_nodes: 3</div><div class="line">gateway.recover_after_nodes: 2</div><div class="line">[root@ELK-test3 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>参考：<a href="http://blog.csdn.net/shudaqi2010/article/details/53941389" target="_blank" rel="external">http://blog.csdn.net/shudaqi2010/article/details/53941389</a><br><a href="http://blog.chinaunix.net/uid-532511-id-4854331.html" target="_blank" rel="external">http://blog.chinaunix.net/uid-532511-id-4854331.html</a><br><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html" target="_blank" rel="external">https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html</a>  </p>
<h4 id="配置-Kibana"><a href="#配置-Kibana" class="headerlink" title="配置 Kibana"></a>配置 Kibana</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#kibana只是一个WEB GUI展示工具，数据均存储在elasticsearch中，故登陆任何一台kibana看到的数据都一样</span></div><div class="line"><span class="comment">#kibana1配置：</span></div><div class="line">[root@ELK-test ~]<span class="comment"># grep -iv '#' /etc/kibana/kibana.yml | grep -iv '^$'</span></div><div class="line">server.port: 5601</div><div class="line">server.host: <span class="string">"192.168.1.41"</span></div><div class="line">server.name: <span class="string">"Julend_Kibana"</span></div><div class="line">elasticsearch.url: <span class="string">"http://192.168.1.42:9200"</span></div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#kibana2配置：</span></div><div class="line">[root@ELK-test2 ~]<span class="comment"># grep -iv '#' /etc/kibana/kibana.yml | grep -iv '^$'</span></div><div class="line">server.port: 5601</div><div class="line">server.host: <span class="string">"192.168.1.42"</span></div><div class="line">elasticsearch.url: <span class="string">"http://192.168.1.42:9200"</span></div><div class="line">[root@ELK-test2 ~]<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#kibana3配置：</span></div><div class="line">[root@ELK-test3 ~]<span class="comment"># grep -iv '#' /etc/kibana/kibana.yml | grep -iv '^$'</span></div><div class="line">server.port: 5601</div><div class="line">server.host: <span class="string">"192.168.1.43"</span></div><div class="line">elasticsearch.url: <span class="string">"http://192.168.1.43:9200"</span></div><div class="line">[root@ELK-test3 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>参考：<a href="http://blog.csdn.net/ming_311/article/details/50619859" target="_blank" rel="external">Kibana基本使用</a><br><a href="https://segmentfault.com/a/1190000002972420" target="_blank" rel="external">ELK：kibana使用的lucene查询语法</a><br><a href="http://www.ttlsa.com/elk/elk-kibana-query-and-filter/" target="_blank" rel="external">ELK kibana查询与过滤</a><br><a href="http://blog.csdn.net/caisini_vc/article/details/53377756" target="_blank" rel="external">Lucene查询语法详解（Lucene query syntax）- 用于Kibana搜索语句</a>  </p>
<h4 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#nginx配置</span></div><div class="line">[root@nginx ~]<span class="comment"># cat /etc/nginx/conf.d/192.168.1.41-43.conf </span></div><div class="line">server &#123;</div><div class="line">	listen       443;</div><div class="line">	server_name  domain_name;</div><div class="line">	ssl on;</div><div class="line">	include conf.d/ssl_conf;</div><div class="line"></div><div class="line">	access_log  /var/<span class="built_in">log</span>/kibana/access.log main;</div><div class="line">	error_log /var/<span class="built_in">log</span>/kibana/error.log;</div><div class="line"></div><div class="line">	location / &#123;</div><div class="line">	auth_basic <span class="string">"Restricted"</span>;</div><div class="line">	auth_basic_user_file /etc/nginx/conf.d/.site_kibana_pass;</div><div class="line">	proxy_pass http://testelk;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">	listen 80;</div><div class="line">	server_name domain_name;</div><div class="line">	rewrite ^/(.*)$ https://domain_name permanent;</div><div class="line">&#125;</div><div class="line"></div><div class="line">upstream domain_name &#123;</div><div class="line">	ip_hash;</div><div class="line">	server 192.168.1.41:5601 max_fails=4 fail_timeout=20s weight=4;</div><div class="line">	server 192.168.1.42:5601 max_fails=4 fail_timeout=20s weight=4;</div><div class="line">	server 192.168.1.43:5601 max_fails=4 fail_timeout=20s weight=4;</div><div class="line">&#125;</div><div class="line">[root@nginx ~]<span class="comment">#</span></div><div class="line"></div><div class="line">[root@nginx ~]<span class="comment"># nginx -t</span></div><div class="line">[root@nginx ~]<span class="comment"># nginx -s reload</span></div></pre></td></tr></table></figure>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@DevEVN-21 ~]<span class="comment"># systemctl enable filebeat</span></div><div class="line">[root@DevEVN-21 ~]<span class="comment"># systemctl start filebeat</span></div><div class="line"></div><div class="line">[root@ELK-test ~]<span class="comment"># /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/conf.d/logstash_192.168.1.21.conf --path.data /data/ELK_data/logstash/data_192.168.1.21</span></div><div class="line">Sending Logstash<span class="string">'s logs to /data/ELK_data/logstash/logs which is now configured via log4j2.properties</span></div><div class="line">...</div><div class="line">[root@ELK-test ~]#</div><div class="line"></div><div class="line">#启动三台elasticsearch</div><div class="line">[root@ELK-test ~]# systemctl enable elasticsearch</div><div class="line">[root@ELK-test ~]# systemctl start elasticsearch</div><div class="line"></div><div class="line">[root@ELK-test ~]# systemctl enable kibana</div><div class="line">[root@ELK-test ~]# systemctl start kibana</div></pre></td></tr></table></figure>
<h5 id="logstash-服务启动日志"><a href="#logstash-服务启动日志" class="headerlink" title="logstash 服务启动日志"></a>logstash 服务启动日志</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># tail -f /data/ELK_data/logstash/logs/logstash-plain.log </span></div><div class="line">[2017-10-19T16:35:07,048][INFO ][logstash.outputs.elasticsearch] Running health check to see <span class="keyword">if</span> an Elasticsearch connection is working &#123;:healthcheck_url=&gt;http://localhost:9</div><div class="line">200/, :path=&gt;<span class="string">"/"</span>&#125;[2017-10-19T16:35:07,146][WARN ][logstash.outputs.elasticsearch] Restored connection to ES instance &#123;:url=&gt;<span class="string">"http://localhost:9200/"</span>&#125;</div><div class="line">[2017-10-19T16:35:07,148][INFO ][logstash.outputs.elasticsearch] Using mapping template from &#123;:path=&gt;nil&#125;</div><div class="line">[2017-10-19T16:35:07,188][INFO ][logstash.outputs.elasticsearch] Attempting to install template &#123;:manage_template=&gt;&#123;<span class="string">"template"</span>=&gt;<span class="string">"logstash-*"</span>, <span class="string">"version"</span>=&gt;50001, <span class="string">"settings"</span>=&gt;</div><div class="line">&#123;<span class="string">"index.refresh_interval"</span>=&gt;<span class="string">"5s"</span>&#125;, <span class="string">"mappings"</span>=&gt;&#123;<span class="string">"_default_"</span>=&gt;&#123;<span class="string">"_all"</span>=&gt;&#123;<span class="string">"enabled"</span>=&gt;<span class="literal">true</span>, <span class="string">"norms"</span>=&gt;<span class="literal">false</span>&#125;, <span class="string">"dynamic_templates"</span>=&gt;[&#123;<span class="string">"message_field"</span>=&gt;&#123;<span class="string">"path_match"</span>=&gt;<span class="string">"message"</span>, <span class="string">"match_mapping_type"</span>=&gt;<span class="string">"string"</span>, <span class="string">"mapping"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"text"</span>, <span class="string">"norms"</span>=&gt;<span class="literal">false</span>&#125;&#125;&#125;, &#123;<span class="string">"string_fields"</span>=&gt;&#123;<span class="string">"match"</span>=&gt;<span class="string">"*"</span>, <span class="string">"match_mapping_type"</span>=&gt;<span class="string">"string"</span>, <span class="string">"mapping"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"text"</span>, <span class="string">"norms"</span>=&gt;<span class="literal">false</span>, <span class="string">"fields"</span>=&gt;&#123;<span class="string">"keyword"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"keyword"</span>, <span class="string">"ignore_above"</span>=&gt;256&#125;&#125;&#125;&#125;&#125;], <span class="string">"properties"</span>=&gt;&#123;<span class="string">"@timestamp"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"date"</span>, <span class="string">"include_in_all"</span>=&gt;<span class="literal">false</span>&#125;, <span class="string">"@version"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"keyword"</span>, <span class="string">"include_in_all"</span>=&gt;<span class="literal">false</span>&#125;, <span class="string">"geoip"</span>=&gt;&#123;<span class="string">"dynamic"</span>=&gt;<span class="literal">true</span>, <span class="string">"properties"</span>=&gt;&#123;<span class="string">"ip"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"ip"</span>&#125;, <span class="string">"location"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"geo_point"</span>&#125;, <span class="string">"latitude"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"half_float"</span>&#125;, <span class="string">"longitude"</span>=&gt;&#123;<span class="string">"type"</span>=&gt;<span class="string">"half_float"</span>&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;[2017-10-19T16:35:07,194][INFO ][logstash.outputs.elasticsearch] New Elasticsearch output &#123;:class=&gt;<span class="string">"LogStash::Outputs::ElasticSearch"</span>, :hosts=&gt;[<span class="string">"//localhost:9200"</span>]&#125;</div><div class="line">[2017-10-19T16:35:07,197][INFO ][logstash.pipeline        ] Starting pipeline &#123;<span class="string">"id"</span>=&gt;<span class="string">"main"</span>, <span class="string">"pipeline.workers"</span>=&gt;2, <span class="string">"pipeline.batch.size"</span>=&gt;125, <span class="string">"pipeline.batch.delay"</span>=&gt;5, <span class="string">"</span></div><div class="line">pipeline.max_inflight"=&gt;250&#125;[2017-10-19T16:35:07,582][INFO ][logstash.inputs.beats    ] Beats inputs: Starting input listener &#123;:address=&gt;<span class="string">"0.0.0.0:5044"</span>&#125;</div><div class="line">[2017-10-19T16:35:07,615][INFO ][logstash.pipeline        ] Pipeline main started</div><div class="line">[2017-10-19T16:35:07,623][INFO ][org.logstash.beats.Server] Starting server on port: 5044</div><div class="line">[2017-10-19T16:35:07,702][INFO ][logstash.agent           ] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</div></pre></td></tr></table></figure>
<h5 id="filebeat-服务启动日志"><a href="#filebeat-服务启动日志" class="headerlink" title="filebeat 服务启动日志"></a>filebeat 服务启动日志</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@DevEVN-21 ~]<span class="comment"># tail -f /var/log/filebeat/filebeat</span></div><div class="line">2017-10-19T15:29:38+08:00 INFO Prospector with previous states loaded: 1</div><div class="line">2017-10-19T15:29:38+08:00 INFO Starting prospector of <span class="built_in">type</span>: <span class="built_in">log</span>; id: 14402121705362619298 </div><div class="line">2017-10-19T15:29:38+08:00 INFO Prospector with previous states loaded: 4</div><div class="line">2017-10-19T15:29:38+08:00 INFO Starting prospector of <span class="built_in">type</span>: <span class="built_in">log</span>; id: 3085250400820318742 </div><div class="line">2017-10-19T15:29:38+08:00 INFO Prospector with previous states loaded: 10</div><div class="line">2017-10-19T15:29:38+08:00 INFO Starting prospector of <span class="built_in">type</span>: <span class="built_in">log</span>; id: 9380947956116938860 </div><div class="line">2017-10-19T15:29:38+08:00 INFO Prospector with previous states loaded: 6</div><div class="line">2017-10-19T15:29:38+08:00 INFO Starting prospector of <span class="built_in">type</span>: <span class="built_in">log</span>; id: 8452203097583608250 </div><div class="line">2017-10-19T15:29:38+08:00 INFO Loading and starting Prospectors completed. Enabled prospectors: 41</div><div class="line">2017-10-19T15:29:48+08:00 INFO Harvester started <span class="keyword">for</span> file: /data/soros/logs/soros-batch.log</div><div class="line">2017-10-19T15:29:48+08:00 INFO Harvester started <span class="keyword">for</span> file: /data/soros/logs/soros-marketing-service-error.log</div><div class="line">2017-10-19T15:29:48+08:00 INFO Harvester started <span class="keyword">for</span> file: /data/soros/logs/soros-marketing-service.log</div><div class="line">2017-10-19T15:29:48+08:00 INFO Harvester started <span class="keyword">for</span> file: /data/soros/logs/soros-order-service.log</div><div class="line">2017-10-19T15:29:58+08:00 INFO Harvester started <span class="keyword">for</span> file: /data/soros/logs/soros-pay-service.log</div><div class="line">2017-10-19T15:29:58+08:00 INFO Harvester started <span class="keyword">for</span> file: /data/soros/logs/soros-risk-service.log</div><div class="line">2017-10-19T15:30:08+08:00 INFO Non-zero metrics <span class="keyword">in</span> the last 30s: filebeat.harvester.open_files=8 filebeat.harvester.running=8 filebeat.harvester.started=8 libbeat.logstash.</div><div class="line">call_count.PublishEvents=6 libbeat.logstash.publish.read_bytes=108 libbeat.logstash.publish.write_bytes=125904 libbeat.logstash.published_and_acked_events=4469 libbeat.publisher.published_events=4469 publish.events=4535 registrar.states.current=58 registrar.states.update=4535 registrar.writes=6</div><div class="line">2017-10-19T15:30:38+08:00 INFO Non-zero metrics <span class="keyword">in</span> the last 30s: filebeat.harvester.open_files=12 filebeat.harvester.running=12 filebeat.harvester.started=12 libbeat.logsta</div><div class="line">sh.call_count.PublishEvents=7 libbeat.logstash.publish.read_bytes=54 libbeat.logstash.publish.write_bytes=127592 libbeat.logstash.published_and_acked_events=4581 libbeat.publisher.published_events=4581 publish.events=4593 registrar.states.update=4593 registrar.writes=7</div><div class="line">...</div><div class="line">[root@DevEVN-21 ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h5 id="elasticsearch-服务启动日志"><a href="#elasticsearch-服务启动日志" class="headerlink" title="elasticsearch 服务启动日志"></a>elasticsearch 服务启动日志</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">[root@ELK-test logs]<span class="comment"># tail -f  Julend_ES-cluster.log</span></div><div class="line">[2017-10-19T17:45:58,104][INFO ][o.e.n.Node               ] [Julend_es1] initializing ...</div><div class="line">[2017-10-19T17:45:58,180][INFO ][o.e.e.NodeEnvironment    ] [Julend_es1] using [1] data paths, mounts [[/data (/dev/sdb1)]], net usable_space [270.3gb], net total_space [29</div><div class="line">5.1gb], spins? [possibly], types [ext4][2017-10-19T17:45:58,180][INFO ][o.e.e.NodeEnvironment    ] [Julend_es1] heap size [1.9gb], compressed ordinary object pointers [<span class="literal">true</span>]</div><div class="line">[2017-10-19T17:45:58,857][INFO ][o.e.n.Node               ] [Julend_es1] node name [Julend_es1], node ID [mXtk8dQeQh-amui<span class="_">-d</span>5pVoA]</div><div class="line">[2017-10-19T17:45:58,857][INFO ][o.e.n.Node               ] [Julend_es1] version[5.6.1], pid[8287], build[667b497/2017-09-14T19:22:05.189Z], OS[Linux/3.10.0-514.el7.x86_64/</div><div class="line">amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_144/25.144-b01][2017-10-19T17:45:58,857][INFO ][o.e.n.Node               ] [Julend_es1] JVM arguments [-Xms2g, -Xmx2g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:</div><div class="line">+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=<span class="literal">true</span>, -Dfile.encoding=UTF-8, -Djna.nosys=<span class="literal">true</span>, -Djdk.io.permissionsUseCanonicalPath=<span class="literal">true</span>, -Dio.netty.noUnsafe=<span class="literal">true</span>, -Dio.netty.noKeySetOptimization=<span class="literal">true</span>, -Dio.netty.recycler.maxCapacityPerThread=0, -D<span class="built_in">log</span>4j.shutdownHookEnabled=<span class="literal">false</span>, -D<span class="built_in">log</span>4j2.disable.jmx=<span class="literal">true</span>, -D<span class="built_in">log</span>4j.skipJansi=<span class="literal">true</span>, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/share/elasticsearch][2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [aggs-matrix-stats]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [ingest-common]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [lang-expression]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [lang-groovy]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [lang-mustache]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [lang-painless]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [parent-join]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [percolator]</div><div class="line">[2017-10-19T17:45:59,707][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [reindex]</div><div class="line">[2017-10-19T17:45:59,708][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [transport-netty3]</div><div class="line">[2017-10-19T17:45:59,708][INFO ][o.e.p.PluginsService     ] [Julend_es1] loaded module [transport-netty4]</div><div class="line">[2017-10-19T17:45:59,708][INFO ][o.e.p.PluginsService     ] [Julend_es1] no plugins loaded</div><div class="line">[2017-10-19T17:46:01,565][INFO ][o.e.d.DiscoveryModule    ] [Julend_es1] using discovery <span class="built_in">type</span> [zen]</div><div class="line">[2017-10-19T17:46:02,716][INFO ][o.e.n.Node               ] [Julend_es1] initialized</div><div class="line">[2017-10-19T17:46:02,716][INFO ][o.e.n.Node               ] [Julend_es1] starting ...</div><div class="line">[2017-10-19T17:46:02,854][INFO ][o.e.t.TransportService   ] [Julend_es1] publish_address &#123;192.168.1.41:9300&#125;, bound_addresses &#123;[::]:9300&#125;</div><div class="line">[2017-10-19T17:46:02,863][INFO ][o.e.b.BootstrapChecks    ] [Julend_es1] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks</div><div class="line">[2017-10-19T17:46:05,946][WARN ][o.e.d.z.ZenDiscovery     ] [Julend_es1] failed to connect to master [&#123;Julend_es3&#125;&#123;Go1e5drSSum7gbrKpIef8g&#125;&#123;KF8fUy32Q-WhSJDBCrdVrQ&#125;&#123;192.168.1</div><div class="line">.43&#125;&#123;192.168.1.43:9300&#125;], retrying...org.elasticsearch.transport.ConnectTransportException: [Julend_es3][192.168.1.43:9300] connect_timeout[30s]</div><div class="line">	at org.elasticsearch.transport.netty4.Netty4Transport.connectToChannels(Netty4Transport.java:361) ~[?:?]</div><div class="line">	at org.elasticsearch.transport.TcpTransport.openConnection(TcpTransport.java:561) ~[elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.transport.TcpTransport.connectToNode(TcpTransport.java:464) ~[elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:332) ~[elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.transport.TransportService.connectToNode(TransportService.java:319) ~[elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.discovery.zen.ZenDiscovery.joinElectedMaster(ZenDiscovery.java:458) [elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.discovery.zen.ZenDiscovery.innerJoinCluster(ZenDiscovery.java:410) [elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.discovery.zen.ZenDiscovery.access<span class="variable">$4100</span>(ZenDiscovery.java:82) [elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.discovery.zen.ZenDiscovery<span class="variable">$JoinThreadControl</span><span class="variable">$1</span>.run(ZenDiscovery.java:1188) [elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at org.elasticsearch.common.util.concurrent.ThreadContext<span class="variable">$ContextPreservingRunnable</span>.run(ThreadContext.java:569) [elasticsearch-5.6.1.jar:5.6.1]</div><div class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_144]</div><div class="line">	at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:624) [?:1.8.0_144]</div><div class="line">	at java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]</div><div class="line">Caused by: io.netty.channel.AbstractChannel<span class="variable">$AnnotatedConnectException</span>: Connection refused: 192.168.1.43/192.168.1.43:9300</div><div class="line">	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:?]</div><div class="line">	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:?]</div><div class="line">	at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:352) ~[?:?]</div><div class="line">	at io.netty.channel.nio.AbstractNioChannel<span class="variable">$AbstractNioUnsafe</span>.finishConnect(AbstractNioChannel.java:340) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:632) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:544) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:498) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:458) ~[?:?]</div><div class="line">	at io.netty.util.concurrent.SingleThreadEventExecutor<span class="variable">$5</span>.run(SingleThreadEventExecutor.java:858) ~[?:?]</div><div class="line">	... 1 more</div><div class="line">Caused by: java.net.ConnectException: Connection refused</div><div class="line">	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:?]</div><div class="line">	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:?]</div><div class="line">	at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:352) ~[?:?]</div><div class="line">	at io.netty.channel.nio.AbstractNioChannel<span class="variable">$AbstractNioUnsafe</span>.finishConnect(AbstractNioChannel.java:340) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:632) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:544) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:498) ~[?:?]</div><div class="line">	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:458) ~[?:?]</div><div class="line">	at io.netty.util.concurrent.SingleThreadEventExecutor<span class="variable">$5</span>.run(SingleThreadEventExecutor.java:858) ~[?:?]</div><div class="line">	... 1 more</div><div class="line">[2017-10-19T17:46:08,968][WARN ][o.e.d.z.ZenDiscovery     ] [Julend_es1] not enough master nodes discovered during pinging (found [[Candidate&#123;node=&#123;Julend_es2&#125;&#123;VQf-ph7NRTei</div><div class="line">EVHqAT4pRw&#125;&#123;v2HyA4hTT0miTzlFmi1vZg&#125;&#123;192.168.1.42&#125;&#123;192.168.1.42:9300&#125;, clusterStateVersion=-1&#125;, Candidate&#123;node=&#123;Julend_es1&#125;&#123;mXtk8dQeQh-amui<span class="_">-d</span>5pVoA&#125;&#123;1f1jfhuQQCyor5YXnm8oAg&#125;&#123;192.168.1.41&#125;&#123;192.168.1.41:9300&#125;, clusterStateVersion=-1&#125;]], but needed [3]), pinging again[2017-10-19T17:46:11,971][WARN ][o.e.d.z.ZenDiscovery     ] [Julend_es1] not enough master nodes discovered during pinging (found [[Candidate&#123;node=&#123;Julend_es2&#125;&#123;VQf-ph7NRTei</div><div class="line">EVHqAT4pRw&#125;&#123;v2HyA4hTT0miTzlFmi1vZg&#125;&#123;192.168.1.42&#125;&#123;192.168.1.42:9300&#125;, clusterStateVersion=-1&#125;, Candidate&#123;node=&#123;Julend_es1&#125;&#123;mXtk8dQeQh-amui<span class="_">-d</span>5pVoA&#125;&#123;1f1jfhuQQCyor5YXnm8oAg&#125;&#123;192.168.1.41&#125;&#123;192.168.1.41:9300&#125;, clusterStateVersion=-1&#125;]], but needed [3]), pinging again[2017-10-19T17:46:15,025][INFO ][o.e.c.s.ClusterService   ] [Julend_es1] detected_master &#123;Julend_es3&#125;&#123;Go1e5drSSum7gbrKpIef8g&#125;&#123;60Fb2YJZQ0Ct2uL7PcsuRQ&#125;&#123;192.168.1.43&#125;&#123;192.168.</div><div class="line">1.43:9300&#125;, added &#123;&#123;Julend_es2&#125;&#123;VQf-ph7NRTeiEVHqAT4pRw&#125;&#123;v2HyA4hTT0miTzlFmi1vZg&#125;&#123;192.168.1.42&#125;&#123;192.168.1.42:9300&#125;,&#123;Julend_es3&#125;&#123;Go1e5drSSum7gbrKpIef8g&#125;&#123;60Fb2YJZQ0Ct2uL7PcsuRQ&#125;&#123;192.168.1.43&#125;&#123;192.168.1.43:9300&#125;,&#125;, reason: zen-disco-receive(from master [master &#123;Julend_es3&#125;&#123;Go1e5drSSum7gbrKpIef8g&#125;&#123;60Fb2YJZQ0Ct2uL7PcsuRQ&#125;&#123;192.168.1.43&#125;&#123;192.168.1.43:9300&#125; committed version [1]])[2017-10-19T17:46:15,056][INFO ][o.e.h.n.Netty4HttpServerTransport] [Julend_es1] publish_address &#123;192.168.1.41:9200&#125;, bound_addresses &#123;[::]:9200&#125;</div><div class="line">[2017-10-19T17:46:15,056][INFO ][o.e.n.Node               ] [Julend_es1] started</div><div class="line">...</div><div class="line">[root@ELK-test logs]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h4 id="查看-elasticsearch-集群状态"><a href="#查看-elasticsearch-集群状态" class="headerlink" title="查看 elasticsearch 集群状态"></a>查看 elasticsearch 集群状态</h4><h5 id="获取集群中节点列表"><a href="#获取集群中节点列表" class="headerlink" title="获取集群中节点列表"></a>获取集群中节点列表</h5><p><code>curl &#39;localhost:9200/_cat/nodes?v&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/329B6F6EA752494CB4C4D6031C77B479?method=download&amp;shareKey=a3fee6f200f0e9d1d5f6382d823d4748" alt="获取集群中节点列表">  </p>
<h5 id="集群健康检查"><a href="#集群健康检查" class="headerlink" title="集群健康检查"></a>集群健康检查</h5><p><code>curl &#39;localhost:9200/_cat/health?v&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/61C65EEE2B034AD09FC4AF4CF3DC3C12?method=download&amp;shareKey=b3bb5668a73fdb35647afed00419fd10" alt="集群健康检查">  </p>
<h5 id="获取ElasticSearch索引"><a href="#获取ElasticSearch索引" class="headerlink" title="获取ElasticSearch索引"></a>获取ElasticSearch索引</h5><p><code>curl &#39;localhost:9200/_cat/indices?v&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/E862D2654364496E8474E7F44E5F09A4?method=download&amp;shareKey=6b9d3f0297cc80f23b43479a6c8a9841" alt="获取ElasticSearch索引"> </p>
<h5 id="本机节点查询"><a href="#本机节点查询" class="headerlink" title="本机节点查询"></a>本机节点查询</h5><p><code>curl -XGET &#39;localhost:9200/_nodes/_local?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/7986E5063E69469C9C77699A37CE0244?method=download&amp;shareKey=ed6aa6f801cc993ccfd70b443772637a" alt="本机节点查询1">  </p>
<p><code>curl -XGET &#39;localhost:9200/_nodes/_local/network?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/0E9EBB54EC8D43B7A4014DA31E70ADDE?method=download&amp;shareKey=4c3db04e15fe968eb9e9cb288a4a0069" alt="本机节点查询2">  </p>
<h5 id="节点状态"><a href="#节点状态" class="headerlink" title="节点状态"></a>节点状态</h5><p><code>curl -XGET &#39;http://localhost:9200/_nodes/stats?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/99AAAE558FE74153914FA78F844400F9?method=download&amp;shareKey=7b22a74b7e6c7226be128574a3af75a9" alt="节点状态1">  </p>
<p><code>curl -XGET &#39;http://localhost:9200/_nodes/stats/os,process?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/C9B6B407B93E4214B63331975EB47EF6?method=download&amp;shareKey=298f0b1e82cc9785fb9e321199bf6909" alt="节点状态2">  </p>
<p><code>curl -XGET &#39;http://localhost:9200/_nodes?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/BB22940B585B4F90BFB2F8349A39B9FA?method=download&amp;shareKey=76c793558852d58d72fca64d37eec706" alt="节点状态3">  </p>
<p><code>curl -XGET &#39;http://localhost:9200/_nodes/process?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/C29147AE73D345D8B50926CB00B4AF29?method=download&amp;shareKey=d32513c28c63fa9658abde8da2bde251" alt="节点状态4">  </p>
<p><code>curl -XGET &#39;http://localhost:9200/_nodes/os?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/C7B4C4CFCCBB41C4AF799CAFE771E370?method=download&amp;shareKey=8aceb129875e52c7a00cc1b2457dabf7" alt="节点状态5">  </p>
<p><code>curl -XGET &#39;http://localhost:9200/_nodes/settings?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/397DF0BEC4D94209B69D023C581406CA?method=download&amp;shareKey=5b2675affc9e3956f9a45fae3b45de59" alt="节点状态6">  </p>
<h5 id="获取集群健康状况"><a href="#获取集群健康状况" class="headerlink" title="获取集群健康状况"></a>获取集群健康状况</h5><p><code>curl -XGET &#39;http://localhost:9200/_cluster/health?pretty=true&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/45011E4E313142FAB9881CB9A5C6EF25?method=download&amp;shareKey=a37a6a50b678ebc5263086dd4c695d79" alt="获取集群健康状况">  </p>
<h5 id="集群状态"><a href="#集群状态" class="headerlink" title="集群状态"></a>集群状态</h5><p><code>curl -XGET &#39;http://localhost:9200/_cluster/state?pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/002F39A9F6CC407A87CE90BEB23C2039?method=download&amp;shareKey=f406f9dad95986261270cd10be864e58" alt="集群状态1">  </p>
<p><code>curl -XGET &#39;http://localhost:9200/_cluster/stats?human&amp;pretty&#39;</code><br><img src="http://note.youdao.com/yws/api/personal/file/63BC83C64A7242F88E43DA5BAA384F58?method=download&amp;shareKey=617d72ec5682fe56ad7d59b591abc205" alt="集群状态2">  </p>
<p>详细参考：<a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html" target="_blank" rel="external">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html</a><br><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cluster-nodes-info.html" target="_blank" rel="external">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cluster-nodes-info.html</a>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@ELK-test ~]<span class="comment"># ls /data/ELK_data/elasticsearch/logs/</span></div><div class="line">Julend_ES-cluster-2017-10-17.log  Julend_ES-cluster_deprecation.log             Julend_ES-cluster_index_search_slowlog.log</div><div class="line">Julend_ES-cluster-2017-10-18.log  Julend_ES-cluster_index_indexing_slowlog.log  Julend_ES-cluster.log</div><div class="line">[root@ELK-test ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>elasticsearch-head安装略  </p>
<p>第三个elasticsearch节点（之前有两个）加入到elasticsearch集群后，前两个elasticsearch节点会自动迁移同步数据到第三个节点<br>elasticsearch集群开始同步<br><img src="http://note.youdao.com/yws/api/personal/file/09534A80B39F4F178B3187517DAFA898?method=download&amp;shareKey=ce322eed4929d14ee88d4c92b950b364" alt="elasticsearch_cluster_status">  </p>
<p>elasticsearch集群同步完成后，各个elasticsearch节点几乎均匀分布，允许宕机一个节点<br><img src="http://note.youdao.com/yws/api/personal/file/B40C211E50634D648CF82E54B2FCD109?method=download&amp;shareKey=00425374d1c0425cbc224b1524ea90bf" alt="elasticsearch_cluster_status">  </p>
<h5 id="kibana-状态"><a href="#kibana-状态" class="headerlink" title="kibana 状态"></a>kibana 状态</h5><p><img src="http://note.youdao.com/yws/api/personal/file/26933567953E40EE8F284794F1CB78FC?method=download&amp;shareKey=56d001acd84646148ad4c51112103c24" alt="kibana">  </p>
<p><img src="http://note.youdao.com/yws/api/personal/file/644A2A5A28A24FE1B20C5ABFD27A9CDD?method=download&amp;shareKey=3251ff9b6046a236ff91f6e157e9ad41" alt="nginx+kibana">  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="http://www.yfshare.vip">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="http://www.yfshare.vip/2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/">http://www.yfshare.vip/2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=2.0.0" async></script><a data-url="http://www.yfshare.vip/2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/" data-id="cjo1nm411005skwm5i6qz0gol" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Elasticsearch/">Elasticsearch</a><a href="/tags/Logstash/">Logstash</a><a href="/tags/Kibana/">Kibana</a><a href="/tags/Filebeat/">Filebeat</a><a href="/tags/Elasticsearch-Cluster/">Elasticsearch Cluster</a></div><div class="post-nav"><a href="/2017/11/14/Elasticsearch监控相关/" class="pre">Elasticsearch监控相关</a><a href="/2017/11/02/Elasticsearch原理/" class="next">Elasticsearch原理</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'yfshare';
var disqus_identifier = '2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/';
var disqus_title = '部署FileBeat+logstash+elasticsearch集群+kibana';
var disqus_url = 'http://www.yfshare.vip/2017/11/04/部署FileBeat-logstash-elasticsearch集群-kibana/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//yfshare.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Atlassian/">Atlassian</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ELK/">ELK</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jenkins/">Jenkins</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/K8S/">K8S</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Virtualization/">Virtualization</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制系统/">版本控制系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维知识体系/">运维知识体系</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/04/Python升级/">Python升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/node-exporter自定义key/">node_exporter自定义key</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/04/Python运算符/">Python运算符</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/27/运维知识体系之操作系统层/">运维知识体系之操作系统层</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/04/部署jenkins项目/">部署jenkins项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/30/部署Zabbix-3-4/">部署Zabbix 3.4</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/21/Ansible部署Jenkins环境/">Ansible部署Jenkins环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/28/k8s滚动升级-RollingUpdate/">k8s滚动升级(RollingUpdate)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/21/Ansible部署TLS-K8S/">Ansible部署TLS K8S</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/17/glusterfs做持久化存储/">glusterfs做持久化存储</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yfshare.blog.51cto.com/" title="酱油瓶 博客" target="_blank">酱油瓶 博客</a><ul></ul><a href="http://zerosre.com/" title="龙哥zero 博客" target="_blank">龙哥zero 博客</a><ul></ul><a href="http://renzhiyuan.blog.51cto.com/" title="任志远Ray 博客" target="_blank">任志远Ray 博客</a><ul></ul><a href="http://rongrong.njdgwl.com" title="浩子的 博客" target="_blank">浩子的 博客</a><ul></ul><a href="http://www.cnblogs.com/aresxin/" title="欣哥aresxin 博客" target="_blank">欣哥aresxin 博客</a><ul></ul><a href="http://securityit.cn/" title="万马奔腾" target="_blank">万马奔腾</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-resources"> 资源站</i></div><ul></ul><a href="http://mirror.symnds.com/distributions/CentOS-vault/" title="Centos镜像站" target="_blank">Centos镜像站</a><ul></ul><a href="http://www.rpmfind.net/" title="rpmfind mirror" target="_blank">rpmfind mirror</a><ul></ul><a href="http://rpm.org/" title="rpm.org" target="_blank">rpm.org</a><ul></ul><a href="http://rpm.pbone.net/" title="rpm search" target="_blank">rpm search</a><ul></ul><a href="http://download.chinaunix.net/" title="chinaunix download" target="_blank">chinaunix download</a><ul></ul><a href="http://www.anquanquan.info/" title="安全圈info" target="_blank">安全圈info</a><ul></ul><a href="http://source.tosimp.net/" title="Tosimp 资源站" target="_blank">Tosimp 资源站</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=371362&auto=1&height=66"></iframe><div class="widget"><div class="widget-title"><i class="fa fa-external-game"> 游戏</i></div><ul></ul><a href="/2048" title="2048小游戏" target="_blank">2048小游戏</a><ul></ul><a href="/tantanqiu" title="变色弹球跳台阶小游戏" target="_blank">变色弹球跳台阶小游戏</a></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//yfshare.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Jack Wang Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=2.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=2.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=2.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3890bdc1bfaccae9364479b65f36fbd2";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=2.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=2.0.0"></script></div></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Blog"><title>Logstash插件 | Jack Wang Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Logstash插件</h1><a id="logo" href="/.">Jack Wang Blog</a><p class="description">Goals determine what you are going to be</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Logstash插件</h1><div class="post-meta">Nov 18, 2017<span> | </span><span class="category"><a href="/categories/ELK/">ELK</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/11/18/Logstash插件/" href="/2017/11/18/Logstash插件/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的codec用法之Logstash展示Nginx日志"><span class="toc-number">1.</span> <span class="toc-text">Logstash的codec用法之Logstash展示Nginx日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的codec插件之multiline用法"><span class="toc-number">2.</span> <span class="toc-text">Logstash的codec插件之multiline用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的filter插件之grok用法"><span class="toc-number">3.</span> <span class="toc-text">Logstash的filter插件之grok用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的filter插件之json用法"><span class="toc-number">4.</span> <span class="toc-text">Logstash的filter插件之json用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的filter插件之geoip用法"><span class="toc-number">5.</span> <span class="toc-text">Logstash的filter插件之geoip用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的filter插件之date时间处理"><span class="toc-number">6.</span> <span class="toc-text">Logstash的filter插件之date时间处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的filter插件之secure日志切割"><span class="toc-number">7.</span> <span class="toc-text">Logstash的filter插件之secure日志切割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的output插件之发生email"><span class="toc-number">8.</span> <span class="toc-text">Logstash的output插件之发生email</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logstash的output插件之发生HDFS"><span class="toc-number">9.</span> <span class="toc-text">Logstash的output插件之发生HDFS</span></a></li></ol></div></div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>Logstash插件主要分为（常用插件）：input、filter、output、Codec等<br><a id="more"></a><br>Logstash input plugins：<a href="https://www.elastic.co/guide/en/logstash/5.1/input-plugins.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/input-plugins.html</a><br>Logstash filter plugins：<a href="https://www.elastic.co/guide/en/logstash/5.1/filter-plugins.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/filter-plugins.html</a><br>Logstash output plugins：<a href="https://www.elastic.co/guide/en/logstash/5.1/output-plugins.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/output-plugins.html</a><br>Logstash Codec plugins：<a href="https://www.elastic.co/guide/en/logstash/5.1/codec-plugins.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/codec-plugins.html</a>  </p>
<p>环境：Centos 6.6<br>　　　ElasticSearch 5.1.1<br>　　　Logstash 5.1.1<br>　　　Kibana 5.1.1  </p>
<h4 id="Logstash的codec用法之Logstash展示Nginx日志"><a href="#Logstash的codec用法之Logstash展示Nginx日志" class="headerlink" title="Logstash的codec用法之Logstash展示Nginx日志"></a>Logstash的codec用法之Logstash展示Nginx日志</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.1/codec-plugins.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/codec-plugins.html</a><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">#文件必须以.<span class="keyword">conf</span>结尾，因为Logstash默认扫描*.<span class="keyword">conf</span>文件</div><div class="line">[root@ELK ~]# <span class="keyword">cat</span> /etc/logstash/              #在用grok时可以直接调用<span class="keyword">conf</span>.<span class="keyword">d</span>/nginx.<span class="keyword">conf</span> </div><div class="line"><span class="keyword">input</span> &#123;</div><div class="line">	<span class="keyword">file</span> &#123;</div><div class="line">		path =&gt; [<span class="string">"/var/log/nginx/access.log"</span>]</div><div class="line">		<span class="keyword">type</span> =&gt; <span class="string">"nginx"</span></div><div class="line">		start_position =&gt; <span class="string">"beginning"</span>  #这里参数可以写beginning和end</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">	stdout &#123;</div><div class="line">		codec =&gt; rubydebug&#123;&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/nginx.<span class="keyword">conf</span> </div><div class="line">Sending Logstash's logs to /<span class="keyword">var</span>/<span class="keyword">log</span>/logstash <span class="keyword">which</span> is now configured via log4j2.properties</div><div class="line">&#123;</div><div class="line">          <span class="string">"path"</span> =&gt; <span class="string">"/var/log/nginx/access.log"</span>,</div><div class="line">    <span class="string">"@timestamp"</span> =&gt; 2016-12-14T03:39:56.805Z,</div><div class="line">      <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">          <span class="string">"host"</span> =&gt; <span class="string">"0.0.0.0"</span>,</div><div class="line">       <span class="string">"message"</span> =&gt; <span class="string">"192.168.31.100 - - [13/Dec/2016:18:22:21 +0800] \"</span>GET / HTTP/1.1\<span class="string">" 200 612 \"</span>-\<span class="string">" \"</span>curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.15.3 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\<span class="string">" \"</span>-\<span class="string">""</span>,</div><div class="line">          <span class="string">"type"</span> =&gt; <span class="string">"nginx"</span>,</div><div class="line">          <span class="string">"tags"</span> =&gt; []</div><div class="line">&#125;</div><div class="line">....</div><div class="line">#当再次请求Nginx时（即Nginx access.<span class="keyword">log</span>日志再次输出时），会打印到屏幕</div></pre></td></tr></table></figure></p>
<p>注，beginning和end区别：<br><code>beginning是文件从头开始读取</code>，<code>end是读取最新内容</code>。第一次读取后会生成缓存文件 (隐藏文件)记录读取的进度，如：<code>.sincedb_d883144359d3b4f516b37dba51fab2a2(隐藏文件)</code>。rpm安装的在<code>/var/lib/logstash/plugins/inputs/file</code>这个目录下，具体位置需要搜索。  </p>
<h4 id="Logstash的codec插件之multiline用法"><a href="#Logstash的codec插件之multiline用法" class="headerlink" title="Logstash的codec插件之multiline用法"></a>Logstash的codec插件之multiline用法</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.1/plugins-codecs-multiline.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/plugins-codecs-multiline.html</a><br><a href="https://kibana.logstash.es/content/logstash/plugins/codec/multiline.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/codec/multiline.html</a>  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">[root@ELK ~]<span class="comment"># cat /etc/logstash/conf.d/multiline.conf </span></div><div class="line">input &#123;</div><div class="line">	stdin &#123;</div><div class="line">		codec =&gt; multiline &#123;</div><div class="line">			pattern =&gt; <span class="string">"^\["</span></div><div class="line">			negate =&gt; <span class="keyword">true</span></div><div class="line">			what =&gt; <span class="string">"previous"</span></div><div class="line">			&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">	stdout &#123;</div><div class="line">		codec =&gt; rubydebug&#123;&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">[root@ELK ~]<span class="comment">#</span></div><div class="line"><span class="comment">#测试配置文件语法</span></div><div class="line">[root@ELK ~]<span class="comment"># /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/conf.d/multiline.conf -t</span></div><div class="line">Sending Logstash<span class="string">'s logs to /var/log/logstash which is now configured via log4j2.properties</span></div><div class="line">Configuration OK</div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/conf.d/multiline.conf</div><div class="line">Sending Logstash's logs to /<span class="keyword">var</span>/log/logstash which is now configured via log4j2.properties</div><div class="line">The stdin plugin is now waiting <span class="keyword">for</span> input:</div><div class="line">[hello world]</div><div class="line">[Windows of the world]</div><div class="line">&#123;</div><div class="line">    <span class="string">"@timestamp"</span> =&gt; <span class="number">2016</span><span class="number">-12</span><span class="number">-14</span>T07:<span class="number">53</span>:<span class="number">20.808</span>Z,</div><div class="line">      <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">          <span class="string">"host"</span> =&gt; <span class="string">"0.0.0.0"</span>,</div><div class="line">       <span class="string">"message"</span> =&gt; <span class="string">"[hello world]"</span>,</div><div class="line">          <span class="string">"tags"</span> =&gt; []</div><div class="line">&#125;</div><div class="line">Good mornning</div><div class="line">[</div><div class="line">&#123;</div><div class="line">    <span class="string">"@timestamp"</span> =&gt; <span class="number">2016</span><span class="number">-12</span><span class="number">-14</span>T07:<span class="number">54</span>:<span class="number">00.060</span>Z,</div><div class="line">      <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">          <span class="string">"host"</span> =&gt; <span class="string">"0.0.0.0"</span>,</div><div class="line">       <span class="string">"message"</span> =&gt; <span class="string">"[Windows of the world]\nGood mornning"</span>,</div><div class="line">          <span class="string">"tags"</span> =&gt; [</div><div class="line">        [<span class="number">0</span>] <span class="string">"multiline"</span></div><div class="line">    ]</div><div class="line">&#125;</div><div class="line"><span class="comment">#multiline插件是以“[”做标记，如果出现“[”，则把两个“[”之间的内容在message输出，“[”是结尾符</span></div></pre></td></tr></table></figure>
<h4 id="Logstash的filter插件之grok用法"><a href="#Logstash的filter插件之grok用法" class="headerlink" title="Logstash的filter插件之grok用法"></a>Logstash的filter插件之grok用法</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.1/plugins-filters-grok.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/plugins-filters-grok.html</a><br><a href="http://kibana.logstash.es/content/logstash/plugins/filter/grok.html" target="_blank" rel="external">http://kibana.logstash.es/content/logstash/plugins/filter/grok.html</a>  </p>
<p>主要是做正则匹配，拆分<br>下面两个地址需要拨VPN才能访问：<br>官方提供的grok表达式：<a href="https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns" target="_blank" rel="external">https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns</a><br>grok在线调试：<a href="https://grokdebug.herokuapp.com/" target="_blank" rel="external">https://grokdebug.herokuapp.com/</a><br>grok正则表达式：<a href="https://github.com/logstash-plugins/logstash-patterns-core/blob/master/patterns/grok-patterns" target="_blank" rel="external">https://github.com/logstash-plugins/logstash-patterns-core/blob/master/patterns/grok-patterns</a><br>在用grok时可以直接调用，也可以自己写，如：<br><img src="http://note.youdao.com/yws/api/personal/file/9E3F41215A5B44F98B4DE31A1D194559?method=download&amp;shareKey=694a15483adc321844d8f3ac40ff77b7" alt="image">  </p>
<p>grok里正则在这里<a href="https://grokdebug.herokuapp.com/" target="_blank" rel="external">调试</a><br><img src="http://note.youdao.com/yws/api/personal/file/CBEC3EEBC35B457CBC28DFE516A32D28?method=download&amp;shareKey=fe1269199d3998d52b92fdb53814dc6f" alt="image">  </p>
<p>#日志内容本身都是一个类似于key-value 的格式，但是格式具体的样式却是多种多样的。logstash提供filters/kv插件，帮助处理不同样式的key-value日志，变成实际的LogStash::Event数据。  </p>
<p>#kv没用会，下面是摘抄的示例<br><a href="https://kibana.logstash.es/content/logstash/plugins/filter/kv.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/filter/kv.html</a><br><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-kv.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/current/plugins-filters-kv.html</a><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">#解析<span class="keyword">test</span>.<span class="keyword">log</span>文件内容</div><div class="line">[root@ELK ~]# <span class="keyword">cat</span> /root/<span class="keyword">test</span>.<span class="keyword">log</span> </div><div class="line">192.168.31.105 - - [14/<span class="keyword">Dec</span>/2016:15:17:56 +0800] <span class="string">"GET / HTTP/1.1"</span> 304 0 <span class="string">"-"</span> <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36"</span> <span class="string">"-"</span></div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# <span class="keyword">cat</span> /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/samp.<span class="keyword">conf</span> </div><div class="line"><span class="keyword">input</span> &#123;</div><div class="line">	<span class="keyword">file</span> &#123;</div><div class="line">		path =&gt; <span class="string">"/root/test.log"</span></div><div class="line">		start_position =&gt; <span class="string">"beginning"</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123;</div><div class="line">	grok &#123;</div><div class="line">		match =&gt; [<span class="string">"message"</span>,<span class="string">"%&#123;IPV4:remote_addr&#125; \- %&#123;USERNAME:remote_user&#125; \[%&#123;DATA:time_local&#125;\] (?&lt;http_request&gt;\"</span>[A-Za-z][A-Za-z]+\s*\/\s*[A-Za-z][A-Za-z]+\/[0-9][0-9]*\.[0-9][0-9]*\<span class="string">") (?&lt;status&gt;[0-9][0-9]*) (?&lt;body_bytes_sent&gt;[0-9][0-9]*) (?&lt;http_referer&gt;\"</span>[\s\S]*?\<span class="string">") (?&lt;http_user_agent&gt;\"</span>[\s\S]*?\<span class="string">") (?&lt;http_x_forwarded_for&gt;\"</span>[\s\S]*?\<span class="string">")"</span>]</div><div class="line">	&#125;</div><div class="line">    kv &#123;</div><div class="line">        source =&gt; <span class="string">"http_user_agent"</span></div><div class="line">        field_split =&gt; <span class="string">";"</span></div><div class="line">        value_split =&gt; <span class="string">"="</span></div><div class="line">        remove_field =&gt; [ <span class="string">"\\"</span>"]</div><div class="line">        &#125;</div><div class="line">	urldecode &#123;</div><div class="line">		all_fields =&gt; true</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">#这里的kv插件好像没有效果额..，kv适合有规律的拆分</div><div class="line">output &#123;</div><div class="line">	stdout &#123;</div><div class="line">		codec =&gt; rubydebug</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/samp.<span class="keyword">conf</span> -t</div><div class="line">Sending Logstash's logs to /<span class="keyword">var</span>/<span class="keyword">log</span>/logstash <span class="keyword">which</span> is now configured via log4j2.properties</div><div class="line">Configuration OK</div><div class="line">[root@ELK ~]# /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/samp.<span class="keyword">conf</span></div><div class="line">Sending Logstash's logs to /<span class="keyword">var</span>/<span class="keyword">log</span>/logstash <span class="keyword">which</span> is now configured via log4j2.properties</div><div class="line">&#123;</div><div class="line">             <span class="string">"remote_addr"</span> =&gt; <span class="string">"192.168.31.105"</span>,</div><div class="line">         <span class="string">"body_bytes_sent"</span> =&gt; <span class="string">"0"</span>,</div><div class="line">              <span class="string">"time_local"</span> =&gt; <span class="string">"14/Dec/2016:15:17:56 +0800"</span>,</div><div class="line">                 <span class="string">"message"</span> =&gt; <span class="string">"192.168.31.105 - - [14/Dec/2016:15:17:56 +0800] \"</span>GET / HTTP/1.1\<span class="string">" 304 0 \"</span>-\<span class="string">" \"</span>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36\<span class="string">" \"</span>-\<span class="string">""</span>,</div><div class="line">                    <span class="string">"tags"</span> =&gt; [],</div><div class="line">         <span class="string">"http_user_agent"</span> =&gt; <span class="string">"\"</span>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36\<span class="string">""</span>,</div><div class="line">             <span class="string">"remote_user"</span> =&gt; <span class="string">"-"</span>,</div><div class="line">                    <span class="string">"path"</span> =&gt; <span class="string">"/root/test.log"</span>,</div><div class="line">              <span class="string">"@timestamp"</span> =&gt; 2016-12-14T16:05:20.443Z,</div><div class="line">            <span class="string">"http_referer"</span> =&gt; <span class="string">"\"</span>-\<span class="string">""</span>,</div><div class="line">                <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">                    <span class="string">"host"</span> =&gt; <span class="string">"0.0.0.0"</span>,</div><div class="line">    <span class="string">"http_x_forwarded_for"</span> =&gt; <span class="string">"\"</span>-\<span class="string">""</span>,</div><div class="line">            <span class="string">"http_request"</span> =&gt; <span class="string">"\"</span>GET / HTTP/1.1\<span class="string">""</span>,</div><div class="line">                  <span class="string">"status"</span> =&gt; <span class="string">"304"</span></div><div class="line">&#125;</div><div class="line">...</div><div class="line">[root@ELK ~]#</div><div class="line">#Logstash日志输出</div><div class="line">[root@ELK ~]# tail -f /<span class="keyword">var</span>/<span class="keyword">log</span>/logstash/logstash-plain.<span class="keyword">log</span> </div><div class="line">[2016-12-15T00:02:28,195][INFO ][logstash.runner          ] Using config.test_and_exit mode. Config Validation Result: OK. Exiting Logstash</div><div class="line">[2016-12-15T00:05:21,397][INFO ][logstash.pipeline        ] Starting pipeline &#123;<span class="string">"id"</span>=&gt;<span class="string">"main"</span>, <span class="string">"pipeline.workers"</span>=&gt;1, <span class="string">"pipeline.batch.size"</span>=&gt;125, <span class="string">"pipeline.batch.delay"</span>=&gt;5, <span class="string">"pipeline.max_inflight"</span>=&gt;125&#125;</div><div class="line">[2016-12-15T00:05:21,477][INFO ][logstash.pipeline        ] Pipeline main started</div><div class="line">[2016-12-15T00:05:22,156][INFO ][logstash.agent           ] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</div><div class="line">...</div><div class="line">[root@ELK ~]#</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">filter &#123;</div><div class="line">    ruby &#123;</div><div class="line">        init =&gt; <span class="string">"@kname = ['method','uri','verb']"</span></div><div class="line">        code =&gt; <span class="string">"</span></div><div class="line">            new_event = LogStash::Event.new(Hash[@kname.zip(event.get('request').split('|'))])</div><div class="line">            new_event.remove('@timestamp')</div><div class="line">            event.append(new_event)</div><div class="line">        "</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> [uri] &#123;</div><div class="line">        ruby &#123;</div><div class="line">            init =&gt; <span class="string">"@kname = ['url_path','url_args']"</span></div><div class="line">            code =&gt; <span class="string">"</span></div><div class="line">                new_event = LogStash::Event.new(Hash[@kname.zip(event.get('uri').split('?'))])</div><div class="line">                new_event.remove('@timestamp')</div><div class="line">                event.append(new_event)</div><div class="line">            "</div><div class="line">        &#125;</div><div class="line">        kv &#123;</div><div class="line">            prefix =&gt; <span class="string">"url_"</span></div><div class="line">            <span class="built_in">source</span> =&gt; <span class="string">"url_args"</span></div><div class="line">            field_split =&gt; <span class="string">"&amp;"</span></div><div class="line">            remove_field =&gt; [ <span class="string">"url_args"</span>, <span class="string">"uri"</span>, <span class="string">"request"</span> ]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#解释</span></div><div class="line">Nginx 访问日志中的 <span class="variable">$request</span>，通过这段配置，可以详细切分成 method, url_path, verb, url_a, url_b ...</div><div class="line"></div><div class="line">进一步的，如果 url_args 中有过多字段，可能导致 Elasticsearch 集群因为频繁 update mapping 或者消耗太多内存在 cluster state 上而宕机。所以，更优的选择，是只保留明确有用的 url_args 内容，其他部分舍去</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">kv &#123;</div><div class="line">    prefix =&gt; <span class="string">"url_"</span></div><div class="line">    <span class="built_in">source</span> =&gt; <span class="string">"url_args"</span></div><div class="line">    field_split =&gt; <span class="string">"&amp;"</span></div><div class="line">    include_keys =&gt; [ <span class="string">"uid"</span>, <span class="string">"cip"</span> ]</div><div class="line">    remove_field =&gt; [ <span class="string">"url_args"</span>, <span class="string">"uri"</span>, <span class="string">"request"</span> ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#grok分析/var/log/secure日志</span></div><div class="line">input &#123;</div><div class="line">   file &#123;</div><div class="line">	path =&gt; [<span class="string">"/var/log/secure"</span>]</div><div class="line">	start_position =&gt; <span class="string">"end"</span></div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">		grok &#123;</div><div class="line">   			match =&gt; [<span class="string">"message"</span>,<span class="string">".* sshd\[\d+\]: (?&lt;status&gt;\S+) .* (?&lt;ClientIP&gt;(?:\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)?) .*"</span>]</div><div class="line">		&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">    stdout &#123;</div><div class="line">		codec =&gt; rubydebug&#123;&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Logstash的filter插件之json用法"><a href="#Logstash的filter插件之json用法" class="headerlink" title="Logstash的filter插件之json用法"></a>Logstash的filter插件之json用法</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.1/plugins-filters-json.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/plugins-filters-json.html</a><br><a href="https://kibana.logstash.es/content/logstash/plugins/filter/json.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/filter/json.html</a><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">#修改Nginx日志格式</div><div class="line">[root@ELK ~]# head -32 /etc/nginx/nginx.<span class="keyword">conf</span> | tail -15</div><div class="line">#    log_format  main  '<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="string">"$request"</span> '</div><div class="line">#                      '<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> <span class="string">"$http_referer"</span> '</div><div class="line">#                      '<span class="string">"$http_user_agent"</span> <span class="string">"$http_x_forwarded_for"</span>';</div><div class="line"></div><div class="line">    log_format json '&#123;<span class="string">"clinet"</span>:<span class="string">"$remote_addr"</span>,'</div><div class="line">		'<span class="string">"@timestamp"</span>:<span class="string">"$time_iso8601"</span>,'</div><div class="line">		'<span class="string">"@version"</span>:<span class="string">"1"</span>,'</div><div class="line">		'<span class="string">"host"</span>:<span class="string">"$server_addr"</span>,'</div><div class="line">		'<span class="string">"size"</span>:<span class="variable">$body_bytes_sent</span>,'</div><div class="line">		'<span class="string">"responsetime"</span>:<span class="variable">$request_time</span>,'</div><div class="line">		'<span class="string">"domain"</span>:<span class="string">"$host"</span>,'</div><div class="line">		'<span class="string">"status"</span>:<span class="string">"$status"</span>,'</div><div class="line">		'<span class="string">"ua"</span>:<span class="string">"$http_user_agent"</span>&#125;';</div><div class="line"></div><div class="line">    access_log  /<span class="keyword">var</span>/<span class="keyword">log</span>/nginx/access.<span class="keyword">log</span>  json;</div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# <span class="keyword">cat</span> /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/json.<span class="keyword">conf</span> </div><div class="line"><span class="keyword">input</span> &#123;</div><div class="line">	<span class="keyword">file</span> &#123;</div><div class="line">		path =&gt; [<span class="string">"/var/log/nginx/access.log"</span>]</div><div class="line">		<span class="keyword">type</span> =&gt; <span class="string">"Nginx"</span></div><div class="line">		start_position =&gt; <span class="string">"end"</span></div><div class="line">		codec =&gt; json</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">	stdout &#123;</div><div class="line">		codec =&gt; rubydebug&#123;&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/json.<span class="keyword">conf</span> -t</div><div class="line">Sending Logstash's logs to /<span class="keyword">var</span>/<span class="keyword">log</span>/logstash <span class="keyword">which</span> is now configured via log4j2.properties</div><div class="line">Configuration OK</div><div class="line">[root@ELK ~]#</div><div class="line">[root@ELK ~]# /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/<span class="keyword">conf</span>.<span class="keyword">d</span>/json.<span class="keyword">conf</span></div><div class="line">Sending Logstash's logs to /<span class="keyword">var</span>/<span class="keyword">log</span>/logstash <span class="keyword">which</span> is now configured via log4j2.properties</div><div class="line">&#123;</div><div class="line">            <span class="string">"path"</span> =&gt; <span class="string">"/var/log/nginx/access.log"</span>,</div><div class="line">      <span class="string">"@timestamp"</span> =&gt; 2016-12-15T07:33:00.000Z,</div><div class="line">            <span class="string">"size"</span> =&gt; 0,</div><div class="line">          <span class="string">"domain"</span> =&gt; <span class="string">"192.168.31.100"</span>,</div><div class="line">        <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">            <span class="string">"host"</span> =&gt; <span class="string">"192.168.31.100"</span>,</div><div class="line">    <span class="string">"responsetime"</span> =&gt; 0.0,</div><div class="line">              <span class="string">"ua"</span> =&gt; <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36"</span>,</div><div class="line">            <span class="string">"type"</span> =&gt; <span class="string">"Nginx"</span>,</div><div class="line">          <span class="string">"clinet"</span> =&gt; <span class="string">"192.168.31.105"</span>,</div><div class="line">          <span class="string">"status"</span> =&gt; <span class="string">"304"</span>,</div><div class="line">            <span class="string">"tags"</span> =&gt; []</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Logstash的filter插件之geoip用法"><a href="#Logstash的filter插件之geoip用法" class="headerlink" title="Logstash的filter插件之geoip用法"></a>Logstash的filter插件之geoip用法</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.1/plugins-filters-geoip.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/plugins-filters-geoip.html</a><br><a href="https://kibana.logstash.es/content/logstash/plugins/filter/geoip.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/filter/geoip.html</a><br>GeoIP 是最常见的免费IP地址归类查询库<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># logstash v5.6.4</span></div><div class="line"><span class="comment"># logstash 配置文件</span></div><div class="line"><span class="comment"># cat logstash_10.20.conf</span></div><div class="line"><span class="keyword">input</span> &#123;</div><div class="line">   file &#123;</div><div class="line">	<span class="attr">path</span> =&gt; [<span class="string">"/root/test.log"</span>]</div><div class="line">	<span class="attr">start_position</span> =&gt; <span class="string">"end"</span></div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">filter</span> &#123;</div><div class="line">	grok &#123;</div><div class="line">   		<span class="attr">match</span> =&gt; [<span class="string">"message"</span>,<span class="string">"%&#123;IPV4:remote_addr&#125; [\-] %&#123;USERNAME:remote_user&#125; \[%&#123;DATA:time_local&#125;\] \"(?&lt;request&gt;[^\"]*)\" (?&lt;status&gt;\d+) (?&lt;body_bytes_sent&gt;\d+) \"(?&lt;http_referer&gt;[^\"]*)\" \"(?&lt;http_user_agent&gt;[^\"]*)\" \"%&#123;IPV4:http_x_forwarded_for&#125;"</span>]	&#125;</div><div class="line">	<span class="keyword">geoip</span> &#123;</div><div class="line">		<span class="attr">source</span> =&gt; <span class="string">"http_x_forwarded_for"</span></div><div class="line">		<span class="attr">fields</span> =&gt; [<span class="string">"ip"</span>,<span class="string">"city_name"</span>,<span class="string">"country_name"</span>,<span class="string">"location"</span>,<span class="string">"latitude"</span>,<span class="string">"longitude"</span>,<span class="string">"timezone"</span>,<span class="string">"region_name"</span>]</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">output</span> &#123;</div><div class="line">	stdout &#123;</div><div class="line">		<span class="attr">codec</span> =&gt; rubydebug&#123;&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#nginx 日志</span></div><div class="line">100.116.46.20 - - [15/Nov/2017:11:59:34 +0800] <span class="string">"GET /static/js/util/plugins/cordova-plugin-geolocation/www/geolocation.js HTTP/1.0"</span> 200 8629 <span class="string">"https://qian.julend.com/static/pageHtml/loan.html?s_qian=iOS"</span> <span class="string">"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_3 like Mac OS X) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60 GrowingIO/0.9.47-20170111143620 (4303466304)"</span> <span class="string">"27.8.223.7"</span></div><div class="line"></div><div class="line"><span class="comment">#nginx grok匹配</span></div><div class="line">%&#123;IPV4:remote_addr&#125; [\-] %&#123;USERNAME:remote_user&#125; \[%&#123;DATA:time_local&#125;\] \<span class="string">"(?&lt;request&gt;[^\"]*)\" (?&lt;status&gt;\d+) (?&lt;body_bytes_sent&gt;\d+) \"(?&lt;http_referer&gt;[^\"]*)\" \"(?&lt;http_user_agent&gt;[^\"]*)\" \"%&#123;IPV4:http_x_forwarded_for&#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /usr/share/logstash/bin/logstash --path.settings /etc/logstash/ -f /etc/logstash/conf.d/logstash_10.20.conf --path.data /data/elk_data/logstash/</span></div><div class="line">dataSending Logstash<span class="string">'s logs to /data/elk_data/logstash/logs which is now configured via log4j2.properties</span></div><div class="line">&#123;</div><div class="line">             "remote_addr" =&gt; "100.116.46.20",</div><div class="line">                 "request" =&gt; "GET /static/js/util/plugins/cordova-plugin-geolocation/www/geolocation.js HTTP/1.0",</div><div class="line">                   "geoip" =&gt; &#123;</div><div class="line">           "city_name" =&gt; "Chongqing",</div><div class="line">            "timezone" =&gt; "Asia/Shanghai",</div><div class="line">                  "ip" =&gt; "27.8.223.7",</div><div class="line">            "latitude" =&gt; 29.5628,</div><div class="line">        "country_name" =&gt; "China",</div><div class="line">         "region_name" =&gt; "Chongqing",</div><div class="line">            "location" =&gt; &#123;</div><div class="line">            "lon" =&gt; 106.5528,</div><div class="line">            "lat" =&gt; 29.5628</div><div class="line">        &#125;,</div><div class="line">           "longitude" =&gt; 106.5528</div><div class="line">    &#125;,</div><div class="line">         "body_bytes_sent" =&gt; "8629",</div><div class="line">              "time_local" =&gt; "15/Nov/2017:11:59:34 +0800",</div><div class="line">                 "message" =&gt; "100.116.46.20 - - [15/Nov/2017:11:59:34 +0800] \"GET /static/js/util/plugins/cordova-plugin-geolocation/www/geolocation.js HTTP/1.0\" 200 8629 \"https://qian.julend.com/static/pageHtml/loan.html?s_qian=iOS\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_3 like Mac OS X) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60 GrowingIO/0.9.47-20170111143620 (4303466304)\" \"27.8.223.7\"",</div><div class="line">         "http_user_agent" =&gt; "Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_3 like Mac OS X) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60 GrowingIO/0.9.47-20170111143620(4303466304)", </div><div class="line">             "remote_user" =&gt; "-",</div><div class="line">                    "path" =&gt; "/root/test.log",</div><div class="line">              "@timestamp" =&gt; 2017-11-15T06:16:03.829Z,</div><div class="line">            "http_referer" =&gt; "https://qian.julend.com/static/pageHtml/loan.html?s_qian=iOS",</div><div class="line">                "@version" =&gt; "1",</div><div class="line">                    "host" =&gt; "elk-cluster3",</div><div class="line">    "http_x_forwarded_for" =&gt; "27.8.223.7",</div><div class="line">                  "status" =&gt; "200"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 去掉geoip后，nginx日志拆分</span></div><div class="line">&#123;</div><div class="line">             <span class="string">"remote_addr"</span> =&gt; <span class="string">"100.116.46.20"</span>,</div><div class="line">                 <span class="string">"request"</span> =&gt; <span class="string">"GET /static/js/util/plugins/cordova-plugin-geolocation/www/geolocation.js HTTP/1.0"</span>,</div><div class="line">         <span class="string">"body_bytes_sent"</span> =&gt; <span class="string">"8629"</span>,</div><div class="line">              <span class="string">"time_local"</span> =&gt; <span class="string">"15/Nov/2017:10:59:34 +0800"</span>,</div><div class="line">                 <span class="string">"message"</span> =&gt; <span class="string">"100.116.46.20 - - [15/Nov/2017:10:59:34 +0800] \"GET /static/js/util/plugins/cordova-plugin-geolocation/www/geolocation.js HTTP/1.0\" 200 8629 \"https://qian.julend.com/static/pageHtml/loan.html?s_qian=iOS\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_3 like Mac OS X) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60 GrowingIO/0.9.47-20170111143620 (4303466304)\" \"27.8.223.7\""</span>,</div><div class="line">         <span class="string">"http_user_agent"</span> =&gt; <span class="string">"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_3 like Mac OS X) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60 GrowingIO/0.9.47-20170111143620 (4303466304)"</span>,</div><div class="line">             <span class="string">"remote_user"</span> =&gt; <span class="string">"-"</span>,</div><div class="line">                    <span class="string">"path"</span> =&gt; <span class="string">"/root/test.log"</span>,</div><div class="line">              <span class="string">"@timestamp"</span> =&gt; 2017-11-15T06:01:24.940Z,</div><div class="line">            <span class="string">"http_referer"</span> =&gt; <span class="string">"https://qian.julend.com/static/pageHtml/loan.html?s_qian=iOS"</span>,</div><div class="line">                <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">                    <span class="string">"host"</span> =&gt; <span class="string">"elk-cluster3"</span>,</div><div class="line">    <span class="string">"http_x_forwarded_for"</span> =&gt; <span class="string">"27.8.223.7"</span>,</div><div class="line">                  <span class="string">"status"</span> =&gt; <span class="string">"200"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Logstash的filter插件之date时间处理"><a href="#Logstash的filter插件之date时间处理" class="headerlink" title="Logstash的filter插件之date时间处理"></a>Logstash的filter插件之date时间处理</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.6/plugins-filters-date.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.6/plugins-filters-date.html</a><br><a href="https://kibana.logstash.es/content/logstash/plugins/filter/date.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/filter/date.html</a><br>filters/date 插件可以用来转换你的日志记录中的时间字符串，变成 LogStash::Timestamp 对象，然后转存到 @timestamp 字段里<br><code>注意：因为在稍后的 outputs/elasticsearch 中常用的 %{+YYYY.MM.dd} 这种写法必须读取 @timestamp 数据，所以一定不要直接删掉这个字段保留自己的字段，而是应该用 filters/date 转换后删除自己的字段！</code>  </p>
<p><code>建议打开 Nginx 的 access_log 配置项的 buffer 参数，对极限响应性能有极大提升！</code></p>
<p>filters/date 插件支持五种时间格式  </p>
<ul>
<li>ISO8601<br>类似 “2011-04-19T03:44:01.103Z” 这样的格式。具体Z后面可以有 “08:00”也可以没有，”.103”这个也可以没有。常用场景里来说，Nginx 的 log_format 配置里就可以使用 $time_iso8601 变量来记录请求时间成这种格式。  </li>
<li>UNIX<br>UNIX 时间戳格式，记录的是从 1970 年起始至今的总秒数。Squid 的默认日志格式中就使用了这种格式。  </li>
<li>UNIX_MS<br>这个时间戳则是从 1970 年起始至今的总毫秒数。据我所知，JavaScript 里经常使用这个时间格式。  </li>
<li>TAI64N<br>TAI64N 格式比较少见，是这个样子的：@4000000052f88ea32489532c。我目前只知道常见应用中， qmail 会用这个格式。  </li>
<li>Joda-Time 库<br>Logstash 内部使用了 Java 的 Joda 时间库来作时间处理。所以我们可以使用 Joda 库所支持的时间格式来作具体定义。Joda 时间格式定义见下表：</li>
</ul>
<p>时间格式：  </p>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Meaning</th>
<th>Presentation</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td>G</td>
<td>era</td>
<td>text</td>
<td>AD</td>
</tr>
<tr>
<td>C</td>
<td>century of era (&gt;=0)</td>
<td>number</td>
<td>20</td>
</tr>
<tr>
<td>Y</td>
<td>year of era (&gt;=0)</td>
<td>year</td>
<td>1996</td>
</tr>
<tr>
<td>x</td>
<td>weekyear</td>
<td>year</td>
<td>1996</td>
</tr>
<tr>
<td>w</td>
<td>week of weekyear</td>
<td>number</td>
<td>27</td>
</tr>
<tr>
<td>e</td>
<td>day of week</td>
<td>number</td>
<td>2</td>
</tr>
<tr>
<td>E</td>
<td>day of week</td>
<td>text</td>
<td>Tuesday; Tue</td>
</tr>
<tr>
<td>y</td>
<td>year</td>
<td>year</td>
<td>1996</td>
</tr>
<tr>
<td>D</td>
<td>day of year</td>
<td>number</td>
<td>189</td>
</tr>
<tr>
<td>M</td>
<td>month of year</td>
<td>month</td>
<td>July; Jul; 07</td>
</tr>
<tr>
<td>d</td>
<td>day of month</td>
<td>number</td>
<td>10</td>
</tr>
<tr>
<td>a</td>
<td>halfday of day</td>
<td>text</td>
<td>PM</td>
</tr>
<tr>
<td>K</td>
<td>hour of halfday (0~11)</td>
<td>number</td>
<td>0</td>
</tr>
<tr>
<td>h</td>
<td>clockhour of halfday (1~12)</td>
<td>number</td>
<td>12</td>
</tr>
<tr>
<td>H</td>
<td>hour of day (0~23)</td>
<td>number</td>
<td>0</td>
</tr>
<tr>
<td>k</td>
<td>clockhour of day (1~24)</td>
<td>number</td>
<td>24</td>
</tr>
<tr>
<td>m</td>
<td>minute of hour</td>
<td>number</td>
<td>30</td>
</tr>
<tr>
<td>s</td>
<td>second of minute</td>
<td>number</td>
<td>55</td>
</tr>
<tr>
<td>S</td>
<td>fraction of second</td>
<td>number</td>
<td>978</td>
</tr>
<tr>
<td>z</td>
<td>time zone</td>
<td>text</td>
<td>Pacific Standard Time; PST</td>
</tr>
<tr>
<td>Z</td>
<td>time zone offset/id</td>
<td>zone</td>
<td>-0800; -08:00; America/Los_Angeles</td>
</tr>
<tr>
<td>‘</td>
<td>escape for text</td>
<td>delimiter</td>
<td></td>
</tr>
<tr>
<td>‘’</td>
<td>single quote</td>
<td>literal</td>
<td>‘</td>
</tr>
</tbody>
</table>
<p><a href="http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html" target="_blank" rel="external">http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html</a>  </p>
<p>Joda 时间格式的配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">filter &#123;</div><div class="line">    grok &#123;</div><div class="line">        match =&gt; [<span class="string">"message"</span>, <span class="string">"%&#123;HTTPDATE:logdate&#125;"</span>]</div><div class="line">    &#125;</div><div class="line">    date &#123;</div><div class="line">        match =&gt; [<span class="string">"logdate"</span>, <span class="string">"dd/MMM/yyyy:HH:mm:ss Z"</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意：时区偏移量只需要用一个字母 <code>Z</code> 即可  </p>
<h4 id="Logstash的filter插件之secure日志切割"><a href="#Logstash的filter插件之secure日志切割" class="headerlink" title="Logstash的filter插件之secure日志切割"></a>Logstash的filter插件之secure日志切割</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.6/plugins-filters-mutate.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.6/plugins-filters-mutate.html</a><br>这个需要配合filebeat操作<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># grep -iv '#' /etc/filebeat/filebeat.yml |grep -iv '^$'</span></div><div class="line">filebeat.prospectors:</div><div class="line">- input_type: <span class="built_in">log</span></div><div class="line">  paths:</div><div class="line">    - /var/<span class="built_in">log</span>/secure</div><div class="line">  document_type: secure_2.250</div><div class="line">  exclude_lines: [<span class="string">"system"</span>]      <span class="comment">#过滤不含system日志</span></div><div class="line">  include_lines: [<span class="string">"Accepted"</span>]    <span class="comment">#过滤含Accepted的日志</span></div><div class="line">output.logstash:</div><div class="line">  hosts: [<span class="string">"192.168.1.41:5044"</span>]</div><div class="line"><span class="comment">#</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#logstash配置文件</span></div><div class="line"><span class="comment"># cat logstash_test.conf</span></div><div class="line">input &#123;</div><div class="line">	beats &#123;</div><div class="line">		port =&gt; 5045</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">	<span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">'secure_2.250'</span>&#123;</div><div class="line">		grok &#123;</div><div class="line">   			match =&gt; [<span class="string">"message"</span>,<span class="string">".* sshd\[\d+\]: (?&lt;status&gt;\S+) .* (?&lt;ClientIP&gt;(?:\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)?) .*"</span>]        <span class="comment">#正则过滤secure日志，且赋值到message字段</span></div><div class="line">		&#125;</div><div class="line"> 		mutate&#123;</div><div class="line">     			split =&gt; [<span class="string">"message"</span>,<span class="string">" "</span>]     <span class="comment">#把message字段以空格拆分，message字段的值来自grok</span></div><div class="line">	        	add_field =&gt;   &#123;</div><div class="line">        	    		<span class="string">"username"</span> =&gt; <span class="string">"%&#123;[message][8]&#125;"</span>         <span class="comment">#数组是以0开始的，第9个字段在数组里角标为8</span></div><div class="line">	            		<span class="string">"loginip"</span> =&gt; <span class="string">"%&#123;[message][10]&#125;"</span></div><div class="line">        	    		<span class="string">"login_result"</span> =&gt; <span class="string">"%&#123;[message][5]&#125;"</span></div><div class="line">        		&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">	stdout &#123;</div><div class="line">		codec =&gt; rubydebug&#123;&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#输出结果</span></div><div class="line">&#123;</div><div class="line">          <span class="string">"offset"</span> =&gt; 136859,</div><div class="line">      <span class="string">"input_type"</span> =&gt; <span class="string">"log"</span>,</div><div class="line">          <span class="string">"source"</span> =&gt; <span class="string">"/var/log/secure"</span>,</div><div class="line">    <span class="string">"login_result"</span> =&gt; <span class="string">"Accepted"</span>,</div><div class="line">         <span class="string">"message"</span> =&gt; [</div><div class="line">        [ 0] <span class="string">"Nov"</span>,</div><div class="line">        [ 1] <span class="string">"16"</span>,</div><div class="line">        [ 2] <span class="string">"14:38:14"</span>,</div><div class="line">        [ 3] <span class="string">"localhost"</span>,</div><div class="line">        [ 4] <span class="string">"sshd[9305]:"</span>,</div><div class="line">        [ 5] <span class="string">"Accepted"</span>,</div><div class="line">        [ 6] <span class="string">"publickey"</span>,</div><div class="line">        [ 7] <span class="string">"for"</span>,</div><div class="line">        [ 8] <span class="string">"yfshare"</span>,</div><div class="line">        [ 9] <span class="string">"from"</span>,</div><div class="line">        [10] <span class="string">"192.168.1.123"</span>,</div><div class="line">        [11] <span class="string">"port"</span>,</div><div class="line">        [12] <span class="string">"2269"</span>,</div><div class="line">        [13] <span class="string">"ssh2:"</span>,</div><div class="line">        [14] <span class="string">"RSA"</span>,</div><div class="line">        [15] <span class="string">"51:37:66:2f:2b:c0:74:d1:0b:15:f8:9c:7f:84:64:0a"</span></div><div class="line">    ],</div><div class="line">            <span class="string">"type"</span> =&gt; <span class="string">"secure_2.250"</span>,</div><div class="line">        <span class="string">"ClientIP"</span> =&gt; <span class="string">"192.168.1.123"</span>,</div><div class="line">            <span class="string">"tags"</span> =&gt; [</div><div class="line">        [0] <span class="string">"beats_input_codec_plain_applied"</span></div><div class="line">    ],</div><div class="line">      <span class="string">"@timestamp"</span> =&gt; 2017-11-16T06:38:19.012Z,</div><div class="line">         <span class="string">"loginip"</span> =&gt; <span class="string">"192.168.1.123"</span>,</div><div class="line">        <span class="string">"@version"</span> =&gt; <span class="string">"1"</span>,</div><div class="line">            <span class="string">"beat"</span> =&gt; &#123;</div><div class="line">            <span class="string">"name"</span> =&gt; <span class="string">"localhost"</span>,</div><div class="line">        <span class="string">"hostname"</span> =&gt; <span class="string">"localhost"</span>,</div><div class="line">         <span class="string">"version"</span> =&gt; <span class="string">"5.6.4"</span></div><div class="line">    &#125;,</div><div class="line">            <span class="string">"host"</span> =&gt; <span class="string">"localhost"</span>,</div><div class="line">          <span class="string">"status"</span> =&gt; <span class="string">"Accepted"</span>,</div><div class="line">        <span class="string">"username"</span> =&gt; <span class="string">"yfshare"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在Kibana上的Visualize上选择Data Table。<br><img src="https://note.youdao.com/yws/api/personal/file/D6AC34D06690457AB5DBA55FC9A7768E?method=download&amp;shareKey=90c8da2df75c8d76924f8127a5e586a4" alt="Kianan_Visualize_dataTable"><br>如果报上面的错误<code>no cached mapping for this field. refresh field list from the management &gt; index patterns pageTransform</code><br>原因是我们自己新增字段后，Kibana上index是之前加上的，新增字段不存在会报错，刷新下index即可<br>解决方案是：<code>management &gt; index patterns</code>，刷新对应的index即可<br><img src="https://note.youdao.com/yws/api/personal/file/52309F704287411BA92143E8BEE341D0?method=download&amp;shareKey=55aa29e1eb3960f040f21e887c82c4fb" alt="Kianan_Visualize_dataTable">  </p>
<h4 id="Logstash的output插件之发生email"><a href="#Logstash的output插件之发生email" class="headerlink" title="Logstash的output插件之发生email"></a>Logstash的output插件之发生email</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.1/plugins-outputs-email.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.1/plugins-outputs-email.html</a><br><a href="https://kibana.logstash.es/content/logstash/plugins/output/email.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/output/email.html</a><br>outputs/email 插件支持 SMTP 协议和 sendmail 两种方式，通过 <code>via</code> 参数设置。SMTP 方式有较多的 options 参数可配置。sendmail 只能利用本机上的 sendmail 服务来完成  </p>
<p>126 邮箱发送到 qq 邮箱示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">output &#123;</div><div class="line">    email &#123;</div><div class="line">        port           =&gt;    <span class="string">"25"</span></div><div class="line">        address        =&gt;    <span class="string">"smtp.126.com"</span></div><div class="line">        username       =&gt;    <span class="string">"test@126.com"</span></div><div class="line">        password       =&gt;    <span class="string">""</span></div><div class="line">        authentication =&gt;    <span class="string">"plain"</span></div><div class="line">        use_tls        =&gt;    <span class="literal">true</span></div><div class="line">        from           =&gt;    <span class="string">"test@126.com"</span></div><div class="line">        subject        =&gt;    <span class="string">"Warning: %&#123;title&#125;"</span></div><div class="line">        to             =&gt;    <span class="string">"test@qq.com"</span></div><div class="line">        via            =&gt;    <span class="string">"smtp"</span></div><div class="line">        body           =&gt;    <span class="string">"%&#123;message&#125;"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Logstash的output插件之发生HDFS"><a href="#Logstash的output插件之发生HDFS" class="headerlink" title="Logstash的output插件之发生HDFS"></a>Logstash的output插件之发生HDFS</h4><p>参考：<a href="https://www.elastic.co/guide/en/logstash/5.6/plugins-outputs-webhdfs.html" target="_blank" rel="external">https://www.elastic.co/guide/en/logstash/5.6/plugins-outputs-webhdfs.html</a><br><a href="https://kibana.logstash.es/content/logstash/plugins/output/hdfs.html" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/output/hdfs.html</a><br>该插件最初来源于社区，目前已被官方收录，Logstash 5.6支持，使用的是Hadoop的 WebHDFS 接口，其本质是发送 POST 数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">input &#123;</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">  webhdfs &#123;</div><div class="line">    host =&gt; <span class="string">"127.0.0.1"</span>                 <span class="comment"># (required)</span></div><div class="line">    port =&gt; 50070                       <span class="comment"># (optional, default: 50070)</span></div><div class="line">    path =&gt; <span class="string">"/user/logstash/dt=%&#123;+YYYY-MM-dd&#125;/logstash-%&#123;+HH&#125;.log"</span>  <span class="comment"># (required)</span></div><div class="line">    user =&gt; <span class="string">"hue"</span>                       <span class="comment"># (required)</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>更多插件请见：<a href="https://kibana.logstash.es/content/logstash/plugins/filter/" target="_blank" rel="external">https://kibana.logstash.es/content/logstash/plugins/filter/</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="http://www.yfshare.vip">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="http://www.yfshare.vip/2017/11/18/Logstash插件/">http://www.yfshare.vip/2017/11/18/Logstash插件/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=2.0.0" async></script><a data-url="http://www.yfshare.vip/2017/11/18/Logstash插件/" data-id="cjja2hjx7002phwm5e5lxeyhm" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ELK/">ELK</a><a href="/tags/Logstash/">Logstash</a><a href="/tags/插件/">插件</a></div><div class="post-nav"><a href="/2017/11/22/ELK安装-基础/" class="pre">ELK安装(基础)</a><a href="/2017/11/14/Elasticsearch监控相关/" class="next">Elasticsearch监控相关</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'yfshare';
var disqus_identifier = '2017/11/18/Logstash插件/';
var disqus_title = 'Logstash插件';
var disqus_url = 'http://www.yfshare.vip/2017/11/18/Logstash插件/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//yfshare.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Atlassian/">Atlassian</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ELK/">ELK</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jenkins/">Jenkins</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/K8S/">K8S</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Virtualization/">Virtualization</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制系统/">版本控制系统</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/07/04/部署jenkins项目/">部署jenkins项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/30/部署Zabbix-3-4/">部署Zabbix 3.4</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/21/Ansible部署Jenkins环境/">Ansible部署Jenkins环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/28/k8s滚动升级-RollingUpdate/">k8s滚动升级(RollingUpdate)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/21/Ansible部署TLS-K8S/">Ansible部署TLS K8S</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/17/glusterfs做持久化存储/">glusterfs做持久化存储</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/14/Prometheus监控TLS-Kubernetes集群/">Prometheus监控TLS Kubernetes集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/23/部署TLS-k8s/">部署TLS k8s</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/11/自建docker私有仓库-Vmware-Harbor/">自建docker私有仓库(Vmware Harbor)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/20/The-Docker-of-Jira7-2-0-and-Confluence6-0-0/">The Docker of Jira7.2.0 and Confluence6.0.0</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yfshare.blog.51cto.com/" title="酱油瓶 博客" target="_blank">酱油瓶 博客</a><ul></ul><a href="http://zerosre.com/" title="龙哥zero 博客" target="_blank">龙哥zero 博客</a><ul></ul><a href="http://renzhiyuan.blog.51cto.com/" title="任志远Ray 博客" target="_blank">任志远Ray 博客</a><ul></ul><a href="http://rongrong.njdgwl.com" title="浩子的 博客" target="_blank">浩子的 博客</a><ul></ul><a href="http://www.cnblogs.com/aresxin/" title="欣哥aresxin 博客" target="_blank">欣哥aresxin 博客</a><ul></ul><a href="http://securityit.cn/" title="万马奔腾" target="_blank">万马奔腾</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-resources"> 资源站</i></div><ul></ul><a href="http://mirror.symnds.com/distributions/CentOS-vault/" title="Centos镜像站" target="_blank">Centos镜像站</a><ul></ul><a href="http://www.rpmfind.net/" title="rpmfind mirror" target="_blank">rpmfind mirror</a><ul></ul><a href="http://rpm.org/" title="rpm.org" target="_blank">rpm.org</a><ul></ul><a href="http://rpm.pbone.net/" title="rpm search" target="_blank">rpm search</a><ul></ul><a href="http://download.chinaunix.net/" title="chinaunix download" target="_blank">chinaunix download</a><ul></ul><a href="http://www.anquanquan.info/" title="安全圈info" target="_blank">安全圈info</a><ul></ul><a href="http://source.tosimp.net/" title="Tosimp 资源站" target="_blank">Tosimp 资源站</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=371362&auto=1&height=66"></iframe><div class="widget"><div class="widget-title"><i class="fa fa-external-game"> 游戏</i></div><ul></ul><a href="/2048" title="2048小游戏" target="_blank">2048小游戏</a><ul></ul><a href="/tantanqiu" title="变色弹球跳台阶小游戏" target="_blank">变色弹球跳台阶小游戏</a></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//yfshare.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Jack Wang Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=2.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=2.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=2.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3890bdc1bfaccae9364479b65f36fbd2";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=2.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=2.0.0"></script></div></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Blog"><title>Redis HA+Sentinel | Jack Wang Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis HA+Sentinel</h1><a id="logo" href="/.">Jack Wang Blog</a><p class="description">Goals determine what you are going to be</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Redis HA+Sentinel</h1><div class="post-meta">Nov 18, 2016<span> | </span><span class="category"><a href="/categories/Database/">Database</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/11/18/Redis-HA-Sentinel/" href="/2016/11/18/Redis-HA-Sentinel/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Sentinel介绍"><span class="toc-number">1.</span> <span class="toc-text">Sentinel介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置redis"><span class="toc-number">2.</span> <span class="toc-text">配置redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动redis"><span class="toc-number">3.</span> <span class="toc-text">启动redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署Sentinel节点"><span class="toc-number">4.</span> <span class="toc-text">部署Sentinel节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动sentinel"><span class="toc-number">5.</span> <span class="toc-text">启动sentinel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试Sentinel的故障转移"><span class="toc-number">6.</span> <span class="toc-text">测试Sentinel的故障转移</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据测试"><span class="toc-number">7.</span> <span class="toc-text">数据测试</span></a></li></ol></div></div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>sentinel是一个管理redis实例的工具，它可以实现对redis的监控、通知、自动故障转移。sentinel不断的检测redis实例是否可以正常工作，通过API向其他程序报告redis的状态，如果redis master不能工作，则会自动启动故障转移进程，将其中的一个slave提升为master，其他的slave重新设置新的master服务器。<br><a id="more"></a></p>
<h4 id="Sentinel介绍"><a href="#Sentinel介绍" class="headerlink" title="Sentinel介绍"></a>Sentinel介绍</h4><p>Redis Sentinel是一个分布式架构，包含若干个Sentinel节点和Redis数据节点，每个Sentinel节点会对数据节点和其余Sentinel节点进行监控，当发现节点不可达时，会对节点做下线标识.<br>如果被标识的是主节点，他还会选择和其他Sentinel节点进行“协商”，当大多数的Sentinel节点都认为主节点不可达时，他们会选举出一个Sentinel节点来完成自动故障转移工作，同时将这个变化通知给Redis应用方.<br>整个过程完全自动，不需要人工介入，所以可以很好解决Redis的高可用问题.  </p>
<p>redis主从复制<br>Redis主从复制可将主节点数据同步给从节点，从节点此时有两个作用:  </p>
<ul>
<li>一旦主节点宕机，从节点作为主节点的备份可以随时顶上来</li>
<li>扩展主节点的读能力，分担主节点读压力</li>
</ul>
<p>环境：<br>　　　Centos 7.4<br>　　　Redis version：3.2.10  </p>
<p>分别有3个Sentinel节点，1个主节点，2个从节点组成一个Redis Sentinel<br>Role | IP | Port<br>—|—|—<br>master | 192.168.1.100 | 6379<br>slave1 | 192.168.1.101 | 6379<br>slave2 | 192.168.1.200 | 6379<br>Sentinel1 | 192.168.1.100 | 26379<br>Sentinel2 | 192.168.1.101 | 26379<br>Sentinel3 | 192.168.1.200 | 26379</p>
<h4 id="配置redis"><a href="#配置redis" class="headerlink" title="配置redis"></a>配置redis</h4><p>关闭防火墙和selinux<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># iptables -F</span></div><div class="line">[root@localhost ~]<span class="comment"># setenforce 0</span></div></pre></td></tr></table></figure></p>
<p>三个redis部署在不同的服务器上<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum install -y https://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span></div><div class="line">[root@localhost ~]<span class="comment"># yum clean all</span></div><div class="line">[root@localhost ~]<span class="comment"># yum install redis</span></div></pre></td></tr></table></figure></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/E073E30FDFBC4276B112D4C796DF6709?method=download&amp;shareKey=0ff579ce084b511e88d0d5dbc1c8a792" alt="redis主从关系">  </p>
<p>master redis配置<br>打井号的为主要配置，其余为默认配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># grep -v '^#' /etc/redis.conf |grep -v '^$'</span></div><div class="line"><span class="built_in">bind</span> 192.168.1.100        <span class="comment">#</span></div><div class="line">protected-mode yes        <span class="comment">#</span></div><div class="line">port 6379                 <span class="comment">#</span></div><div class="line">tcp-backlog 511</div><div class="line">timeout 0</div><div class="line">tcp-keepalive 300</div><div class="line">daemonize yes             <span class="comment">#</span></div><div class="line">supervised no</div><div class="line">pidfile /var/run/redis_6379.pid</div><div class="line">loglevel notice</div><div class="line">logfile /var/<span class="built_in">log</span>/redis/redis.log</div><div class="line">databases 16</div><div class="line">save 900 1</div><div class="line">save 300 10</div><div class="line">save 60 10000</div><div class="line">stop-writes-on-bgsave-error yes</div><div class="line">rdbcompression yes</div><div class="line">rdbchecksum yes</div><div class="line">dbfilename dump.rdb</div><div class="line">dir /var/lib/redis</div><div class="line">slave-serve-stale-data yes</div><div class="line">slave-read-only yes</div><div class="line">repl-diskless-sync no</div><div class="line">repl-diskless-sync-delay 5</div><div class="line">repl-disable-tcp-nodelay no</div><div class="line">slave-priority 100</div><div class="line">requirepass 1234567           <span class="comment">#</span></div><div class="line">appendonly no</div><div class="line">appendfilename <span class="string">"appendonly.aof"</span></div><div class="line">appendfsync everysec</div><div class="line">no-appendfsync-on-rewrite no</div><div class="line">auto-aof-rewrite-percentage 100</div><div class="line">auto-aof-rewrite-min-size 64mb</div><div class="line">aof-load-truncated yes</div><div class="line">lua-time-limit 5000</div><div class="line">slowlog-log-slower-than 10000</div><div class="line">slowlog-max-len 128</div><div class="line">latency-monitor-threshold 0</div><div class="line">notify-keyspace-events <span class="string">""</span></div><div class="line"><span class="built_in">hash</span>-max-ziplist-entries 512</div><div class="line"><span class="built_in">hash</span>-max-ziplist-value 64</div><div class="line">list-max-ziplist-size -2</div><div class="line">list-compress-depth 0</div><div class="line"><span class="built_in">set</span>-max-intset-entries 512</div><div class="line">zset-max-ziplist-entries 128</div><div class="line">zset-max-ziplist-value 64</div><div class="line">hll-sparse-max-bytes 3000</div><div class="line">activerehashing yes</div><div class="line">client-output-buffer-limit normal 0 0 0</div><div class="line">client-output-buffer-limit slave 256mb 64mb 60</div><div class="line">client-output-buffer-limit pubsub 32mb 8mb 60</div><div class="line">hz 10</div><div class="line">aof-rewrite-incremental-fsync yes</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>slave1 redis配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># grep -v '^#' /etc/redis.conf |grep -v '^$'</span></div><div class="line"><span class="built_in">bind</span> 192.168.1.101               <span class="comment">#</span></div><div class="line">protected-mode yes               <span class="comment">#</span></div><div class="line">port 6379                        <span class="comment">#</span></div><div class="line">tcp-backlog 511</div><div class="line">timeout 0</div><div class="line">tcp-keepalive 300</div><div class="line">daemonize yes                    <span class="comment">#</span></div><div class="line">supervised no</div><div class="line">pidfile /var/run/redis_6379.pid</div><div class="line">loglevel notice</div><div class="line">logfile /var/<span class="built_in">log</span>/redis/redis.log</div><div class="line">databases 16</div><div class="line">save 900 1</div><div class="line">save 300 10</div><div class="line">save 60 10000</div><div class="line">stop-writes-on-bgsave-error yes</div><div class="line">rdbcompression yes</div><div class="line">rdbchecksum yes</div><div class="line">dbfilename dump.rdb</div><div class="line">dir /var/lib/redis</div><div class="line">slaveof 192.168.1.100 6379           <span class="comment">#</span></div><div class="line">masterauth <span class="string">"1234567"</span>                 <span class="comment">#</span></div><div class="line">slave-serve-stale-data yes</div><div class="line">slave-read-only yes</div><div class="line">repl-diskless-sync no</div><div class="line">repl-diskless-sync-delay 5</div><div class="line">repl-disable-tcp-nodelay no</div><div class="line">slave-priority 100</div><div class="line">appendonly no</div><div class="line">appendfilename <span class="string">"appendonly.aof"</span></div><div class="line">appendfsync everysec</div><div class="line">no-appendfsync-on-rewrite no</div><div class="line">auto-aof-rewrite-percentage 100</div><div class="line">auto-aof-rewrite-min-size 64mb</div><div class="line">aof-load-truncated yes</div><div class="line">lua-time-limit 5000</div><div class="line">slowlog-log-slower-than 10000</div><div class="line">slowlog-max-len 128</div><div class="line">latency-monitor-threshold 0</div><div class="line">notify-keyspace-events <span class="string">""</span></div><div class="line"><span class="built_in">hash</span>-max-ziplist-entries 512</div><div class="line"><span class="built_in">hash</span>-max-ziplist-value 64</div><div class="line">list-max-ziplist-size -2</div><div class="line">list-compress-depth 0</div><div class="line"><span class="built_in">set</span>-max-intset-entries 512</div><div class="line">zset-max-ziplist-entries 128</div><div class="line">zset-max-ziplist-value 64</div><div class="line">hll-sparse-max-bytes 3000</div><div class="line">activerehashing yes</div><div class="line">client-output-buffer-limit normal 0 0 0</div><div class="line">client-output-buffer-limit slave 256mb 64mb 60</div><div class="line">client-output-buffer-limit pubsub 32mb 8mb 60</div><div class="line">hz 10</div><div class="line">aof-rewrite-incremental-fsync yes</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>slave2 redis配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># grep -v '^#' /etc/redis.conf |grep -v '^$'</span></div><div class="line"><span class="built_in">bind</span> 192.168.1.200                <span class="comment">#</span></div><div class="line">protected-mode yes                <span class="comment">#</span></div><div class="line">port 6379                         <span class="comment">#</span></div><div class="line">tcp-backlog 511</div><div class="line">timeout 0</div><div class="line">tcp-keepalive 300</div><div class="line">daemonize yes                     <span class="comment">#</span></div><div class="line">supervised no</div><div class="line">pidfile /var/run/redis_6379.pid</div><div class="line">loglevel notice</div><div class="line">logfile /var/<span class="built_in">log</span>/redis/redis.log</div><div class="line">databases 16</div><div class="line">save 900 1</div><div class="line">save 300 10</div><div class="line">save 60 10000</div><div class="line">stop-writes-on-bgsave-error yes</div><div class="line">rdbcompression yes</div><div class="line">rdbchecksum yes</div><div class="line">dbfilename dump.rdb</div><div class="line">dir /var/lib/redis</div><div class="line">slaveof 192.168.1.100 6379        <span class="comment">#</span></div><div class="line">masterauth <span class="string">"1234567"</span>              <span class="comment">#</span></div><div class="line">slave-serve-stale-data yes</div><div class="line">slave-read-only yes</div><div class="line">repl-diskless-sync no</div><div class="line">repl-diskless-sync-delay 5</div><div class="line">repl-disable-tcp-nodelay no</div><div class="line">slave-priority 100</div><div class="line">appendonly no</div><div class="line">appendfilename <span class="string">"appendonly.aof"</span></div><div class="line">appendfsync everysec</div><div class="line">no-appendfsync-on-rewrite no</div><div class="line">auto-aof-rewrite-percentage 100</div><div class="line">auto-aof-rewrite-min-size 64mb</div><div class="line">aof-load-truncated yes</div><div class="line">lua-time-limit 5000</div><div class="line">slowlog-log-slower-than 10000</div><div class="line">slowlog-max-len 128</div><div class="line">latency-monitor-threshold 0</div><div class="line">notify-keyspace-events <span class="string">""</span></div><div class="line"><span class="built_in">hash</span>-max-ziplist-entries 512</div><div class="line"><span class="built_in">hash</span>-max-ziplist-value 64</div><div class="line">list-max-ziplist-size -2</div><div class="line">list-compress-depth 0</div><div class="line"><span class="built_in">set</span>-max-intset-entries 512</div><div class="line">zset-max-ziplist-entries 128</div><div class="line">zset-max-ziplist-value 64</div><div class="line">hll-sparse-max-bytes 3000</div><div class="line">activerehashing yes</div><div class="line">client-output-buffer-limit normal 0 0 0</div><div class="line">client-output-buffer-limit slave 256mb 64mb 60</div><div class="line">client-output-buffer-limit pubsub 32mb 8mb 60</div><div class="line">hz 10</div><div class="line">aof-rewrite-incremental-fsync yes</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h4 id="启动redis"><a href="#启动redis" class="headerlink" title="启动redis"></a>启动redis</h4><p>先启动redis master，在启动redis slave<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># redis-server /etc/redis.conf</span></div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># redis-cli -h 192.168.1.100 -p 6379 -a '1234567'</span></div><div class="line">192.168.1.100:6379&gt; info replication</div><div class="line"><span class="comment"># Replication</span></div><div class="line">role:master</div><div class="line">connected_slaves:2</div><div class="line">slave0:ip=192.168.1.101,port=6379,state=online,offset=1,lag=0</div><div class="line">slave1:ip=192.168.1.200,port=6379,state=online,offset=1,lag=0</div><div class="line">master_repl_offset:1</div><div class="line">repl_backlog_active:1</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:2</div><div class="line">repl_backlog_histlen:0</div><div class="line">192.168.1.100:6379&gt;</div></pre></td></tr></table></figure>
<h4 id="部署Sentinel节点"><a href="#部署Sentinel节点" class="headerlink" title="部署Sentinel节点"></a>部署Sentinel节点</h4><p>三个Sentinel部署在不同的服务器上  </p>
<p>Sentinel1配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># grep -iv '^#' /etc/redis-sentinel.conf | grep -iv '^$'</span></div><div class="line"><span class="built_in">bind</span> 192.168.1.100        <span class="comment">#</span></div><div class="line">port 26379                <span class="comment">#</span></div><div class="line">daemon yes                <span class="comment">#</span></div><div class="line">dir <span class="string">"/opt/redis-sentinel/data"</span>       <span class="comment">#</span></div><div class="line"><span class="comment">#当前Sentinel节点监控192.168.1.100:6379这个主节点</span></div><div class="line"><span class="comment">#2代表判断主节点失败至少需要2个Sentinel节点同意</span></div><div class="line"><span class="comment">#mymaster是主节点的别名</span></div><div class="line">sentinel monitor mymaster 192.168.1.100 6379 2    <span class="comment">#</span></div><div class="line">sentinel auth-pass mymaster 1234567               <span class="comment">#redis启动了身份验证</span></div><div class="line"><span class="comment">#每个Sentinel节点都要定期PING命令来判断Redis数据节点和其余Sentinel节点是否可达，如果超过30000毫秒且没有回复，则判定不可达</span></div><div class="line">sentinel down-after-milliseconds mymaster 30000</div><div class="line"><span class="comment">#当Sentinel节点集合对主节点故障判定达成一致时，Sentinel领导者节点会做故障转移操作，选出新的主节点，原来的从节点会向新的主节点发起复制操作，限制每次向新的主节点发起复制操作的从节点个数为1</span></div><div class="line">sentinel parallel-syncs mymaster 1</div><div class="line"><span class="comment">#故障转移超时时间为180000毫秒</span></div><div class="line">sentinel failover-timeout mymaster 180000</div><div class="line">logfile /var/<span class="built_in">log</span>/redis/sentinel.log</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h4 id="启动sentinel"><a href="#启动sentinel" class="headerlink" title="启动sentinel"></a>启动sentinel</h4><p><img src="https://note.youdao.com/yws/api/personal/file/4FE2253C42C4407BBF2CFD8702B70DDA?method=download&amp;shareKey=bdc18c3e861af6b6dea8bf8c6a6c5339" alt="Sentinelt拓扑图"><br>当部署号Redis Sentinel之后，会有如下变化  </p>
<ul>
<li>Sentinel节点自动发现了从节点、其余Sentinel节点  </li>
<li>去掉了默认配置，例如：<code>parallel-syncs</code>、<code>failover-timeout</code>  </li>
<li>新添加了纪元(epoch)参数  </li>
</ul>
<p>需要先启动sentinel再启动redis<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># redis-sentinel /etc/redis-sentinel.conf &amp;</span></div><div class="line">[root@localhost ~]<span class="comment"># redis-server /etc/redis.conf</span></div></pre></td></tr></table></figure></p>
<p>查看日志<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">11116:X 28 Apr 00:59:09.095 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced be cause /proc/sys/net/core/somaxconn is set to the lower value of 128.11116:X 28 Apr 00:59:09.095 # Sentinel ID is 1f8abc9be76435a72401e236767cced5c8d535ba</span></div><div class="line">11116:X 28 Apr 00:59:09.095 <span class="comment"># +monitor master mymaster 192.168.1.100 6379 quorum 2</span></div><div class="line">11116:X 28 Apr 00:59:29.978 * +sentinel sentinel 8f2a2091de02341d21d8f5fb9e00cbf72112e007 192.168.1.200 26379 @ mymaster 192.168.1.100 637911116:X 28 Apr 00:59:31.748 * +sentinel sentinel 9b905b81691a53a5b2ae53b7bbb9b286f047f5b6 192.168.1.101 26379 @ mymaster 192.168.1.100 637911116:X 28 Apr 00:59:49.953 * +slave slave 192.168.1.101:6379 192.168.1.101 6379 @ mymaster 192.168.1.100 637911116:X 28 Apr 00:59:49.967 * +slave slave 192.168.1.200:6379 192.168.1.200 6379 @ mymaster 192.168.1.100 6379</div></pre></td></tr></table></figure></p>
<p>通过redis sentinel日志可以看到redis-192.168.1.101和redis-192.168.1.200已经加入到mymaster组，现在mymaster组有三台redis服务器了  </p>
<p>在主节点上看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">192.168.1.100:6379&gt; info replication</div><div class="line"><span class="comment"># Replication</span></div><div class="line">role:master</div><div class="line">connected_slaves:2</div><div class="line">slave0:ip=192.168.1.101,port=6379,state=online,offset=132341,lag=1</div><div class="line">slave1:ip=192.168.1.200,port=6379,state=online,offset=132341,lag=1</div><div class="line">master_repl_offset:132341</div><div class="line">repl_backlog_active:1</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:2</div><div class="line">repl_backlog_histlen:132340</div><div class="line">192.168.1.100:6379&gt;</div></pre></td></tr></table></figure></p>
<p>在从节点上看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">192.168.1.101:6379&gt; info replication</div><div class="line"><span class="comment"># Replication</span></div><div class="line">role:slave</div><div class="line">master_host:192.168.1.100</div><div class="line">master_port:6379</div><div class="line">master_link_status:down</div><div class="line">master_last_io_seconds_ago:-1</div><div class="line">master_sync_in_progress:0</div><div class="line">slave_repl_offset:421</div><div class="line">master_link_down_since_seconds:43</div><div class="line">slave_priority:100</div><div class="line">slave_read_only:1</div><div class="line">connected_slaves:0</div><div class="line">master_repl_offset:0</div><div class="line">repl_backlog_active:0</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:0</div><div class="line">repl_backlog_histlen:0</div><div class="line">192.168.1.101:6379&gt;</div></pre></td></tr></table></figure></p>
<h4 id="测试Sentinel的故障转移"><a href="#测试Sentinel的故障转移" class="headerlink" title="测试Sentinel的故障转移"></a>测试Sentinel的故障转移</h4><p><img src="https://note.youdao.com/yws/api/personal/file/944C4B085C2C47819121FA6349C756FF?method=download&amp;shareKey=6d541872aca92f1f23c4c6fd4568d419" alt="redis节点终止复制">  </p>
<p>Redis Sentinel对主节点进行客观下线（Objectively Down， 简称 ODOWN）的判断，确认主节点不可达，则通知从节点中止复制主节点的操作<br>当主节点下线时长超过配置的下线时长30000秒，<code>Redis Sentinel</code>执行故障转移操作  </p>
<p>手动让redis master(192.168.1.100)下线<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ps -ef |grep -i redis | egrep -iv 'color|grep'</span></div><div class="line">root      11120      1  0 00:59 ?        00:00:05 redis-server 192.168.1.100:6379</div><div class="line">[root@localhost ~]<span class="comment"># kill 11120</span></div></pre></td></tr></table></figure></p>
<p>再来看下redis sentinel日志<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">11116:X 28 Apr 01:13:24.489 <span class="comment"># +sdown master mymaster 192.168.1.100 6379</span></div><div class="line">11116:X 28 Apr 01:13:24.531 <span class="comment"># +new-epoch 1</span></div><div class="line">11116:X 28 Apr 01:13:24.533 <span class="comment"># +vote-for-leader 9b905b81691a53a5b2ae53b7bbb9b286f047f5b6 1</span></div><div class="line">11116:X 28 Apr 01:13:24.566 <span class="comment"># +odown master mymaster 192.168.1.100 6379 #quorum 3/2</span></div><div class="line">11116:X 28 Apr 01:13:24.567 <span class="comment"># Next failover delay: I will not start a failover before Sat Apr 28 01:19:24 201811116:X 28 Apr 01:13:25.238 # +config-update-from sentinel 9b905b81691a53a5b2ae53b7bbb9b286f047f5b6 192.168.1.101 26379 @ mymaster 192.168.1.100 637911116:X 28 Apr 01:13:25.239 # +switch-master mymaster 192.168.1.100 6379 192.168.1.200 6379</span></div><div class="line">11116:X 28 Apr 01:13:25.240 * +slave slave 192.168.1.101:6379 192.168.1.101 6379 @ mymaster 192.168.1.200 6379</div></pre></td></tr></table></figure></p>
<p>通过日志观察，现在redis master切换到redis-192.168.1.200上了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">192.168.1.200:6379&gt; info replication</div><div class="line"><span class="comment"># Replication</span></div><div class="line">role:master</div><div class="line">connected_slaves:0</div><div class="line">master_repl_offset:0</div><div class="line">repl_backlog_active:0</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:0</div><div class="line">repl_backlog_histlen:0</div><div class="line">192.168.1.200:6379&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">192.168.1.101:6379&gt; info replication</div><div class="line"><span class="comment"># Replication</span></div><div class="line">role:slave</div><div class="line">master_host:192.168.1.200</div><div class="line">master_port:6379</div><div class="line">master_link_status:down</div><div class="line">master_last_io_seconds_ago:-1</div><div class="line">master_sync_in_progress:0</div><div class="line">slave_repl_offset:1</div><div class="line">master_link_down_since_seconds:1524849879</div><div class="line">slave_priority:100</div><div class="line">slave_read_only:1</div><div class="line">connected_slaves:0</div><div class="line">master_repl_offset:0</div><div class="line">repl_backlog_active:0</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:0</div><div class="line">repl_backlog_histlen:0</div><div class="line">192.168.1.101:6379&gt;</div></pre></td></tr></table></figure>
<p><img src="https://note.youdao.com/yws/api/personal/file/5EDB333796B64D89AE22BE52AA3568A4?method=download&amp;shareKey=762ff90f872888bf53fbbd3f107be608" alt="redis降级"><br>从上面的逻辑架构和故障转移试验中，可以看出Redis Sentinel的以下几个功能  </p>
<ul>
<li>监控：Sentinel节点会定期检测Redis数据节点和其余Sentinel节点是否可达  </li>
<li>通知：Sentinel节点会将故障转移通知给应用方  </li>
<li>主节点故障转移：实现从节点晋升为主节点并维护后续正确的主从关系  </li>
<li>配置提供者：在Redis Sentinel结构中，客户端在初始化的时候连接的是Sentinel节点集合，从中获取主节点信息  </li>
</ul>
<p><img src="https://note.youdao.com/yws/api/personal/file/63A94A6AE11442378D1791244FD1BF2E?method=download&amp;shareKey=7db2ae3f78913cb6a11bfedaee09ea4c" alt="redis连接中断"><br>现在启动redis-192.168.1.100，再来看看下redis sentinel日志<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">11116:X 28 Apr 01:26:08.209 * +convert-to-slave slave 192.168.1.100:6379 192.168.1.100 6379 @ mymaster 192.168.1.200 6379</div></pre></td></tr></table></figure></p>
<p>通过查看redis sentinel日志，当redis-192.168.1.100上线后，角色转换为slave了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">192.168.1.100:6379&gt; info replication</div><div class="line"><span class="comment"># Replication</span></div><div class="line">role:slave</div><div class="line">master_host:192.168.1.200</div><div class="line">master_port:6379</div><div class="line">master_link_status:up</div><div class="line">master_last_io_seconds_ago:0</div><div class="line">master_sync_in_progress:0</div><div class="line">slave_repl_offset:82068</div><div class="line">slave_priority:100</div><div class="line">slave_read_only:1</div><div class="line">connected_slaves:0</div><div class="line">master_repl_offset:0</div><div class="line">repl_backlog_active:0</div><div class="line">repl_backlog_size:1048576</div><div class="line">repl_backlog_first_byte_offset:0</div><div class="line">repl_backlog_histlen:0</div><div class="line">192.168.1.100:6379&gt;</div></pre></td></tr></table></figure></p>
<h4 id="数据测试"><a href="#数据测试" class="headerlink" title="数据测试"></a>数据测试</h4><p>redis主节点数据写入测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">192.168.1.100:6379&gt; <span class="built_in">set</span> myname jack_wang</div><div class="line">OK</div><div class="line">192.168.1.100:6379&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">192.168.1.101:6379&gt; keys *</div><div class="line">1) <span class="string">"myname"</span></div><div class="line">192.168.1.101:6379&gt;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">192.168.1.200:6379&gt; keys *</div><div class="line">1) <span class="string">"myname"</span></div><div class="line">192.168.1.200:6379&gt;</div></pre></td></tr></table></figure>
<p>OK，测试成功。  </p>
<p>注：这个版本的redis好像没有<code>sentinel</code>命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192.168.1.100:6379&gt; sentinel masters</div><div class="line">(error) ERR unknown <span class="built_in">command</span> <span class="string">'sentinel'</span></div></pre></td></tr></table></figure></p>
<p>参考：<a href="https://blog.csdn.net/men_wen/article/details/72724406" target="_blank" rel="external">https://blog.csdn.net/men_wen/article/details/72724406</a>  </p>
<hr>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/2.5/cn/" target="_blank" rel="external">知识共享署名 2.5 中国大陆许可协议</a>进行许可，欢迎转载，但转载请注明来自<a href="http://www.yfshare.vip">Jack Wang Blog</a>，并保持转载后文章内容的完整。本人保留所有版权相关权利。<br><img src="http://note.youdao.com/yws/api/personal/file/FE3C6F68961F4541AF284E5F346FC3CA?method=download&amp;shareKey=c5e4c3ca81daa6e908d5630f8c6ec242" alt="打赏"><br>本文出自”Jack Wang Blog”：<a href="http://www.yfshare.vip/2016/11/18/Redis-HA-Sentinel/">http://www.yfshare.vip/2016/11/18/Redis-HA-Sentinel/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=2.0.0" async></script><a data-url="http://www.yfshare.vip/2016/11/18/Redis-HA-Sentinel/" data-id="cjo4db9lj003s9cm5yqyuh6wn" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Redis/">Redis</a><a href="/tags/HA/">HA</a><a href="/tags/Sentinel/">Sentinel</a></div><div class="post-nav"><a href="/2017/02/13/使用GitHub-Hexo搭建免费静态Blog/" class="pre">使用GitHub-Hexo搭建免费静态Blog</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'yfshare';
var disqus_identifier = '2016/11/18/Redis-HA-Sentinel/';
var disqus_title = 'Redis HA+Sentinel';
var disqus_url = 'http://www.yfshare.vip/2016/11/18/Redis-HA-Sentinel/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//yfshare.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Atlassian/">Atlassian</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ELK/">ELK</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jenkins/">Jenkins</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/K8S/">K8S</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Virtualization/">Virtualization</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制系统/">版本控制系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维知识体系/">运维知识体系</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/04/Python升级/">Python升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/node-exporter自定义key/">node_exporter自定义key</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/04/Python运算符/">Python运算符</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/27/运维知识体系之操作系统层/">运维知识体系之操作系统层</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/04/部署jenkins项目/">部署jenkins项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/30/部署Zabbix-3-4/">部署Zabbix 3.4</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/21/Ansible部署Jenkins环境/">Ansible部署Jenkins环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/28/k8s滚动升级-RollingUpdate/">k8s滚动升级(RollingUpdate)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/21/Ansible部署TLS-K8S/">Ansible部署TLS K8S</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/17/glusterfs做持久化存储/">glusterfs做持久化存储</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yfshare.blog.51cto.com/" title="酱油瓶 博客" target="_blank">酱油瓶 博客</a><ul></ul><a href="http://zerosre.com/" title="龙哥zero 博客" target="_blank">龙哥zero 博客</a><ul></ul><a href="http://renzhiyuan.blog.51cto.com/" title="任志远Ray 博客" target="_blank">任志远Ray 博客</a><ul></ul><a href="http://rongrong.njdgwl.com" title="浩子的 博客" target="_blank">浩子的 博客</a><ul></ul><a href="http://www.cnblogs.com/aresxin/" title="欣哥aresxin 博客" target="_blank">欣哥aresxin 博客</a><ul></ul><a href="http://securityit.cn/" title="万马奔腾" target="_blank">万马奔腾</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-resources"> 资源站</i></div><ul></ul><a href="http://mirror.symnds.com/distributions/CentOS-vault/" title="Centos镜像站" target="_blank">Centos镜像站</a><ul></ul><a href="http://www.rpmfind.net/" title="rpmfind mirror" target="_blank">rpmfind mirror</a><ul></ul><a href="http://rpm.org/" title="rpm.org" target="_blank">rpm.org</a><ul></ul><a href="http://rpm.pbone.net/" title="rpm search" target="_blank">rpm search</a><ul></ul><a href="http://download.chinaunix.net/" title="chinaunix download" target="_blank">chinaunix download</a><ul></ul><a href="http://www.anquanquan.info/" title="安全圈info" target="_blank">安全圈info</a><ul></ul><a href="http://source.tosimp.net/" title="Tosimp 资源站" target="_blank">Tosimp 资源站</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=371362&auto=1&height=66"></iframe><div class="widget"><div class="widget-title"><i class="fa fa-external-game"> 游戏</i></div><ul></ul><a href="/2048" title="2048小游戏" target="_blank">2048小游戏</a><ul></ul><a href="/tantanqiu" title="变色弹球跳台阶小游戏" target="_blank">变色弹球跳台阶小游戏</a></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//yfshare.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Jack Wang Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=2.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=2.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=2.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3890bdc1bfaccae9364479b65f36fbd2";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=2.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=2.0.0"></script></div></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Blog"><title>Python十行代码爬抖音 | Jack Wang Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python十行代码爬抖音</h1><a id="logo" href="/.">Jack Wang Blog</a><p class="description">Goals determine what you are going to be</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python十行代码爬抖音</h1><div class="post-meta">Nov 6, 2018<span> | </span><span class="category"><a href="/categories/Python/">Python</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2018/11/06/Python十行代码爬抖音/" href="/2018/11/06/Python十行代码爬抖音/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果图"><span class="toc-number">1.</span> <span class="toc-text">效果图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#环境说明"><span class="toc-number">2.</span> <span class="toc-text">环境说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署"><span class="toc-number">3.</span> <span class="toc-text">部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#py脚本"><span class="toc-number">4.</span> <span class="toc-text">py脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解读"><span class="toc-number">5.</span> <span class="toc-text">代码解读</span></a></li></ol></div></div><div class="post-content"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>今天看到一篇文章介绍怎么用python来爬抖音的小视频和音乐。于是兴趣大增，先来试试能不能玩，哈哈。<br><a id="more"></a><br>先来看个效果图，嗯嗯…  </p>
<h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="https://note.youdao.com/yws/api/personal/file/39A6E0DC37EA4772BFFFE2FB749455C3?method=download&amp;shareKey=0f9dc13147fe991223234ff80d468afe" alt="py_video">  </p>
<h4 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h4><p>环境：<br>　　　python 3.7.1<br>　　　centos 7.4<br>　　　pip 10.0.1  </p>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># python3.7 --version</span></div><div class="line">Python <span class="number">3.7</span><span class="number">.1</span></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># pip3 install douyin</span></div></pre></td></tr></table></figure>
<p><img src="https://note.youdao.com/yws/api/personal/file/6C5A7B9EE298427E8EB44FCBB98C773D?method=download&amp;shareKey=ded7cd2ee3b179a0fc1f7830eb827fc4" alt="py_install_douyin"><br>有时候因为网络原因会安装失败，这时重新执行上面的命令即可，直到安装完成。  </p>
<p>导入douyin模块<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># python3.7</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> douyin</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>导入如果报错的话，可能douyin模块没有安装成功。  </p>
<p>下面我们开始爬…爬抖音小视频和音乐咯<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost douyin]<span class="comment"># python3.7 dou.py</span></div></pre></td></tr></table></figure></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/D3CE0E55A29F4CDE95B30643D179053B?method=download&amp;shareKey=e17a3c7a177e531471edfbc4c571bcf2" alt="py_download"><br><img src="https://note.youdao.com/yws/api/personal/file/04D69EAF98CB47098B498897383F693F?method=download&amp;shareKey=6f37956f071cc65b949c67ea8c715358" alt="py_download">  </p>
<p>几分钟后…我们来看看爬的成果<br>可以看到视频配的音乐被存储成了 mp3 格式的文件，抖音视频存储成了 mp4 文件。<br><img src="https://note.youdao.com/yws/api/personal/file/77B9BD11581D4D61A825B0AAD07CD12F?method=download&amp;shareKey=9d5eb61e94e2d418f1ebf1315075134f" alt="py_download">  </p>
<p>嗯…不错，哈哈。  </p>
<h4 id="py脚本"><a href="#py脚本" class="headerlink" title="py脚本"></a>py脚本</h4><p>作者说，能爬抖音上所有热门话题和音乐下的相关视频都爬取到，并且将爬到的视频下载下来，同时还要把视频所配的音乐也单独下载下来，不仅如此，所有视频的相关信息如发布人、点赞数、评论数、发布时间、发布人、发布地点等等信息都需要爬取下来，并存储到 MongoDB 数据库。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> douyin</div><div class="line"><span class="keyword">from</span> douyin.structures <span class="keyword">import</span> Topic, Music</div><div class="line"></div><div class="line"><span class="comment"># 定义视频下载、音频下载、MongoDB 存储的处理器</span></div><div class="line">video_file_handler = douyin.handlers.VideoFileHandler(folder=<span class="string">'./videos'</span>)</div><div class="line">music_file_handler = douyin.handlers.MusicFileHandler(folder=<span class="string">'./musics'</span>)</div><div class="line"><span class="comment">#mongo_handler = douyin.handlers.MongoHandler()</span></div><div class="line"><span class="comment"># 定义下载器，并将三个处理器当做参数传递</span></div><div class="line"><span class="comment">#downloader = douyin.downloaders.VideoDownloader([mongo_handler, video_file_handler, music_file_handler])</span></div><div class="line">downloader = douyin.downloaders.VideoDownloader([video_file_handler, music_file_handler])</div><div class="line"><span class="comment"># 循环爬取抖音热榜信息并下载存储</span></div><div class="line"><span class="keyword">for</span> result <span class="keyword">in</span> douyin.hot.trend():</div><div class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> result.data:</div><div class="line">        <span class="comment"># 爬取热门话题和热门音乐下面的所有视频，每个话题或音乐最多爬取 10 个相关视频。</span></div><div class="line">        downloader.download(item.videos(max=<span class="number">10</span>))</div></pre></td></tr></table></figure></p>
<p>由于我这里没有mongodb所以，把这mongodb相关的配置给注释掉了。<br>作者github地址：<a href="https://github.com/Python3WebSpider/DouYin" target="_blank" rel="external">https://github.com/Python3WebSpider/DouYin</a>  </p>
<p>====以下摘自作者====</p>
<h4 id="代码解读"><a href="#代码解读" class="headerlink" title="代码解读"></a>代码解读</h4><p>本库依赖的其他库有：  </p>
<ul>
<li>aiohttp：利用它可以完成异步数据下载，加快下载速度  </li>
<li>dateparser：利用它可以完成任意格式日期的转化  </li>
<li>motor：利用它可以完成异步 MongoDB 存储，加快存储速度  </li>
<li>requests：利用它可以完成最基本的 HTTP 请求模拟  </li>
<li>tqdm：利用它可以进行进度条的展示  </li>
</ul>
<p><strong>数据结构定义</strong><br>如果要做一个库的话，一个很重要的点就是对一些关键的信息进行结构化的定义，使用面向对象的思维对某些对象进行封装，抖音的爬取也不例外。  </p>
<p>在抖音中，其实有很多种对象，比如视频、音乐、话题、用户、评论等等，它们之间通过某种关系联系在一起，例如视频中使用了某个配乐，那么视频和音乐就存在使用关系；比如用户发布了视频，那么用户和视频就存在发布关系，我们可以使用面向对象的思维对每个对象进行封装，比如视频的话，就可以定义成如下结构：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Video</span><span class="params">(Base)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        init video object</div><div class="line">        :param kwargs:</div><div class="line">        """</div><div class="line">        super().__init__()</div><div class="line">        self.id = kwargs.get(<span class="string">'id'</span>)</div><div class="line">        self.desc = kwargs.get(<span class="string">'desc'</span>)</div><div class="line">        self.author = kwargs.get(<span class="string">'author'</span>)</div><div class="line">        self.music = kwargs.get(<span class="string">'music'</span>)</div><div class="line">        self.like_count = kwargs.get(<span class="string">'like_count'</span>)</div><div class="line">        self.comment_count = kwargs.get(<span class="string">'comment_count'</span>)</div><div class="line">        self.share_count = kwargs.get(<span class="string">'share_count'</span>)</div><div class="line">        self.hot_count = kwargs.get(<span class="string">'hot_count'</span>)</div><div class="line">        ...</div><div class="line">        self.address = kwargs.get(<span class="string">'address'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        video to str</div><div class="line">        :return: str</div><div class="line">        """</div><div class="line">        <span class="keyword">return</span> <span class="string">'&lt;Video: &lt;%s, %s&gt;&gt;'</span> % (self.id, self.desc[:<span class="number">10</span>].strip() <span class="keyword">if</span> self.desc <span class="keyword">else</span> <span class="keyword">None</span>)</div></pre></td></tr></table></figure></p>
<p>这里将一些关键的属性定义成 Video 类的一部分，包括 id 索引、desc 描述、author 发布人、music 配乐等等，其中 author 和 music 并不是简单的字符串的形式，它也是单独定义的数据结构，比如 author 就是 User 类型的对象，而 User 的定义又是如下结构：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        init user object</div><div class="line">        :param kwargs:</div><div class="line">        """</div><div class="line">        super().__init__()</div><div class="line">        self.id = kwargs.get(<span class="string">'id'</span>)</div><div class="line">        self.gender = kwargs.get(<span class="string">'gender'</span>)</div><div class="line">        self.name = kwargs.get(<span class="string">'name'</span>)</div><div class="line">        self.create_time = kwargs.get(<span class="string">'create_time'</span>)</div><div class="line">        self.birthday = kwargs.get(<span class="string">'birthday'</span>)</div><div class="line">        ...</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        user to str</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        <span class="keyword">return</span> <span class="string">'&lt;User: &lt;%s, %s&gt;&gt;'</span> % (self.alias, self.name)</div></pre></td></tr></table></figure></p>
<p>所以说，通过属性之间的关联，我们就可以将不同的对象关联起来，这样显得逻辑架构清晰，而且我们也不用一个个单独维护字典来存储了，其实这就和 Scrapy 里面的 Item 的定义是类似的。  </p>
<p><strong>请求和重试</strong><br>实现爬取的过程就不必多说了，这里面其实用到的就是最简单的抓包技巧，使用 Charles 直接进行抓包即可。抓包之后便可以观察到对应的接口请求，然后进行模拟即可。  </p>
<p>所以问题就来了，难道我要一个接口写一个请求方法吗？另外还要配置 Headers、超时时间等等的内容，那岂不是太费劲了，所以，我们可以将请求的方法进行单独的封装，这里我定义了一个 fetch 方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fetch</span><span class="params">(url, **kwargs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    fetch api response</div><div class="line">    :param url: fetch url</div><div class="line">    :param kwargs: other requests params</div><div class="line">    :return: json of response</div><div class="line">    """</div><div class="line">    response = requests.get(url, **kwargs)</div><div class="line">    <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</div><div class="line">        <span class="keyword">raise</span> requests.ConnectionError(<span class="string">'Expected status code 200, but got &#123;&#125;'</span>.format(response.status_code))</div><div class="line">    <span class="keyword">return</span> response.json()</div></pre></td></tr></table></figure></p>
<p>这个方法留了一个必要参数，即 url，另外其他的配置我留成了 kwargs，也就是可以任意传递，传递之后，它会依次传递给 requests 的请求方法，然后这里还做了异常处理，如果成功请求，即可返回正常的请求结果。  </p>
<p>定义了这个方法，在其他的调用方法里面我们只需要单独调用这个 fetch 方法即可，而不需要再去关心异常处理，返回类型了。  </p>
<p>好，那么定义好了请求之后，如果出现了请求失败怎么办呢？按照常规的方法，我们可能就会在外面套一层方法，然后记录调用 fetch 方法请求失败的次数，然后重新调用 fetch 方法进行重试，但这里可以告诉大家一个更好用的库，叫做 retrying，使用它我们可以通过定义一个装饰器来完成重试的操作。  </p>
<p>比如我可以使用 retry 装饰器这么装饰 fetch 方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</div><div class="line"></div><div class="line"><span class="meta">@retry(stop_max_attempt_number=retry_max_number, wait_random_min=retry_min_random_wait,</span></div><div class="line">           wait_random_max=retry_max_random_wait, retry_on_exception=need_retry)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fetch</span><span class="params">(url, **kwargs)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p>这里使用了装饰器的四个参数：  </p>
<ul>
<li>stop_max_attempt_number：最大重试次数，如果重试次数达到该次数则放弃重试  </li>
<li>wait_random_min：下次重试之前随机等待时间的最小值  </li>
<li>wait_random_max：下次重试之前随机等待时间的最大值  </li>
<li>retry_on_exception：判断出现了怎样的异常才重试  </li>
</ul>
<p>这里 retry_on_exception 参数指定了一个方法，叫做 need_retry，方法定义如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">need_retry</span><span class="params">(exception)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    need to retry</div><div class="line">    :param exception:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    result = isinstance(exception, (requests.ConnectionError, requests.ReadTimeout))</div><div class="line">    <span class="keyword">if</span> result:</div><div class="line">        print(<span class="string">'Exception'</span>, type(exception), <span class="string">'occurred, retrying...'</span>)</div><div class="line">    <span class="keyword">return</span> result</div></pre></td></tr></table></figure></p>
<p>这里判断了如果是 requests 的 ConnectionError 和 ReadTimeout 异常的话，就会抛出异常进行重试，否则不予重试。  </p>
<p>所以，这样我们就实现了请求的封装和自动重试，是不是非常 Pythonic？  </p>
<p><strong>下载处理器的设计</strong><br>为了下载视频，我们需要设计一个下载处理器来下载已经爬取到的视频链接，所以下载处理器的输入就是一批批的视频链接，下载器接收到这些链接，会将其进行下载处理，并将视频存储到对应的位置，另外也可以完成一些信息存储操作。  </p>
<ul>
<li>在设计时，下载处理器的要求有两个，一个是保证高速的下载，另一个就是可扩展性要强，下面我们分别来针对这两个特点进行设计：<br>高速下载，为了实现高速的下载，要么可以使用多线程或多进程，要么可以用异步下载，很明显，后者是更有优势的。</li>
<li>扩展性强，下载处理器要能下载音频、视频，另外还可以支持数据库等存储，所以为了解耦合，我们可以将视频下载、音频下载、数据库存储的功能独立出来，下载处理器只负责视频链接的主要逻辑处理和分配即可。  </li>
</ul>
<p>为了实现高速下载，这里我们可以使用 aiohttp 库来完成，另外异步下载我们也不能一下子下载太多，不然网络波动太大，所以我们可以设置 batch 式下载，可以避免同时大量的请求和网络拥塞，主要的下载函数如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(self, inputs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    download video or video lists</div><div class="line">    :param data:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> isinstance(inputs, types.GeneratorType):</div><div class="line">        temps = []</div><div class="line">        <span class="keyword">for</span> result <span class="keyword">in</span> inputs:</div><div class="line">            print(<span class="string">'Processing'</span>, result, <span class="string">'...'</span>)</div><div class="line">            temps.append(result)</div><div class="line">            <span class="keyword">if</span> len(temps) == self.batch:</div><div class="line">                self.process_items(temps)</div><div class="line">                temps = []</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        inputs = inputs <span class="keyword">if</span> isinstance(inputs, list) <span class="keyword">else</span> [inputs]</div><div class="line">        self.process_items(inputs)</div></pre></td></tr></table></figure></p>
<p>这个 download 方法设计了多种数据接收类型，可以接收一个生成器，也可以接收单个或列表形式的视频对象数据，接着调用了 process_items 方法进行了异步下载，其方法实现如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_items</span><span class="params">(self, objs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    process items</div><div class="line">    :param objs: objs</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="comment"># define progress bar</span></div><div class="line">    <span class="keyword">with</span> tqdm(total=len(objs)) <span class="keyword">as</span> self.bar:</div><div class="line">        <span class="comment"># init event loop</span></div><div class="line">        loop = asyncio.get_event_loop()</div><div class="line">        <span class="comment"># get num of batches</span></div><div class="line">        total_step = int(math.ceil(len(objs) / self.batch))</div><div class="line">        <span class="comment"># for every batch</span></div><div class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(total_step):</div><div class="line">            start, end = step * self.batch, (step + <span class="number">1</span>) * self.batch</div><div class="line">            print(<span class="string">'Processing %d-%d of files'</span> % (start + <span class="number">1</span>, end))</div><div class="line">            <span class="comment"># get batch of objs</span></div><div class="line">            objs_batch = objs[start: end]</div><div class="line">            <span class="comment"># define tasks and run loop</span></div><div class="line">            tasks = [asyncio.ensure_future(self.process_item(obj)) <span class="keyword">for</span> obj <span class="keyword">in</span> objs_batch]</div><div class="line">            <span class="keyword">for</span> task <span class="keyword">in</span> tasks:</div><div class="line">                task.add_done_callback(self.update_progress)</div><div class="line">            loop.run_until_complete(asyncio.wait(tasks))</div></pre></td></tr></table></figure></p>
<p>这里使用了 asyncio 实现了异步处理，并通过对视频链接进行分批处理保证了流量的稳定性，另外还使用了 tqdm 实现了进度条的显示。  </p>
<p>我们可以看到，真正的处理下载的方法是 process_item，这里面会调用视频下载、音频下载、数据库存储的一些组件来完成处理，由于我们使用了 asyncio 进行了异步处理，所以 process_item 也需要是一个支持异步处理的方法，定义如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, obj)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    process item</div><div class="line">    :param obj: single obj</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> isinstance(obj, Video):</div><div class="line">        print(<span class="string">'Processing'</span>, obj, <span class="string">'...'</span>)</div><div class="line">        <span class="keyword">for</span> handler <span class="keyword">in</span> self.handlers:</div><div class="line">            <span class="keyword">if</span> isinstance(handler, Handler):</div><div class="line">                <span class="keyword">await</span> handler.process(obj)</div></pre></td></tr></table></figure></p>
<p>这里我们可以看到，真正的处理逻辑都在一个个 handler 里面，我们将每个单独的功能进行了抽离，定义成了一个个 Handler，这样可以实现良好的解耦合，如果我们要增加和关闭某些功能，只需要配置不同的 Handler 即可，而不需要去改动代码，这也是设计模式的一个解耦思想，类似工厂模式。  </p>
<p><strong>Handler 的设计</strong><br>刚才我们讲了，Handler 就负责一个个具体功能的实现，比如视频下载、音频下载、数据存储等等，所以我们可以将它们定义成不同的 Handler，而视频下载、音频下载又都是文件下载，所以又可以利用继承的思想设计一个文件下载的 Handler，定义如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join, exists</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> makedirs</div><div class="line"><span class="keyword">from</span> douyin.handlers <span class="keyword">import</span> Handler</div><div class="line"><span class="keyword">from</span> douyin.utils.type <span class="keyword">import</span> mime_to_ext</div><div class="line"><span class="keyword">import</span> aiohttp</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span><span class="params">(Handler)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, folder)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        init save folder</div><div class="line">        :param folder:</div><div class="line">        """</div><div class="line">        super().__init__()</div><div class="line">        self.folder = folder</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> exists(self.folder):</div><div class="line">            makedirs(self.folder)</div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_process</span><span class="params">(self, obj, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        download to file</div><div class="line">        :param url: resource url</div><div class="line">        :param name: save name</div><div class="line">        :param kwargs:</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        print(<span class="string">'Downloading'</span>, obj, <span class="string">'...'</span>)</div><div class="line">        kwargs.update(&#123;<span class="string">'ssl'</span>: <span class="keyword">False</span>&#125;)</div><div class="line">        kwargs.update(&#123;<span class="string">'timeout'</span>: <span class="number">10</span>&#125;)</div><div class="line">        <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</div><div class="line">            <span class="keyword">async</span> <span class="keyword">with</span> session.get(obj.play_url, **kwargs) <span class="keyword">as</span> response:</div><div class="line">                <span class="keyword">if</span> response.status == <span class="number">200</span>:</div><div class="line">                    extension = mime_to_ext(response.headers.get(<span class="string">'Content-Type'</span>))</div><div class="line">                    full_path = join(self.folder, <span class="string">'%s.%s'</span> % (obj.id, extension))</div><div class="line">                    <span class="keyword">with</span> open(full_path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">                        f.write(<span class="keyword">await</span> response.content.read())</div><div class="line">                    print(<span class="string">'Downloaded file to'</span>, full_path)</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    print(<span class="string">'Cannot download %s, response status %s'</span> % (obj.id, response.status))</div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(self, obj, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        process obj</div><div class="line">        :param obj:</div><div class="line">        :param kwargs:</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        <span class="keyword">return</span> <span class="keyword">await</span> self._process(obj, **kwargs)</div></pre></td></tr></table></figure></p>
<p>这里我们还是使用了 aiohttp，因为在下载处理器中需要 Handler 支持异步操作，这里下载的时候就是直接请求了文件链接，然后判断了文件的类型，并完成了文件保存。  </p>
<p>视频下载的 Handler 只需要继承当前的 FileHandler 即可：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> douyin.handlers <span class="keyword">import</span> FileHandler</div><div class="line"><span class="keyword">from</span> douyin.structures <span class="keyword">import</span> Video</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VideoFileHandler</span><span class="params">(FileHandler)</span>:</span></div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(self, obj, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        process video obj</div><div class="line">        :param obj:</div><div class="line">        :param kwargs:</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> isinstance(obj, Video):</div><div class="line">            <span class="keyword">return</span> <span class="keyword">await</span> self._process(obj, **kwargs)</div></pre></td></tr></table></figure></p>
<p>这里其实就是加了类别判断，确保数据类型的一致性，当然音频下载也是一样的。  </p>
<p><strong>异步 MongoDB 存储</strong><br>上面介绍了视频和音频处理的 Handler，另外还有一个存储的 Handler 没有介绍，那就是 MongoDB 存储，平常我们可能习惯使用 PyMongo 来完成存储，但这里我们为了加速，需要支持异步操作，所以这里有一个可以实现异步 MongoDB 存储的库，叫做 Motor，其实使用的方法差不太多，MongoDB 的连接对象不再是 PyMongo 的 MongoClient 了，而是 Motor 的 AsyncIOMotorClient，其他的配置基本类似。  </p>
<p>在存储时使用的是 update_one 方法并开启了 upsert 参数，这样可以做到存在即更新，不存在即插入的功能，保证数据的不重复性。  </p>
<p>整个 MongoDB 存储的 Handler 定义如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> douyin.handlers <span class="keyword">import</span> Handler</div><div class="line"><span class="keyword">from</span> motor.motor_asyncio <span class="keyword">import</span> AsyncIOMotorClient</div><div class="line"><span class="keyword">from</span> douyin.structures <span class="keyword">import</span> *</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoHandler</span><span class="params">(Handler)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, conn_uri=None, db=<span class="string">'douyin'</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        init save folder</div><div class="line">        :param folder:</div><div class="line">        """</div><div class="line">        super().__init__()</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> conn_uri:</div><div class="line">            conn_uri = <span class="string">'localhost'</span></div><div class="line">        self.client = AsyncIOMotorClient(conn_uri)</div><div class="line">        self.db = self.client[db]</div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(self, obj, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        download to file</div><div class="line">        :param url: resource url</div><div class="line">        :param name: save name</div><div class="line">        :param kwargs:</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        collection_name = <span class="string">'default'</span></div><div class="line">        <span class="keyword">if</span> isinstance(obj, Video):</div><div class="line">            collection_name = <span class="string">'videos'</span></div><div class="line">        <span class="keyword">elif</span> isinstance(obj, Music):</div><div class="line">            collection_name = <span class="string">'musics'</span></div><div class="line">        collection = self.db[collection_name]</div><div class="line">        <span class="comment"># save to mongodb</span></div><div class="line">        print(<span class="string">'Saving'</span>, obj, <span class="string">'to mongodb...'</span>)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">await</span> collection.update_one(&#123;<span class="string">'id'</span>: obj.id&#125;, &#123;<span class="string">'$set'</span>: obj.json()&#125;, upsert=<span class="keyword">True</span>):</div><div class="line">            print(<span class="string">'Saved'</span>, obj, <span class="string">'to mongodb successfully'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            print(<span class="string">'Error occurred while saving'</span>, obj)</div></pre></td></tr></table></figure></p>
<p>可以看到我们在类中定义了 AsyncIOMotorClient 对象，并暴露了 conn_uri 连接字符串和 db 数据库名称，可以在声明 MongoHandler 类的时候指定 MongoDB 的链接地址和数据库名。<br>同样的 process 方法，这里使用 await 修饰了 update_one 方法，完成了异步 MongoDB 存储。<br>好，以上便是 douyin 库的所有的关键部分介绍，这部分内容可以帮助大家理解这个库的核心部分实现，另外可能对设计模式、面向对象思维以及一些实用库的使用有一定的帮助。  </p>
<p>参考：<a href="https://github.com/Python3WebSpider/DouYin" target="_blank" rel="external">https://github.com/Python3WebSpider/DouYin</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzI5NDY1MjQzNA==&amp;mid=2247488007&amp;idx=2&amp;sn=476479988cd21e86783c2bd729e0b162&amp;chksm=ec5ecd7adb29446c376cf8b3cdb7925be6759b199c05ba26fefbd029e5ba73a2840ac27edeb3&amp;mpshare=1&amp;scene=1&amp;srcid=1103OLXZhYrY7PEiUvxL57HI#rd" target="_blank" rel="external">不到 10 行代码爬抖音</a>  </p>
<p>附件：<br><a href="https://note.youdao.com/yws/api/personal/file/D319D842BB8C4D6A8F797978C25BC14E?method=download&amp;shareKey=728953d9df759a2ad43fc196e6b27489" target="_blank" rel="external">douyin.py</a><br><a href="https://note.youdao.com/yws/api/personal/file/F075863D139D4644A6D77D564BAD14AA?method=download&amp;shareKey=536691dc6533368dee6579a3b6b7f299" target="_blank" rel="external">Python-3.7.1.tar.xz</a>  </p>
<hr>
<p>本文出自”Jack Wang Blog”：<a href="http://www.yfshare.vip/2018/11/06/Python十行代码爬抖音/">http://www.yfshare.vip/2018/11/06/Python十行代码爬抖音/</a></p>
</div><script type="text/javascript" src="/js/share.js?v=2.0.0" async></script><a data-url="http://www.yfshare.vip/2018/11/06/Python十行代码爬抖音/" data-id="clazk7v5b00dt0wm5grw4ubqw" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Python/">Python</a><a href="/tags/douyin/">douyin</a></div><div class="post-nav"><a href="/2019/01/20/Grafana日志聚合工具Loki/" class="pre">Grafana日志聚合工具Loki</a><a href="/2018/11/04/Python升级/" class="next">Python升级</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'yfshare';
var disqus_identifier = '2018/11/06/Python十行代码爬抖音/';
var disqus_title = 'Python十行代码爬抖音';
var disqus_url = 'http://www.yfshare.vip/2018/11/06/Python十行代码爬抖音/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//yfshare.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Atlassian/">Atlassian</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ELK/">ELK</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jenkins/">Jenkins</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/K8S/">K8S</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Virtualization/">Virtualization</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制系统/">版本控制系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维知识体系/">运维知识体系</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/11/27/解决Prometheus too many open files问题/">解决Prometheus too many open files问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/11/07/部署文件不切片的Minio-Server/">部署文件不切片的Minio-Server</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/10/27/解决Grafana query processing would load too many samples into memory in query exec/">解决Grafana query processing would load too many samples into memory in query exec</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/27/Redis-Sentinel/">Redis-Sentinel</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/05/07/部署nsq/">部署NSQ</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/22/Prometheus监控docker/">Prometheus监控docker</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/14/Grafana展示Prometheus数据/">Grafana展示Prometheus数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/02/Prometheus查询语法/">Prometheus查询语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/17/代理转zabbix proxy/">代理转发zabbix proxy</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/16/Python-读取Mysql生成EXCEL（XLSX）/">Python 读取Mysql生成EXCEL（XLSX）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://yfshare.blog.51cto.com/" title="酱油瓶 博客" target="_blank">酱油瓶 博客</a><ul></ul><a href="https://blog.phplearn.xin/" title="震哥 博客" target="_blank">震哥 博客</a><ul></ul><a href="http://renzhiyuan.blog.51cto.com/" title="任志远Ray 博客" target="_blank">任志远Ray 博客</a><ul></ul><a href="http://www.cnblogs.com/aresxin/" title="欣哥aresxin 博客" target="_blank">欣哥aresxin 博客</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-resources"> 资源站</i></div><ul></ul><a href="http://mirror.symnds.com/distributions/CentOS-vault/" title="Centos镜像站" target="_blank">Centos镜像站</a><ul></ul><a href="http://www.rpmfind.net/" title="rpmfind mirror" target="_blank">rpmfind mirror</a><ul></ul><a href="http://rpm.org/" title="rpm.org" target="_blank">rpm.org</a><ul></ul><a href="http://rpm.pbone.net/" title="rpm search" target="_blank">rpm search</a><ul></ul><a href="http://download.chinaunix.net/" title="chinaunix download" target="_blank">chinaunix download</a><ul></ul><a href="http://www.anquanquan.info/" title="安全圈info" target="_blank">安全圈info</a><ul></ul><a href="http://source.tosimp.net/" title="Tosimp 资源站" target="_blank">Tosimp 资源站</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=371362&auto=1&height=66"></iframe><div class="widget"><div class="widget-title"><i class="fa fa-external-game"> 游戏</i></div><ul></ul><a href="/2048" title="2048小游戏" target="_blank">2048小游戏</a><ul></ul><a href="/tantanqiu" title="变色弹球跳台阶小游戏" target="_blank">变色弹球跳台阶小游戏</a></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//yfshare.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">Jack Wang Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=2.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=2.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=2.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3890bdc1bfaccae9364479b65f36fbd2";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=2.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=2.0.0"></script></div></body></html>